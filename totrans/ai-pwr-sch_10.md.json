["```py\ndef create_boosting_collection(collection_name):\n  basic_signals_aggregation_query = \"\"\"  #1\n  SELECT q.target AS query, c.target AS doc,  #1\n  COUNT(c.target) AS boost  #1\n  FROM signals c LEFT JOIN signals q  #1\n  ON c.query_id = q.query_id  #1\n  WHERE c.type = 'click' AND q.type = 'query'  #1\n  GROUP BY q.target, doc  #1\n  ORDER BY boost DESC  #1\n  \"\"\"\n  collection = engine.get_collection(collection_name)  #2\n  return aggregate_signals(collection, \"basic_signals_boosts\",  #2\n                           basic_signals_aggregation_query)  #2\n\ndef search_for_boosts(query, collection, query_field=\"query\"):  #3\n  boosts_request = {\"query\": query,  #3\n                    \"query_fields\": [query_field],  #3\n                    \"return_fields\": [\"query\", \"doc\", \"boost\"], #3\n                    \"limit\": 20, 3((CO1-16)) #3\n                    \"order_by\": [(\"boost\", \"desc\")]}  #3\n  response = collection.search(**boosts_request)  #3\n  return response[\"docs\"] #3\n\nsignals_boosting_collection = create_boosting_collection(\"signals\")\nquery = \"885909457588\"  #4\nsignals_docs = search_for_boosts(query, signals_boosting_collection, \"doc\") #5\nshow_raw_boosted_queries(signals_docs)  #5\n```", "```py\nRaw Boosted Queries\n\"iPad\" : 1050\n\"ipad\" : 966\n\"Ipad\" : 829\n\"iPad 2\" : 509\n\"ipad 2\" : 347\n\"Ipad2\" : 261\n\"ipad2\" : 238\n\"Ipad 2\" : 213\n\"I pad\" : 203\n\"i pad\" : 133\n\"IPad\" : 77\n\"Apple\" : 76\n\"I pad 2\" : 60\n\"apple ipad\" : 55\n\"Apple iPad\" : 53\n\"ipads\" : 43\n\"tablets\" : 42\n\"apple\" : 41\n\"iPads\" : 38\n\"i pad 2\" : 38\n```", "```py\nnormalized_signals_aggregation_query = \"\"\" \nSELECT LOWER(q.target) AS query, #1\nc.target AS doc, COUNT(c.target) AS boost   #2\nFROM signals c LEFT JOIN signals q ON c.query_id = q.query_id \nWHERE c.type = 'click' AND q.type = 'query' \nGROUP BY LOWER(q.target), doc   #2\nORDER BY boost DESC\n\"\"\" \n\nnormalized_collection = \\ \n  aggregate_signals(signals_collection, \"normalized_signals_boosts\", \n                    normalized_signals_aggregation_query) \n\nquery = \"885909457588\"  #3\nsignals_documents = search_for_boosts(query, normalized_collection, \"doc\") \nshow_raw_boosted_queries(signals_documents)\n```", "```py\nRaw Boosted Queries\n\"ipad\" : 2939\n\"ipad 2\" : 1104\n\"ipad2\" : 540\n\"i pad\" : 341\n\"apple ipad\" : 152\n\"ipads\" : 123\n\"apple\" : 118\n\"i pad 2\" : 99\n\"tablets\" : 67\n\"tablet\" : 61\n\"ipad 1\" : 52\n\"apple ipad 2\" : 27\n\"hp touchpad\" : 26\n\"ipaq\" : 20\n\"i pad2\" : 19\n\"wi\" : 19\n\"apple computers\" : 18\n\"apple i pad\" : 15\n\"ipad 2 16gb\" : 15\n\"samsung galaxy\" : 14\n```", "```py\nsignals_collection = engine.get_collection(\"signals\")\nspam_user = \"u8675309\"\nspam_query = \"star wars\"\nspam_signal_boost_doc_upc = \"45626176\"  #1\n\nsignal_docs = []\nfor num in range(5000):  #2\n  query_id = f\"u8675309_0_{num}\"  #2\n  query_signal = {   #2\n    \"query_id\": query_id,  #2\n    \"user\": spam_user,  #2\n    \"type\": \"query\",  #2\n    \"target\": spam_query,  #2\n    \"signal_time\": datetime.now().strftime(\"%Y-%m-%dT%H:%M:%SZ\"),  #2\n    \"id\": f\"spam_signal_query_{num}\"}  #2\n  click_signal = {   #2\n    \"query_id\": query_id,  #2\n    \"user\": spam_user,  #2\n    \"type\": \"click\",  #2\n    \"target\": spam_signal_boost_doc_upc,  #2\n    \"signal_time\": datetime.now().strftime(\"%Y-%m-%dT%H:%M:%SZ\"),  #2\n    \"id\": f\"spam_signal_click_{num}\"}  #2\n  signal_docs.extend([click_signal, query_signal])  #2\n\nsignals_collection.add_documents(signal_docs)   #2\n\nspam_signals_collection = \\  #3\n  aggregate_signals(signals_collection, \"signals_boosts_with_spam\", #3\n    normalized_signals_aggregation_query)  #3\n```", "```py\ndef boosted_product_search_request(query, collection, boost_field=None):\n  signals_documents = search_for_boosts(query, collection)  #1\n  signals_boosts = create_boosts_query(signals_documents)  #1\n  boosted_request = product_search_request(query)  #2\n  if boost_field:  #2\n    signals_boosts = (boost_field, signals_boosts)  #2\n  boosted_request[\"query_boosts\"] = signals_boosts  #2\n  return boosted_request\n\nquery = '\"star wars\"'\nboosted_request = boosted_product_search_request(query,\n                    spam_signals_collection, \"upc\")\nresponse = products_collection.search(**boosted_request)\ndisplay_product_search(query, response[\"docs\"])\n```", "```py\nanti_spam_aggregation_query = \"\"\" \nSELECT query, doc, COUNT(doc) AS boost FROM ( \n  SELECT c.user unique_user, LOWER(q.target) AS query, c.target AS doc, \n  MAX(c.signal_time) AS boost  #1\n  FROM signals c LEFT JOIN signals q ON c.query_id = q.query_id \n  WHERE c.type = 'click' AND q.type = 'query' \n  **GROUP BY unique_user**, LOWER(q.target), doc)   #2\nGROUP BY query, doc \nORDER BY boost DESC\"\"\" \n\nanti_spam_collection = \\ \n  aggregate_signals(signals_collection, \"signals_boosts_anti_spam\", \n                    anti_spam_aggregation_query)\n```", "```py\nsignals_boost = (1 * sum(click_signals)) +\n                (10 * sum(add_to_cart_signals)) +\n                (25 * sum(purchase_signals))\n```", "```py\nmixed_signal_types_aggregation_query = \"\"\" \nSELECT query, doc, ((1 * click_boost)  **#1\n **+ (10 * add_to_cart_boost) +**  #1\n **(25 * purchase_boost)) AS boost** FROM (  #1\n  SELECT query, doc, \n    **SUM(click) AS click_boost**,  #2\n    **SUM(add_to_cart) AS add_to_cart_boost**,   #2\n    **SUM(purchase) AS purchase_boost** FROM (   #2\n      SELECT lower(q.target) AS query, cap.target AS doc, \n        IF(cap.type = 'click', 1, 0) AS click, \n        IF(cap.type = 'add-to-cart', 1, 0) AS  add_to_cart, \n        IF(cap.type = 'purchase', 1, 0) AS purchase \n      FROM signals cap LEFT JOIN signals q on cap.query_id = q.query_id \n      WHERE (cap.type != 'query' AND q.type = 'query') \n    ) raw_signals \n  GROUP BY query, doc) AS per_type_boosts\"\"\" \n\ntype_weighted_collection = \\ \n    aggregate_signals(signals_collection, \"signals_boosts_weighted_types\", \n                      mixed_signal_types_aggregation_query)**\n```", "```py\npositive_signals = (1 * sum(click_signals)) +\n                   (25 * (purchase_signals)) +\n                   (10 * sum(add_to_cart_signals)) +\n                   (0.025 * sum(seen_doc_signals))\n\nnegative_signals = (-0.025 * sum(skipped_doc_signals)) +\n                   (-20 * sum(remove_from_cart_signals)) +\n                   (-100 * sum(returned_item_signals)) +\n                   (-50 * sum(negative_post_about_item_in_review_signals))\n\ntype_based_signal_weight = positive_signals + negative_signals\n```", "```py\nstarting_weight × 0.5(signal_age / half_life)\n```", "```py\nhalf_life_days = 30 \ntarget_date = '2024-06-01'  #1\n**signal_weight** = 1  #2\n\ntime_decay_aggregation = f\"\"\" \nSELECT query, doc, sum(time_weighted_boost) AS boost FROM ( \n  SELECT user, query, doc, {signal_weight} * #3\n  POW(0.5, (DATEDIFF('{target_date}', signal_time) /  #3\n            {half_life_days}))  #3\n  AS time_weighted_boost FROM ( \n    SELECT c.user AS user, lower(q.target) AS query, c.target AS doc, \n    MAX(c.signal_time) as signal_time  #4\n    FROM signals c LEFT JOIN signals q ON c.query_id = q.query_id \n    WHERE c.type = 'click' AND q.type = 'query' \n          AND c.signal_time <= '{target_date}'    #5\n    GROUP BY c.user, q.target, c.target #4\n  ) AS raw_signals \n) AS time_weighted_signals \nGROUP BY query, doc \nORDER BY boost DESC\"\"\" \n\ntime_weighted_collection = \\ \n    aggregate_signals(signals_collection, \"signals_boosts_time_weighted\", \n                      time_decay_aggregation)\n```", "```py\n\"885909457588\"^966 \"885909457595\"^205 \"885909471812\"^202 \"886111287055\"^109\n\"843404073153\"^73 \"885909457601\"^62 \"635753493559\"^62 \"885909472376\"^61\n\"610839379408\"^29 \"884962753071\"^28\n```", "```py\n\"885909457588\"^966 \"885909457595\"^205 \"885909471812\"^202 \"886111287055\"^109\n\"843404073153\"^73 \"635753493559\"^62 \"885909457601\"^62 \"885909472376\"^61\n\"610839379408\"^29 \"884962753071\"^28 \"635753490879\"^27 \"885909457632\"^26\n\"885909393404\"^26 \"716829772249\"^23 \"821793013776\"^21 \"027242798236\"^15\n\"600603132827\"^14 \"886111271283\"^14 \"722868830062\"^13 \"092636260712\"^13\n```", "```py\nfrom aips.data_loaders import index_time_boosts\n\nboosts_collection = engine.get_collection(\"normalized_signals_boosts\")\ncreate_view_from_collection(boosts_collection,  #1\n                            boosts_collection.name)   #1\n\nboosted_products_collection = \\ \n  engine.get_collection(\"products_with_signals_boosts\") \ncreate_view_from_collection(boosted_products_collection,   #2\n                            boosted_products_collection.name)   #2\n\nboosted_products = index_time_boosts.load_dataframe(  #3\n  boosted_products_collection,  #3\n  boosts_collection)  #3\n\nboosted_products_collection.write(boosted_products) #4\n```", "```py\n{...\n   \"id\": \"885909457588\",\n   \"name\": \"Apple® - iPad® 2 with Wi-Fi - 16GB - Black\"\n   \"signals_boosts\": \"ipad|2939,ipad 2|1104,ipad2|540,i pad|341,apple ipad|\n      152,ipads|123,apple|118,i pad 2|99,tablets|67,...\"\n ...\n }\n```", "```py\ndef get_boosted_search_request(query, boost_field):\n  request = product_search_request(query)\n  request[\"index_time_boost\"] = (boost_field, query)  #1\n  return request\n\nquery = \"ipad\"\nboosted_query = get_boosted_search_request(query, \"signals_boosts\")\nresponse = boosted_products_collection.search(**boosted_query)\ndisplay_product_search(query, response[\"docs\"])\n```"]