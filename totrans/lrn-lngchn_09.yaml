- en: 'Chapter 9\. Deployment: Launching Your AI Application into Production'
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第9章\. 部署：将您的AI应用程序投入生产
- en: So far, we’ve explored the key concepts, ideas, and tools to help you build
    the core functionality of your AI application. You’ve learned how to utilize LangChain
    and LangGraph to generate LLM outputs, index and retrieve data, and enable memory
    and agency.
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 到目前为止，我们已经探讨了帮助您构建AI应用程序核心功能的关键概念、思想和工具。您已经学习了如何利用LangChain和LangGraph生成LLM输出、索引和检索数据，以及启用记忆和代理。
- en: But your application is limited to your local environment, so external users
    can’t access its features yet.
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 但您的应用程序仅限于您的本地环境，因此外部用户还不能访问其功能。
- en: In this chapter, you’ll learn the best practices for deploying your AI application
    into production. We’ll also explore various tools to debug, collaborate, test,
    and monitor your LLM applications.
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，您将学习将您的AI应用程序部署到生产环境中的最佳实践。我们还将探索各种工具来调试、协作、测试和监控您的LLM应用程序。
- en: Let’s get started.
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们开始吧。
- en: Prerequisites
  id: totrans-5
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 前提条件
- en: 'In order to effectively deploy your AI application, you need to utilize various
    services to host your application, store and retrieve data, and monitor your application.
    In the deployment example in this chapter, we will incorporate the following services:'
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
  zh: 为了有效地部署您的AI应用程序，您需要利用各种服务来托管您的应用程序、存储和检索数据，以及监控您的应用程序。在本章的部署示例中，我们将包含以下服务：
- en: Vector store
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: 向量存储
- en: Supabase
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: Supabase
- en: Monitoring and debugging
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: 监控和调试
- en: LangSmith
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: LangSmith
- en: Backend API
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 后端API
- en: LangGraph Platform
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: LangGraph平台
- en: We will dive deeper into each of these components and services and see how to
    adapt them for your use case. But first, let’s install necessary dependencies
    and set up the environment variables.
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将深入了解这些组件和服务，并了解如何根据您的用例进行适配。但首先，让我们安装必要的依赖项并设置环境变量。
- en: If you’d like to follow the example, fork this [LangChain template](https://oreil.ly/brqVm)
    to your GitHub account. This repository contains the full logic of a retrieval
    agent-based AI application.
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您想跟随示例，请将此[LangChain模板](https://oreil.ly/brqVm)分叉到您的GitHub账户。此存储库包含基于检索代理的AI应用程序的完整逻辑。
- en: Install Dependencies
  id: totrans-15
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 安装依赖项
- en: First, follow the instructions in the [*README.md* file](https://oreil.ly/N5eqe)
    to install the project dependencies.
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，按照[*README.md*文件](https://oreil.ly/N5eqe)中的说明安装项目依赖项。
- en: If you’re not using the template, you can install the dependencies individually
    from the respective *pyproject.toml* or *package.json* files.
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您不使用模板，您可以从相应的*pyproject.toml*或*package.json*文件中单独安装依赖项。
- en: 'Second, create a *.env* file and store the following variables:'
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 第二，创建一个 *.env* 文件并存储以下变量：
- en: '[PRE0]'
  id: totrans-19
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: Next, we’ll walk through the process of retrieving the values for each of these
    variables.
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们将逐步介绍检索这些变量值的过程。
- en: Large Language Model
  id: totrans-21
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 大型语言模型
- en: The LLM is responsible for generating the output based on a given query. LangChain
    provides access to popular LLM providers, including OpenAI, Anthropic, Google,
    and Cohere.
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: LLM负责根据给定的查询生成输出。LangChain提供了访问流行的LLM提供商，包括OpenAI、Anthropic、Google和Cohere。
- en: In this deployment example, we’ll utilize OpenAI by retrieving the [API keys](https://oreil.ly/MIpY5),
    as shown in [Figure 9-1](#ch09_figure_1_1736545675498459). Once you’ve retrieved
    your API keys, input the value as `OPENAI_API_KEY` in your *.env* file.
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: 在本部署示例中，我们将通过检索[API密钥](https://oreil.ly/MIpY5)来利用OpenAI，如图9-1所示。一旦您检索到您的API密钥，请在您的*.env*文件中将值输入为`OPENAI_API_KEY`。
- en: '![A screenshot of a computer  Description automatically generated](assets/lelc_0901.png)'
  id: totrans-24
  prefs: []
  type: TYPE_IMG
  zh: '![计算机截图  自动生成的描述](assets/lelc_0901.png)'
- en: Figure 9-1\. OpenAI API keys dashboard
  id: totrans-25
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图9-1\. OpenAI API密钥仪表板
- en: Vector Store
  id: totrans-26
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 向量存储
- en: As discussed in previous chapters, a vector store is a special database responsible
    for storing and managing vector representations of your data—in other words, embeddings.
    A vector store enables similarity search and context retrieval to help the LLM
    generate accurate answers based on the user’s query.
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: 如前几章所述，向量存储是一个特殊的数据库，负责存储和管理您数据的向量表示——换句话说，嵌入。向量存储使相似性搜索和上下文检索成为可能，以帮助LLM根据用户的查询生成准确的答案。
- en: For our deployment, we’ll use Supabase—a PostgreSQL database—as the vector store.
    Supabase utilizes the `pgvector` extension to store embeddings and query vectors
    for similarity search.
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: 对于我们的部署，我们将使用Supabase——一个PostgreSQL数据库——作为向量存储。Supabase使用`pgvector`扩展来存储嵌入和查询向量以进行相似性搜索。
- en: If you haven’t yet done it, create a [Supabase account](https://oreil.ly/CXDsx).
    Once you’ve created an account, click “New project” on the dashboard page. Follow
    the steps and save the database password after creating it, as shown in [Figure 9-2](#ch09_figure_2_1736545675498492).
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您还没有这样做，请创建一个[Supabase账户](https://oreil.ly/CXDsx)。一旦您创建了账户，点击仪表板页面上的“新建项目”。按照步骤操作，并在创建后保存数据库密码，如图[图9-2](#ch09_figure_2_1736545675498492)所示。
- en: '![A screenshot of a computer  Description automatically generated](assets/lelc_0902.png)'
  id: totrans-30
  prefs: []
  type: TYPE_IMG
  zh: '![计算机屏幕截图  自动生成的描述](assets/lelc_0902.png)'
- en: Figure 9-2\. Supabase project creation dashboard
  id: totrans-31
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图9-2. Supabase项目创建仪表板
- en: Once your Supabase project is created, navigate to the Project Settings tab
    and select API under Configuration. Under this new tab, you will see Project URL
    and Project API keys.
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦您的Supabase项目创建完成，导航到项目设置选项卡，并在配置下选择API。在这个新标签页下，您将看到项目URL和项目API密钥。
- en: In your *.env* file, copy and paste the Project URL as the value to `SUPABASE_URL`
    and the `service_role` secret API key as the value to `SUPABASE_SERVICE_ROLE_KEY`.
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: 在您的*.env*文件中，将项目URL复制并粘贴到`SUPABASE_URL`的值，将`service_role`秘密API密钥作为`SUPABASE_SERVICE_ROLE_KEY`的值。
- en: 'Navigate to the SQL editor in the Supabase menu and run the following SQL scripts.
    First, let’s enable `pgvector`:'
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: 在Supabase菜单中导航到SQL编辑器，并运行以下SQL脚本。首先，让我们启用`pgvector`：
- en: '[PRE1]'
  id: totrans-35
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: 'Now create a table called `documents` to store vectors of your data:'
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: 现在创建一个名为`documents`的表来存储您数据中的向量：
- en: '[PRE2]'
  id: totrans-37
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: You should now see the `documents` table in the Supabase database.
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，你应该能在Supabase数据库中看到`documents`表。
- en: 'Now you can create a script to generate the embeddings of your data, store
    them, and query from the database. Open the Supabase SQL editor again and run
    the following script:'
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，您可以创建一个脚本来生成您数据的嵌入，存储它们，并从数据库中进行查询。再次打开Supabase SQL编辑器，并运行以下脚本：
- en: '[PRE3]'
  id: totrans-40
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'The `match_documents` database function takes a `query_embedding` vector and
    compares it to embeddings in the `documents` table using cosine similarity. It
    calculates a similarity score for each document (1 - (`documents.embedding` <=>
    `query_embedding`)), then returns the most similar matches. The results are:'
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: '`match_documents` 数据库函数接受一个 `query_embedding` 向量，并使用余弦相似度将其与 `documents` 表中的嵌入进行比较。它为每个文档计算一个相似度分数（1
    - (`documents.embedding` <=> `query_embedding`))，然后返回最相似的匹配项。结果如下：'
- en: Filtered first by the metadata criteria specified in the filter argument (using
    JSON containment @>).
  id: totrans-42
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 首先根据过滤器参数中指定的元数据标准进行过滤（使用JSON包含@>）。
- en: Ordered by similarity score (highest first).
  id: totrans-43
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 按相似度分数排序（从高到低）。
- en: Limited to the number of matches specified in `match_count`.
  id: totrans-44
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 限制在`match_count`中指定的匹配数量。
- en: 'Once the vector similarity function is generated, you can use Supabase as a
    vector store by importing the class and providing the necessary parameters. Here’s
    an example of how it works:'
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦生成了向量相似度函数，您可以通过导入类并提供必要的参数将Supabase用作向量存储。以下是如何工作的一个示例：
- en: '*Python*'
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: '*Python*'
- en: '[PRE4]'
  id: totrans-47
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: '*JavaScript*'
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: '*JavaScript*'
- en: '[PRE5]'
  id: totrans-49
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: '*The output:*'
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: '*输出：*'
- en: '[PRE6]'
  id: totrans-51
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: You can review the full logic of the Supabase vector store implementation in
    the Github LangChain template mentioned previously.
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以在之前提到的Github LangChain模板中查看Supabase向量存储实现的完整逻辑。
- en: Backend API
  id: totrans-53
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 后端API
- en: As discussed in previous chapters, LangGraph is a low-level open source framework
    used to build complex agentic systems powered by LLMs. LangGraph enables fine-grained
    control over the flow and state of your application, built-in persistence, and
    advanced human-in-the-loop and memory features. [Figure 9-3](#ch09_figure_3_1736545675498514)
    illustrates LangGraph’s control flow.
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: 如前几章所述，LangGraph是一个用于构建由LLMs驱动的复杂智能系统的低级开源框架。LangGraph允许您对应用程序的流程和状态进行细粒度控制，内置持久性，以及高级人机交互和记忆功能。[图9-3](#ch09_figure_3_1736545675498514)展示了LangGraph的控制流。
- en: '![A diagram of a software flowchart  Description automatically generated](assets/lelc_0903.png)'
  id: totrans-55
  prefs: []
  type: TYPE_IMG
  zh: '![软件流程图  自动生成的描述](assets/lelc_0903.png)'
- en: Figure 9-3\. Example of LangGraph API control flow
  id: totrans-56
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图9-3. LangGraph API控制流示例
- en: To deploy an AI application that utilizes LangGraph, we will use LangGraph Platform.
    LangGraph Platform is a managed service for deploying and hosting LangGraph agents
    at scale.
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: 要部署一个利用LangGraph的AI应用程序，我们将使用LangGraph平台。LangGraph平台是一个托管服务，用于大规模部署和托管LangGraph代理。
- en: As your agentic use case gains traction, uneven task distribution among agents
    can overload the system, leading to downtime. LangGraph Platform manages horizontally
    scaling task queues, servers, and a robust Postgres checkpointer to handle many
    concurrent users and efficiently store large states and threads. This ensures
    fault-tolerant scalability.
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: 随着你的代理用例获得关注，代理之间不均匀的任务分配可能导致系统过载，从而导致停机。LangGraph 平台管理水平扩展的任务队列、服务器和一个强大的 Postgres
    检查点，以处理许多并发用户并有效地存储大型状态和线程。这确保了容错可伸缩性。
- en: 'LangGraph Platform is designed to support real-world interaction patterns.
    In addition to streaming and human-in-the-loop features, LangGraph Platform enables
    the following:'
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: LangGraph 平台旨在支持现实世界的交互模式。除了流式传输和人工干预功能外，LangGraph 平台还支持以下功能：
- en: Double textingto handle new user inputs on ongoing graph threads
  id: totrans-60
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 双重文本处理以处理持续图线程上的新用户输入
- en: Asynchronous background jobs for long-running tasks
  id: totrans-61
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 异步后台作业用于处理长时间运行的任务
- en: Cron jobs for running common tasks on a schedule
  id: totrans-62
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Cron 作业用于按计划运行常见任务
- en: LangGraph Platform also provides an integrated solution for collaborating on,
    deploying, and monitoring agentic AI applications. It includes [LangGraph Studio](https://oreil.ly/2Now-)—a
    visual playground for debugging, editing, and testing agents. LangGraph Studio
    also enables you to share your LangGraph agent with team members for collaborative
    feedback and rapid iteration, as [Figure 9-4](#ch09_figure_4_1736545675498542)
    shows.
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: LangGraph 平台还提供了一种集成解决方案，用于协作、部署和监控代理 AI 应用程序。它包括 [LangGraph Studio](https://oreil.ly/2Now-)——一个用于调试、编辑和测试代理的可视化游乐场。LangGraph
    Studio 还允许你与团队成员共享你的 LangGraph 代理，以获得协作反馈和快速迭代，如图 [图 9-4](#ch09_figure_4_1736545675498542)
    所示。
- en: '![Screens screenshot of a computer  Description automatically generated](assets/lelc_0904.png)'
  id: totrans-64
  prefs: []
  type: TYPE_IMG
  zh: '![计算机屏幕截图，自动生成描述](assets/lelc_0904.png)'
- en: Figure 9-4\. Snapshot of LangGraph Studio UI
  id: totrans-65
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图 9-4\. LangGraph Studio UI 快照
- en: Additionally, LangGraph Platform simplifies agentic deployment by enabling one-click
    submissions.
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: 此外，LangGraph 平台通过实现一键提交，简化了代理部署。
- en: Create a LangSmith Account
  id: totrans-67
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 创建 LangSmith 账户
- en: LangSmith is an all-in-one developer platform that enables you to debug, collaborate,
    test, and monitor your LLM applications. LangGraph Platform is seamlessly integrated
    with LangSmith and is accessible from within the LangSmith UI.
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: LangSmith 是一个一站式开发者平台，它使你能够调试、协作、测试和监控你的 LLM 应用程序。LangGraph 平台与 LangSmith 无缝集成，并可在
    LangSmith UI 中访问。
- en: To deploy your application on LangGraph Platform, you need to create a [LangSmith
    account](https://oreil.ly/2WVCn). Once you’re logged in to the dashboard, navigate
    to the Settings page, then scroll to the API Keys section and click Create API
    Key. You should see a UI similar to [Figure 9-5](#ch09_figure_5_1736545675498579).
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: 要在 LangGraph 平台上部署你的应用程序，你需要创建一个 [LangSmith 账户](https://oreil.ly/2WVCn)。登录仪表板后，导航到设置页面，然后滚动到
    API 密钥部分并点击创建 API 密钥。你应该看到一个类似于 [图 9-5](#ch09_figure_5_1736545675498579) 的用户界面。
- en: '![A screenshot of a application  Description automatically generated](assets/lelc_0905.png)'
  id: totrans-70
  prefs: []
  type: TYPE_IMG
  zh: '![应用程序截图，自动生成描述](assets/lelc_0905.png)'
- en: Figure 9-5\. Create LangSmith API Key UI
  id: totrans-71
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图 9-5\. 创建 LangSmith API 密钥 UI
- en: Copy the API Key value as your `LANGCHAIN_API_KEY` in your *.env* file.
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: 将 API 密钥值复制到你的 *.env* 文件中的 `LANGCHAIN_API_KEY`。
- en: Navigate to “Usage and billing” and set up your billing details. Then click
    the “Plans and Billings” tab and the “Upgrade to Plus” button to get instructions
    on transitioning to a LangSmith Plus plan, which will enable LangGraph Platform
    usage. If you’d prefer to use a free self-hosted deployment, you can follow the
    [instructions here](https://oreil.ly/TBgSQ). Please note that this option requires
    management of the infrastructure, including setting up and maintaining required
    databases and Redis instances.
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: 导航到“使用和计费”并设置你的计费详情。然后点击“计划和计费”选项卡和“升级到 Plus”按钮，以获取过渡到 LangSmith Plus 计划的说明，这将启用
    LangGraph 平台的使用。如果你更喜欢使用免费的自行托管部署，可以按照 [此处说明](https://oreil.ly/TBgSQ) 进行操作。请注意，此选项需要管理基础设施，包括设置和维护所需的数据库和
    Redis 实例。
- en: Understanding the LangGraph Platform API
  id: totrans-74
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 理解 LangGraph 平台 API
- en: Before deploying your AI application on LangGraph Platform, it’s important to
    understand how each component of the LangGraph API works. These components can
    generally be split into data models and features.
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: 在 LangGraph 平台上部署你的 AI 应用程序之前，了解 LangGraph API 的每个组件如何工作非常重要。这些组件通常可以分为数据模型和功能。
- en: Data Models
  id: totrans-76
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 数据模型
- en: 'The LangGraph Platform API consists of a few core data models:'
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: LangGraph 平台 API 包含几个核心数据模型：
- en: Assistants
  id: totrans-78
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 助手
- en: Threads
  id: totrans-79
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 线程
- en: Runs
  id: totrans-80
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 运行
- en: Cron jobs
  id: totrans-81
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 定时任务
- en: Assistants
  id: totrans-82
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 助手
- en: An *assistant* is a configured instance of a `CompiledGraph`. It abstracts the
    cognitive architecture of the graph and contains instance-specific configuration
    and metadata. Multiple assistants can reference the same graph but can contain
    different configuration and metadata—which may differentiate the behavior of the
    assistants. An assistant (that is, the graph) is invoked as part of a run.
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: 一个*助手*是`CompiledGraph`的配置实例。它抽象了图的认知架构，并包含实例特定的配置和元数据。多个助手可以引用相同的图，但可以包含不同的配置和元数据——这可能会区分助手的操作。助手（即图）作为运行的一部分被调用。
- en: The LangGraph Platform API provides several endpoints for creating and managing
    assistants.
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: LangGraph平台API提供了一些端点用于创建和管理助手。
- en: Threads
  id: totrans-85
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 线程
- en: A *thread* contains the accumulated state of a group of runs. If a run is executed
    on a thread, then the state of the underlying graph of the assistant will be persisted
    to the thread. A thread’s current and historical state can be retrieved. To persist
    state, a thread must be created prior to executing a run. The state of a thread
    at a particular point in time is called a *checkpoint*.
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: 一个*线程*包含了一组运行的累积状态。如果一个运行在一个线程上执行，那么助手的底层图的状态将被持久化到线程中。可以检索线程的当前和历史状态。为了持久化状态，必须在执行运行之前创建线程。特定时间点的线程状态称为*检查点*。
- en: The LangGraph Platform API provides several endpoints for creating and managing
    threads and thread state.
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: LangGraph平台API提供了一些端点用于创建和管理线程及其状态。
- en: Runs
  id: totrans-88
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 运行
- en: A *run* is an invocation of an assistant. Each run may have its own input, configuration,
    and metadata—which may affect the execution and output of the underlying graph.
    A run can optionally be executed on a thread.
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: 一个*运行*是对助手的调用。每个运行可能有自己的输入、配置和元数据——这可能会影响底层图的执行和输出。运行可以选择在线程上执行。
- en: The LangGraph Platform API provides several endpoints for creating and managing
    runs.
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: LangGraph平台API提供了一些端点用于创建和管理运行。
- en: Cron jobs
  id: totrans-91
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 定时任务
- en: LangGraph Platform supports *cron jobs*, which enable graphs to be run on a
    user-defined schedule. The user specifies a schedule, an assistant, and an input.
    Then LangGraph Platform creates a new thread with the specified assistant and
    sends the specified input to that thread.
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
  zh: LangGraph平台支持*定时任务*，这允许图按照用户定义的日程运行。用户指定一个日程、一个助手和一个输入。然后LangGraph平台创建一个新的线程，并使用指定的助手将指定的输入发送到该线程。
- en: Features
  id: totrans-93
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 功能
- en: 'The LangGraph Platform API also offers several features to support complex
    agent architectures, including the following:'
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: LangGraph平台API还提供了一些支持复杂代理架构的功能，包括以下内容：
- en: Streaming
  id: totrans-95
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 流式传输
- en: Human-in-the-loop
  id: totrans-96
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 人工介入
- en: Double texting
  id: totrans-97
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 双重发送
- en: Stateless runs
  id: totrans-98
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 无状态运行
- en: Webhooks
  id: totrans-99
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Webhooks
- en: Streaming
  id: totrans-100
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 流式传输
- en: 'Streaming is critical for ensuring that LLM applications feel responsive to
    end users. When creating a streaming run, the streaming mode determines what data
    is streamed back to the API client. The LangGraph Platform API supports five streaming
    modes:'
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: 流式传输对于确保LLM应用对最终用户感觉响应至关重要。在创建流式传输运行时，流式传输模式决定了哪些数据被流式传输回API客户端。LangGraph平台API支持五种流式传输模式：
- en: Values
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: 值
- en: Stream the full state of the graph after each super-step is executed.
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: 在每个超级步骤执行后流式传输图的完整状态。
- en: Messages
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: 消息
- en: Stream complete messages (at the end of node execution) as well as tokens for
    any messages generated inside a node. This mode is primarily meant for powering
    chat applications. This is only an option if your graph contains a `messages`
    key.
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
  zh: 流式传输完整的消息（节点执行结束时）以及节点内部生成的任何消息的令牌。此模式主要用于支持聊天应用。这仅在你图包含`messages`键时才是一个选项。
- en: Updates
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
  zh: 更新
- en: Stream updates to the state of the graph after each node is executed.
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: 在每个节点执行后流式传输图的状态更新。
- en: Events
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: 事件
- en: Stream all events (including the state of the graph) that occur during graph
    execution. This can be used to do token-by-token streaming for LLMs.
  id: totrans-109
  prefs: []
  type: TYPE_NORMAL
  zh: 流式传输图执行期间发生的所有事件（包括图的状态）。这可以用于为LLM进行按令牌流式传输。
- en: Debug
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
  zh: 调试
- en: Stream debug events throughout graph execution.
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: 在图执行过程中流式传输调试事件。
- en: Human-in-the-loop
  id: totrans-112
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 人工介入
- en: If left to run autonomously, a complex agent can take unintended actions, leading
    to catastrophic application outcomes. To prevent this, human intervention is recommended,
    especially at checkpoints where application logic involves invoking certain tools
    or accessing specific documents. LangGraph Platform enables you to insert this
    human-in-the-loop behavior to ensure your graph doesn’t have undesired outcomes.
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: 如果让其自主运行，复杂的代理可能会采取意外的行动，导致灾难性的应用程序结果。为了防止这种情况，建议进行人工干预，尤其是在涉及调用某些工具或访问特定文档的应用程序逻辑检查点处。LangGraph
    平台使你能够插入这种人工干预行为，以确保你的图不会产生不希望的结果。
- en: Double texting
  id: totrans-114
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 双重短信
- en: 'Graph execution may take longer than expected, and often users may send one
    message and then, before the graph has finished running, send a second message.
    This is known as *double texting*. For example, a user might notice a typo in
    their original request and edit the prompt and resend it. In such scenarios, it’s
    important to prevent your graphs from behaving in unexpected ways and ensure a
    smooth user experience. LangGraph Platform provides four different solutions to
    handle double texting:'
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
  zh: 图执行可能比预期更长，并且用户可能会发送一条消息，然后在图运行完成之前再发送第二条消息。这被称为*双重短信*。例如，用户可能会注意到他们原始请求中的一个错误，并编辑提示并重新发送。在这种情况下，防止你的图以意外的方式行为并确保良好的用户体验非常重要。LangGraph
    平台提供了四种不同的解决方案来处理双重短信：
- en: Reject
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: 拒绝
- en: This rejects any follow-up runs and does not allow double texting.
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
  zh: 这将拒绝任何后续运行，并且不允许双重短信。
- en: Enqueue
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: 入队
- en: This option continues the first run until it completes the whole run, then sends
    the new input as a separate run.
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
  zh: 此选项将继续第一次运行，直到它完成整个运行，然后发送新的输入作为单独的运行。
- en: Interrupt
  id: totrans-120
  prefs: []
  type: TYPE_NORMAL
  zh: 中断
- en: This option interrupts the current execution but saves all the work done up
    until that point. It then inserts the user input and continues from there. If
    you enable this option, your graph should be able to handle weird edge cases that
    may arise.
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
  zh: 此选项中断当前执行但保存到该点为止所做的所有工作。然后插入用户输入并从那里继续。如果你启用此选项，你的图应该能够处理可能出现的奇怪边缘情况。
- en: Rollback
  id: totrans-122
  prefs: []
  type: TYPE_NORMAL
  zh: 回滚
- en: This option rolls back all work done up until that point. It then sends the
    user input in—as if it just followed the original run input.
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
  zh: 此选项回滚到该点为止所做的所有工作。然后发送用户输入，就像它刚刚跟随原始运行输入一样。
- en: Stateless runs
  id: totrans-124
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 无状态运行
- en: 'All runs use the built-in checkpointer to store checkpoints for runs. However,
    it can often be useful to just kick off a run without worrying about explicitly
    creating a thread and keeping those checkpointers around. *Stateless* runs allow
    you to do this by exposing an endpoint that does these things:'
  id: totrans-125
  prefs: []
  type: TYPE_NORMAL
  zh: 所有运行都使用内置的检查点器来存储运行的检查点。然而，有时只需启动一个运行而不必担心显式创建线程并保留这些检查点器可能非常有用。*无状态*运行允许你通过暴露一个端点来完成这些事情：
- en: Takes in user input
  id: totrans-126
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 接收用户输入
- en: Creates a thread
  id: totrans-127
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 创建线程
- en: Runs the agent, but skips all checkpointing steps
  id: totrans-128
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 运行代理，但跳过所有检查点步骤
- en: Cleans up the thread afterwards
  id: totrans-129
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 之后清理线程
- en: Stateless runs are retried while keeping memory intact. However, in the case
    of stateless background runs, if the task worker dies halfway, the entire run
    will be retried from scratch.
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: 无状态运行会在保持内存完整的情况下重试。然而，在无状态后台运行的情况下，如果任务工作进程在中间死亡，整个运行将从头开始重试。
- en: Webhooks
  id: totrans-131
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: Webhooks
- en: LangGraph Platform also supports completion *webhooks*. A webhook URL is provided,
    which notifies your application whenever a run completes.
  id: totrans-132
  prefs: []
  type: TYPE_NORMAL
  zh: LangGraph 平台还支持完成 *webhooks*。提供一个 webhook URL，当运行完成时通知你的应用程序。
- en: Deploying Your AI Application on LangGraph Platform
  id: totrans-133
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 在 LangGraph 平台上部署您的 AI 应用程序
- en: At this point, you have created accounts for the recommended services, filled
    in your *.env* file with values of all necessary environment variables, and completed
    the core logic for your AI application. Next, we will take the necessary steps
    to effectively deploy your application.
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
  zh: 到目前为止，你已经为推荐的服务创建了账户，在你的 *.env* 文件中填写了所有必要的环境变量的值，并完成了你的 AI 应用程序的核心逻辑。接下来，我们将采取必要的步骤来有效地部署你的应用程序。
- en: Create a LangGraph API Config
  id: totrans-135
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 创建 LangGraph API 配置
- en: 'Prior to deployment, you need to configure your application with a [LangGraph
    API configuration file called *langgraph.json*](https://oreil.ly/aVDhd). Here’s
    an example of what the file looks like in a Python repository:'
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: 在部署之前，你需要使用一个名为 [LangGraph API 配置文件 *langgraph.json*](https://oreil.ly/aVDhd)
    来配置你的应用程序。以下是在 Python 仓库中该文件的一个示例：
- en: '*Python*'
  id: totrans-137
  prefs: []
  type: TYPE_NORMAL
  zh: '*Python*'
- en: '[PRE7]'
  id: totrans-138
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: 'And here’s an example repository structure:'
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
  zh: 以下是一个示例仓库结构：
- en: '[PRE8]'
  id: totrans-140
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: Note that the *langgraph.json* file is placed on the same level or higher than
    the files that contain compiled graphs and associated dependencies.
  id: totrans-141
  prefs: []
  type: TYPE_NORMAL
  zh: 注意，*langgraph.json* 文件放置在与包含编译后的图和关联依赖项的文件相同的级别或更高。
- en: In addition, the dependencies are specified in a *requirements.txt* file. But
    they can also be specified in *pyproject.toml*, *setup.py*, or *package.json*
    files.
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
  zh: 此外，依赖项在 *requirements.txt* 文件中指定。但它们也可以在 *pyproject.toml*、*setup.py* 或 *package.json*
    文件中指定。
- en: 'Here’s what each of the properties mean:'
  id: totrans-143
  prefs: []
  type: TYPE_NORMAL
  zh: 这里是每个属性的含义：
- en: Dependencies
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
  zh: 依赖项
- en: Array of dependencies for LangGraph Platform API server
  id: totrans-145
  prefs: []
  type: TYPE_NORMAL
  zh: LangGraph 平台 API 服务器依赖项数组
- en: Graphs
  id: totrans-146
  prefs: []
  type: TYPE_NORMAL
  zh: 图
- en: Mapping from graph ID to path where the compiled graph or a function that makes
    a graph is defined
  id: totrans-147
  prefs: []
  type: TYPE_NORMAL
  zh: 从图 ID 到定义编译后的图或创建图的函数的路径的映射
- en: Env
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
  zh: 环境
- en: Path to your *.env* file or a mapping from environment variable to its value
    (you can learn more about configurations for the `langgraph.json` file [here](https://oreil.ly/bPA0W))
  id: totrans-149
  prefs: []
  type: TYPE_NORMAL
  zh: 到你的 *.env* 文件或环境变量到其值的映射（你可以在[这里](https://oreil.ly/bPA0W)了解更多关于 `langgraph.json`
    文件配置的信息）
- en: Test Your LangGraph App Locally
  id: totrans-150
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 本地测试 LangGraph 应用
- en: Testing your application locally ensures that there are no errors or dependency
    conflicts prior to deployment. To do this, we will utilize the LangGraph CLI,
    which includes commands to run a local development server with hot reloading and
    debugging capabilities.
  id: totrans-151
  prefs: []
  type: TYPE_NORMAL
  zh: 在部署之前在本地测试你的应用程序确保没有错误或依赖项冲突。为此，我们将利用 LangGraph CLI，它包括运行具有热重载和调试功能的本地开发服务器的命令。
- en: 'For Python, install the Python `langgraph-cli` package (note: this requires
    Python 3.11 or higher):'
  id: totrans-152
  prefs: []
  type: TYPE_NORMAL
  zh: 对于 Python，安装 Python `langgraph-cli` 包（注意：这需要 Python 3.11 或更高版本）：
- en: '[PRE9]'
  id: totrans-153
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: 'Or for JavaScript, install the package as follows:'
  id: totrans-154
  prefs: []
  type: TYPE_NORMAL
  zh: 或者对于 JavaScript，按照以下方式安装包：
- en: '[PRE10]'
  id: totrans-155
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: 'Once the CLI is installed, run the following command to start the API:'
  id: totrans-156
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦 CLI 安装完成，运行以下命令以启动 API：
- en: '[PRE11]'
  id: totrans-157
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: 'This will start up the LangGraph API server locally. If this runs successfully,
    you should see something like this:'
  id: totrans-158
  prefs: []
  type: TYPE_NORMAL
  zh: 这将启动 LangGraph API 服务器本地。如果运行成功，你应该看到类似以下内容：
- en: '[PRE12]'
  id: totrans-159
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: The LangGraph Platform API reference is available with each deployment at the
    */docs* URL path (*http://localhost:2024/docs*).
  id: totrans-160
  prefs: []
  type: TYPE_NORMAL
  zh: LangGraph 平台 API 参考文档在每个部署的 */docs* 路径下可用 (*http://localhost:2024/docs*)。
- en: 'The easiest way to interact with your local API server is to use the auto-launched
    LangGraph Studio UI. Alternatively, you can interact with the local API server
    using cURL, as seen in this example:'
  id: totrans-161
  prefs: []
  type: TYPE_NORMAL
  zh: 与本地 API 服务器交互的最简单方法是使用自动启动的 LangGraph Studio UI。或者，你可以像这个示例中那样使用 cURL 与本地 API
    服务器交互：
- en: '[PRE13]'
  id: totrans-162
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: If you receive a valid response, your application is functioning well. Next,
    we can interact with the server using the LangGraph SDK.
  id: totrans-163
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你收到一个有效的响应，那么你的应用程序运行良好。接下来，我们可以使用 LangGraph SDK 与服务器交互。
- en: 'Here’s an example both initializing the SDK client and invoking the graph:'
  id: totrans-164
  prefs: []
  type: TYPE_NORMAL
  zh: 这里有一个初始化 SDK 客户端和调用图的示例：
- en: '*Python*'
  id: totrans-165
  prefs: []
  type: TYPE_NORMAL
  zh: '*Python*'
- en: '[PRE14]'
  id: totrans-166
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: '*JavaScript*'
  id: totrans-167
  prefs: []
  type: TYPE_NORMAL
  zh: '*JavaScript*'
- en: '[PRE15]'
  id: totrans-168
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: If your LangGraph application is working correctly, you should see your graph
    output displayed in the console.
  id: totrans-169
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你的 LangGraph 应用程序运行正确，你应该在控制台看到你的图输出。
- en: Deploy from the LangSmith UI
  id: totrans-170
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 从 LangSmith UI 部署
- en: At this point, you should have completed all prerequisite steps and your LangGraph
    API should be working locally. Your next step is to navigate to your LangSmith
    dashboard panel and click the Deployments tab. You should see a UI similar to
    [Figure 9-6](#ch09_figure_6_1736545675498598).
  id: totrans-171
  prefs: []
  type: TYPE_NORMAL
  zh: 到目前为止，你应该已经完成了所有先决步骤，并且你的 LangGraph API 应该在本地运行。你的下一步是导航到你的 LangSmith 控制面板并点击部署选项卡。你应该看到一个类似于
    [图 9-6](#ch09_figure_6_1736545675498598) 的用户界面。
- en: '![A screenshot of a computer  Description automatically generated](assets/lelc_0906.png)'
  id: totrans-172
  prefs: []
  type: TYPE_IMG
  zh: '![计算机屏幕截图 自动生成描述](assets/lelc_0906.png)'
- en: Figure 9-6\. LangGraph Platform deployment UI page
  id: totrans-173
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图 9-6\. LangGraph 平台部署用户界面页面
- en: Next, click the New Deployment button in the top right corner of the page.
  id: totrans-174
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，点击页面右上角的“新建部署”按钮。
- en: Note
  id: totrans-175
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 注意
- en: If you don’t see a page with the New Deployment button, it’s likely that you
    haven’t yet upgraded to a LangSmith Plus plan according to the instructions in
    the “Usage and billing” setting.
  id: totrans-176
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你没有看到带有“新建部署”按钮的页面，那么很可能是你还没有根据“使用和计费”设置中的说明升级到 LangSmith Plus 计划。
- en: You should now see a page of three form fields to complete.
  id: totrans-177
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，你应该会看到一个包含三个表单字段的页面来完成。
- en: Deployment details
  id: totrans-178
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 部署详情
- en: Select “Import with GitHub” and follow the GitHub OAuth workflow to install
    and authorize LangChain’s hosted-langserve GitHub app to access the selected repositories.
    After installation is complete, return to the Create New Deployment panel and
    select the GitHub repository to deploy from the drop-down menu.
  id: totrans-179
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择“通过 GitHub 导入”并遵循 GitHub OAuth 工作流程来安装和授权 LangChain 的托管 langserve GitHub 应用程序以访问所选存储库。安装完成后，返回“创建新部署”面板，并从下拉菜单中选择要部署的
    GitHub 仓库。
- en: Specify a name for the deployment and the full path to the LangGraph API config
    file, including the filename. For example, if the file *langgraph.json* is in
    the root of the repository, simply specify*langgraph.json*.
  id: totrans-180
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 为部署指定一个名称和 LangGraph API 配置文件的完整路径，包括文件名。例如，如果文件 *langgraph.json* 在存储库的根目录中，只需指定
    *langgraph.json*。
- en: Specify the desired `git` reference (branch name) of your repository to deploy.
  id: totrans-181
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 指定您要部署的存储库的所需 `git` 引用（分支名称）。
- en: Development type
  id: totrans-182
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 开发类型
- en: Select Production from the dropdown. This will enable a production deployment
    that can serve up to 500 requests/second and is provisioned with highly available
    storage and automatic backups.
  id: totrans-183
  prefs: []
  type: TYPE_NORMAL
  zh: 从下拉菜单中选择生产环境。这将启用一个可以每秒处理高达 500 个请求的生产部署，并配备了高可用存储和自动备份。
- en: Environment variables
  id: totrans-184
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 环境变量
- en: Provide the properties and values in your *.env* here. For sensitive values,
    like your `OPENAI_API_KEY`, make sure to tick the Secret box before inputting
    the value.
  id: totrans-185
  prefs: []
  type: TYPE_NORMAL
  zh: 在此处提供 *.env* 中的属性和值。对于敏感值，如您的 `OPENAI_API_KEY`，在输入值之前确保勾选“秘密”框。
- en: Once you’ve completed the fields, click the button to submit the deployment
    and wait for a few seconds for the build to complete. You should see a new revision
    associated with the deployment.
  id: totrans-186
  prefs: []
  type: TYPE_NORMAL
  zh: 完成字段后，点击按钮提交部署，并等待几秒钟以完成构建。您应该会看到一个与部署相关的新版本。
- en: Since LangGraph Platform is integrated within LangSmith, you can gain deeper
    visibility into your app and track and monitor usage, errors, performance, and
    costs in production too. [Figure 9-7](#ch09_figure_7_1736545675498618) shows a
    visual Trace Count summary chart showing successful, pending, and error traces
    over a given time period. You can also view all monitoring info for your server
    by clicking the “All charts” button.
  id: totrans-187
  prefs: []
  type: TYPE_NORMAL
  zh: 由于 LangGraph 平台集成在 LangSmith 中，您可以在生产环境中更深入地了解您的应用程序，并跟踪和监控使用情况、错误、性能和成本。[图
    9-7](#ch09_figure_7_1736545675498618) 展示了一个可视化的跟踪计数摘要图表，显示了在给定时间段内的成功、挂起和错误跟踪。您还可以通过点击“所有图表”按钮查看您服务器的所有监控信息。
- en: '![A screenshot of a computer  Description automatically generated](assets/lelc_0907.png)'
  id: totrans-188
  prefs: []
  type: TYPE_IMG
  zh: '![计算机的截图  自动生成的描述](assets/lelc_0907.png)'
- en: Figure 9-7\. Deployment revisions and trace count on dashboard
  id: totrans-189
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图 9-7\. 仪表板上的部署版本和跟踪计数
- en: To view the build and deployment logs, select the desired revision from the
    Revisions tab, then choose the Deploy tab to view the full deployment logs history.
    You can also adjust the date and time range.
  id: totrans-190
  prefs: []
  type: TYPE_NORMAL
  zh: 要查看构建和部署日志，请从“版本”选项卡中选择所需的版本，然后选择“部署”选项卡以查看完整的部署日志历史记录。您还可以调整日期和时间范围。
- en: To create a new deployment, click the New Revision button in the navigation
    bar. Fill out the necessary fields, including the LangGraph API config file path,
    git reference, and environment variables, as done previously.
  id: totrans-191
  prefs: []
  type: TYPE_NORMAL
  zh: 要创建新的部署，请点击导航栏中的“新建版本”按钮。填写必要的字段，包括 LangGraph API 配置文件路径、git 引用和环境变量，如之前所做的那样。
- en: Finally, you can access the API documentation by clicking the API docs link,
    which should display a similar page to the UI shown in [Figure 9-8](#ch09_figure_8_1736545675498636).
  id: totrans-192
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，您可以通过点击 API 文档链接来访问 API 文档，该链接应显示与 [图 9-8](#ch09_figure_8_1736545675498636)
    中显示的 UI 类似的页面。
- en: '![A screenshot of a computer  Description automatically generated](assets/lelc_0908.png)'
  id: totrans-193
  prefs: []
  type: TYPE_IMG
  zh: '![计算机的截图  自动生成的描述](assets/lelc_0908.png)'
- en: Figure 9-8\. LangGraph API documentation
  id: totrans-194
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图 9-8\. LangGraph API 文档
- en: Launch LangGraph Studio
  id: totrans-195
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 启动 LangGraph Studio
- en: LangGraph Studio provides a specialized agent IDE for visualizing, interacting
    with, and debugging complex agentic applications. It enables developers to modify
    an agent result (or the logic underlying a specific node) halfway through the
    agent’s trajectory. This creates an iterative process by letting you interact
    with and manipulate the state at that point in time.
  id: totrans-196
  prefs: []
  type: TYPE_NORMAL
  zh: LangGraph Studio 提供了一个专门的代理 IDE，用于可视化、交互和调试复杂的代理应用程序。它允许开发者在代理轨迹中途修改代理结果（或特定节点的底层逻辑）。通过让您在该时间点交互和操作状态，这创建了一个迭代过程。
- en: Once you’ve deployed your AI application, click the LangGraph Studio button
    at the top righthand corner of the deployment dashboard, as you can see in [Figure 9-9](#ch09_figure_9_1736545675498656).
  id: totrans-197
  prefs: []
  type: TYPE_NORMAL
  zh: 部署您的AI应用后，点击部署仪表板右上角的LangGraph Studio按钮，如图[图9-9](#ch09_figure_9_1736545675498656)所示。
- en: '![A screenshot of a computer  Description automatically generated](assets/lelc_0909.png)'
  id: totrans-198
  prefs: []
  type: TYPE_IMG
  zh: '![计算机的截图  自动生成的描述](assets/lelc_0909.png)'
- en: Figure 9-9\. LangGraph deployment UI
  id: totrans-199
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图9-9\. LangGraph部署UI
- en: After clicking the button, you should see the LangGraph Studio UI (for example,
    see [Figure 9-10](#ch09_figure_10_1736545675498675)).
  id: totrans-200
  prefs: []
  type: TYPE_NORMAL
  zh: 点击按钮后，您应该看到LangGraph Studio UI（例如，参见[图9-10](#ch09_figure_10_1736545675498675)）。
- en: '![A screenshot of a computer  Description automatically generated](assets/lelc_0910.png)'
  id: totrans-201
  prefs: []
  type: TYPE_IMG
  zh: '![计算机的截图  自动生成的描述](assets/lelc_0910.png)'
- en: Figure 9-10\. LangGraph Studio UI
  id: totrans-202
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图9-10\. LangGraph Studio UI
- en: 'To invoke a graph and start a new run, follow these steps:'
  id: totrans-203
  prefs: []
  type: TYPE_NORMAL
  zh: 要调用一个图并启动一个新的运行，请按照以下步骤操作：
- en: Select a graph from the drop-down menu in the top left corner of the lefthand
    pane. The graph in [Figure 9-10](#ch09_figure_10_1736545675498675) is called *agent*.
  id: totrans-204
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在左侧窗格顶部左角的下拉菜单中选择一个图。图9-10中的图被称为*代理*。
- en: In the Input section, click the “+ Message” icon and input a *human* message,
    but the input will vary depending on your application state definitions.
  id: totrans-205
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在输入部分，点击“+消息”图标并输入一个*人类*消息，但输入将根据您的应用程序状态定义而变化。
- en: Click Submit to invoke the selected graph.
  id: totrans-206
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击提交以调用所选图。
- en: View the output of the invocation in the right-hand pane.
  id: totrans-207
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在右侧窗格中查看调用的输出。
- en: The output of your invoked graph should look like [Figure 9-11](#ch09_figure_11_1736545675498694).
  id: totrans-208
  prefs: []
  type: TYPE_NORMAL
  zh: 您调用的图输出应类似于[图9-11](#ch09_figure_11_1736545675498694)。
- en: '![A screenshot of a computer  Description automatically generated](assets/lelc_0911.png)'
  id: totrans-209
  prefs: []
  type: TYPE_IMG
  zh: '![计算机的截图  自动生成的描述](assets/lelc_0911.png)'
- en: Figure 9-11\. LangGraph Studio invocation output
  id: totrans-210
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图9-11\. LangGraph Studio调用输出
- en: In addition to invocation, LangGraph Studio enables you to change run configurations,
    create and edit threads, interrupt your graphs, edit graph code, and enable human-in-the-loop
    intervention. You can read the [full guide](https://oreil.ly/xUU37) to learn more.
  id: totrans-211
  prefs: []
  type: TYPE_NORMAL
  zh: 除了调用之外，LangGraph Studio还允许您更改运行配置、创建和编辑线程、中断您的图、编辑图代码，并启用人机交互干预。您可以阅读[完整指南](https://oreil.ly/xUU37)以了解更多信息。
- en: Note
  id: totrans-212
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 注意
- en: LangGraph Studio is also available as a desktop application (for Apple silicon),
    which enables you to test your AI application locally.
  id: totrans-213
  prefs: []
  type: TYPE_NORMAL
  zh: LangGraph Studio也作为桌面应用程序（适用于Apple硅芯片）提供，这使您能够本地测试您的AI应用。
- en: If you’ve followed the installation guide in the GitHub template and successfully
    deployed your AI application, it’s now live for production use. But before you
    share to external users or use the backend API in existing applications, it’s
    important to be aware of key security considerations.
  id: totrans-214
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您已按照GitHub模板中的安装指南进行操作并成功部署了您的AI应用，它现在可用于生产使用。但在您向外部用户分享或在使用现有应用程序中的后端API之前，了解关键安全考虑因素非常重要。
- en: Security
  id: totrans-215
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 安全
- en: Although AI applications are powerful, they are vulnerable to several security
    risks that may lead to data corruption or loss, unauthorized access to confidential
    information, and compromised performance. These risks may carry adverse legal,
    reputational, and financial consequences.
  id: totrans-216
  prefs: []
  type: TYPE_NORMAL
  zh: 尽管AI应用功能强大，但它们容易受到可能导致数据损坏或丢失、未经授权访问机密信息以及性能受损的多种安全风险的影响。这些风险可能带来不利的法律、声誉和财务后果。
- en: 'To mitigate these risks, it’s recommended to follow general application security
    best practices, including the following:'
  id: totrans-217
  prefs: []
  type: TYPE_NORMAL
  zh: 为了减轻这些风险，建议遵循一般的应用程序安全最佳实践，包括以下内容：
- en: Limit permissions
  id: totrans-218
  prefs: []
  type: TYPE_NORMAL
  zh: 限制权限
- en: Scope permissions specific to the application’s need. Granting broad or excessive
    permissions can introduce significant security vulnerabilities. To avoid such
    vulnerabilities, consider using read-only credentials, disallowing access to sensitive
    resources, and using sandboxing techniques (such as running inside a container).
  id: totrans-219
  prefs: []
  type: TYPE_NORMAL
  zh: 根据应用程序的需求范围权限。授予过于宽泛或过度的权限可能会引入重大的安全漏洞。为了避免此类漏洞，考虑使用只读凭证、禁止访问敏感资源，并使用沙箱技术（例如在容器内运行）。
- en: Anticipate potential misuse
  id: totrans-220
  prefs: []
  type: TYPE_NORMAL
  zh: 预测潜在滥用
- en: Always assume that any system access or credentials may be used in any way allowed
    by the permissions they are assigned. For example, if a pair of database credentials
    allows deleting data, it’s safest to assume that any LLM able to use those credentials
    may in fact delete data.
  id: totrans-221
  prefs: []
  type: TYPE_NORMAL
  zh: 总是假设任何系统访问或凭证可能会以它们被分配的任何方式使用。例如，如果一对数据库凭证允许删除数据，那么最安全的假设是任何能够使用这些凭证的LLM实际上可能会删除数据。
- en: Defense in depth
  id: totrans-222
  prefs: []
  type: TYPE_NORMAL
  zh: 多层防御
- en: It’s often best to combine multiple layered security approaches rather than
    rely on any single layer of defense to ensure security. For example, use both
    read-only permissions and sandboxing to ensure that LLMs are only able to access
    data that is explicitly meant for them to use.
  id: totrans-223
  prefs: []
  type: TYPE_NORMAL
  zh: 通常最好结合多种分层安全方法，而不是依赖任何单一防御层来确保安全。例如，使用只读权限和沙箱化，以确保LLM只能访问明确为其使用而设计的特定数据。
- en: 'Here are three example scenarios implementing these mitigation strategies:'
  id: totrans-224
  prefs: []
  type: TYPE_NORMAL
  zh: 这里是三个实施这些缓解策略的示例场景：
- en: File access
  id: totrans-225
  prefs: []
  type: TYPE_NORMAL
  zh: 文件访问
- en: A user may ask an agent with access to the file system to delete files that
    should not be deleted or read the content of files that contain sensitive information.
    To mitigate this risk, limit the agent to only use a specific directory and only
    allow it to read or write files that are safe to read or write. Consider further
    sandboxing the agent by running it in a container.
  id: totrans-226
  prefs: []
  type: TYPE_NORMAL
  zh: 用户可能会要求一个可以访问文件系统的代理删除不应删除的文件或读取包含敏感信息的文件内容。为了减轻这种风险，限制代理只能使用特定的目录，并且只允许它读取或写入安全读取或写入的文件。考虑通过在容器中运行代理进一步沙箱化代理。
- en: API access
  id: totrans-227
  prefs: []
  type: TYPE_NORMAL
  zh: API访问
- en: A user may ask an agent with write access to an external API to write malicious
    data to the API or delete data from that API. To mitigate, give the agent read-only
    API keys, or limit it to only use endpoints that are already resistant to such
    misuse.
  id: totrans-228
  prefs: []
  type: TYPE_NORMAL
  zh: 用户可能会要求一个具有对外部API写入访问权限的代理向API写入恶意数据或从该API删除数据。为了减轻风险，给代理只读API密钥，或者限制它只能使用已经对这种滥用具有抵抗力的端点。
- en: Database access
  id: totrans-229
  prefs: []
  type: TYPE_NORMAL
  zh: 数据库访问
- en: A user may ask an agent with access to a database to drop a table or mutate
    the schema. To mitigate, scope the credentials to only the tables that the agent
    needs to access and consider issuing read-only credentials.
  id: totrans-230
  prefs: []
  type: TYPE_NORMAL
  zh: 用户可能会要求一个可以访问数据库的代理删除表或修改模式。为了减轻风险，将凭证范围限制在代理需要访问的表上，并考虑发放只读凭证。
- en: 'In addition to the preceding security measures, you can take further steps
    to mitigate abuse of your AI application. Due to the dependency of external LLM
    API providers (such as OpenAI), there is a direct cost associated with running
    your application. To prevent abuse of your API and exponential costs, you can
    implement the following:'
  id: totrans-231
  prefs: []
  type: TYPE_NORMAL
  zh: 除了前面的安全措施之外，您还可以采取进一步措施来减轻对您的AI应用的滥用。由于对外部LLM API提供商（如OpenAI）的依赖，运行您的应用会产生直接成本。为了防止滥用您的API和指数级成本，您可以实施以下措施：
- en: Account creation verification
  id: totrans-232
  prefs: []
  type: TYPE_NORMAL
  zh: 账户创建验证
- en: This typically includes a form of authentication login, such as email or phone
    number verification.
  id: totrans-233
  prefs: []
  type: TYPE_NORMAL
  zh: 这通常包括一种形式的身份验证登录，例如电子邮件或电话号码验证。
- en: Rate limiting
  id: totrans-234
  prefs: []
  type: TYPE_NORMAL
  zh: 速率限制
- en: Implement a rate-limiting mechanism in the middleware of the application to
    prevent users from making too many requests in a short period of time. This should
    check the number of requests a user has made in the last X minutes and “timeout”
    or “ban” the user if the abuse is severe.
  id: totrans-235
  prefs: []
  type: TYPE_NORMAL
  zh: 在应用程序的中间件中实施速率限制机制，以防止用户在短时间内发出过多请求。这应该检查用户在最后X分钟内发出的请求数量，如果滥用严重，则“超时”或“禁止”用户。
- en: Implement prompt injection guardrails
  id: totrans-236
  prefs: []
  type: TYPE_NORMAL
  zh: 实施提示注入防护措施
- en: '*Prompt injection* occurs when a malicious user injects a prompt in an attempt
    to trick the LLM to act in unintended ways. This usually includes extracting confidential
    data or generating unrelated outputs. To mitigate this, you should ensure the
    LLM has proper permission scoping and that the application’s prompts are specific
    and strict to the desired outcomes.'
  id: totrans-237
  prefs: []
  type: TYPE_NORMAL
  zh: 当恶意用户注入提示以试图欺骗LLM以不期望的方式行事时，会发生*提示注入*。这通常包括提取机密数据或生成不相关的输出。为了减轻这种风险，您应该确保LLM具有适当的权限范围，并且应用程序的提示具体且严格，以符合期望的结果。
- en: Summary
  id: totrans-238
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 摘要
- en: Throughout this chapter, you’ve learned the best practices for deploying your
    AI application and enabling users to interact with it. We explored recommended
    services to handle various key components of the application in production, including
    the LLM, vector store, and backend API.
  id: totrans-239
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，您已经学习了部署您的AI应用和启用用户与之交互的最佳实践。我们探讨了在生产环境中处理应用程序各种关键组件的推荐服务，包括LLM、向量存储和后端API。
- en: We also discussed using LangGraph Platform as a managed service for deploying
    and hosting LangGraph agents at scale—in conjunction with LangGraph Studio—to
    visualize, interact with, and debug your application.
  id: totrans-240
  prefs: []
  type: TYPE_NORMAL
  zh: 我们还讨论了将LangGraph平台作为一个托管服务来大规模部署和托管LangGraph代理，与LangGraph Studio结合使用，以可视化、交互和调试你的应用。
- en: Finally, we briefly explored various security best practices to mitigate data
    breach risks often associated with AI applications.
  id: totrans-241
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，我们简要探讨了各种安全最佳实践，以减轻与人工智能应用相关的数据泄露风险。
- en: In [Chapter 10](ch10.html#ch10_testing_evaluation_monitoring_and_continuous_im_1736545678108525),
    you’ll learn how to effectively evaluate, monitor, benchmark, and improve the
    performance of your AI application.
  id: totrans-242
  prefs: []
  type: TYPE_NORMAL
  zh: 在[第10章](ch10.html#ch10_testing_evaluation_monitoring_and_continuous_im_1736545678108525)，你将学习如何有效地评估、监控、基准测试和改进你的人工智能应用性能。
