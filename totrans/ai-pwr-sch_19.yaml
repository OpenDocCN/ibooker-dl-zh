- en: appendix A Running the code examples
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: During your journey through *AI-Powered Search*, we walk through a lot of code
    and run software examples demonstrating the techniques within this book. This
    appendix shows you how to easily set up and run the accompanying source code so
    that you can experiment with live, running examples as you work through the material.
    We’ll cover how the book’s source code is packaged, pulling and building the source
    code, and working with Jupyter notebooks and Docker to run the examples.
  prefs: []
  type: TYPE_NORMAL
- en: A.1 Overall structure of code examples
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Building an AI-powered search system requires integrating many components and
    libraries. For our default search engine, we will use Apache Solr, which internally
    relies on Apache ZooKeeper. You can also swap out Solr with many other popular
    search engines and vector databases—see appendix B for instructions.
  prefs: []
  type: TYPE_NORMAL
- en: For significant data processing and machine learning tasks, we use Apache Spark.
    We use Python as our programming language for all the code examples and rely on
    many Python library dependencies, in addition to other system dependencies (like
    Java), which several of our systems require. Of course, we also need to execute
    our code examples and see the results in a user-friendly way, which we accomplish
    with the use of Jupyter notebooks.
  prefs: []
  type: TYPE_NORMAL
- en: 'Instead of installing dozens of software libraries and hundreds of dependencies
    to make this all work, we’ve made this process as easy as possible by packaging
    all of the book’s examples into Docker containers, which are already fully configured
    and and ready to use. This means there is only a single prerequisite you must
    install before running the code examples in this book: Docker.'
  prefs: []
  type: TYPE_NORMAL
- en: Docker enables the creation and running of tiny containers—fully functioning
    virtual machines that run only a lightweight operating system with all of the
    needed software and dependencies already installed and configured. This allows
    you to run the code on most operating systems (macOS, Windows, Linux) without
    having to configure any system-specific dependencies.
  prefs: []
  type: TYPE_NORMAL
- en: Once all of the services are running, all of the code listings in the book will
    be available through Jupyter notebooks, which will serve as the interface for
    running through and experimenting with the code examples to see the resulting
    outputs.
  prefs: []
  type: TYPE_NORMAL
- en: A.2 Pulling the source code
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'The source code accompanying this book is available on GitHub here: [https://github.com/treygrainger/ai-powered-search](https://github.com/treygrainger/ai-powered-search).
    To pull the code, either use an installed Git client or open up a command-line
    interface in your preferred development folder and run the following command:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE0]'
  prefs: []
  type: TYPE_PRE
- en: You should now have a new folder in your current directory called ai-powered-search/
    that contains all the source code for the book.
  prefs: []
  type: TYPE_NORMAL
- en: If you don’t have Git installed or can’t pull the code through the preceding
    command, there is also an option on the website to download the source code as
    a zip file through your web browser, which you would then just need to unzip into
    your development folder.
  prefs: []
  type: TYPE_NORMAL
- en: Feel free to rename or move the ai-powered-search/ folder if you wish; throughout
    the rest of this book, we’ll simply refer to this directory using the variable
    `$AIPS_HOME`.
  prefs: []
  type: TYPE_NORMAL
- en: A.3 Building and running the code
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: As previously mentioned, Docker is the one key dependency you must install on
    your system to build and run the *AI-Powered Search* code examples. We will not
    cover this installation process here as it is system-dependent and changes from
    time to time. Please visit [https://docker.com](https://docker.com) for download
    and installation instructions. We should also note that other container-management
    tools, like Podman, can be used instead of Docker, though we will not cover those
    here.
  prefs: []
  type: TYPE_NORMAL
- en: 'Once you have Docker installed, make sure to change the directory in your command-line
    interface to the `$AIPS_HOME` directory (`cd` `$AIPS_HOME`). To build and run
    the codebase, you then just need to run the following command:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE1]'
  prefs: []
  type: TYPE_PRE
- en: Note that this command is equivalent to running `docker compose up solr`. The
    book’s codebase works with multiple search engines and vector databases, and that
    (optional) last argument allows you to specify which engine(s) you want to use
    (with Apache Solr being the default). If you wanted to use OpenSearch with the
    book, for example, you would run `docker compose up opensearch` instead. For more
    information on other supported search engines, see appendix B.
  prefs: []
  type: TYPE_NORMAL
- en: TIP The `docker compose up` command runs in the foreground of your console,
    which allows you to see all the logs streaming in real time, but this also means
    your containers will all die if you close the console. If you would like to instead
    run the containers in the background and close or continue using your console,
    you can pass in the `-d` or `--detach` parameter (`docker compose up -d`). If
    you launch it like this, be sure to explicitly run `docker compose --profile all
    down` when you are finished to stop the containers from running indefinitely in
    the background, consuming resources.
  prefs: []
  type: TYPE_NORMAL
- en: This command will take a while to run the first time, as it pulls in all of
    the code, operating systems, and dependencies needed to build and run the software
    accompanying this book. Once the command finishes, however, you will have all
    of the necessary services (Jupyter, Spark, ZooKeeper, Solr, etc.) running in separate
    Docker containers.
  prefs: []
  type: TYPE_NORMAL
- en: Now, to get started, simply open up your web browser and go to http://localhost:8888\.
    This will redirect to the welcome screen listing all the book’s chapters and their
    corresponding Jupyter notebooks (figure A.1). You can now click on any of the
    chapters to start running their code examples.
  prefs: []
  type: TYPE_NORMAL
- en: '![figure](../Images/APPA_F01_Grainger.png)'
  prefs: []
  type: TYPE_IMG
- en: Figure A.1 Welcome screen. Once you see this, the *AI-Powered Search* containers
    are built and the Jupyter notebooks are running.
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
- en: By default, the Jupyter Notebooks are loaded into a Jupyter Labs environment,
    which is a development environment for working with, debugging, and navigating
    notebooks. It allows you to open up and edit multiple notebooks at once (in separate
    tabs) and to navigate and modify the directory structure on the left side of the
    screen as you explore.
  prefs: []
  type: TYPE_NORMAL
- en: If you just want to follow along with the book in a simpler environment, you
    can alternatively go to http://localhost:8888/notebooks and navigate the table
    of contents to follow along, one notebook at a time, as you progress through the
    book. We’ll use this simpler interface in the next section, though the same functionality
    (and more) is present in the default Jupyter Labs environment at http://localhost:8888\.
  prefs: []
  type: TYPE_NORMAL
- en: A.4 Working with Jupyter
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Once you view the `welcome.ipynb` notebook, you’ll see a few data cells on the
    screen, including an introduction message, a “health check” script, and a table
    of contents to various notebooks containing executable examples from the book.
  prefs: []
  type: TYPE_NORMAL
- en: If you’ve never used Jupyter before, it is a tool that lets you mix markup (usually
    instructions and explanation) and code in your browser, and to edit, run, and
    interact with the output from the code examples. This makes learning much easier,
    as you don’t have to use command-line tools and can instead interact entirely
    with ready-to-execute examples with the click of a button.
  prefs: []
  type: TYPE_NORMAL
- en: You’ll notice a toolbar near the top of the screen (below the menu bar) that
    allows you to interact with the sections of content (called *cells*) within the
    notebook. You can use these tools to navigate up and down, to stop and restart
    the notebook, or to execute each cell sequentially using the Run button.
  prefs: []
  type: TYPE_NORMAL
- en: In figure A.2, clicking Run while the healthcheck code cell is highlighted will
    result in the healthcheck executing to confirm that all Docker containers are
    running and that the services running within them are healthy and responding.
  prefs: []
  type: TYPE_NORMAL
- en: '![figure](../Images/APPA_F02_Grainger.png)'
  prefs: []
  type: TYPE_IMG
- en: Figure A.2 Running code examples. Clicking Run in the toolbar will execute any
    examples in the current cell (if any) and proceed to the next cell.
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
- en: Figure A.3 shows the response you will see when everything is running as expected.
  prefs: []
  type: TYPE_NORMAL
- en: '![figure](../Images/APPA_F03_Grainger.png)'
  prefs: []
  type: TYPE_IMG
- en: Figure A.3 Healthcheck success. You should see this message if everything is
    running correctly.
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
- en: At this point, you can scroll down to the table of contents and proceed through
    the notebooks for each chapter. Of course, since the explanation behind the examples
    is contained within the book, you’ll probably prefer to work through the examples
    as you’re reading the book so that you have the appropriate background when running
    them. The Jupyter notebooks are not intended to be standalone examples, so you’ll
    probably want to keep the book close by to provide context.
  prefs: []
  type: TYPE_NORMAL
- en: All Jupyter notebooks are designed to be independently idempotent. This means
    that, while all steps in a notebook need to be executed in order to guarantee
    a successful result, you can always start over at the beginning of any notebook,
    and it will “reset” to the expected results necessary to make the subsequent steps
    succeed. If ever you experience errors in a notebook, just go back to the first
    cell on the page and run through the whole notebook again.
  prefs: []
  type: TYPE_NORMAL
- en: A.5 Working with Docker
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: While everything in the previous sections should work as expected, it’s of course
    possible that you could run into problems along the way. The most likely challenge
    you’ll face is having one of your Docker containers, or the service running inside
    of it, fail. It’s also possible, if you’re making changes to underlying data or
    config in one of the services, for example, that you could put it in a bad state.
  prefs: []
  type: TYPE_NORMAL
- en: 'When this happens, you can always tear down your containers and start over.
    To do this, just run this command from the `$AIPS_HOME` directory:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE2]'
  prefs: []
  type: TYPE_PRE
- en: Keep in mind that if you’ve made any changes to your notebooks or code, any
    work you’ve done will be lost when you run `docker` `compose` `--profile` `all`
    `down`. In general, the examples are designed to be transient. If you want to
    preserve your work across container rebuilds, you can modify the docker-compose.yaml
    file to mount folders to your local drive or use Docker data volumes marked as
    `external` that will be persistent. Please refer to the Docker documentation if
    you plan to make changes there, as the mechanisms and APIs can change from time
    to time.
  prefs: []
  type: TYPE_NORMAL
- en: 'If you ever modify the code examples or your configuration, it’s also possible
    you may need to rebuild your Docker images. When you run `docker compose up` the
    first time, it will pull or build your images and start them, but it doesn’t rebuild
    with changes made after the first build. To rebuild everything prior to restarting
    your Docker containers, you can instead run this command:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE3]'
  prefs: []
  type: TYPE_PRE
- en: If you just want to temporarily stop your running Docker containers and resume
    them later, you can also run `docker` `compose` `--profile` `all` `stop` to stop,
    and then `docker compose start` later to resume. This is helpful if you want to
    preserve any changes you’ve made without resetting to a clean version of the notebooks
    on the next start.
  prefs: []
  type: TYPE_NORMAL
- en: This should give you everything you need to run through all of the notebooks
    and code in *AI-Powered Search*.
  prefs: []
  type: TYPE_NORMAL
