- en: appendix A Running the code examples
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 附录A 运行代码示例
- en: During your journey through *AI-Powered Search*, we walk through a lot of code
    and run software examples demonstrating the techniques within this book. This
    appendix shows you how to easily set up and run the accompanying source code so
    that you can experiment with live, running examples as you work through the material.
    We’ll cover how the book’s source code is packaged, pulling and building the source
    code, and working with Jupyter notebooks and Docker to run the examples.
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 在您的“基于AI的搜索”之旅中，我们将通过大量代码和运行软件示例来展示本书中的技术。本附录向您展示如何轻松设置和运行附带的源代码，以便您可以在处理材料时实验实时运行的示例。我们将介绍如何打包本书的源代码，拉取和构建源代码，以及如何使用Jupyter笔记本和Docker来运行示例。
- en: A.1 Overall structure of code examples
  id: totrans-2
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: A.1 代码示例的整体结构
- en: Building an AI-powered search system requires integrating many components and
    libraries. For our default search engine, we will use Apache Solr, which internally
    relies on Apache ZooKeeper. You can also swap out Solr with many other popular
    search engines and vector databases—see appendix B for instructions.
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 构建一个基于AI的搜索系统需要集成许多组件和库。对于我们的默认搜索引擎，我们将使用Apache Solr，它内部依赖于Apache ZooKeeper。您也可以用许多其他流行的搜索引擎和向量数据库替换Solr——有关说明，请参阅附录B。
- en: For significant data processing and machine learning tasks, we use Apache Spark.
    We use Python as our programming language for all the code examples and rely on
    many Python library dependencies, in addition to other system dependencies (like
    Java), which several of our systems require. Of course, we also need to execute
    our code examples and see the results in a user-friendly way, which we accomplish
    with the use of Jupyter notebooks.
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: 对于重要的数据处理和机器学习任务，我们使用Apache Spark。我们使用Python作为所有代码示例的编程语言，并依赖于许多Python库依赖项，以及其他系统依赖项（如Java），其中一些系统需要这些依赖项。当然，我们还需要以用户友好的方式执行代码示例并查看结果，这通过使用Jupyter笔记本来实现。
- en: 'Instead of installing dozens of software libraries and hundreds of dependencies
    to make this all work, we’ve made this process as easy as possible by packaging
    all of the book’s examples into Docker containers, which are already fully configured
    and and ready to use. This means there is only a single prerequisite you must
    install before running the code examples in this book: Docker.'
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: 为了让整个过程尽可能简单，我们不是安装几十个软件库和数百个依赖项来使所有这些工作正常，而是将本书的所有示例打包到Docker容器中，这些容器已经完全配置并准备好使用。这意味着在运行本书中的代码示例之前，您只需安装一个先决条件：Docker。
- en: Docker enables the creation and running of tiny containers—fully functioning
    virtual machines that run only a lightweight operating system with all of the
    needed software and dependencies already installed and configured. This allows
    you to run the code on most operating systems (macOS, Windows, Linux) without
    having to configure any system-specific dependencies.
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
  zh: Docker允许创建和运行微小的容器——这些是完全功能的虚拟机，仅运行一个轻量级的操作系统，其中已安装并配置了所有需要的软件和依赖项。这使得您可以在大多数操作系统（macOS、Windows、Linux）上运行代码，而无需配置任何特定于系统的依赖项。
- en: Once all of the services are running, all of the code listings in the book will
    be available through Jupyter notebooks, which will serve as the interface for
    running through and experimenting with the code examples to see the resulting
    outputs.
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦所有服务都启动，本书中的所有代码列表都将通过Jupyter笔记本提供，这些笔记本将作为运行和实验代码示例的接口，以查看生成的输出。
- en: A.2 Pulling the source code
  id: totrans-8
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: A.2 拉取源代码
- en: 'The source code accompanying this book is available on GitHub here: [https://github.com/treygrainger/ai-powered-search](https://github.com/treygrainger/ai-powered-search).
    To pull the code, either use an installed Git client or open up a command-line
    interface in your preferred development folder and run the following command:'
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: 本书附带的源代码可在GitHub上找到：[https://github.com/treygrainger/ai-powered-search](https://github.com/treygrainger/ai-powered-search)。要拉取代码，您可以使用已安装的Git客户端或在您首选的开发文件夹中打开命令行界面，并运行以下命令：
- en: '[PRE0]'
  id: totrans-10
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: You should now have a new folder in your current directory called ai-powered-search/
    that contains all the source code for the book.
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 您现在应该在当前目录中有一个名为ai-powered-search/的新文件夹，其中包含本书的所有源代码。
- en: If you don’t have Git installed or can’t pull the code through the preceding
    command, there is also an option on the website to download the source code as
    a zip file through your web browser, which you would then just need to unzip into
    your development folder.
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您没有安装Git或无法通过前面的命令拉取代码，网站上也提供了一个选项，可以通过您的网络浏览器下载源代码的zip文件，然后您只需将其解压缩到您的开发文件夹中。
- en: Feel free to rename or move the ai-powered-search/ folder if you wish; throughout
    the rest of this book, we’ll simply refer to this directory using the variable
    `$AIPS_HOME`.
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您愿意，可以重命名或移动ai-powered-search/文件夹；在本书的其余部分，我们将简单地使用变量`$AIPS_HOME`来指代此目录。
- en: A.3 Building and running the code
  id: totrans-14
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: A.3 构建和运行代码
- en: As previously mentioned, Docker is the one key dependency you must install on
    your system to build and run the *AI-Powered Search* code examples. We will not
    cover this installation process here as it is system-dependent and changes from
    time to time. Please visit [https://docker.com](https://docker.com) for download
    and installation instructions. We should also note that other container-management
    tools, like Podman, can be used instead of Docker, though we will not cover those
    here.
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 如前所述，Docker是您必须在系统上安装的一个关键依赖项，以构建和运行*AI-Powered Search*代码示例。我们不会在这里介绍此安装过程，因为它依赖于系统，并且会不时发生变化。请访问[https://docker.com](https://docker.com)以获取下载和安装说明。我们还应该注意，除了Docker之外，还可以使用其他容器管理工具，如Podman，但我们将不会在这里介绍这些工具。
- en: 'Once you have Docker installed, make sure to change the directory in your command-line
    interface to the `$AIPS_HOME` directory (`cd` `$AIPS_HOME`). To build and run
    the codebase, you then just need to run the following command:'
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦您安装了Docker，请确保在您的命令行界面中将目录更改为`$AIPS_HOME`目录（`cd` `$AIPS_HOME`）。要构建和运行代码库，您只需运行以下命令：
- en: '[PRE1]'
  id: totrans-17
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: Note that this command is equivalent to running `docker compose up solr`. The
    book’s codebase works with multiple search engines and vector databases, and that
    (optional) last argument allows you to specify which engine(s) you want to use
    (with Apache Solr being the default). If you wanted to use OpenSearch with the
    book, for example, you would run `docker compose up opensearch` instead. For more
    information on other supported search engines, see appendix B.
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 注意，此命令等同于运行 `docker compose up solr`。本书的代码库支持多个搜索引擎和向量数据库，并且最后一个（可选）参数允许您指定您想要使用的引擎（默认为Apache
    Solr）。例如，如果您想使用OpenSearch，您将运行 `docker compose up opensearch`。有关其他支持搜索引擎的更多信息，请参阅附录B。
- en: TIP The `docker compose up` command runs in the foreground of your console,
    which allows you to see all the logs streaming in real time, but this also means
    your containers will all die if you close the console. If you would like to instead
    run the containers in the background and close or continue using your console,
    you can pass in the `-d` or `--detach` parameter (`docker compose up -d`). If
    you launch it like this, be sure to explicitly run `docker compose --profile all
    down` when you are finished to stop the containers from running indefinitely in
    the background, consuming resources.
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: 提示：`docker compose up`命令在您的控制台前台运行，这允许您实时查看所有日志流，但这也意味着如果关闭控制台，所有容器都将停止。如果您想在不关闭或继续使用控制台的情况下在后台运行容器，可以传递`-d`或`--detach`参数（`docker
    compose up -d`）。如果您这样启动它，请确保在完成后明确运行`docker compose --profile all down`，以停止容器在后台无限期运行，消耗资源。
- en: This command will take a while to run the first time, as it pulls in all of
    the code, operating systems, and dependencies needed to build and run the software
    accompanying this book. Once the command finishes, however, you will have all
    of the necessary services (Jupyter, Spark, ZooKeeper, Solr, etc.) running in separate
    Docker containers.
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: 此命令第一次运行需要一段时间，因为它会拉取构建和运行本书所附软件所需的所有代码、操作系统和依赖项。然而，一旦命令完成，您将拥有所有必要的服务（Jupyter、Spark、ZooKeeper、Solr等）在单独的Docker容器中运行。
- en: Now, to get started, simply open up your web browser and go to http://localhost:8888\.
    This will redirect to the welcome screen listing all the book’s chapters and their
    corresponding Jupyter notebooks (figure A.1). You can now click on any of the
    chapters to start running their code examples.
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，要开始，只需打开您的网络浏览器并访问http://localhost:8888。这将重定向到欢迎屏幕，列出本书的所有章节及其对应的Jupyter笔记本（图A.1）。您现在可以点击任何章节以启动其代码示例。
- en: '![figure](../Images/APPA_F01_Grainger.png)'
  id: totrans-22
  prefs: []
  type: TYPE_IMG
  zh: '![图](../Images/APPA_F01_Grainger.png)'
- en: Figure A.1 Welcome screen. Once you see this, the *AI-Powered Search* containers
    are built and the Jupyter notebooks are running.
  id: totrans-23
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图 A.1 欢迎屏幕。一旦你看到这个，*AI-Powered Search* 容器就构建完成，Jupyter 笔记本正在运行。
- en: By default, the Jupyter Notebooks are loaded into a Jupyter Labs environment,
    which is a development environment for working with, debugging, and navigating
    notebooks. It allows you to open up and edit multiple notebooks at once (in separate
    tabs) and to navigate and modify the directory structure on the left side of the
    screen as you explore.
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: 默认情况下，Jupyter 笔记本被加载到 Jupyter Labs 环境中，这是一个用于处理、调试和导航笔记本的开发环境。它允许你同时打开和编辑多个笔记本（在单独的标签页中），并在你探索时在屏幕左侧导航和修改目录结构。
- en: If you just want to follow along with the book in a simpler environment, you
    can alternatively go to http://localhost:8888/notebooks and navigate the table
    of contents to follow along, one notebook at a time, as you progress through the
    book. We’ll use this simpler interface in the next section, though the same functionality
    (and more) is present in the default Jupyter Labs environment at http://localhost:8888\.
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你只想在更简单的环境中跟随书籍，你可以选择访问 http://localhost:8888/notebooks 并导航目录表，逐个笔记本地跟随，随着你在书中前进。我们将在下一节中使用这个更简单的界面，尽管默认的
    Jupyter Labs 环境在 http://localhost:8888\ 中提供了相同的功能（以及更多）。
- en: A.4 Working with Jupyter
  id: totrans-26
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: A.4 使用 Jupyter
- en: Once you view the `welcome.ipynb` notebook, you’ll see a few data cells on the
    screen, including an introduction message, a “health check” script, and a table
    of contents to various notebooks containing executable examples from the book.
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦你查看 `welcome.ipynb` 笔记本，你会在屏幕上看到几个数据单元，包括一个介绍消息、“健康检查”脚本以及包含书中可执行示例的各个笔记本的目录表。
- en: If you’ve never used Jupyter before, it is a tool that lets you mix markup (usually
    instructions and explanation) and code in your browser, and to edit, run, and
    interact with the output from the code examples. This makes learning much easier,
    as you don’t have to use command-line tools and can instead interact entirely
    with ready-to-execute examples with the click of a button.
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你之前从未使用过 Jupyter，它是一个允许你在浏览器中混合标记（通常是说明和解释）和代码的工具，并且可以编辑、运行和与代码示例的输出进行交互。这使得学习变得更加容易，因为你不需要使用命令行工具，而是可以通过点击按钮与准备好的可执行示例完全交互。
- en: You’ll notice a toolbar near the top of the screen (below the menu bar) that
    allows you to interact with the sections of content (called *cells*) within the
    notebook. You can use these tools to navigate up and down, to stop and restart
    the notebook, or to execute each cell sequentially using the Run button.
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: 你会注意到屏幕顶部附近有一个工具栏，允许你与笔记本中的内容部分（称为 *单元*）进行交互。你可以使用这些工具上下导航，停止和重新启动笔记本，或使用“运行”按钮按顺序执行每个单元。
- en: In figure A.2, clicking Run while the healthcheck code cell is highlighted will
    result in the healthcheck executing to confirm that all Docker containers are
    running and that the services running within them are healthy and responding.
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: 在图 A.2 中，当健康检查代码单元被突出显示时点击“运行”将导致健康检查执行以确认所有 Docker 容器正在运行，并且其中运行的服务是健康的并且正在响应。
- en: '![figure](../Images/APPA_F02_Grainger.png)'
  id: totrans-31
  prefs: []
  type: TYPE_IMG
  zh: '![图](../Images/APPA_F02_Grainger.png)'
- en: Figure A.2 Running code examples. Clicking Run in the toolbar will execute any
    examples in the current cell (if any) and proceed to the next cell.
  id: totrans-32
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图 A.2 运行代码示例。在工具栏中点击“运行”将执行当前单元中的任何示例（如果有）并转到下一个单元。
- en: Figure A.3 shows the response you will see when everything is running as expected.
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: 图 A.3 显示了当一切按预期运行时你将看到的响应。
- en: '![figure](../Images/APPA_F03_Grainger.png)'
  id: totrans-34
  prefs: []
  type: TYPE_IMG
  zh: '![图](../Images/APPA_F03_Grainger.png)'
- en: Figure A.3 Healthcheck success. You should see this message if everything is
    running correctly.
  id: totrans-35
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图 A.3 健康检查成功。如果一切运行正常，你应该看到这条消息。
- en: At this point, you can scroll down to the table of contents and proceed through
    the notebooks for each chapter. Of course, since the explanation behind the examples
    is contained within the book, you’ll probably prefer to work through the examples
    as you’re reading the book so that you have the appropriate background when running
    them. The Jupyter notebooks are not intended to be standalone examples, so you’ll
    probably want to keep the book close by to provide context.
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: 在这一点上，你可以向下滚动到目录表，并逐章浏览笔记本。当然，由于示例背后的解释包含在书中，你可能更喜欢在阅读书籍的同时处理示例，以便在运行它们时拥有适当的背景知识。Jupyter
    笔记本不是旨在作为独立示例，所以你可能需要将书籍放在附近以提供上下文。
- en: All Jupyter notebooks are designed to be independently idempotent. This means
    that, while all steps in a notebook need to be executed in order to guarantee
    a successful result, you can always start over at the beginning of any notebook,
    and it will “reset” to the expected results necessary to make the subsequent steps
    succeed. If ever you experience errors in a notebook, just go back to the first
    cell on the page and run through the whole notebook again.
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: 所有 Jupyter 笔记本都设计为独立幂等的。这意味着，虽然笔记本中的所有步骤都需要按顺序执行以保证成功的结果，但你总是可以从任何笔记本的开始处重新开始，并且它将“重置”到执行后续步骤所需的预期结果。如果你在笔记本中遇到错误，只需回到页面上的第一个单元格并重新运行整个笔记本即可。
- en: A.5 Working with Docker
  id: totrans-38
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: A.5 使用 Docker
- en: While everything in the previous sections should work as expected, it’s of course
    possible that you could run into problems along the way. The most likely challenge
    you’ll face is having one of your Docker containers, or the service running inside
    of it, fail. It’s also possible, if you’re making changes to underlying data or
    config in one of the services, for example, that you could put it in a bad state.
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然前几节中的所有内容都应该按预期工作，但当然有可能你在过程中会遇到问题。你可能会遇到的最大挑战是其中一个 Docker 容器，或者其中运行的服务失败。如果你正在更改某个服务的基础数据或配置，例如，你可能会将其置于不良状态。
- en: 'When this happens, you can always tear down your containers and start over.
    To do this, just run this command from the `$AIPS_HOME` directory:'
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: 当这种情况发生时，你总是可以拆毁你的容器并重新开始。为此，只需从 `$AIPS_HOME` 目录运行以下命令：
- en: '[PRE2]'
  id: totrans-41
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: Keep in mind that if you’ve made any changes to your notebooks or code, any
    work you’ve done will be lost when you run `docker` `compose` `--profile` `all`
    `down`. In general, the examples are designed to be transient. If you want to
    preserve your work across container rebuilds, you can modify the docker-compose.yaml
    file to mount folders to your local drive or use Docker data volumes marked as
    `external` that will be persistent. Please refer to the Docker documentation if
    you plan to make changes there, as the mechanisms and APIs can change from time
    to time.
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: 请记住，如果你对笔记本或代码进行了任何更改，当你运行 `docker` `compose` `--profile` `all` `down` 时，你已完成的工作将会丢失。一般来说，示例被设计为短暂的。如果你想跨容器重建保留你的工作，你可以修改
    docker-compose.yaml 文件以将文件夹挂载到本地驱动器，或者使用标记为 `external` 的 Docker 数据卷，这将保持持久性。如果你计划在
    Docker 文档中进行更改，请参考 Docker 文档，因为机制和 API 可能会不时更改。
- en: 'If you ever modify the code examples or your configuration, it’s also possible
    you may need to rebuild your Docker images. When you run `docker compose up` the
    first time, it will pull or build your images and start them, but it doesn’t rebuild
    with changes made after the first build. To rebuild everything prior to restarting
    your Docker containers, you can instead run this command:'
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你修改了代码示例或你的配置，你可能还需要重新构建你的 Docker 镜像。当你第一次运行 `docker compose up` 时，它将拉取或构建你的镜像并启动它们，但它不会在第一次构建后重建。为了在重新启动
    Docker 容器之前重建一切，你可以运行以下命令：
- en: '[PRE3]'
  id: totrans-44
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: If you just want to temporarily stop your running Docker containers and resume
    them later, you can also run `docker` `compose` `--profile` `all` `stop` to stop,
    and then `docker compose start` later to resume. This is helpful if you want to
    preserve any changes you’ve made without resetting to a clean version of the notebooks
    on the next start.
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你只想暂时停止正在运行的 Docker 容器并在以后恢复，你也可以运行 `docker` `compose` `--profile` `all` `stop`
    来停止，然后在稍后运行 `docker compose start` 来恢复。如果你想在下次启动时保留所做的任何更改而不重置到笔记本的干净版本，这将非常有用。
- en: This should give you everything you need to run through all of the notebooks
    and code in *AI-Powered Search*.
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: 这应该会给你运行所有 *AI-Powered Search* 中的笔记本和代码所需的一切。
