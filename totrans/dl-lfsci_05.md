# 第五章 生物物理机器学习

在本章中，我们将探讨如何使用深度学习来理解生物物理系统。特别是，我们将深入探讨如何预测类似药物的小分子如何与人体中感兴趣的蛋白质结合。

这个问题在药物发现中具有基本的兴趣。以有针对性的方式调节单个蛋白质往往可以产生显著的治疗效果。例如，突破性的癌症药物伊马替尼紧密结合 BCR-ABL，这也是其有效性的原因之一。对于其他疾病，要找到具有相同疗效的单个蛋白质靶标可能是具有挑战性的，但抽象概念仍然是有用的。在人体中有很多机制在起作用，找到一个有效的心理模型可能是至关重要的。

# 药物不仅仅靶向单个蛋白质

正如我们讨论过的，将为疾病设计药物的问题简化为设计与给定蛋白质紧密相互作用的药物的问题可能非常有用。但非常重要的是要意识到，实际上，任何给定的药物都将与人体中许多不同的子系统相互作用。研究这种多方面的相互作用被广泛称为多药效学。

目前，处理多药效学的计算方法仍然相对不发达，因此测试多药效的黄金标准仍然是动物和人体实验。随着计算技术的成熟，这种情况可能会在未来几年发生变化。

因此，我们的目标是设计能够有效预测给定分子何时与给定蛋白质相互作用的学习算法。我们如何做到这一点呢？首先，我们可以借鉴上一章关于分子机器学习的一些技术，尝试创建一个特定于蛋白质的模型。这样一个模型将会在给定一组分子（无论是否与给定蛋白质结合）的数据集的情况下，学习预测新分子是否会结合。这个想法实际上并不糟糕，但需要大量的数据来适应当前系统。理想情况下，我们希望有一种算法，可以在没有大量数据的情况下为新蛋白质工作。

事实证明，关键在于利用蛋白质的物理特性。正如我们将在下一节中讨论的那样，关于蛋白质分子的物理结构已经有了相当多的了解。特别是，可以使用现代实验技术创建蛋白质的 3D 状态的快照。这些 3D 快照可以输入学习算法中，并用于预测结合。还可以拍摄蛋白质与较小分子（通常称为配体）相互作用的快照。如果您现在觉得这个讨论很抽象，不用担心。在本章中，您将看到大量实用的代码。

我们将从更深入地概述蛋白质及其在生物学中的功能开始这一章。然后我们将转向计算机科学，并介绍一些用于将蛋白质系统特征化的算法，这些算法可以将生物物理系统转化为向量或张量以供学习使用。在本章的最后部分，我们将通过一个深入的案例研究来构建蛋白质-配体结合相互作用模型。为了进行实验，我们将介绍包含一系列实验确定的蛋白质-配体结构的 PDBBind 数据集。我们将演示如何使用 DeepChem 对这个数据集进行特征化。然后我们将在这些特征化的数据集上构建一些模型，包括深度模型和简单模型，并研究它们的性能。

# 为什么叫生物物理学？

人们常说，所有生物学都基于化学，所有化学都基于物理。乍一看，生物学和物理学可能看起来相距甚远。但正如我们将在本章后面更详细地讨论的那样，物理定律是所有生物机制的核心。此外，蛋白质结构的研究很大程度上取决于在物理学中精细改进的实验技术的使用。操纵纳米尺度的机器（因为蛋白质实际上就是这样）需要在理论和实践方面具有相当的物理复杂性。

有趣的是，我们将在本章讨论的深度学习算法与用于研究粒子物理系统或物理模拟的深度学习架构存在显著相似之处。这些主题超出了本书的范围，但我们鼓励感兴趣的读者进一步探索。

# 蛋白质结构

蛋白质是细胞中完成大部分工作的微型机器。尽管它们体积很小，但它们可能非常复杂。典型的蛋白质由数千个以精确方式排列的原子组成。

要理解任何机器，您必须知道它由哪些部分组成以及它们是如何组装在一起的。在了解汽车有底部的车轮、中间的空间用于搭载乘客以及乘客可以进出的门之前，您无法希望理解汽车。蛋白质也是如此。要理解它的工作原理，您必须确切地知道它是如何组装的。

此外，您需要知道它如何与其他分子相互作用。很少有机器是孤立运行的。汽车与搭载的乘客、行驶的道路以及使其移动的能源相互作用。这也适用于大多数蛋白质。它们作用于分子（例如，催化化学反应），被其他分子作用（例如，调节其活性），并从其他分子中吸取能量。所有这些相互作用取决于两个分子中原子的具体位置。要理解它们，您必须知道原子在三维空间中的排列方式。

不幸的是，您不能只是用显微镜观察蛋白质；它们太小了。相反，科学家们不得不发明复杂而巧妙的方法来确定蛋白质的结构。目前有三种这样的方法：X 射线晶体学、核磁共振（简称 NMR）和冷冻电子显微镜（简称 cryo-EM）。

X 射线晶体学是最古老的方法，仍然是最广泛使用的方法。大约 90%已知的蛋白质结构是通过这种方法确定的。晶体学涉及生长感兴趣蛋白质的晶体（许多蛋白质分子紧密堆积在一起形成规律重复的图案）。然后在晶体上照射 X 射线，测量散射光，然后分析结果以确定单个分子的结构。尽管这种方法取得了成功，但它有许多限制。即使在最好的情况下，它也是缓慢且昂贵的。许多蛋白质无法形成晶体，使晶体学成为不可能。将蛋白质包装成晶体可能会改变其结构，因此结果可能与其在活细胞中的结构不同。许多蛋白质是灵活的，可以采取一系列结构，但晶体学只产生一个静止的快照。但即使有这些限制，它仍然是一个非常强大和重要的工具。

核磁共振是第二常见的方法。它作用于溶液中的蛋白质，因此无需生长晶体。这使得它成为无法结晶的蛋白质的重要替代方法。与产生单个固定快照的晶体学不同，核磁共振产生代表蛋白质在溶液中可能呈现的形状范围的结构集合。这是一个非常重要的好处，因为它提供了有关蛋白质如何移动的信息。不幸的是，核磁共振也有其局限性。它需要高浓度的溶液，因此主要限于小型、高溶解性的蛋白质。

近年来，冷冻电镜已经成为确定蛋白质结构的第三种选择。它涉及迅速冷冻蛋白质分子，然后用电子显微镜对其进行成像。每个图像的分辨率远远不足以看清精确的细节；但通过结合许多不同的图像，可以产生一个最终结构，其分辨率比任何单个电子显微镜图像都要高得多。经过几十年对方法和技术的稳步改进，冷冻电镜终于开始接近原子分辨率。与晶体学和核磁共振不同，它适用于无法结晶的大型蛋白质。这可能使其成为未来几年中非常重要的技术。

[蛋白质数据银行（PDB）](https://www.rcsb.org/)是已知蛋白质结构的主要存储库。目前，它包含超过 142,000 个结构，如图 5-1 中的结构。这可能看起来很多，但远远不及我们真正想要的。已知蛋白质的数量是数量级更大的，而且每时每刻都在发现更多。对于您想研究的任何蛋白质，很有可能其结构仍然未知。而且您确实希望每种蛋白质有多个结构，而不仅仅是一个。许多蛋白质可以存在于多种功能上不同的状态（例如，“活跃”和“非活跃”状态），因此您希望了解每种状态的结构。如果蛋白质与其他分子结合，您希望有一个单独的结构，其中蛋白质与每个分子结合，以便您可以准确地看到它们如何结合。PDB 是一个很棒的资源，但整个领域仍处于“低数据”阶段。我们拥有的数据远远不及我们想要的，一个主要挑战是弄清如何充分利用我们所拥有的数据。这可能会持续几十年。

![来自炭疽芽孢杆菌的 CapD 蛋白的晶体结构，炭疽病原体。确定细菌蛋白质的结构可以成为抗生素设计的有力工具。更一般地说，确定与治疗相关的蛋白质的结构是现代药物发现的关键步骤之一。](img/dlls_0501.png)

###### 图 5-1。来自炭疽芽孢杆菌的 CapD 蛋白的晶体结构，炭疽病原体。确定细菌蛋白质的结构可以成为抗生素设计的有力工具。更一般地说，确定与治疗相关的蛋白质的结构是现代药物发现的关键步骤之一。

## 蛋白质序列

到目前为止，在本章中，我们主要讨论了蛋白质的结构，但我们还没有详细说明蛋白质在原子层面上由什么构成。蛋白质是由称为*氨基酸*的基本构建块构建而成。这些氨基酸是一组共享共同核心的分子，但具有不同的“侧链”附着（图 5-2）。这些不同的侧链改变了蛋白质的行为。

蛋白质是一条氨基酸链，一个接一个地连接在一起（图 5-3）。氨基酸链的起始部分通常被称为 N-末端，而链的末端被称为 C-末端。小的氨基酸链通常被称为*肽*，而较长的链被称为蛋白质。肽太小，无法具有复杂的三维结构，但蛋白质的结构可以非常复杂。

![氨基酸是蛋白质结构的构建块。这张图表示了一些常见氨基酸的化学结构。](img/dlls_0502.png)

###### 图 5-2。氨基酸是蛋白质结构的构建块。这张图表示了一些常见氨基酸的化学结构。（改编自[维基媒体](https://commons.wikimedia.org/wiki/File:Overview_proteinogenic_amino_acids-DE.svg)。）

![一个由四个氨基酸组成的链，N-末端在左侧，C-末端在右侧。](img/dlls_0503.png)

###### 图 5-3。一个由四个氨基酸组成的链，N-末端在左侧，C-末端在右侧。（来源：[维基百科](https://en.wikipedia.org/wiki/N-terminus#/media/File:Tetrapeptide_structural_formulae_v.1.png)。）

值得注意的是，虽然大多数蛋白质具有刚性形状，但也有固有无序蛋白质，其区域不愿采取刚性形状（图 5-4）。

![SUMO-1 蛋白的快照。蛋白质的中心核心具有结构，而 N-末端和 C-末端区域是无序的。像 SUMO-1 这样的固有无序蛋白质在计算上是具有挑战性的。](img/dlls_0504.png)

###### 图 5-4。SUMO-1 蛋白的快照。蛋白质的中心核心具有结构，而 N-末端和 C-末端区域是无序的。像 SUMO-1 这样的固有无序蛋白质在计算上是具有挑战性的。

在本章的其余部分，我们将主要讨论具有刚性、三维形状的蛋白质。处理没有固定形状的松散结构对现代计算技术仍然是具有挑战性的。

# 我们不能通过计算来预测三维蛋白质结构吗？

阅读本节后，您可能会想知道为什么我们不直接使用算法来预测有趣的蛋白质分子的结构，而是依赖复杂的物理实验。这是一个很好的问题，实际上已经有几十年的关于计算预测蛋白质结构的工作。

预测蛋白质结构有两种主要方法。第一种被称为*同源建模*。蛋白质序列和结构是亿万年演化的产物。如果两个蛋白质是近亲（技术术语是“同源物”），它们可能具有相似的结构。通过同源建模预测蛋白质的结构，您首先寻找一个结构已知的同源物，然后根据两种蛋白质序列之间的差异进行调整。同源建模对于确定蛋白质的整体形状效果还不错，但通常会出现细节错误。当然，这要求您已经知道一个同源蛋白质的结构。

另一种主要方法是*物理建模*。利用物理定律的知识，您尝试探索蛋白质可能采取的许多不同构象，并预测哪种构象最稳定。这种方法需要大量的计算时间。直到大约十年前，这是不可能的。即使在今天，它也只适用于小型、快速折叠的蛋白质。此外，它需要物理近似来加快计算速度，这些近似会降低结果的准确性。物理建模通常会预测正确的结构，但并非总是如此。

## 蛋白质结合简介

到目前为止，本章我们已经讨论了大量关于蛋白质结构的内容，但我们并没有多说蛋白质如何与其他分子相互作用。在实践中，蛋白质通常与小分子结合。有时，这种结合行为对蛋白质的功能至关重要：给定蛋白质的主要作用可能涉及与特定分子的结合。例如，细胞中的信号传导通常通过蛋白质与另一种分子结合的机制传递信息。有时，结合到蛋白质的分子是外来的：可能是我们创造的用于操纵蛋白质的药物，可能是干扰其功能的毒素。

![通过嵌入在细胞膜中的蛋白质传导的信号。](img/dlls_0505.png)

###### 图 5-5. 通过嵌入在细胞膜中的蛋白质传导的信号。（来源：[维基百科](https://simple.wikipedia.org/wiki/Signal_transduction#/media/File:The_External_Reactions_and_the_Internal_Reactions.jpg)。）

了解分子如何、何时、何地与蛋白质结合对于理解它们的功能并开发药物至关重要。如果我们能够利用人体细胞的信号传导机制，我们就可以在人体中引发期望的医学反应。

蛋白质结合涉及许多非常特定的相互作用，这使得计算预测变得困难。仅仅几个原子位置的微小变化就可以决定分子是否与蛋白质结合。此外，许多蛋白质是灵活的，不断移动。蛋白质可能在特定构象时能够结合分子，但在其他构象时则不能。结合反过来可能导致蛋白质构象的进一步变化，从而影响其功能。

在本章的其余部分，我们将以理解蛋白质结合的挑战作为激励计算的示例。我们将深入探讨当前深度学习和机器学习方法，以预测结合事件。

# 生物物理特征化

正如我们在上一章中讨论的那样，将机器学习应用于新领域的关键步骤之一是找出如何将训练数据转换（或特征化）为适合学习算法的格式。我们已经讨论了许多特征化单个小分子的技术。也许我们可以将这些技术调整为在生物物理系统中使用？

不幸的是，生物物理系统的行为受到它们的 3D 结构的严格限制，因此前几章的 2D 技术缺少关键信息。因此，我们将在本章讨论一对新的特征化技术。第一种特征化技术，*网格特征化*，明确搜索 3D 结构中关键物理相互作用的存在，例如氢键和盐桥（稍后会详细介绍），这些相互作用已知在决定蛋白质结构中起重要作用。这种技术的优势在于我们可以依赖大量关于蛋白质物理的已知事实。当然，弱点在于我们受到已知物理的约束，减少了我们的算法能够检测新物理的机会。

另一种特征化技术是*原子特征化*，它简单地提供了系统中所有原子的 3D 位置和身份的处理表示。这使得学习算法的挑战变得更加困难，因为它必须学会识别关键的物理相互作用，但也使得学习算法能够检测到有趣行为的新模式。

# PDB 文件及其缺陷

蛋白质结构通常存储在 PDB 文件中。这些文件只是包含结构中原子描述及其相对于彼此的坐标空间位置的文本文件。特征化算法通常依赖于读取 PDB 文件并将其存储到内存数据结构中的库。到目前为止一切顺利，对吧？

不幸的是，PDB 文件经常存在格式错误。原因在于底层物理学。通常，实验无法提供足够的分辨率来完全指定蛋白质结构的某个部分。这些区域在 PDB 文件中未指定，因此很常见地发现许多原子甚至整个蛋白质的亚结构缺失在核心结构中。

DeepChem 等库通常会尝试做“正确”的事情，并通过算法填补这些缺失区域。重要的是要注意，这种清理只是近似的，仍然没有完全令人满意的替代方案，即让专业人员在蛋白质结构（在适当的查看程序中）上查找问题。希望在未来几年内，处理这些错误的软件工具将得到改进，对专家指导的需求将减少。

## 网格特征化

通过将生物物理结构转换为向量，我们可以使用机器学习算法对其进行预测。可以想象，为处理蛋白质-配体系统而设计特征化算法将是有用的。然而，设计这样的算法是相当困难的。理想情况下，特征化技术需要在设计中将这些系统的化学知识融入其中，以便提取有用的特征。

这些特征可能包括蛋白质和配体之间的非共价键的计数，例如氢键或其他相互作用。（大多数蛋白质-配体系统之间没有蛋白质和配体之间的共价键。）

幸运的是，DeepChem 有这样一个可用的特征化器。其`RdkitGridFeaturizer`将一组相关的化学信息总结为一个简短的向量，用于学习算法。虽然不必深入了解底层科学就能使用特征化器，但了解底层物理学仍然是有用的。因此，在我们深入描述网格特征化器计算之前，我们将首先回顾一些有关大分子复合物的相关生物物理学。

在阅读本节时，可能有必要回顾前一章中关于基本化学相互作用的讨论。共价键和非共价键等概念将经常出现。

网格特征化器在给定结构中搜索这种化学相互作用的存在，并构建一个包含这些相互作用计数的特征向量。我们将在本章后面更详细地介绍这是如何通过算法完成的。

### 氢键

当氢原子与氧或氮等更电负原子共价键合时，共享电子大部分时间都靠近更电负的原子。这使得氢带有净正电荷。如果这个带正电的氢接近另一个带有净负电荷的原子，它们会相互吸引。这就是氢键（图 5-6）。

![氢键的渲染示例。氧上的过剩负电荷与氢上的过剩正电荷相互作用，形成键合作用。](img/dlls_0506.png)

###### 图 5-6。氢键的渲染示例。氧上的过剩负电荷与氢上的过剩正电荷相互作用，形成键合作用。（来源：[Wikimedia](https://commons.wikimedia.org/wiki/File:Hydrogen-bonding-in-water-2D.png)。）

由于氢原子非常小，它们可以非常靠近其他原子，导致强烈的静电吸引力。这使得氢键成为最强的非共价相互作用之一。它们是一种通常稳定分子系统的关键相互作用形式。例如，水独特的性质很大程度上归因于水分子之间形成的氢键网络。

`RdkitGridFeaturizer`尝试通过检查适当接近的蛋白质/配体原子对来计算结构中存在的氢键。这需要对距离应用一个截断，这在某种程度上是任意的。实际上，原子之间不存在明确的成键和非成键之间的分界线。这可能导致一些被错误识别的相互作用，但经验上，简单的截断通常效果还不错。

### 盐桥

盐桥是两个氨基酸之间的一种非共价吸引力，其中一个带有正电荷，另一个带有负电荷（见图 5-7）。它结合了离子键和氢键。尽管这些键相对较弱，但它们可以通过在蛋白质序列中远距离的氨基酸之间提供相互作用来帮助稳定蛋白质的结构。

![谷氨酸和赖氨酸之间盐桥的插图。盐桥是一种离子式静电相互作用和氢键的组合，用于稳定结构。](img/dlls_0507.png)

###### 图 5-7。谷氨酸和赖氨酸之间盐桥的插图。盐桥是一种离子式静电相互作用和氢键的组合，用于稳定结构。（来源：[Wikimedia](https://commons.wikimedia.org/wiki/File:Revisited_Glutamic_Acid_Lysine_salt_bridge.png)。）

网格特征化器尝试通过明确检查已知形成这种相互作用的氨基酸对（如谷氨酸和赖氨酸），并且在蛋白质的三维结构中处于密切物理接近的位置来检测盐桥。

### Pi-堆叠相互作用

Pi-堆叠相互作用是*芳香环*之间的一种非共价相互作用（图 5-8）。这些是平坦的、环形的结构，出现在许多生物分子中，包括 DNA 和 RNA。它们还出现在一些氨基酸的侧链中，包括苯丙氨酸、酪氨酸和色氨酸。

![苯分子中的芳香环。这种环结构以其异常稳定性而闻名。此外，芳香环中的所有原子都位于同一平面上。相比之下，非同质环的原子并不在同一平面上。](img/dlls_0508.png)

###### 图 5-8。苯分子中的芳香环。这种环结构以其异常稳定性而闻名。此外，芳香环中的所有原子都位于同一平面上。相比之下，非同质环的原子并不在同一平面上。

粗略地说，pi-堆叠相互作用发生在两个芳香环“堆叠”在一起时。图 5-9 显示了两个苯环可以相互作用的一些方式。这种堆叠相互作用，就像盐桥一样，可以帮助稳定各种大分子结构。重要的是，pi-堆叠相互作用可以在配体-蛋白相互作用中找到，因为芳香环通常出现在小分子中。网格特征化器通过检测芳香环的存在并检查它们的质心之间的距离和两个平面之间的角度来计算这些相互作用。

![各种非共价芳香环相互作用。在位移相互作用中，两个芳香环的中心略微偏离彼此。在边对面相互作用中，一个芳香环的边叠在另一个的面上。夹心结构有两个环直接叠放，但比位移或边对面相互作用的能量更不利，因为相同电荷的区域会紧密相互作用。](img/dlls_0509.png)

###### 图 5-9。各种非共价芳香环相互作用。在位移相互作用中，两个芳香环的中心略微偏离彼此。在边对面相互作用中，一个芳香环的边叠在另一个的面上。夹心结构有两个环直接叠放，但比位移或边对面相互作用的能量更不利，因为相同电荷的区域会紧密相互作用。

此时，您可能想知道为什么这种类型的相互作用被称为π-堆叠。这个名字指的是π键，一种共价化学键的形式，其中两个共价键合原子的电子轨道重叠。在芳香环中，环中的所有原子都参与了一个共同的π键。这种共同键解释了芳香环的稳定性，并且还解释了它的许多独特化学性质。

对于那些不是化学家的读者，如果这些材料目前还不太明白，不要担心太多。DeepChem 抽象了许多这些实现细节，因此在开发时不需要经常担心π-堆叠。然而，了解这些相互作用的存在并在基础化学中发挥重要作用是有用的。

# 复杂的几何结构和快照

在这一部分，我们介绍了许多关于静态几何配置的相互作用。非常重要的是要意识到键是动态实体，在真实的物理系统中，键会以令人眼花缭乱的速度伸展、断裂、破裂和重组。请记住，当有人说盐桥存在时，他们真正的意思是在某种统计平均意义上，盐桥在特定位置很可能经常存在。

### 指纹

从前一章，您可能还记得使用圆形指纹。这些指纹计算分子中给定类型的片段数量，然后使用哈希函数将这些片段计数适应到固定长度的向量中。这种片段计数也可以用于 3D 分子复合物。尽管仅仅计算片段通常不足以计算系统的几何结构，但已知存在的片段的知识对机器学习系统仍然有用。这可能是因为某些片段的存在可以强烈表明某些分子事件。

### 一些实现细节

要搜索化学特征，如氢键，`dc.feat.RdkitGridFeaturizer`需要能够有效地处理分子的几何结构。DeepChem 使用 RDKit 库将每个分子、蛋白质和配体加载到一个共同的内存对象中。然后，这些分子被转换为包含空间中所有原子位置的 NumPy 数组。例如，一个具有*N*个原子的分子可以表示为形状为`(*N*, 3)`的 NumPy 数组，其中每行表示 3D 空间中一个原子的位置。

然后，进行（粗略的）氢键检测只需要查看所有可能形成氢键（如氧和氢）的原子对，这些原子彼此之间足够接近。检测其他类型的键也使用相同的计算策略。对于处理芳香结构，有一些特殊代码来检测结构中芳香环的存在并计算它们的质心。

## 原子特征化

在上一节的结尾，我们简要概述了`RdkitGridFeaturizer`如何计算氢键等特征。大多数操作将具有*N*个原子的分子转换为形状为`(*N*, 3)`的 NumPy 数组，然后从这些数组开始执行各种额外的计算。

您可以轻松想象，为给定分子进行特征化可能只涉及计算这个`(*N*, 3)`数组并将其传递给适当的机器学习算法。然后，模型可以自行学习哪些特征是重要的，而不是依赖人类选择并手动编码它们。

事实上，这是可以实现的，只需多做几个步骤。`(*N*, 3)`位置数组不区分原子类型，因此您还需要提供另一个数组，列出每个原子的原子序数。作为第二个实现驱动的注意事项，计算形状为`(*N*, 3)`的两个位置数组之间的成对距离可能非常耗费计算资源。在预处理步骤中创建“邻居列表”是有用的，其中邻居列表维护了靠近任何给定原子的邻近原子的列表。

DeepChem 提供了一个`dc.feat.ComplexNeighborListFragmentAtomicCoordinates`特征化器，可以为您处理其中的大部分内容。我们不会在本章进一步讨论它，但知道它作为另一个选择是很好的。

# PDBBind 案例研究

有了这个介绍，让我们开始尝试处理生物物理数据集的一些代码示例。我们将首先介绍 PDBBind 数据集和结合自由能预测问题。然后，我们将提供如何对 PDBBind 数据集进行特征化的代码示例，并演示如何为其构建机器学习模型。我们将以讨论如何评估结果结束案例研究。

## PDBBind 数据集

PDBBind 数据集包含大量生物分子晶体结构及其结合亲和力。有一些术语，让我们停下来解释一下。生物分子是任何生物感兴趣的分子。这不仅包括蛋白质，还包括核酸（如 DNA 和 RNA）、脂质和较小的药物样分子。生物分子系统的丰富性很大程度上来自各种生物分子之间的相互作用（我们已经详细讨论过）。结合亲和力是两种分子形成复合物的实验测定亲和力，这两种分子相互作用。如果形成这样的复合物是能量有利的，那么分子将更多时间保持在这种构型中，而不是其他构型中。

PDBBind 数据集已经收集了许多生物分子复合物的结构。其中绝大多数是蛋白质-配体复合物，但数据集还包含蛋白质-蛋白质、蛋白质-核酸和核酸-配体复合物。对于我们的目的，我们将专注于蛋白质-配体子集。完整数据集包含近 15000 个这样的复合物，其中“精炼”和“核心”集合包含更小但更干净的复合物子集。每个复合物都附带了对该复合物的结合亲和力的实验测量。PDBBind 数据集的学习挑战是根据蛋白质-配体结构预测复合物的结合亲和力。

PDBBind 的数据是从蛋白质数据银行中收集的。请注意，PDB（因此 PDBBind）中的数据非常异质！不同的研究小组有不同的实验设置，不同小组进行的不同测量之间可能存在高实验方差。因此，我们将主要使用 PDBBind 数据集的经过筛选的精炼子集来进行我们的实验工作。

# 动态很重要！

在这个案例研究中，我们将蛋白质和配体视为一个冻结的快照。请注意，这是非常不符合物理规律的！蛋白质和配体实际上在快速运动，配体会在蛋白质的结合口中进出。此外，蛋白质甚至可能没有一个固定的结合口。对于一些蛋白质，可能有多个不同的位点与潜在的配体相互作用。

所有这些因素的组合意味着我们的模型的准确性将相对有限。如果我们有更多的数据，可能强大的学习模型可以学会考虑这些因素，但在数据集更有限的情况下，这是具有挑战性的。

您可能应该注意这些信息。设计更好的生物物理深度学习模型以准确考虑这些系统的热力学行为仍然是一个重要的未解问题。

# 如果您没有结构会怎么样？

药物发现的老手可能会在这里停顿一分钟。事实是，在实验上确定一个复杂结构要比测量结合亲和力更困难。这在直觉上是有道理的。结合亲和力是给定生物分子复合物的一个单一数字，而结构是一个丰富的三维快照。从结构预测结合亲和力可能感觉有点本末倒置！

对于这个（公平的）指责有几个答案。第一个是确定生物分子系统的结合亲和力是一个物理上有趣的问题。检查我们能否准确预测这种结合亲和力是一个值得的测试问题，可以用来评估我们的机器学习方法，并可以作为设计能够理解复杂生物物理系统的深度架构的基石。

第二个答案是，我们可以使用现有的计算工具，比如“对接”软件，来预测蛋白质-配体复合物的近似结构，只要我们有蛋白质的结构。虽然直接预测蛋白质结构是一个艰巨的挑战，但在已有蛋白质结构的情况下，预测蛋白质-配体复合物的结构就相对容易一些。因此，在这个案例研究中，通过将其与对接引擎配对，您可能能够使用我们将创建的系统进行有用的预测。事实上，DeepChem 支持这种用例，但在本章中我们不会深入探讨这一更高级的功能。

总的来说，在进行机器学习时，查看数据集中的单个数据点或文件可能特别有用。在与本书相关的[代码存储库](https://github.com/deepchem/DeepLearningLifeSciences)中，我们包含了一个名为 2D3U 的蛋白质-配体复合物的 PDB 文件。它包含有关蛋白质的氨基酸（也称为残基）的信息。此外，PDB 文件包含每个原子在三维空间中的坐标。这些坐标的单位是埃（1 埃等于 10 的负 10 次方米）。这个坐标系的原点是任意设置的，以帮助可视化蛋白质，并且通常设置在蛋白质的质心处。我们建议花一分钟时间在文本编辑器中打开这个文件并查看一下。

# 为什么氨基酸被称为残基？

当您花更多时间处理生物物理数据时，您将经常遇到将氨基酸称为“残基”的术语。这涉及到蛋白质形成的化学过程。当两个氨基酸在一个不断增长的链中连接在一起时，一个氧和两个氢被移除。在这个反应发生后，所谓的“残基”就是氨基酸剩余的部分。

理解 PDB 文件的内容可能非常困难，因此让我们可视化一个蛋白质。我们将使用[NGLview](https://github.com/arose/nglview)可视化包，它与 Jupyter 笔记本很好地集成。在与本章相关的代码存储库中的笔记本中，您将能够操纵和与可视化的蛋白质进行交互。目前，图 5-10 显示了在 Jupyter 笔记本中生成的蛋白质-配体复合物（2D3U）的可视化。

![来自 PDBBind 数据集的 2D3U 蛋白质-配体复合物的可视化。请注意，为了方便可视化，蛋白质以卡通格式表示，而配体（靠近右上角）以球棒格式表示以获得完整细节。](img/dlls_0510.png)

###### 图 5-10。来自 PDBBind 数据集的 2D3U 蛋白质-配体复合物的可视化。请注意，为了方便可视化，蛋白质以卡通格式表示，而配体（靠近右上角）以球棒格式表示以获得完整细节。

请注意配体如何位于蛋白质的一种“口袋”中。通过旋转可视化以从不同角度观察，您可以更清楚地看到这一点。

# 蛋白质可视化工具

考虑到可视化蛋白质对于处理它们的重要性，有许多蛋白质可视化工具可供选择。虽然 NGLview 具有令人惊叹的 Jupyter 集成功能，但更常见的是看到其他工具，如[VMD](https://www.ks.uiuc.edu/Research/vmd/)，[PyMOL](https://pymol.org)，或[Chimera](https://www.cgl.ucsf.edu/chimera/)，被专业的药物发现者使用。然而，请注意，这些工具通常并非完全开源，并且可能没有开发人员友好的 API。尽管如此，如果您计划花费大量时间处理蛋白质结构，使用其中一个更成熟的工具可能仍然值得权衡。

## 对 PDBBind 数据集进行特征化

让我们从构建一个我们可以检查的`RdkitGridFeaturizer`对象开始：

```py
import deepchem as dc
grid_featurizer = dc.feat.RdkitGridFeaturizer(
                     voxel_width=2.0, 
                     feature_types=['hbond', 'salt_bridge', 'pi_stack', 
                                     'cation_pi', 'ecfp', 'splif'], 
                     sanitize=True, flatten=True)

```

这里有许多选项，让我们暂停一下并考虑它们的含义。`sanitize=True`标志要求特征化器尝试清理给定的任何结构。回想一下我们之前讨论过的，结构经常存在错误。清理步骤将尝试修复它检测到的任何明显错误。设置`flatten=True`要求特征化器为每个输入结构输出一个一维特征向量。

`feature_types`标志设置了`RdkitGridFeaturizer`将尝试在输入结构中检测的生物物理和化学特征的类型。请注意，许多我们在本章前面讨论过的化学键的存在：氢键，盐桥等。最后，选项`voxel_width=2.0`将组成网格的体素的大小设置为 2 埃。`RdkitGridFeaturizer`将蛋白质转换为体素化表示，以用于提取有用的特征。对于每个空间体素，它计算生物物理特征，并计算一个局部指纹向量。`RdkitGridFeaturizer`计算两种不同类型的指纹，即 ECFP 和 SPLIF 指纹。

# 体素化

什么是体素化？广义上说，体素是像素的三维模拟（参见图 5-11）。正如图像的像素化表示对处理图像数据非常有用一样，体素化表示在处理 3D 数据时也非常关键。

![一个球的体素化表示。请注意每个体素代表一个输入的空间立方体。](img/dlls_0511.png)

###### 图 5-11。一个球的体素化表示。请注意每个体素代表一个输入的空间立方体。

我们现在准备加载 PDBBind 数据集。实际上，我们不需要使用刚刚定义的特征化器：MoleculeNet 会为我们处理。如果在加载数据集时包含标志`featurizer="grid"`，它将自动执行网格特征化：

```py
tasks, datasets, transformers = dc.molnet.load_pdbbind(
        featurizer="grid", split="random", subset="core")
train_dataset, valid_dataset, test_dataset = datasets

```

通过这段代码片段，我们已经加载并对 PDBBind 的核心子集进行了特征化。在一台快速计算机上，这应该在 10 分钟内运行。在现代服务器上，对精炼子集进行特征化将需要几个小时。

现在我们已经掌握了数据，让我们开始构建一些机器学习模型。我们将首先训练一个称为*随机森林*的经典模型：

```py
from sklearn.ensemble import RandomForestRegressor                 
sklearn_model = RandomForestRegressor(n_estimators=100)
model = dc.models.SklearnModel(sklearn_model)
model.fit(train_dataset)
```

作为替代方案，我们还将尝试构建一个用于预测蛋白质-配体结合的神经网络。我们可以使用`dc.models.MultitaskRegressor`类构建一个具有两个隐藏层的 MLP。我们将隐藏层的宽度分别设置为 2,000 和 1,000，并使用 50%的丢失率来减少过度拟合。

```py
n_features = train_dataset.X.shape[1]
model = dc.models.MultitaskRegressor(
        n_tasks=len(pdbbind_tasks),
        n_features=n_features,
        layer_sizes=[2000, 1000],
        dropouts=0.5,
        learning_rate=0.0003)
model.fit(train_dataset, nb_epoch=250)
```

# 基线模型

深度学习模型有时很难正确优化。即使是经验丰富的从业者在调整深度模型时也很容易出错。因此，构建一个更加稳健的基线模型至关重要，即使它可能表现较低。

随机森林是基线的非常有用选择。它们通常在学习任务中表现出色，而且调整量相对较小。随机森林分类器构建许多“决策树”分类器，每个分类器仅使用可用特征的随机子集，然后通过多数投票结合这些分类器的个别决策。

Scikit-learn 是一个无价的包，用于构建简单的机器学习基线。我们将在本章中使用 scikit-learn 构建一个基线模型，使用`RdkitGridFeaturizer`将复合物特征化为随机森林的输入。

现在我们有了一个经过训练的模型，我们可以继续检查其准确性。为了评估模型的准确性，我们必须首先定义一个合适的指标。让我们使用 Pearson R²分数。这是一个介于-1 和 1 之间的数字，其中 0 表示真实标签和预测标签之间没有相关性，1 表示完美相关性。

```py
metric = dc.metrics.Metric(dc.metrics.pearson_r2_score)

```

现在让我们根据这个指标评估模型在训练和测试数据集上的准确性。执行此操作的代码在两个模型之间再次共享：

```py
print("Evaluating model")
train_scores = model.evaluate(train_dataset, [metric], transformers)
test_scores = model.evaluate(test_dataset, [metric], transformers)

print("Train scores")
print(train_scores)

print("Test scores")
print(test_scores)

```

# 许多架构可能具有类似的效果

在本节中，我们提供了如何使用带有网格特征化的 MLP 来模拟 DeepChem 中的蛋白质-配体结构的代码示例。重要的是要注意，还有许多其他深度架构具有类似的效果。已经有一系列关于使用 3D 卷积网络来预测基于体素特征化的蛋白质-配体结合相互作用的工作。其他工作使用了我们在上一章中看到的图卷积的变体来处理大分子复合物。

这些架构之间有什么区别？到目前为止，大多数看起来具有类似的预测能力。我们使用网格特征化是因为 DeepChem 中有一个经过调整的实现，但其他模型也可能满足您的需求。未来版本的 DeepChem 可能会包括额外的架构来实现这一目的。

对于随机森林，这报告了训练集得分为 0.979，但测试集得分仅为 0.133。它在复制训练数据方面表现出色，但在预测测试数据方面表现非常糟糕。显然，它过度拟合得相当严重。

相比之下，神经网络的训练集得分为 0.990，测试集得分为 0.359。它在训练集上稍微表现更好，在测试集上表现更好。显然仍然存在过度拟合，但过度拟合的程度有所减少，模型预测新数据的整体能力更高。

了解相关系数是理解我们构建的模型的一个强大的第一步，但直接可视化我们的预测与实际实验数据的相关性总是有用的。图 5-12 显示了在测试集上运行时每个模型的真实与预测标签。我们立即看到神经网络的预测与真实数据的相关性要比随机森林的要更接近。

![在测试集上运行时两个模型的真实与预测标签。](img/dlls_0512.png)

###### 图 5-12。在测试集上运行时两个模型的真实与预测标签。

# 结论

在本章中，您已经了解了将深度学习应用于生物物理系统，特别是解决预测蛋白质-配体系统结合亲和力的问题。您可能会好奇您学到的技能有多通用。您能否应用这些相同的模型和技术来理解其他生物物理数据集？让我们进行一个快速调查和浏览。

蛋白质-蛋白质和蛋白质-DNA 系统在高层次上遵循与蛋白质-配体系统相同的基本物理规律。相同的氢键，盐桥，π-堆积相互作用等起着关键作用。我们能否只是重复使用本章的代码来分析这些系统？答案是有点复杂的。驱动蛋白质-配体相互作用的许多物理相互作用是由带电动力驱动的。另一方面，蛋白质-蛋白质动力学可能更多地受到体积疏水相互作用的影响。我们不会深入探讨这些相互作用的含义，但它们在某种程度上在质性上与蛋白质-配体相互作用有所不同。这可能意味着`RdkitGridFeaturizer`可能无法很好地表征这些相互作用。另一方面，原子卷积模型可能更适合处理这些系统，因为这些深度模型中的物理相互作用的信息要少得多。

尽管如此，规模仍然存在一个重大问题。原子卷积模型训练速度相当慢，需要大量内存。将这些模型扩展到处理更大的蛋白质-蛋白质系统需要在工程端进行额外的工作。DeepChem 开发团队正在努力解决这些和其他挑战，但可能需要更多时间才能取得成果。

抗体-抗原相互作用是另一种关键的生物物理相互作用形式。抗体是 Y 形蛋白质（参见图 5-13），具有可变的“抗原结合位点”，用于结合抗原。在这里，抗原是与特定病原体相关的分子。在培养中生长的细胞可以被利用来产生针对特定抗原的抗体。如果培养中的所有细胞都是给定细胞的克隆体，那么产生的抗体将是相同的。这种“单克隆抗体”最近在广泛的治疗中得到了应用。

![抗体-抗原相互作用示意图](img/dlls_0513.png)

###### 图 5-13。抗体-抗原相互作用示意图。 (来源：[Wikimedia](https://en.wikipedia.org/wiki/Antibody#/media/File:Antibody.svg).)

抗体的设计直到现在主要还是一门实验科学。部分原因是由于获取 3D 抗体结构所涉及的挑战。然而，建模复杂的抗原-抗体结合位点也被证明是一个挑战。我们在本章中介绍的一些技术可能在未来几年内在抗体-抗原结合建模中找到有益的用途。

我们还提到了动态在理解蛋白质物理学中的重要性。我们不能直接在蛋白质模拟中进行深度学习，以了解哪些配体可以结合到蛋白质吗？原则上是可以的，但仍然存在巨大的挑战。一些公司正在积极应对这一挑战，但良好的开源工具尚未推出。

在第十一章中，我们将回顾一些生物物理技术，并展示这些模型如何对药物发现工作非常有用。
