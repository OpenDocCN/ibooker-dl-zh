- en: Capitolo 9\. Proteggere i servizi di intelligenza artificiale
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第9章。保护人工智能服务
- en: 'Questo lavoro è stato tradotto utilizzando l''AI. Siamo lieti di ricevere il
    tuo feedback e i tuoi commenti: [translation-feedback@oreilly.com](mailto:translation-feedback@oreilly.com)'
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 这项工作是用人工智能翻译的。我们很高兴收到您的反馈和评论：[translation-feedback@oreilly.com](mailto:translation-feedback@oreilly.com)
- en: Nei capitoli precedenti, hai imparato a costruire servizi GenAI che servano
    vari generatori di IA supportando la concorrenza e lo streaming dei dati in tempo
    reale. Inoltre, hai integrato sistemi esterni come i database e hai implementato
    i tuoi meccanismi di autenticazione e autorizzazione. Infine, hai scritto una
    suite di test per verificare la funzionalità e le prestazioni dell'intero sistema.
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 在前面的章节中，你学习了如何构建服务于各种IA生成器的GenAI服务，支持实时数据流和竞争。此外，你集成了外部系统，如数据库，并实现了你的身份验证和授权机制。最后，你编写了一套测试来验证整个系统的功能和性能。
- en: In questo capitolo imparerai a implementare meccanismi di moderazione dell'uso
    e di protezione dagli abusi per proteggere i tuoi servizi GenAI.
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，你将学习如何实施使用监控和保护滥用机制来保护你的GenAI服务。
- en: Moderazione dell'uso e protezione dagli abusi
  id: totrans-4
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用监控和保护滥用
- en: Quando distribuisci i tuoi servizi GenAI, devi considerare come i tuoi servizi
    saranno utilizzati in modo improprio da utenti malintenzionati. Questo è essenziale
    per proteggere la sicurezza degli utenti e la tua reputazione. Non puoi sapere
    come gli utenti utilizzeranno il tuo sistema, quindi devi pensare al peggio e
    implementare *delle protezioni* per proteggerti da qualsiasi abuso o uso improprio.
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: 当你分发你的GenAI服务时，你必须考虑你的服务可能会被恶意用户不当使用。这对于保护用户安全和你的声誉至关重要。你无法知道用户会如何使用你的系统，因此你必须考虑最坏的情况，并实施*保护措施*以防止任何滥用或不正当使用。
- en: Secondo un [recente studio sulle applicazioni nefaste della GenAI](https://oreil.ly/ihmzR),
    i tuoi servizi possono essere potenzialmente utilizzati con *intenti malevoli*,
    come descritto nella [Tabella 9-1](#malicious_intents).
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
  zh: 根据[关于GenAI有害应用的近期研究](https://oreil.ly/ihmzR)，你的服务可能被潜在地用于*恶意意图*，如[表9-1](#malicious_intents)中所述。
- en: Tabella 9-1\. Intenti malevoli alla base dell'abuso dei servizi GenAI
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: 表9-1. GenAI服务滥用背后的恶意意图
- en: '| Intento | Esempi | Casi reali |'
  id: totrans-8
  prefs: []
  type: TYPE_TB
  zh: '| 意图 | 例子 | 实际案例 |'
- en: '| --- | --- | --- |'
  id: totrans-9
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- | --- |'
- en: '| **Disonestà**Sostenere bugie e falsità | Plagio, falsificazione di competenze
    e conoscenze, falsificazione di documenti, imbrogli negli esami e nei colloqui,
    ecc. | Aumentano i casi di studenti che imbrogliano con l''intelligenza artificiale
    nelle università britanniche e australiane^([a](ch09.html#id1032)) |'
  id: totrans-10
  prefs: []
  type: TYPE_TB
  zh: '| **不诚实**支持谎言和虚假 | 剽窃、伪造技能和知识、伪造文件、考试和面试作弊等 | 英国和澳大利亚大学中利用人工智能作弊的学生案例增加^([a](ch09.html#id1032))
    |'
- en: '| **Propaganda**Distorsione della percezione della realtà per promuovere un''agenda
    | Impersonare altre persone, promuovere l''estremismo, influenzare le campagne,
    ecc. | I falsi conduttori di notizie AI che diffondono disinformazione o propaganda^([b](ch09.html#id1033))
    |'
  id: totrans-11
  prefs: []
  type: TYPE_TB
  zh: '| **宣传**扭曲现实感知以推广议程 | 模仿他人、推广极端主义、影响竞选活动等 | 传播虚假信息或宣传的人工智能假新闻主播^([b](ch09.html#id1033))
    |'
- en: '| **L''inganno**Ingannare gli altri e creare false impressioni | Generazione
    di recensioni false, annunci truffaldini ed email di phishing, profili sintetici
    (ad esempio, sockpuppeting), ecc. | Lo studio di ingegneria Arup è stato vittima
    di una truffa deepfake da 25 milioni di dollari^([c](ch09.html#id1034)) |'
  id: totrans-12
  prefs: []
  type: TYPE_TB
  zh: '| **欺骗**欺骗他人并创造虚假印象 | 生成虚假评论、欺诈性广告和钓鱼邮件、合成资料（例如，sockpuppeting）等 | 阿鲁普工程公司成为价值2500万美元的deepfake欺诈的受害者^([c](ch09.html#id1034))
    |'
- en: '| ^([a](ch09.html#id1032-marker)) Fonti: *Times Higher Education* e *The Guardian*^([b](ch09.html#id1033-marker))
    Fonti: *The Guardian*, *MIT Technology Review* e *The Washington Post*^([c](ch09.html#id1034-marker))
    Fonti: CNN e *The Guardian* |'
  id: totrans-13
  prefs: []
  type: TYPE_TB
  zh: '| ^([a](ch09.html#id1032-marker)) 来源：*《泰晤士高等教育》* 和 *《卫报》*^([b](ch09.html#id1033-marker))
    来源：*《卫报》*、*《麻省理工学院技术评论》* 和 *《华盛顿邮报》*^([c](ch09.html#id1034-marker)) 来源：CNN 和 *《卫报》*
    |'
- en: 'Lo stesso studio classifica gli abusi delle applicazioni GenAI come segue:'
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 同一研究将GenAI应用的滥用分类如下：
- en: '*Disinformazione e disinformazione* per diffondere propaganda e fake news'
  id: totrans-15
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*虚假信息与误导* 用于传播宣传和假新闻'
- en: '*Amplificazione dei pregiudizi e discriminazione* per promuovere programmi
    razzisti ediscriminazioni sociali'
  id: totrans-16
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*偏见放大和歧视* 用于推广种族主义和社会歧视计划'
- en: '*Generazione di contenuti dannosi* attraverso la creazione di contenuti tossici,
    ingannevoli e radicalizzanti'
  id: totrans-17
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*有害内容的生成* 通过创建有毒、欺骗性和极端主义的内容'
- en: '*Attacchi alla privacy dei dati* per colmare le lacune dei dati privati rubati
    e far trapelareinformazioni sensibili'
  id: totrans-18
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*数据隐私攻击* 用于填补被盗数据的空白并泄露敏感信息'
- en: '*Cyberattacchi automatizzati* per personalizzare gli attacchi di phishing e
    ransomware'
  id: totrans-19
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*自动化网络攻击* 用于定制钓鱼和勒索软件攻击'
- en: '*Furto d''identità e ingegneria sociale* per aumentare il tasso di successo
    delle truffe'
  id: totrans-20
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*身份盗窃和社会工程学* 用于提高诈骗成功率'
- en: '*Deepfakes e manipolazione multimediale* per trarre profitto e alterare la
    percezione della realtà e le credenze sociali'
  id: totrans-21
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*深度伪造和多媒体操纵* 用于获利并改变对现实和社交信念的感知'
- en: '*Truffa e frode* manipolando i mercati azionari e realizzando truffe mirate'
  id: totrans-22
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*欺诈和诈骗* 通过操纵股市和实施针对性诈骗'
- en: Non si tratta di un elenco esaustivo, ma dovrebbe darti qualche idea su quali
    misure di moderazione dell'uso prendere in considerazione.
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: 这不是一个详尽的列表，但它应该给你一些关于可以考虑采取哪些使用调节措施的思路。
- en: '[Un altro studio sulla tassonomia delle tattiche di abuso della GenAI](https://oreil.ly/jbG01)
    ha analizzato l''abuso per modalità e ha rilevato che:'
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: '[关于GenAI滥用策略分类的另一项研究](https://oreil.ly/jbG01)分析了滥用模式，并发现：'
- en: Per la maggior parte dei tentativi di impersonificazione sono stati utilizzati*generatori
    audio e video*.
  id: totrans-25
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 对于大多数拟人化尝试，都使用了*音频和视频生成器*。
- en: I*generatori di immagini e di testo* sono stati utilizzati per la maggior parte
    dei sockpuppeting, il content farming per la manipolazione delle opinioni in scala
    e i tentativi di falsificazione.
  id: totrans-26
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*图像和文本生成器* 被用于大多数sockpuppeting、大规模意见操纵的内容农场和伪造尝试。'
- en: I*generatori di immagini e video* sono stati utilizzati per la maggior parte
    dei tentativi di steganografia (cioè di nascondere messaggi codificati nei risultati
    del modello) e di generazione di contenuti intimi non consensuali (NCII).
  id: totrans-27
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*图像和视频生成器* 已被用于大多数隐写术尝试（即隐藏在模型结果中的编码消息）和非同意的私密内容生成。'
- en: Se stai creando dei servizi che supportano queste modalità, devi considerare
    le forme di abuso ad esse associate e implementare i relativi meccanismi di protezione.
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你正在创建支持这些模式的服务，你必须考虑与之相关的滥用形式，并实施相应的保护机制。
- en: Oltre all'uso improprio e all'abuso, dovrai anche considerare le vulnerabilità
    della sicurezza.
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: 除了误用和滥用之外，你还必须考虑安全漏洞。
- en: La sicurezza dei servizi GenAI è ancora un'area di ricerca al momento della
    stesura di questo articolo. Ad esempio, se i tuoi servizi sfruttano le LLM, OWASP
    ha classificato le [10 principali vulnerabilità delle LLM](https://oreil.ly/4zob2),
    come mostrato nella [Tabella 9-2](#llm_vulnerabilities).
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: 到本文撰写时，GenAI服务的安全性仍是一个研究领域。例如，如果你的服务利用了LLM，OWASP已将[10个主要LLM漏洞](https://oreil.ly/4zob2)分类，如[表9-2](#llm_vulnerabilities)所示。
- en: Tabella 9-2\. Le 10 principali vulnerabilità LLM di OWASP
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: 表9-2\. OWASP的10个主要LLM漏洞
- en: '| Rischio | Descrizione |'
  id: totrans-32
  prefs: []
  type: TYPE_TB
  zh: '| 风险 | 描述 |'
- en: '| --- | --- |'
  id: totrans-33
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- |'
- en: '| Iniezione prompt | La manipolazione degli input per controllare le risposte
    del LLM porta ad accessi non autorizzati, violazioni dei dati e compromissione
    del processo decisionale. |'
  id: totrans-34
  prefs: []
  type: TYPE_TB
  zh: '| 提示注入 | 通过操纵输入来控制LLM的响应导致未经授权的访问、数据违规和决策过程受损。 |'
- en: '| Gestione insicura dell''output | La mancata sanitizzazione o convalida degli
    output di LLM causa l''esecuzione di codice remoto sui sistemi a valle. |'
  id: totrans-35
  prefs: []
  type: TYPE_TB
  zh: '| 输出管理不安全 | LLM输出未进行消毒或验证导致在下游系统上执行远程代码。 |'
- en: '| Avvelenamento dei dati di formazione | Iniettare dati nelle fonti su cui
    i modelli vengono addestrati per compromettere la sicurezza, l''accuratezza o
    il comportamento etico. I modelli open source e i servizi RAG che si basano su
    dati web sono i più esposti a questi attacchi. |'
  id: totrans-36
  prefs: []
  type: TYPE_TB
  zh: '| 训练数据中毒 | 将数据注入用于训练模型的来源，以损害安全性、准确性或道德行为。开源模型和基于网络数据的RAG服务最容易受到此类攻击。 |'
- en: '| Modello di negazione del servizio | Causare interruzioni del servizio ed
    esplosioni dei costi sovraccaricando gli LLMs con carichi pesanti e richieste
    simultanee. |'
  id: totrans-37
  prefs: []
  type: TYPE_TB
  zh: '| 服务拒绝模型 | 通过向LLMs加载重负载和并发请求来造成服务中断和成本激增。 |'
- en: '| Vulnerabilità della catena di approvvigionamento | Causando la compromissione
    di vari componenti, tra cui le fonti di dati, e minando l''integrità del sistema.
    |'
  id: totrans-38
  prefs: []
  type: TYPE_TB
  zh: '| 供应链漏洞 | 导致数据源等各个组件的妥协，损害系统完整性。|'
- en: '| Perdita di informazioni sensibili | Con conseguente esposizione accidentale
    di dati privati, responsabilità legali e perdita di vantaggi competitivi. |'
  id: totrans-39
  prefs: []
  type: TYPE_TB
  zh: '| 敏感信息丢失 | 导致意外泄露私人数据，承担法律责任和失去竞争优势。|'
- en: '| Design insicuro del plug-in | Le vulnerabilità nelle integrazioni di terze
    parti causano l''esecuzione di codice remoto. |'
  id: totrans-40
  prefs: []
  type: TYPE_TB
  zh: '| 插件设计不安全 | 第三方集成中的漏洞导致远程代码执行。|'
- en: '| Agenzia eccessiva | L''eccessiva autonomia degli LLMs nel compiere azioni
    può portare a conseguenze indesiderate e dannose. |'
  id: totrans-41
  prefs: []
  type: TYPE_TB
  zh: '| 过度授权 | LLM在执行动作时的过度自主可能导致不希望的和有害的后果。|'
- en: '| Eccessiva dipendenza dall''LLM | Compromettendo il processo decisionale,
    contribuendo alla vulnerabilità della sicurezza e alle responsabilità legali.
    |'
  id: totrans-42
  prefs: []
  type: TYPE_TB
  zh: '| 过度依赖LLM | 破坏决策过程，导致安全漏洞和法律责任。|'
- en: '| Modello furto | In relazione alla copia o all''utilizzo non autorizzato dei
    tuoi modelli. |'
  id: totrans-43
  prefs: []
  type: TYPE_TB
  zh: '| 模型盗窃 | 与你的模型未经授权的复制或使用相关。|'
- en: Suggerimento
  id: totrans-44
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 建议
- en: Vulnerabilità simili esistono anche per altri tipi di sistemi GenAI, come i
    generatori di immagini, audio, video e geometrie.
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: 类似的漏洞也存在于其他类型的GenAI系统中，如图像、音频、视频和几何形状生成器。
- en: Ti consiglio di ricercare e identificare le vulnerabilità del software relative
    ai tuoi casi d'uso.
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: 我建议你搜索并识别与你的用例相关的软件漏洞。
- en: Senza protezioni, i tuoi servizi possono essere abusati per causare danni personali
    e finanziari, furti di identità, danni economici, diffondere disinformazione e
    contribuire a problemi sociali. Di conseguenza, è fondamentale implementare diverse
    misure di sicurezza e protezioni per proteggere i tuoi servizi da tali attacchi.
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: 没有保护措施，你的服务可能会被滥用，造成个人和财务损害、身份盗窃、经济损失、传播虚假信息和加剧社会问题。因此，实施多种安全措施和保护措施，以保护你的服务免受此类攻击至关重要。
- en: Nella prossima sezione scoprirai le misure di moderazione dell'uso e di sicurezza
    che puoi implementare per proteggere i tuoi servizi GenAI prima della distribuzione.
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一节中，你将了解你可以实施的使用和安全性措施，以在分发前保护你的GenAI服务。
- en: Guardrail
  id: totrans-49
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 防护栏
- en: I*guardrail* si riferiscono a *controlli investigativi* che hanno lo scopo di
    guidare la tua applicazione verso i risultati previsti. Sono incredibilmente diversi
    e possono essere configurati per adattarsi a qualsiasi situazione che potrebbe
    andare storta con i tuoi sistemi GenAI.
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: '*防护栏*指的是*调查性控制*，其目的是引导你的应用程序达到预期的结果。它们极其不同，可以配置以适应任何可能对你的GenAI系统出错的情境。'
- en: Ad esempio, i *guardrail I/O* sono progettati per verificare i dati che entrano
    in un modello GenAI e le uscite inviate ai sistemi o agli utenti a valle. Tali
    guardrail possono segnalare query inappropriate da parte dell'utente e convalidare
    il contenuto dell'uscita contro la tossicità, le allucinazioni o gli argomenti
    vietati. La[Figura 9-1](#guardrails) mostra l'aspetto di un sistema LLM una volta
    aggiunti i guardrail I/O.
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，*防护栏I/O*被设计来验证进入GenAI模型的输入数据和发送给下游系统或用户的输出。这些防护栏可以报告用户的不适当查询，并验证输出内容是否具有毒性、幻觉或被禁止的主题。[图9-1](#guardrails)展示了添加了防护栏I/O的系统LLM的外观。
- en: '![bgai 0901](assets/bgai_0901.png)'
  id: totrans-52
  prefs: []
  type: TYPE_IMG
  zh: '![bgai 0901](assets/bgai_0901.png)'
- en: Figura 9-1\. Confronto di un sistema LLM senza e con guardrail
  id: totrans-53
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图9-1. 带与不带防护栏的系统LLM对比
- en: Non è necessario implementare guardrail da zero. Al momento della stesura di
    questo articolo, esistono framework guardrail open source precostituiti come NVIDIA
    NeMo Guardrails, LLM-Guard e Guardrails AI per proteggere i tuoi servizi. Tuttavia,
    potrebbero richiedere l'apprendimento di linguaggi correlati al framework e hanno
    come contropartita il rallentamento dei servizi e l'appesantimento dell'applicazione
    a causa di varie dipendenze esterne.
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: 你不需要从头开始实现防护措施。在撰写本文时，存在一些预先构建的开源防护框架，如NVIDIA NeMo Guardrails、LLM-Guard和Guardrails
    AI，用于保护你的服务。然而，它们可能需要学习与框架相关的相关语言，并且以服务速度降低和应用程序因各种外部依赖而变重为代价。
- en: Altri guardrail commerciali disponibili sul mercato, come Open AI's Moderation
    API, Microsoft Azure AI Content Safety API e Google's Guardrails API, non sono
    open source o mancano di dettagli e contenuti per misurare i vincoli di qualità.
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: 市场上可用的其他商业边界防护，如Open AI的Moderation API、Microsoft Azure AI内容安全API和Google的Guardrails
    API，不是开源的，或者缺乏用于衡量质量限制的详细信息和内容。
- en: Avvertenze
  id: totrans-56
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 注意事项
- en: I guardrail rimangono un'area di ricerca attiva. Sebbene tali difese possano
    contrastare alcuni attacchi, gli attacchi più potenti supportati dall'intelligenza
    artificiale possono comunque aggirarli. Questo potrebbe portare a un [ciclo continuo
    e infinito di attacchi e difese](https://oreil.ly/xlUmw).
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: 边界防护仍然是一个活跃的研究领域。尽管这些防御措施可以抵御一些攻击，但由人工智能支持的更强大的攻击仍然可以绕过它们。这可能导致[持续不断的攻击和防御循环](https://oreil.ly/xlUmw)。
- en: Sebbene l'ingegnerizzazione dei guardrail I/O a livello di applicazione non
    fornisca una protezione perfetta, i prossimi modelli GenAI potrebbero includere
    guardrail integrati all'interno del modello per migliorare le garanzie di sicurezza.
    Tuttavia, tali guardrail potrebbero avere un impatto sulle prestazioni dei tempi
    di risposta introducendo latenza nel sistema.
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然在应用级别进行边界防护的I/O工程不能提供完美的保护，但未来的GenAI模型可能会包含集成到模型内部的边界防护，以提高安全保证。然而，这些边界防护可能会通过在系统中引入延迟来影响响应时间性能。
- en: Guardrail di ingresso
  id: totrans-59
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 边界防护
- en: Lo scopo dei guardrail di ingresso è quello di impedire che contenuti dannosi
    o inappropriati raggiungano il tuo modello. [La Tabella 9-3](#guardrails_input)
    mostra i guardrail di ingresso più comuni.
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: 边界防护的目的是阻止有害或不适当的内容到达你的模型。[表9-3](#guardrails_input)显示了最常见的输入边界防护。
- en: Tabella 9-3\. Guardrail comuni per gli ingressi
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: 表9-3\. 输入常见边界防护
- en: '| Guardrail di ingresso | Esempi |'
  id: totrans-62
  prefs: []
  type: TYPE_TB
  zh: '| 边界防护 | 示例 |'
- en: '| --- | --- |'
  id: totrans-63
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- |'
- en: '| **Attuale**Evita i contenuti off-topic o sensibili. | Impedire a un utente
    di discutere di argomenti politici e contenuti espliciti. |'
  id: totrans-64
  prefs: []
  type: TYPE_TB
  zh: '| **当前**避免不相关或敏感的内容。| 阻止用户讨论政治和露骨内容。|'
- en: '| **Iniezione diretta di prompt**(jail-breaking)Impedisci agli utenti di rivelare
    o di ignorare i prompt e i segreti del sistema: più lungo è il contenuto dell''input,
    più il tuo sistema sarà soggetto a questi attacchi. | Bloccando i tentativi di
    ignorare i prompt del sistema e di manipolare il sistema per fargli rivelare le
    chiavi API interne o le impostazioni di configurazione.^([a](ch09.html#id1036))
    |'
  id: totrans-65
  prefs: []
  type: TYPE_TB
  zh: '| **直接提示注入**(越狱)阻止用户揭示或忽略系统提示和秘密：输入内容越长，你的系统就越容易受到这些攻击。| 阻止忽略系统提示和操纵系统以使其揭示内部API密钥或配置设置的行为.^([a](ch09.html#id1036))
    |'
- en: '| **Iniezione indiretta di prompt**Impedire l''accettazione di contenuti dannosi
    da fonti esterne, come file o siti web, che possono causare confusione del modello
    o l''esecuzione di codice remoto sui sistemi a valle.I contenuti dannosi possono
    essere invisibili all''occhio umano e codificati all''interno del testo o delle
    immagini in ingresso. | Sanificazione di payload codificati nelle immagini caricate,
    caratteri nascosti o prompt override nei documenti caricati, script nascosti negli
    URL remoti o persino trascrizioni di video di YouTube. |'
  id: totrans-66
  prefs: []
  type: TYPE_TB
  zh: '| **间接提示注入**阻止从外部来源（如文件或网站）接受有害内容，这些内容可能导致模型混淆或远程系统上执行代码。有害内容可能对人类肉眼不可见，并编码在输入文本或图像中。|
    对上传图像中编码的负载进行消毒，隐藏字符或文档中的提示覆盖，远程URL中的隐藏脚本，甚至YouTube视频的转录。|'
- en: '| **Moderazione**Rispettare le linee guida del marchio, i requisiti legali
    e di branding. | Contrassegnare e rifiutare le query degli utenti non valide se
    queste includono riferimenti a bestemmie, concorrenti, contenuti espliciti, informazioni
    di identificazione personale (PII), autolesionismo, ecc. |'
  id: totrans-67
  prefs: []
  type: TYPE_TB
  zh: '| **审查**遵守品牌指南、法律要求和品牌要求。| 如果用户查询包含诅咒、竞争对手、露骨内容、个人识别信息（PII）、自残等，则标记并拒绝这些查询。|'
- en: '| **Attributo**Convalida le proprietà dell''input. | Controlla la lunghezza
    della query, le dimensioni del file, le scelte, l''intervallo, il formato e la
    struttura dei dati, ecc. |'
  id: totrans-68
  prefs: []
  type: TYPE_TB
  zh: '| **属性**验证输入属性。| 检查查询长度、文件大小、选项、范围、数据格式和结构等。|'
- en: '| Anche se i guardrail sono utili, la pratica migliore è evitare di dare ai
    tuoi modelli GenAI la conoscenza diretta di segreti o impostazioni di configurazione
    sensibili. |'
  id: totrans-69
  prefs: []
  type: TYPE_TB
  zh: '| 即使边界防护很有用，最佳实践是避免让你的GenAI模型直接了解秘密或敏感的配置设置。|'
- en: I guardrail di ingresso possono anche essere combinati con gli igienizzatori
    di contenuto per pulire gli ingressi difettosi.
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: 输入护栏也可以与内容清洁器结合使用，以清理有缺陷的输入。
- en: Se vuoi implementare i tuoi guardrail, puoi iniziare con l'utilizzo di tecniche
    avanzate di ingegneria dei prompt all'interno del tuo sistema. Inoltre, puoi utilizzare
    tecniche di valutazione automatica (ad esempio, modelli di intelligenza artificiale).
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你想实现你的护栏，你可以从在你的系统中使用高级提示工程技巧开始。此外，你可以使用自动评估技术（例如，人工智能模型）。
- en: L['esempio 9-1](#guardrail_topical_prompt) mostra un esempio di prompt del sistema
    per un valutatore automatico di guardrail AI per rifiutare query fuori tema.
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: '[esempio 9-1](#guardrail_topical_prompt)展示了为拒绝离题查询而设计的AI护栏自动评估器的系统提示示例。'
- en: Esempio 9-1\. prompt del sistema guardrail di input topico
  id: totrans-73
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: Esempio 9-1\. 输入主题护栏系统提示
- en: '[PRE0]'
  id: totrans-74
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: Puoi vedere un'implementazione di un guardrail topico in ingresso nell'[Esempio
    9-2](#guardrail_topical) che utilizza la tecnica di valutazione automatica di
    LLM.
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以在[Esempio 9-2](#guardrail_topical)中看到一个主题入口护栏的实现示例，它使用了LLM的自动评估技术。
- en: Esempio 9-2\. Parapetto di ingresso topico
  id: totrans-76
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: Esempio 9-2\. 主题入口护栏
- en: '[PRE1]'
  id: totrans-77
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: '[![1](assets/1.png)](#co_securing_ai_services_CO1-1)'
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: '[![1](assets/1.png)](#co_securing_ai_services_CO1-1)'
- en: Gestire i casi in cui l'LLM non restituisce una classificazione valida
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: 处理LLM未返回有效分类的情况
- en: Suggerimento
  id: totrans-80
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 建议
- en: Utilizzando la tecnica mostrata nell'[Esempio 9-2](#guardrail_topical), puoi
    implementare dei valutatori automatici per verificare la presenza di tentativi
    di jail-breaking e prompt injection o anche per rilevare la presenza di PII e
    bestemmie negli input.
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: 使用[Esempio 9-2](#guardrail_topical)中展示的技术，你可以实现自动评估器来验证是否存在越狱尝试和提示注入，或者甚至检测输入中是否存在PII和咒骂。
- en: Come abbiamo visto nel [Capitolo 5](ch05.html#ch05), puoi sfruttare il più possibile
    la programmazione asincrona anche quando utilizzi tecniche di valutazione automatica
    nei tuoi guardrail. Questo perché i guardrail di AI richiedono l'invio di più
    chiamate all'API del modello per ogni query dell'utente. Per migliorare l'esperienza
    dell'utente, puoi eseguire questi guardrail in parallelo al processo di inferenza
    del modello.
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: 正如我们在[第5章](ch05.html#ch05)中看到的，即使在使用自动评估技术时，你仍然可以充分利用异步编程。这是因为AI护栏需要对每个用户查询向模型API发送多个调用。为了提高用户体验，你可以并行执行这些护栏和模型推理过程。
- en: Una volta che hai un guardrail autovalutativo per la verifica degli argomenti
    consentiti, puoi eseguirlo in parallelo alla tua generazione di dati^([1](ch09.html#id1037))
    utilizzando `asyncio.wait`, come mostrato nell'[Esempio 9-3](#guardrail_concurrent_execution).
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦你有一个用于验证允许主题的自评估护栏，你就可以使用 `asyncio.wait` 在你的数据生成过程中并行执行它，如[Esempio 9-3](#guardrail_concurrent_execution)所示。
- en: Avvertenze
  id: totrans-84
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 注意事项
- en: Tieni presente che l'implementazione di guardrail async può innescare meccanismi
    di limitazione della velocità e di strozzatura delle API dei provider di modelli.
    A seconda dei requisiti della tua applicazione, potresti voler richiedere limiti
    di velocità più elevati o ridurre la velocità delle chiamate API in un breve lasso
    di tempo.
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: 请记住，实现异步护栏可能会触发模型提供者的API速度限制和流量控制机制。根据你的应用程序需求，你可能需要请求更高的速度限制或减少API调用速度。
- en: Esempio 9-3\. Esecuzione di guardrail AI in parallelo alla generazione di risposte
  id: totrans-86
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: Esempio 9-3\. 在生成响应时并行执行AI护栏
- en: '[PRE2]'
  id: totrans-87
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: '[![1](assets/1.png)](#co_securing_ai_services_CO2-1)'
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: '[![1](assets/1.png)](#co_securing_ai_services_CO2-1)'
- en: Crea due task asyncio da eseguire in parallelo utilizzando `asyncio.wait`. L'operazione
    ritorna non appena un task viene completato.
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: 使用`asyncio.wait`创建两个并行执行的asyncio任务。操作会在任一任务完成时返回。
- en: '[![2](assets/2.png)](#co_securing_ai_services_CO2-2)'
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: '[![2](assets/2.png)](#co_securing_ai_services_CO2-2)'
- en: Se il guardrail viene attivato, annulla l'operazione di chat e restituisce una
    risposta codificata. Puoi registrare l'attivazione in un database e inviare email
    di notifica qui.
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: 如果护栏被激活，取消聊天操作并返回一个编码后的响应。你可以将激活记录在数据库中并发送通知邮件。
- en: '[![3](assets/3.png)](#co_securing_ai_services_CO2-3)'
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
  zh: '[![3](assets/3.png)](#co_securing_ai_services_CO2-3)'
- en: Continua a controllare il ciclo di eventi asyncio ogni 100 ms fino a quando
    un'attività non viene completata.
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: 每隔100毫秒继续检查asyncio事件循环，直到活动完成。
- en: '[![4](assets/4.png)](#co_securing_ai_services_CO2-4)'
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: '[![4](assets/4.png)](#co_securing_ai_services_CO2-4)'
- en: Sfrutta l'iniezione di dipendenza per restituire la risposta del modello se
    i guardrail non vengono attivati.
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: 如果护栏未激活，利用依赖注入来返回模型响应。
- en: Poiché i guardrail abilitati per GenAI, come quelli implementati nell'[Esempio
    9-3](#guardrail_concurrent_execution), rimangono probabilistici, i tuoi servizi
    GenAI possono ancora essere vulnerabili agli attacchi di tipo prompt injection
    e jail-breaking. Ad esempio, gli aggressori possono utilizzare tecniche più avanzate
    di prompt injection per aggirare i tuoi guardrail AI. D'altro canto, i tuoi guardrail
    possono anche rifiutare in modo errato query valide dell'utente, causando falsi
    positivi che possono peggiorare l'esperienza dell'utente.
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: 由于为GenAI启用的护栏，如[Esempio 9-3](#guardrail_concurrent_execution)中实现的，仍然是概率性的，你的GenAI服务仍然可能容易受到提示注入和越狱攻击。例如，攻击者可以使用更高级的提示注入技术来绕过你的AI护栏。另一方面，你的护栏也可能错误地拒绝有效的用户查询，导致假阳性，这可能会恶化用户体验。
- en: Suggerimento
  id: totrans-97
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 建议
- en: La combinazione di guardrail con modelli di rilevamento basati su regole o sull'apprendimento
    automatico tradizionale può aiutare a mitigare alcuni dei rischi sopra citati.
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: 将护栏与基于规则或传统机器学习的检测模型相结合可以帮助减轻上述一些风险。
- en: Inoltre, puoi utilizzare dei guardrail che considerano solo l'ultimo messaggio
    per ridurre il rischio che il modello venga confuso da una lunga conversazione.
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: 此外，你可以使用仅考虑最后一条消息的护栏来降低模型被长时间对话混淆的风险。
- en: Quando si progettano i guardrail, è necessario considerare i compromessi tra
    *precisione*, *latenza* e *costi* per bilanciare l'esperienza dell'utente con
    i controlli di sicurezza richiesti.
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
  zh: 在设计护栏时，需要考虑在**精确度**、**延迟**和**成本**之间的权衡，以平衡用户体验和安全控制需求。
- en: Guardrail di uscita
  id: totrans-101
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 输出护栏
- en: Lo scopo dei guardrail di output è quello di convalidare il contenuto prodotto
    da Genai prima che venga passato agli utenti o ai sistemi a valle. [La Tabella
    9-4](#guardrails_output) mostra i guardrail di output più comuni.
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: 输出护栏的目的是在内容传递给用户或下游系统之前验证Genai生成的内容。[表9-4](#guardrails_output)展示了常见的输出护栏。
- en: Tabella 9-4\. Guardrail di uscita comuni
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: 表9-4\. 常见输出护栏
- en: '| Guardrail di uscita | Esempi |'
  id: totrans-104
  prefs: []
  type: TYPE_TB
  zh: '| 输出护栏 | 示例 |'
- en: '| --- | --- |'
  id: totrans-105
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- |'
- en: '| **Allucinazione/controllo dei fatti**Blocca le allucinazioni e restituisce
    risposte in scatola come "Non lo so". | Misurare metriche come la *pertinenza*,
    la *coerenza*, la *consistenza*, la *fluidità* e così via, sui risultati del modello
    rispetto a un corpus di verità di base nelle applicazioni RAG. |'
  id: totrans-106
  prefs: []
  type: TYPE_TB
  zh: '| **幻觉/事实控制**阻止幻觉并返回如“我不知道”这样的封装响应。| 在RAG应用中，测量模型结果相对于基础真实语料库的*相关性*、*一致性*、*一致性*、*流畅性*等指标。|'
- en: '| **Moderazione**Applicare le linee guida del marchio e dell''azienda per regolare
    i risultati del modello, filtrando o riscrivendo le risposte che le violano. |
    Verifica di metriche come la *leggibilità*, la *tossicità*, il *sentiment*, il
    *numero di menzioni dei concorrenti*, ecc. |'
  id: totrans-107
  prefs: []
  type: TYPE_TB
  zh: '| **审查**应用品牌和公司的指南来调整模型结果，过滤或重写违反这些指南的响应。| 检查诸如*可读性*、*毒性*、*情感*、*竞争对手提及次数*等指标。|'
- en: '| **Controlli della sintassi**Verificare la struttura e il contenuto degli
    output del modello. Questi guardrail possono rilevare e riprovare o gestire con
    grazia le eccezioni per evitare guasti nei sistemi a valle. | Convalida degli
    schemi JSON e dei parametri delle funzioni nei flussi di lavoro *di chiamata delle
    funzioni* quando i modelli invocano le funzioni.Verifica delle selezioni di strumenti/agenti
    nei *flussi di lavoro agenziali*. |'
  id: totrans-108
  prefs: []
  type: TYPE_TB
  zh: '| **语法控制**检查模型的输出结构和内容。这些护栏可以检测并重试或优雅地处理异常，以避免下游系统出现故障。| 在模型调用函数时验证JSON模式和函数参数的工作流调用函数。验证工具/代理在工作流代理中的选择。|'
- en: Tutti i guardrail di uscita sopra citati si baseranno sul *valore di soglia*
    per rilevare le risposte non valide.
  id: totrans-109
  prefs: []
  type: TYPE_NORMAL
  zh: 所述的所有输出护栏都将基于**阈值值**来检测无效的响应。
- en: Soglie per guardrail
  id: totrans-110
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 护栏阈值
- en: 'Guardrail può utilizzare varie metriche come la *leggibilità*, la *tossicità*,
    ecc. per misurare e convalidare la qualità dei risultati del modello. Per ogni
    metrica, dovrai sperimentare per identificare il*valore soglia* appropriato per
    il tuo caso d''uso, tenendo presente che:'
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: 护栏可以使用诸如*可读性*、*毒性*等不同的指标来衡量和验证模型结果的质量。对于每个指标，你将需要通过实验来识别适合你用例的**阈值值**，同时考虑到：
- en: Un maggior numero di *falsi positivi* può infastidire i tuoi utenti e ridurre
    l'usabilità dei tuoiservizi.
  id: totrans-112
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 较多的*假阳性*可能会打扰你的用户并降低你服务的可用性。
- en: Un numero maggiore di *falsi negativi* può causare danni duraturi alla tua reputazione
    e far esplodere i costi, poiché gli utenti malintenzionati possono abusare del
    sistema o eseguire attacchi prompt injection/jail-breaking.
  id: totrans-113
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 较多的*假阴性*可能会导致你的声誉受到长期损害，并使成本激增，因为恶意用户可能会滥用系统或执行快速注入/越狱攻击。
- en: In genere, dovresti valutare i rischi e i casi peggiori di avere dei falsi negativi
    e se sei disposto a barattare alcuni falsi negativi nel tuo caso d'uso per migliorare
    l'esperienza dell'utente. Ad esempio, puoi ridurre i casi di blocco degli output
    se includono più gergo e non sono così leggibili.
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
  zh: 通常，你应该评估假阴性的风险和最坏情况，以及你是否愿意在你的用例中为了改善用户体验而牺牲一些假阴性。例如，你可以减少包含更多术语且不太易读的输出被阻止的情况。
- en: Implementare una barriera di moderazione
  id: totrans-115
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 实现一个审查屏障
- en: Implementiamo una barriera di moderazione utilizzando una versione del [metodo
    di valutazione*G-Eval*](https://oreil.ly/7Nent) per misurare la presenza di contenuti
    indesiderati nell'output del modello.
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: 我们使用 [G-Eval 评估方法](https://oreil.ly/7Nent) 的一个版本来实现一个审查屏障，以测量模型输出中不希望内容的存在。
- en: 'Il framework G-Eval utilizza i seguenti componenti per assegnare un punteggio
    ai contenuti non validi:'
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
  zh: G-Eval 框架使用以下组件为无效内容分配评分：
- en: Un nome di *dominio* che specifichi il tipo di contenuto da moderare
  id: totrans-118
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 一个指定要审查的内容类型的*域名*
- en: Una serie di *criteri* per delineare chiaramente quali sono i contenuti validi
    e quali quelli non validi.
  id: totrans-119
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 一系列*标准*，用于明确界定哪些内容是有效的，哪些内容是无效的。
- en: Un elenco ordinato di *fasi di istruzione* per la classificazione del contenuto
  id: totrans-120
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 一个有序的*指令阶段*列表，用于内容分类
- en: Il *contenuto* deve essere valutato con un punteggio discreto da 1 a 5.
  id: totrans-121
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*内容*必须通过1到5的离散评分进行评估。'
- en: L['esempio 9-4](#guardrail_moderation_prompt) mostra un prompt di sistema che
    implementa il framework *G-Eval* e che verrà utilizzato da un valutatore automatico
    LLM.
  id: totrans-122
  prefs: []
  type: TYPE_NORMAL
  zh: '[示例 9-4](#guardrail_moderation_prompt) 展示了一个实现 *G-Eval* 框架的系统提示，该框架将由自动 LLM
    评估者使用。'
- en: Esempio 9-4\. prompt del sistema di moderazione del parapetto
  id: totrans-123
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 9-4. 系统护栏审查的示例
- en: '[PRE3] `### Instructions`  `{``steps``}` `` `### Evaluation (score only!)`
    `"""` `` [PRE4]'
  id: totrans-124
  prefs: []
  type: TYPE_NORMAL
  zh: '[PRE3] `### 指令` `{``步骤``}` `` `### 评估（仅评分！）` `"""` `` [PRE4]'
- en: '[PRE5]`Utilizzando il prompt del sistema implementato nell''[Esempio 9-4](#guardrail_moderation_prompt),
    puoi ora implementare una barriera di moderazione seguendo l''[Esempio 9-2](#guardrail_topical).    In
    seguito, integriamo la barriera di moderazione con la logica di invocazione della
    chat esistente, come illustrato nell''[Esempio 9-5](#guardrail_moderation).    #####
    Esempio 9-5\. Integrazione del guardrail di moderazione    [PRE6]    [![1](assets/1.png)](#co_securing_ai_services_CO3-1)      Usa
    un tipo intero vincolato da Pydantic per convalidare il punteggio G-Eval del valutatore
    automatico di LLM.      [![2](assets/2.png)](#co_securing_ai_services_CO3-2)      Contrassegnare
    i contenuti che hanno un punteggio superiore alla soglia come se non avessero
    superato la moderazione.      [![3](assets/3.png)](#co_securing_ai_services_CO3-3)      Integrare
    ed eseguire il guardrail di moderazione dell''output con altri guardrail.      ######
    Suggerimento    Oltre al nuovo framework *G-Eval*, implementato utilizzando un
    autovalutatore LLM, è possibile utilizzare framework di valutazione automatica
    più tradizionali come [ROUGE](https://oreil.ly/_9Q9g), [BERTScore](https://oreil.ly/jRTeL)
    e [SummEval](https://oreil.ly/5YtJG) per moderare i contenuti in uscita.    Hai
    implementato due guardrail di I/O, uno per verificare gli argomenti delle query
    degli utenti e l''altro per moderare gli output di LLM.    Per migliorare ulteriormente
    il tuo sistema di guardrail, puoi:    *   Adotta l''approccio del *guasto rapido*
    uscendo prima se si attiva un guardrail per ottimizzare i tempi di risposta.           *   Seleziona
    solo i *guardrail appropriati* per i tuoi casi d''uso, invece di usarli tutti
    insieme, che potrebbero sovraccaricare i tuoi servizi.           *   Esegui i
    guardrail *in modo asincrono* anziché sequenziale per ottimizzare la latenza.           *   Implementa
    il *campionamento delle richieste* eseguendo guardrail più lenti su un campione
    di richieste per ridurre la latenza complessiva quando i tuoi servizi sono sottoposti
    a un carico elevato.              Ora dovresti sentirti più sicuro nell''implementare
    i tuoi guardrail utilizzando tecniche di autovalutazione classiche o LLM senza
    affidarti a strumenti e librerie esterne.    Nella prossima sezione scoprirai
    come limitare la velocità delle API per proteggere i tuoi servizi dal sovraccarico
    dei modelli e dai tentativi di scraping.[PRE7]``  [PRE8][PRE9]py[PRE10] [PRE11]
    from slowapi import Limiter from slowapi.middleware import SlowAPIMiddleware  app.state.limiter
    = Limiter(storage_uri="redis://localhost:6379") app.add_middleware(SlowAPIMiddleware)
    [PRE12]` [PRE13][PRE14][PRE15]`` [PRE16] from contextlib import asynccontextmanager
    import redis from fastapi import Depends, FastAPI from fastapi.websockets import
    WebSocket from fastapi_limiter import FastAPILimiter from fastapi_limiter.depends
    import WebSocketRateLimiter  ...  @asynccontextmanager async def lifespan(_: FastAPI):
    ![1](assets/1.png)     redis_connection = redis.from_url("redis://localhost:6379",
    encoding="utf8")     await FastAPILimiter.init(redis_connection)     yield     await
    FastAPILimiter.close()  app = FastAPI(lifespan=lifespan)  @app.websocket("/ws")
    async def websocket_endpoint(     websocket: WebSocket, user_id: int = Depends(get_current_user)
    ![2](assets/2.png) ):     ratelimit = WebSocketRateLimiter(times=1, seconds=5)     await
    ws_manager.connect(websocket)     try:         while True:             prompt
    = await ws_manager.receive(websocket)             await ratelimit(websocket, context_key=user_id)
    ![3](assets/3.png)             async for chunk in azure_chat_client.chat_stream(prompt,
    "ws"):                 await ws_manager.send(chunk, websocket)     except WebSocketRateLimitException:         await
    websocket.send_text(f"Rate limit exceeded. Try again later")     finally:         await
    ws_manager.disconnect(websocket) [PRE17]` [PRE18][PRE19][PRE20][PRE21]`` [PRE22]
    class AzureOpenAIChatClient:     def __init__(self, throttle_rate = 0.5): ![1](assets/1.png)         self.aclient
    = ...         self.throttle_rate = throttle_rate      async def chat_stream(             self,
    prompt: str, mode: str = "sse", model: str = "gpt-3.5-turbo"     ) -> AsyncGenerator[str,
    None]:         stream = ...  # OpenAI chat completion stream         async for
    chunk in stream:             await asyncio.sleep(self.throttle_rate) ![2](assets/2.png)             if
    chunk.choices[0].delta.content is not None:                 yield (                     f"data:
    {chunk.choices[0].delta.content}\n\n"                     if mode == "sse"                     else
    chunk.choices[0].delta.content                 )                 await asyncio.sleep(0.05)          if
    mode == "sse":             yield f"data: [DONE]\n\n" [PRE23]` [PRE24][PRE25] ``
    `# Riassunto    Questo capitolo ha fornito un riepilogo completo dei vettori di
    attacco per i servizi GenAI e di come salvaguardarli da tentativi avversari, usi
    impropri e abusi.    Hai imparato a implementare guardrail in ingresso e in uscita,
    oltre a meccanismi di valutazione e filtraggio dei contenuti per moderare l''uso
    del servizio. Oltre ai guardrail, hai anche sviluppato protezioni per la limitazione
    della velocità e il throttling delle API per gestire il carico del server e prevenire
    gli abusi.    Nel prossimo capitolo scopriremo come ottimizzare i servizi di intelligenza
    artificiale attraverso varie tecniche come il caching, l''elaborazione in batch,
    la quantizzazione dei modelli, il prompt engineering e la messa a punto dei modelli.    ^([1](ch09.html#id1037-marker))
    Ispirato a ["Come implementare i Guardrail di LLM" del Cookbook di OpenAI.](https://oreil.ly/UQV6i)`
    `` [PRE26][PRE27]``````'
  id: totrans-125
  prefs: []
  type: TYPE_NORMAL
  zh: '[PRE5]`使用在[Esempio 9-4](#guardrail_moderation_prompt)中实现的系统提示，你现在可以按照[Esempio
    9-2](#guardrail_topical)的示例来实施一个 moderation barrier。    随后，我们将 moderation barrier
    与现有的 chat invocation 逻辑集成，如[Esempio 9-5](#guardrail_moderation)所示。    ##### Esempio
    9-5\. moderation barrier 集成    [PRE6]    [![1](assets/1.png)](#co_securing_ai_services_CO3-1)      使用
    Pydantic 限制的整数类型来验证 LLM 自动评估器的 G-Eval 分数。      [![2](assets/2.png)](#co_securing_ai_services_CO3-2)      将得分高于阈值的内内容标记为未通过
    moderation。      [![3](assets/3.png)](#co_securing_ai_services_CO3-3)      将 output
    moderation barrier 与其他 barrier 集成并执行。      ###### 建议    除了使用 LLM 自评估器实现的 *G-Eval*
    新框架外，还可以使用更传统的自动评估框架，如 [ROUGE](https://oreil.ly/_9Q9g)，[BERTScore](https://oreil.ly/jRTeL)
    和 [SummEval](https://oreil.ly/5YtJG) 来 moderation 输出内容。    你已经实现了两个 I/O barrier，一个用于验证用户查询的主题，另一个用于
    moderation LLM 的输出。    为了进一步改进你的 barrier 系统，你可以：    *   采用 *快速故障* 方法，一旦 barrier
    被激活就先退出，以优化响应时间。           *   根据你的用例选择合适的 *guardrail*，而不是一次性使用所有 guardrail，这可能会给你的服务带来过重负担。           *   以异步方式执行
    guardrail，而不是顺序执行，以优化延迟。           *   通过对请求进行采样执行较慢的 guardrail，以降低在高负载下服务的总延迟。              现在，你应该更有信心使用传统的自评估技术或
    LLM 来实现你的 barrier，而不必依赖外部工具和库。    在下一节中，你将了解如何通过限制 API 速度来保护你的服务免受模型过载和 scraping
    尝试的影响。[PRE7]``  [PRE8][PRE9]py[PRE10] [PRE11] from slowapi import Limiter from
    slowapi.middleware import SlowAPIMiddleware  app.state.limiter = Limiter(storage_uri="redis://localhost:6379")
    app.add_middleware(SlowAPIMiddleware) [PRE12]` [PRE13][PRE14][PRE15]`` [PRE16]
    from contextlib import asynccontextmanager import redis from fastapi import Depends,
    FastAPI from fastapi.websockets import WebSocket from fastapi_limiter import FastAPILimiter
    from fastapi_limiter.depends import WebSocketRateLimiter  ...  @asynccontextmanager
    async def lifespan(_: FastAPI): ![1](assets/1.png)     redis_connection = redis.from_url("redis://localhost:6379",
    encoding="utf8")     await FastAPILimiter.init(redis_connection)     yield     await
    FastAPILimiter.close()  app = FastAPI(lifespan=lifespan)  @app.websocket("/ws")
    async def websocket_endpoint(     websocket: WebSocket, user_id: int = Depends(get_current_user)
    ![2](assets/2.png) ):     ratelimit = WebSocketRateLimiter(times=1, seconds=5)     await
    ws_manager.connect(websocket)     try:         while True:             prompt
    = await ws_manager.receive(websocket)             await ratelimit(websocket, context_key=user_id)
    ![3](assets/3.png)             async for chunk in azure_chat_client.chat_stream(prompt,
    "ws"):                 await ws_manager.send(chunk, websocket)     except WebSocketRateLimitException:         await
    websocket.send_text(f"Rate limit exceeded. Try again later")     finally:         await
    ws_manager.disconnect(websocket) [PRE17]` [PRE18][PRE19][PRE20][PRE21]`` [PRE22]
    class AzureOpenAIChatClient:     def __init__(self, throttle_rate = 0.5): ![1](assets/1.png)         self.aclient
    = ...         self.throttle_rate = throttle_rate      async def chat_stream(             self,
    prompt: str, mode: str = "sse", model: str = "gpt-3.5-turbo"     ) -> AsyncGenerator[str,
    None]:         stream = ...  # OpenAI chat completion stream         async for
    chunk in stream:             await asyncio.sleep(self.throttle_rate) ![2](assets/2.png)             if
    chunk.choices[0].delta.content is not None:                 yield (                     f"data:
    {chunk.choices[0].delta.content}\n\n"                     if mode == "sse"                     else
    chunk.choices[0].delta.content                 )                 await asyncio.sleep(0.05)          if
    mode == "sse":             yield f"data: [DONE]\n\n" [PRE23]` [PRE24][PRE25] ``
    `# 总结    本章全面概述了 GenAI 服务的攻击向量以及如何保护它们免受恶意用户、滥用和不当使用。    你学习了如何实现输入和输出 barrier，以及内容评估和过滤机制来
    moderation 服务使用。    除了 barrier，你还开发了速度限制和 API 节流保护来管理服务器负载并防止滥用。    在下一章中，我们将探讨如何通过缓存、批量处理、模型量化、提示工程和模型调优等技巧来优化人工智能服务。    ^([1](ch09.html#id1037-marker))
    受 OpenAI 烹饪书中的 "如何实现 LLM Barrier" 启发。[PRE26][PRE27]```'
