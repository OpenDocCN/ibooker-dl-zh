- en: Chapter 15\. Using ChatGPT to Call Your API
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: In the previous chapter, you built a basic generative AI application that could
    chat with a model in natural language and retrieve data from the SportsWorldCentral
    API. You created quite a bit of Python code to accomplish that.
  prefs: []
  type: TYPE_NORMAL
- en: In this chapter, you will use custom GPTs from OpenAI to accomplish this task
    without creating any Python code other than the SportsWorldCentral API. You can
    think of a custom GPT as a low-code method for creating a generative AI application
    that connects to your API.
  prefs: []
  type: TYPE_NORMAL
- en: Architecture of Your Application
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: '[Figure 15-1](#chatgpt_architecture_ch15) shows the high-level architecture
    of the project you will create in this chapter.'
  prefs: []
  type: TYPE_NORMAL
- en: If you compare this diagram to [Figure 14-1](ch14.html#langgraph_architecture_ch14),
    you will see a few similarities. In both cases, a user is using natural language
    chat to retrieve data from the SportsWorldCentral API. In both cases, a function-calling
    LLM is used to chat with the user and decide when to call the API for additional
    information. Although you used an Anthropic model in [Chapter 14](ch14.html#chapter_14),
    you could have used the same OpenAI GPT-4o model that you will use in this chapter.
  prefs: []
  type: TYPE_NORMAL
- en: However, there are also large differences from [Chapter 14](ch14.html#chapter_14)’s
    architecture. Where [Chapter 14](ch14.html#chapter_14) required many different
    Python components to be developed and run on GitHub Codespaces, in this chapter,
    only the SportsWorldCentral API will be running there. As you continue through
    this chapter, I will share more contrasts with [Chapter 14](ch14.html#chapter_14).
  prefs: []
  type: TYPE_NORMAL
- en: '![High-level architecture](assets/haad_1501.png)'
  prefs: []
  type: TYPE_IMG
- en: Figure 15-1\. High-level architecture
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
- en: Warning
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
- en: As with the model used in [Chapter 14](ch14.html#chapter_14), you should be
    aware of the limitations and risks of the model you are using. The [GPT-4o System
    Card](https://oreil.ly/v8SNX) states risks that include misinformation, violent
    speech, and others.
  prefs: []
  type: TYPE_NORMAL
- en: Getting Started with ChatGPT
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: The first step is to sign up for a ChatGPT user account, from the [OpenAI home
    page](https://chat.openai.com). You need to select a plan that includes the Create
    GPTs capability. At the time of this writing, the [ChatGPT pricing page](https://oreil.ly/gptpri)
    shows that Plus, Team, and Enterprise accounts have that option. Follow the sign-up
    instructions to activate your account. Once you have signed up, log in and navigate
    back to the [ChatGPT home page](https://chat.openai.com).
  prefs: []
  type: TYPE_NORMAL
- en: Tip
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
- en: If you would like to prevent OpenAI from using your chats to train its models,
    you can request this through the [OpenAI privacy portal](https://oreil.ly/2qLwN).
    Doing so reduces the possibility that information you enter in ChatGPT or custom
    GPTs will be shown to other users accidentally.
  prefs: []
  type: TYPE_NORMAL
- en: Creating a Custom GPT
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: To create your first GPT, click your profile photo and select My GPTs. You will
    see the My GPTs page, as shown in [Figure 15-2](#my_gpts_ch15).
  prefs: []
  type: TYPE_NORMAL
- en: '![My GPTs page](assets/haad_1502.png)'
  prefs: []
  type: TYPE_IMG
- en: Figure 15-2\. My GPTs page
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
- en: Click Create a GPT. The New GPT page will be displayed with the Configure option
    selected, as shown in [Figure 15-3](#new_gpt_ch15).
  prefs: []
  type: TYPE_NORMAL
- en: '![Creating a new GPT](assets/haad_1503.png)'
  prefs: []
  type: TYPE_IMG
- en: Figure 15-3\. Creating a new GPT
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
- en: The large button with the plus sign on it is used to select an image for your
    custom GPT. Download a public-domain image to your computer, then click that button.
    Select Upload Photo and upload the local file. You can view an example of a public
    domain image of a football and helmet at [*https://oreil.ly/dItdO*](https://oreil.ly/dItdO).
  prefs: []
  type: TYPE_NORMAL
- en: To configure the GPT, fill out the options on the New GPT page as shown in [Figure 15-4](#completed_new_gpt_part1_ch15).
  prefs: []
  type: TYPE_NORMAL
- en: '![New GPT information part one](assets/haad_1504.png)'
  prefs: []
  type: TYPE_IMG
- en: Figure 15-4\. New GPT information, part 1
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
- en: Scroll down the page to see additional options. Leave the conversation starters
    empty at this time. Under the Capabilities section, do not select any capabilities.
    The display should look like [Figure 15-5](#completed_new_gpt_part2_ch15).
  prefs: []
  type: TYPE_NORMAL
- en: '![New GPT information part two](assets/haad_1505.png)'
  prefs: []
  type: TYPE_IMG
- en: Figure 15-5\. New GPT information, part 2
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
- en: 'Take a minute to see what your custom GPT can do with what you have given it
    so far. In the Preview pane, enter the following prompt: **`What are the specific
    league names from the SportsWorldCentral fantasy football platform?`**'
  prefs: []
  type: TYPE_NORMAL
- en: The response you get when you perform this task may be different from what another
    user would receive. That is because generative AI responses are nondeterministic.
    (If you make your query too broad, your GPT may hallucinate and provide information
    that isn’t valid.) [Figure 15-6](#prompt_response1_ch15) displays an example where
    the GPT states that it doesn’t have specific information about team names, because
    they are not publicly available. That is correct; to get the team names, it will
    need to call an API.
  prefs: []
  type: TYPE_NORMAL
- en: '![Prompt and response from Custom GPT](assets/haad_1506.png)'
  prefs: []
  type: TYPE_IMG
- en: Figure 15-6\. Prompt and response from custom GPT
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
- en: This reflects a *knowledge gap*, which means that the model has not been trained
    on the information it needs to answer your prompt. To overcome this knowledge
    gap, you will create a custom action that enables your GPT to call the SWC API.
  prefs: []
  type: TYPE_NORMAL
- en: First, you need to launch your API in GitHub Codespaces with a public endpoint
    and update it to include the server URL in the OAS file.
  prefs: []
  type: TYPE_NORMAL
- en: Launching Your GitHub Codespace
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: You will be working with the Part III GitHub Codespace that you created in [“Cloning
    the Part III Repository”](ch12.html#cloning_part_3_sect). If you haven’t created
    your Part III Codespace yet, you can complete that section now.
  prefs: []
  type: TYPE_NORMAL
- en: Running the SportsWorldCentral (SWC) API in GitHub Codespaces
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'In the Terminal of your Codespace, install the required libraries using the
    provided *requirements.txt* file as follows:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE0]'
  prefs: []
  type: TYPE_PRE
- en: 'Launch the API from the command line as shown:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE1]'
  prefs: []
  type: TYPE_PRE
- en: 'You will see several messages, ending with the following:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE2]'
  prefs: []
  type: TYPE_PRE
- en: You will see a dialog stating “Your application running on port 8000 is available”
    as shown in [Figure 15-7](#make_api_public_ch15). Click Make Public.
  prefs: []
  type: TYPE_NORMAL
- en: '![Make API Public](assets/haad_1507.png)'
  prefs: []
  type: TYPE_IMG
- en: Figure 15-7\. Making the API public
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
- en: The API is now running in Codespaces with a public port. To view the API in
    the browser, click Ports in the terminal and hover over Port 8000 (see [Figure 15-8](#api_running_public_port_15)).
  prefs: []
  type: TYPE_NORMAL
- en: '![API on public address](assets/haad_1508.png)'
  prefs: []
  type: TYPE_IMG
- en: Figure 15-8\. API on a public address
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
- en: Click the globe icon to open in the browser. If you receive the message “You
    are about to access a development port served by someone’s codespace,” click Continue.
  prefs: []
  type: TYPE_NORMAL
- en: 'The browser will open to a URL that ends in *app.github.dev*, and you should
    see the following health check message in your web browser:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE3]'
  prefs: []
  type: TYPE_PRE
- en: Your API is running publicly in the cloud.
  prefs: []
  type: TYPE_NORMAL
- en: Next, you need to capture the public URL of your API so that you can use it
    in the next section. Copy the URL in the address bar and save that value.
  prefs: []
  type: TYPE_NORMAL
- en: Stop the API by pressing Ctrl-C at the terminal.
  prefs: []
  type: TYPE_NORMAL
- en: Adding the Servers Section to Your OAS File
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'To update your OAS file, you need to update your FastAPI code. Open the *main.py*
    file and update the constructor so that it matches the following:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE4]'
  prefs: []
  type: TYPE_PRE
- en: '[![1](assets/1.png)](#co_using_chatgpt_to_call_your_api_CO1-1)'
  prefs: []
  type: TYPE_NORMAL
- en: The value inside the quote marks should be the full public URL you copied in
    the previous step.
  prefs: []
  type: TYPE_NORMAL
- en: 'Adding this section in the code makes two changes that you can verify:'
  prefs: []
  type: TYPE_NORMAL
- en: The `Servers` section will be added to the OAS file.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The `Servers` section will be added to the API documentation (which is auto-generated
    from the OAS file).
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'To verify these, start your API again from the Terminal:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE5]'
  prefs: []
  type: TYPE_PRE
- en: Navigate to the API documentation by adding */docs* to the URL. Below the General
    section, you should see a Servers select box as shown in [Figure 15-9](#servers_section_ch15).
  prefs: []
  type: TYPE_NORMAL
- en: '![Servers section added to API documentation](assets/haad_1509.png)'
  prefs: []
  type: TYPE_IMG
- en: Figure 15-9\. Servers section added to API documentation
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
- en: 'To view the OAS file, click the *openapi.json* link at the top of the documentation
    page. (You may need to add a browser extension to format the JSON for readability.)
    Below the `info` section of the OAS file, you should see a new `servers` section
    that looks like the following:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE6]'
  prefs: []
  type: TYPE_PRE
- en: Copy the full path of the OAS file from the browser, including *openapi.json*.
    You will use it in the next step.
  prefs: []
  type: TYPE_NORMAL
- en: Creating a GPT Action
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: As shown in [Figure 15-1](#chatgpt_architecture_ch15), your custom GPT will
    contain a custom action inside it. This is the component that calls your API.
  prefs: []
  type: TYPE_NORMAL
- en: At the bottom of the Configure tab, click the “Create new action” button. The
    Add Actions page will be displayed. Leave the Authentication entry as None, because
    your API does not require authentication.
  prefs: []
  type: TYPE_NORMAL
- en: Click Import URL, and then paste the full address of your OAS file from the
    previous step. Your display should look like [Figure 15-10](#oas_file_import_ch15)
    at this point.
  prefs: []
  type: TYPE_NORMAL
- en: '![Importing OAS file](assets/haad_1510.png)'
  prefs: []
  type: TYPE_IMG
- en: Figure 15-10\. Importing the OAS file
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
- en: Click Import. The Schema section will be populated with the contents of your
    OAS file, as shown in [Figure 15-11](#oas_file_populated_ch15).
  prefs: []
  type: TYPE_NORMAL
- en: '![OAS file populated](assets/haad_1511.png)'
  prefs: []
  type: TYPE_IMG
- en: Figure 15-11\. OAS file populated
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
- en: Scroll down below the text of the OAS file and you will see a list of available
    actions. [Figure 15-12](#available_actions_ch15) shows the top of this list.
  prefs: []
  type: TYPE_NORMAL
- en: '![Available actions list](assets/haad_1512.png)'
  prefs: []
  type: TYPE_IMG
- en: Figure 15-12\. Available actions list
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
- en: Testing the APIs in Your GPT
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: You will notice that the “Available actions” section lists all of the endpoints
    in your OAS file. If you wanted to restrict the GPT to a subset of the endpoints
    in your API, you could manually edit this schema to remove any endpoints you did
    not want it to use. All of these endpoints are public read-only, so you will leave
    them in the schema.
  prefs: []
  type: TYPE_NORMAL
- en: To verify that the connection to your API is set up properly, click the Test
    button next to *v0_health_check*. Your GPT will call the API’s health check endpoint
    and give a status of the API, as shown in [Figure 15-13](#health_check_endpoint_test_ch15).
  prefs: []
  type: TYPE_NORMAL
- en: '![GPT calling health check endpoint](assets/haad_1513.png)'
  prefs: []
  type: TYPE_IMG
- en: Figure 15-13\. GPT calling health check endpoint
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
- en: You are ready to add this action to your GPT. Click the Save button. The Share
    GPT dialog will be displayed as shown in [Figure 15-14](#gpt_sharing_options_ch15).
  prefs: []
  type: TYPE_NORMAL
- en: '![Share GPT dialog](assets/haad_1514.png)'
  prefs: []
  type: TYPE_IMG
- en: Figure 15-14\. Share GPT dialog
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
- en: Select “Only me” to keep this GPT private. Click Save.
  prefs: []
  type: TYPE_NORMAL
- en: The Settings Saved dialog will be displayed with a direct link to the GPT. You
    do not need to use the link at this time. Click View GPT.
  prefs: []
  type: TYPE_NORMAL
- en: Chatting with Your Custom GPT
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Now that you have created a custom GPT, you will see it displayed in the navigation
    sidebar beneath ChatGPT. As shown in [Figure 15-1](#chatgpt_architecture_ch15),
    your GPT is a separate application from ChatGPT. Now your GPT has the ability
    to access the SWC Fantasy Football API to get information.
  prefs: []
  type: TYPE_NORMAL
- en: Select the SWC Fantasy Football Advisor in the navigation. The display should
    look like [Figure 15-15](#swc_fantasy_advisor_ch15).
  prefs: []
  type: TYPE_NORMAL
- en: '![Fantasy advisor ready to chat](assets/haad_1515.png)'
  prefs: []
  type: TYPE_IMG
- en: Figure 15-15\. Fantasy Football advisor ready to chat
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
- en: Warning
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
- en: 'Don’t miss the note at the bottom of this page: “ChatGPT can make mistakes.
    Check important info.” It bears repeating that conversations with GPTs are impressive
    and quite convincing, but OpenAI is transparent that LLMs can provide unreliable
    information and hallucinate in their responses.'
  prefs: []
  type: TYPE_NORMAL
- en: Some developers have found that GPTs [struggle to process statistics accurately
    for APIs that return large amounts of data](https://oreil.ly/Pncx5). For fantasy
    sports, the stakes are fairly low. But if your usage expands to tasks where accuracy
    is more important, don’t overlook the warnings that OpenAI is clearly publishing.
  prefs: []
  type: TYPE_NORMAL
- en: 'Start your conversation by repeating the question you asked before: **`What
    are the specific league names from the SportsWorldCentral Fantasy Football platform?`**'
  prefs: []
  type: TYPE_NORMAL
- en: The GPT will state that it wants permission to call your API. Click Always Allow.
  prefs: []
  type: TYPE_NORMAL
- en: The GPT will state that it talked to your API. It also will show that it found
    the `limit` parameter and used a value of 10 to limit the number of results.
  prefs: []
  type: TYPE_NORMAL
- en: Then, it will answer the questions using the information returned from your
    API, as shown in [Figure 15-16](#api_call_results_ch15). It has overcome the knowledge
    gap by accessing data from your API.
  prefs: []
  type: TYPE_NORMAL
- en: '![Results from API call](assets/haad_1516.png)'
  prefs: []
  type: TYPE_IMG
- en: Figure 15-16\. Results from API call
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
- en: 'To see the API calls that the GPT made, look at the Terminal output in your
    Codespace. You will see the API calls made:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE7]'
  prefs: []
  type: TYPE_PRE
- en: '[![1](assets/1.png)](#co_using_chatgpt_to_call_your_api_CO2-1)'
  prefs: []
  type: TYPE_NORMAL
- en: This is a call to the health check endpoint.
  prefs: []
  type: TYPE_NORMAL
- en: '[![2](assets/2.png)](#co_using_chatgpt_to_call_your_api_CO2-2)'
  prefs: []
  type: TYPE_NORMAL
- en: This is a call to the get leagues endpoint.
  prefs: []
  type: TYPE_NORMAL
- en: 'In this case, the custom GPT made the right choices: it used the health check
    endpoint to make sure the API was available, and it used the get leagues endpoint
    to see available SWC leagues.'
  prefs: []
  type: TYPE_NORMAL
- en: Congratulations! You have created a custom GPT and provided it access to your
    API through a custom action.
  prefs: []
  type: TYPE_NORMAL
- en: Take time and experiment with questions that will encourage the agent to use
    more of your API endpoints. Look at the Terminal output to see the API calls that
    are generated. How can you influence which API it calls? How can you guide it
    to answer more difficult questions using the tools? How can you stump it?
  prefs: []
  type: TYPE_NORMAL
- en: Completing Your Part III Portfolio Project
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: You have reached the end of Part III, congratulations! As with Parts I and II,
    there is some housekeeping required to get the portfolio project ready to share.
    You’ll move the code out of the chapter folders and into functional folders, then
    update *README.md*.
  prefs: []
  type: TYPE_NORMAL
- en: Before you make these changes, you’ll save a copy of your files to a separate
    GitHub branch, named *learning-branch*, so that it’s still available if you want
    to continue working through the code.
  prefs: []
  type: TYPE_NORMAL
- en: 'Create the new branch from the command line as follows:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE8]'
  prefs: []
  type: TYPE_PRE
- en: '[![1](assets/1.png)](#co_using_chatgpt_to_call_your_api_CO3-1)'
  prefs: []
  type: TYPE_NORMAL
- en: Create a new branch named *learning-branch* locally based on the *main* branch.
  prefs: []
  type: TYPE_NORMAL
- en: '[![2](assets/2.png)](#co_using_chatgpt_to_call_your_api_CO3-2)'
  prefs: []
  type: TYPE_NORMAL
- en: Push this new branch to your remote repository on GitHub.com.
  prefs: []
  type: TYPE_NORMAL
- en: 'Next, you will make some changes to the directory structure. Enter the following
    commands:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE9]'
  prefs: []
  type: TYPE_PRE
- en: '[![1](assets/1.png)](#co_using_chatgpt_to_call_your_api_CO4-1)'
  prefs: []
  type: TYPE_NORMAL
- en: Switch your Codespace back to the *main* branch of your repository.
  prefs: []
  type: TYPE_NORMAL
- en: '[![2](assets/2.png)](#co_using_chatgpt_to_call_your_api_CO4-2)'
  prefs: []
  type: TYPE_NORMAL
- en: Make a new directory for the files from Chapter 13.
  prefs: []
  type: TYPE_NORMAL
- en: '[![3](assets/3.png)](#co_using_chatgpt_to_call_your_api_CO4-3)'
  prefs: []
  type: TYPE_NORMAL
- en: Move Chapter 13’s files to the new folder.
  prefs: []
  type: TYPE_NORMAL
- en: '[![4](assets/4.png)](#co_using_chatgpt_to_call_your_api_CO4-4)'
  prefs: []
  type: TYPE_NORMAL
- en: Make a new directory for the files from Chapter 14.
  prefs: []
  type: TYPE_NORMAL
- en: '[![5](assets/5.png)](#co_using_chatgpt_to_call_your_api_CO4-5)'
  prefs: []
  type: TYPE_NORMAL
- en: Move Chapter 14’s files to the new folder.
  prefs: []
  type: TYPE_NORMAL
- en: '[![6](assets/6.png)](#co_using_chatgpt_to_call_your_api_CO4-6)'
  prefs: []
  type: TYPE_NORMAL
- en: Remove all the subdirectories and their files.
  prefs: []
  type: TYPE_NORMAL
- en: 'To see the directory structure of the completed project, run the following
    command:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE10]'
  prefs: []
  type: TYPE_PRE
- en: 'Now update the *README.md* file to showcase your work. Here is a start, and
    then you can add your own thoughts:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE11]'
  prefs: []
  type: TYPE_PRE
- en: Now commit these changes to GitHub, and your Part III portfolio project is ready
    to share with the world. Congratulations on completing your Part III capstone!
  prefs: []
  type: TYPE_NORMAL
- en: Summary
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'In this chapter, you used OpenAI’s ChatGPT to interact with your API:'
  prefs: []
  type: TYPE_NORMAL
- en: You created a custom GPT.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: You created a custom action to give your GPT access to the SWC API.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: You updated the contents of your Part III portfolio project.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
