- en: Chapter 7\. Deploying to Production
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第七章\. 部署到生产
- en: The [Knight Capital incident](https://oreil.ly/pTAIv) of August 1, 2012, stands
    as a stark example of how a software deployment gone wrong can have catastrophic
    consequences. On that day, Knight Capital, then one of the largest trading firms
    in the US, deployed a large update to its automated trading system. Due to a confluence
    of factors, including limited automation, human error in deployments, and poor
    feature flag management, outdated code was accidentally reactivated, causing the
    system to [rapidly place erroneous orders in the stock market](https://oreil.ly/efPYb).
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 2012年8月1日的[Knight Capital事件](https://oreil.ly/pTAIv)是一个鲜明的例子，说明了软件部署失败可能带来的灾难性后果。那天，Knight
    Capital，当时美国最大的交易公司之一，对其自动化交易系统进行了大规模更新。由于多种因素的综合作用，包括有限的自动化、部署中的人为错误和糟糕的功能标志管理，过时的代码意外地被重新激活，导致系统在股票市场上[迅速发出错误订单](https://oreil.ly/efPYb)。
- en: Within just 45 minutes, the faulty algorithm had executed over 4 million trades,
    resulting in a staggering loss of $460 million for the firm. This incident not
    only nearly bankrupted Knight Capital, leading to its eventual acquisition, but
    also caused significant market disruption. It highlighted the critical importance
    of robust deployment practices, thorough testing, governance, and fail-safe mechanisms
    in high-stakes software environments.
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 在仅仅45分钟内，有缺陷的算法执行了超过400万笔交易，导致公司损失了4.6亿美元。这一事件不仅几乎使Knight Capital破产，最终导致其被收购，还造成了重大的市场动荡。它强调了在高风险软件环境中实施稳健的部署实践、彻底的测试、治理和应急机制的关键重要性。
- en: Deploying to production can be a high-stakes activity. While not every application
    is a market-making trading platform, applications worth updating have people who
    depend on them, and changing anything introduces risk. Although we might prefer
    to avoid this risk by deploying less often, we face business demands for more
    frequent change. Moreover, certain types of risk increase as we delay and accumulate
    more and more changes into our planned release, making the continuous delivery
    approach more valuable.
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 部署到生产可能是一项高风险的活动。虽然并非每个应用程序都是市场制造交易平台，但值得更新的应用程序都有依赖它们的人，任何改变都引入了风险。尽管我们可能更喜欢通过减少部署频率来避免这种风险，但我们面临着对更频繁变更的商业需求。此外，随着我们推迟并积累越来越多的变更到计划发布中，某些类型的风险会增加，这使得持续交付方法更有价值。
- en: In previous chapters, as we’ve navigated the software delivery process, we’ve
    hit upon strategies to mitigate the risk of finally deploying to production. In
    [Chapter 2](ch02.html#chapter_2_source_control_management_1749354010078326), we
    discussed the importance of code reviews. In [Chapter 3](ch03.html#chapter_3_the_build_and_pre_deployment_testing_steps_of_cont_1749354010266208),
    we looked at how to use early scans and unit testing to detect issues quickly.
    [Chapter 4](ch04.html#chapter_4_deploying_to_test_environments_1749354010445896)
    described additional types of testing to harden your software and reviewed best
    practices in deploying to test environments. By using consistent tooling, pipeline
    steps, and deployment strategies, and by parameterizing for differences in environments,
    we use our deployments to test environments to vet our deployments to production.
    In [Chapter 5](ch05.html#chapter_5_securing_applications_and_the_software_supply_chai_1749354010735711),
    we dived deep into security, reviewing the practices that help secure our production
    deployments.
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: 在前面的章节中，当我们导航软件交付流程时，我们找到了减轻最终部署到生产环境风险的策略。在[第二章](ch02.html#chapter_2_source_control_management_1749354010078326)中，我们讨论了代码审查的重要性。在[第三章](ch03.html#chapter_3_the_build_and_pre_deployment_testing_steps_of_cont_1749354010266208)中，我们探讨了如何使用早期扫描和单元测试来快速检测问题。[第四章](ch04.html#chapter_4_deploying_to_test_environments_1749354010445896)描述了额外的测试类型，以加固你的软件，并回顾了部署到测试环境中的最佳实践。通过使用一致的工具、管道步骤和部署策略，并通过参数化环境差异，我们使用我们的部署到测试环境的部署来检验我们的生产部署。在[第五章](ch05.html#chapter_5_securing_applications_and_the_software_supply_chai_1749354010735711)中，我们深入探讨了安全问题，回顾了有助于保护我们生产部署的实践。
- en: Today, artificial intelligence is transforming how organizations approach production
    deployments to prevent such disasters. ML systems now analyze deployment patterns,
    detect anomalies during rollouts, and verify application health with greater precision
    than traditional monitoring. Unlike rule-based verification, which relies on predefined
    thresholds, AI systems can learn normal behavior patterns unique to each application
    and detect subtle deviations that might indicate emerging problems. These capabilities
    allow teams to deploy faster while paradoxically reducing risk—the opposite of
    the traditional speed-versus-safety trade-off.
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: 今天，人工智能正在改变组织对待生产部署的方式，以防止此类灾难。机器学习系统现在分析部署模式，在部署过程中检测异常，并以比传统监控更高的精度验证应用程序的健康状况。与基于规则的验证不同，后者依赖于预定义的阈值，人工智能系统可以学习每个应用程序独特的正常行为模式，并检测可能表明出现问题的微妙偏差。这些能力使团队能够更快地部署，同时矛盾地降低风险——这与传统的速度与安全权衡相反。
- en: In this chapter, in addition to covering the transformative role of AI, we’ll
    look at best practices for governing production deployments and strategies to
    safely deploy to production, and we’ll discuss observability to validate the quality
    of production deployments. We’ll explore how modern AI-powered deployment tooling
    helps mitigate risk through intelligent verification rather than just reactive
    monitoring, and how AI-powered systems evaluate multiple signals simultaneously
    to determine deployment health, catching issues that might slip past human operators.
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，除了介绍人工智能的变革性作用外，我们还将探讨治理生产部署的最佳实践和安全的部署策略，并讨论可观察性以验证生产部署的质量。我们将探讨现代人工智能驱动的部署工具如何通过智能验证而不是仅仅通过反应式监控来降低风险，以及人工智能系统如何同时评估多个信号以确定部署健康，捕捉可能被人类操作员忽略的问题。
- en: Governing Production Deployments
  id: totrans-7
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 治理生产部署
- en: 'The Knight Capital incident is a good reminder: the consequences of deploying
    software with defects can be nothing short of catastrophic financial ruin. Your
    organization’s trust and credibility are also at risk. For the organization, the
    cost of fixing defects post-deployment can skyrocket, far exceeding the expense
    of addressing them during development.'
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: 凯特资本事件是一个很好的提醒：部署存在缺陷的软件的后果可能是灾难性的财务毁灭。您的组织的信任和信誉也处于风险之中。对于组织来说，部署后修复缺陷的成本可能会飙升，远远超过在开发期间解决它们的费用。
- en: To deploy with confidence, we need to understand what code changed and who made
    those changes. We need to validate that the code review processes we put in place
    were conducted, and understand who conducted those reviews. For any dependencies
    that were introduced, we want to understand them and know that they comply with
    our policies. We want to know if they were reviewed for any known defects. We
    need assurance that the builds, scans, and test processes that we require were
    executed against all code changes. And of course, we want to ensure that the results
    of the scans and tests, in fact, met our criteria for passing. Lastly, we require
    evidence that our development processes themselves remain in compliance with the
    frameworks and requirements relevant to our organization.
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: 为了有信心地部署，我们需要了解哪些代码发生了变化，以及是谁进行了这些更改。我们需要验证我们实施的代码审查流程是否已执行，并了解是谁进行了这些审查。对于引入的任何依赖项，我们希望了解它们，并知道它们是否符合我们的政策。我们希望了解它们是否经过了对已知缺陷的审查。我们需要确保我们要求的构建、扫描和测试流程针对所有代码更改都得到了执行。当然，我们还想确保扫描和测试的结果实际上符合我们通过的标准。最后，我们需要证据证明我们的开发流程本身仍然符合我们组织相关的框架和需求。
- en: Stringent code reviews, thorough and robust testing practices, and automated,
    repeatable deployment procedures are essential to avoiding deployment failures.
    However, without appropriate governance and controls to ensure thatwe’ve adhered
    to our processes, all of our efforts can be rendered ineffective.
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 严格的代码审查、彻底和稳健的测试实践以及自动化、可重复的部署程序对于避免部署失败至关重要。然而，如果没有适当的治理和控制来确保我们遵守了我们的流程，我们所有的努力都可能变得无效。
- en: AI is beginning to transform deployment governance, though most applications
    are still emerging. Current AI systems focus primarily on analyzing deployment
    patterns to identify risk factors and policy violations rather than making autonomous
    decisions. These systems can process more deployment variables simultaneously
    than humans, helping to identify subtle correlations between code changes, deployment
    configurations, and historical incidents. Organizations are beginning to use these
    insights to refine their governance frameworks, though human oversight remains
    essential for final approval decisions.
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 人工智能开始改变部署治理，尽管大多数应用仍在出现。当前的AI系统主要专注于分析部署模式以识别风险因素和政策违规，而不是做出自主决策。这些系统可以同时处理比人类更多的部署变量，帮助识别代码更改、部署配置和历史事件之间的微妙相关性。组织开始利用这些见解来完善他们的治理框架，尽管对于最终批准决策，人类监督仍然是必不可少的。
- en: Note
  id: totrans-12
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 注意
- en: Deployment governance is simply the systematic oversight and control of the
    software deployment process to ensure the rules and policies we’ve defined are
    enforced. Fundamentally, governance is about reducing the risk of change. Governance
    includes the policies, processes, and tools that organizations use to ensure that
    software deployments are carried out in a consistent, controlled, secure, and
    compliant manner. The challenge in governance is balancing the need for agility
    and innovation with the need for stability and risk management.
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 部署治理仅仅是系统性地监督和控制软件部署过程，以确保我们定义的规则和政策得到执行。从根本上说，治理是关于降低变更风险。治理包括组织使用的政策、流程和工具，以确保软件部署以一致、受控、安全和合规的方式进行。治理的挑战在于平衡敏捷性和创新的需求与稳定性和风险管理的需求。
- en: In the next few sections, we’ll discuss traditional and modern approaches to
    deployment governance. We’ll investigate how to automate the enforcement of our
    governing policies to make our delivery process more efficient. We’ll review tools
    and strategies that support our governance processes, and lastly, we’ll look at
    the future of deployment governance.
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 在接下来的几节中，我们将讨论部署治理的传统和现代方法。我们将研究如何自动化执行我们的治理政策，以提高我们的交付流程效率。我们将回顾支持我们的治理流程的工具和策略，最后，我们将探讨部署治理的未来。
- en: Traditional Approaches to Deployment Governance
  id: totrans-15
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 部署治理的传统方法
- en: Traditional approaches to deployment governance are those built for a pre-DevOps
    world. In this world, changes to production were infrequent, risky, and executed
    by a traditional operations team. Decision making was centralized and involved
    rigid processes.
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: 部署治理的传统方法是为预DevOps世界构建的。在这个世界中，对生产的变更很少见、风险高，并由传统的运维团队执行。决策是集中的，涉及严格的过程。
- en: The Information Technology Infrastructure Library (ITIL) is one widely adopted
    framework that characterizes a traditional approach. ITIL originally emerged in
    the 1980s as a response to the need for standardized IT management practices,
    evolving from a collection of best practices into a comprehensive framework. It
    includes several processes and practices that are directly relevant to deployment
    governance.
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: 信息技术基础设施库（ITIL）是一个广泛采用的框架，它描述了一种传统方法。ITIL最初在20世纪80年代作为对标准化IT管理实践需求的回应而出现，从一系列最佳实践发展成为一个全面的框架。它包括几个与部署治理直接相关的流程和实践。
- en: One of these is the change management process, which defines a structured approach
    for managing all changes to services and infrastructure, including deployments.
    It prescribes formal documentation of a proposed change, including its purpose,
    scope, impact, and risk assessment. A Change Advisory Board (CAB) or a similar
    body assesses changes. The change request is formally authorized or denied based
    on its merits and potential risks. If the change is approved and executed, a post-implementation
    assessment is conducted to ensure the change achieved its objectives and identify
    any lessons learned.
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 其中之一是变更管理流程，它定义了一种结构化的方法来管理所有对服务和基础设施的变更，包括部署。它规定了提出变更的正式文档，包括其目的、范围、影响和风险评估。变更顾问委员会（CAB）或类似的机构评估变更。变更请求根据其优点和潜在风险正式授权或拒绝。如果变更获得批准并执行，将进行实施后评估，以确保变更实现了其目标并确定任何经验教训。
- en: The release management process is similarly formal and orders the planning,
    scheduling, and controlling of releases into production environments. It’s closely
    related to the change management process and is intended to ensure that deployments
    are executed in a controlled and transparent manner.
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: 发布管理流程同样正式，并规范了将发布计划、调度和控制纳入生产环境的流程。它与变更管理流程密切相关，旨在确保部署以受控和透明的方式进行。
- en: CABs are a typical feature of approaches like those defined by ITIL. A CAB is
    a committee of individuals responsible for formally assessing and approving or
    rejecting proposed changes to software. This board might include a change manager
    responsible for coordinating change request reviews and tracking change implementation,
    as well as technical experts, business stakeholders, security specialists, compliance
    officers, and others. The intention is to reduce risk through thorough evaluation
    of requests from several perspectives.
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: CABs是像ITIL定义的方法中典型的特征。CAB是一个由个人组成的委员会，负责正式评估和批准或拒绝软件变更的提案。这个委员会可能包括负责协调变更请求审查和跟踪变更实施的变更经理，以及技术专家、业务利益相关者、安全专家、合规官员和其他人。目的是通过从多个角度彻底评估请求来降低风险。
- en: Moreover, CABs ensure accountability if anything does go wrong. While a highly
    functioning CAB will provide the intended oversight, at their worst CABs consist
    of inattentive reviewers that rubber-stamp reviews with little to no assessment.
    Or a CAB may be nominally effective but hopelessly inefficient. Email-driven approval
    processes are slowed by ignored emails, approvers being out of the office with
    no delegation, and review meetings getting rescheduled.
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: 此外，如果发生任何问题，CABs确保了问责制。虽然一个高度运作的CAB将提供预期的监督，但最糟糕的情况是，CAB由粗心大意的审查员组成，他们几乎不做评估就盖章批准。或者，CAB可能名义上有效，但效率低下。电子邮件驱动的审批流程因被忽视的电子邮件、审批人不在办公室且未进行委托，以及审查会议被重新安排而变得缓慢。
- en: Research shows that these traditional CAB processes aren’t just inefficient,
    they’re actually counterproductive to the stability they aim to ensure. Writing
    about their landmark study of high-performing organizations in their book *Accelerate*,
    Forsgren, Humble, and Kim explain that “external approvals were negatively correlated
    with lead time, deployment frequency, and restore time and had no correlation
    with change fail rate.” In other words, approval by external bodies like CABs
    demonstrably slows down delivery without improving stability.
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: 研究表明，这些传统的CAB流程不仅效率低下，实际上与它们旨在确保的稳定性背道而驰。在他们的书《加速》中，Forsgren、Humble和Kim在讨论他们对高绩效组织的里程碑式研究时解释说：“外部批准与领先时间、部署频率和恢复时间呈负相关，与变更失败率没有相关性。”换句话说，像CAB这样的外部机构批准实际上会减慢交付速度，而不会提高稳定性。
- en: This occurs because CABs divorce responsibility from knowledge; the people with
    the deepest understanding of the changes aren’t the ones making approval decisions.
    While these committees create the appearance of due diligence, they often function
    as compliance theater, giving organizations someone to point to when things go
    wrong rather than actually preventing failures. The illusion of control they provide
    can even reduce vigilance among those implementing changes, since “the CAB approved
    it” becomes a shield against accountability.
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: 这是因为变更顾问委员会（CABs）将责任与知识分离；对变更理解最深的人并不是做出批准决定的人。虽然这些委员会看起来在尽职调查，但它们通常充当合规戏剧，当事情出错时，组织可以指向某人，而不是真正防止失败。它们提供的控制错觉甚至可能降低实施变更的人的警惕性，因为“变更顾问委员会批准了”成为逃避责任的保护伞。
- en: The expense of CAB meetings, coupled with the ineffectiveness and delay, was
    tolerable when applications were released infrequently. As release frequencies
    have increased, the trouble with CABs is increasingly clear.
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: 当应用程序发布频率较低时，CAB会议的支出以及其无效性和延迟是可以容忍的。随着发布频率的增加，CAB的问题越来越明显。
- en: Modern Approaches to Deployment Governance
  id: totrans-25
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 现代部署治理方法
- en: In previous chapters, we explored how to streamline the development process
    by automating steps at every stage, enabling faster and more frequent software
    releases. Modern approaches to deployment governance are similarly focused on
    automating the manual steps that are an unnecessary obstacle to releasing software.
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: 在前面的章节中，我们探讨了如何通过在每个阶段自动化步骤来简化开发流程，从而实现更快、更频繁的软件发布。现代部署治理方法同样专注于自动化那些成为发布软件不必要的障碍的手动步骤。
- en: Instead of relying on committees and manual approvals for deployment decisions,
    modern approaches favor automated decision making and deployments. Because the
    stakes of production deployment are so high, this must be done with great care.
    In this section we’ll explore how.
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: 与依赖委员会和手动批准的部署决策相比，现代方法更倾向于自动化决策和部署。由于生产部署的风险非常高，这必须非常谨慎地进行。在本节中，我们将探讨如何实现这一点。
- en: In addition to automation, modern governance approaches also leverage contemporary
    strategies and tools to manage compliance. We’ll look at how to use audit logs
    to simplify compliance, and tools like Open Policy Agent (OPA) to enforce security
    and regulatory standards.
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: 除了自动化之外，现代治理方法还利用当代策略和工具来管理合规性。我们将探讨如何使用审计日志简化合规性，以及如何使用像Open Policy Agent (OPA)这样的工具来执行安全和监管标准。
- en: Automating decision making
  id: totrans-29
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 自动化决策
- en: With modern CI/CD tools we can empower our pipelines to make autonomous deployment
    decisions. If we can ensure that our pipelines can adequately enforce governance
    policies to maintain our standards, we can accelerate software delivery by removing
    or minimizing manual approvals.
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: 使用现代CI/CD工具，我们可以赋予我们的管道自主部署决策的能力。如果我们能确保我们的管道能够充分执行治理政策以维护我们的标准，我们就可以通过减少或最小化手动批准来加速软件交付。
- en: 'Consider these steps to automate deployment decision making in your delivery
    process:'
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: 在您的交付过程中自动化部署决策，请考虑以下步骤：
- en: 1\. Identify your “pass” criteria
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: 1. 确定您的“通过”标准
- en: Identifying clear criteria for promoting builds is crucial for automating your
    deployment process, but this can be challenging. One bank that we worked with
    documented its controls in a three-inch-thick binder containing hundreds of pages
    of regulations and policy. Often, decision makers may rely on both objective data
    and subjective judgment. Ambiguity can make it challenging to translate human
    decision making into a set of rigid, automated rules. For example, a decision
    maker might promote a build with a few minor test failures if they believe the
    issues are low risk and unlikely to impact users. However, translating this intuition
    into an automated rule that accurately assesses risk and user impact can be complex.
    AI has a growing role in bringing the fuzzier elements of human decision making
    into fully or mostly automated flows. If used this way, it should be required
    to explain its recommendations and insights.
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: 明确制定促进构建的标准对于自动化部署流程至关重要，但这可能具有挑战性。我们合作的一家银行将其控制措施记录在一个三英寸厚的活页夹中，包含数百页的法规和政策。通常，决策者可能会同时依赖客观数据和主观判断。模糊性可能使得将人类决策转化为一系列严格、自动化的规则变得困难。例如，如果决策者认为问题风险较低且不太可能影响用户，他们可能会在少数测试失败的情况下提升构建。然而，将这种直觉转化为准确评估风险和用户影响的自动化规则可能很复杂。人工智能在将人类决策的模糊元素引入完全或主要自动化流程中发挥着越来越重要的作用。如果以这种方式使用，它应该需要解释其建议和见解。
- en: 2\. Use “quality gates” to implement complex criteria to automate as many controls
    as possible
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: 2. 使用“质量网关”实现复杂标准以尽可能自动化更多控制措施
- en: Gates are checkpoints within a CI/CD pipeline that evaluate specific criteria
    to determine whether a build should proceed to the next stage. Gates can take
    into account test results, code quality metrics based on static analysis results,
    code coverage, and adherence to coding standards, security scans results, and
    performance metrics. Other tools allow you to introduce a pipeline step that fails
    if the decision is “no,” or you can set up conditional execution based on your
    specific criteria. Often, the simplest approach is to configure each set of tests
    to fail if it doesn’t meet your standards. This way, if any step fails, the entire
    pipeline halts, preventing the promotion of a substandard build.
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: 网关是CI/CD管道中的检查点，用于评估特定标准以确定构建是否应进入下一阶段。网关可以考虑到测试结果、基于静态分析结果的代码质量指标、代码覆盖率以及遵守编码标准、安全扫描结果和性能指标。其他工具允许您引入一个如果决策为“否”则失败的管道步骤，或者您可以根据您特定的标准设置条件执行。通常，最简单的方法是配置每一组测试，如果它不符合您的标准则失败。这样，如果任何步骤失败，整个管道就会停止，防止推广不达标的构建。
- en: 3\. Consider historical results when automating nuanced decisions
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: 3. 在自动化细微决策时考虑历史结果
- en: For instance, security initiatives often start with a zero-tolerance policy
    for new high-priority issues but tolerate existing ones while the team works through
    them. This requires considering historical data, not just the most recent results.
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，安全倡议通常从对新的高优先级问题实行零容忍政策开始，但在团队解决现有问题期间则对此予以容忍。这需要考虑历史数据，而不仅仅是最近的结果。
- en: 4\. Finally, standardize on that automation
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: 4. 最后，标准化自动化
- en: Use the choice of standardization or painful manual compliance as an incentive
    to use standardized tooling. Teams at the bank that we worked with were given
    a choice to deploy to production by certifying that a release complies with all
    of the controls detailed in the binder, or by using their standardized automated
    processes and tooling. This became an easy choice.
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: 使用标准化或痛苦的手动合规性选择作为使用标准化工具的激励。与我们合作的银行团队可以选择通过认证，证明发布符合绑定的所有控制措施来部署到生产环境，或者使用他们标准化的自动化流程和工具。这成为了一个简单的选择。
- en: Building strong audit trails to automate compliance
  id: totrans-40
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 建立强大的审计跟踪以自动化合规性
- en: Deployment governance and compliance are closely related. Effective governance
    practices are crucial in achieving and maintaining compliance with various regulatory
    standards and frameworks.
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: 部署治理和合规性密切相关。有效的治理实践对于实现和维护符合各种监管标准和框架至关重要。
- en: We reviewed several frameworks in [Chapter 5](ch05.html#chapter_5_securing_applications_and_the_software_supply_chai_1749354010735711),
    specifically security-related ones. PCI DSS is one widely applicable example.
    It’s used to ensure that all companies that accept, process, store, or transmit
    credit card information maintain a secure environment. Regardless of the size
    or number of transactions you process, if your organization handles cardholder
    data then you are subject to its requirements. The major card brands (Visa, Mastercard,
    etc.) may impose fines or restrict your ability to process card payments if compliance
    cannot be demonstrated.
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: 我们在[第5章](ch05.html#chapter_5_securing_applications_and_the_software_supply_chai_1749354010735711)中回顾了几个框架，特别是与安全相关的框架。PCI
    DSS是一个广泛应用的例子。它被用来确保所有接受、处理、存储或传输信用卡信息的公司都保持一个安全的环境。无论您处理的交易规模或数量如何，如果您的组织处理持卡人数据，那么您就受其要求约束。主要信用卡品牌（如Visa、Mastercard等）如果无法证明合规性，可能会处以罚款或限制您处理信用卡支付的能力。
- en: While PCI DSS primarily focuses on securing cardholder data, several requirements
    directly pertain to the software development and deployment process. This is to
    ensure the overall security of the environment where this data is handled. For
    example, PCI DSS requires that you develop and maintain secure systems and applications
    by taking steps such as conducting reviews of custom code prior to release to
    production and addressing common coding vulnerabilities. PCI DSS also includes
    testing requirements, mandating internal and external penetration testing after
    any significant infrastructure or application upgrade or modification.
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然PCI DSS主要关注保护持卡人数据，但其中一些要求直接与软件开发和部署过程相关。这是为了确保处理这些数据的环境的整体安全性。例如，PCI DSS要求您通过在发布到生产之前对自定义代码进行审查和解决常见的编码漏洞等措施来开发和维护安全系统和应用程序。PCI
    DSS还包括测试要求，规定在任何重大基础设施或应用程序升级或修改之后进行内部和外部渗透测试。
- en: A strong and comprehensive audit trail is essential to demonstrating the practices
    that compliance requires. And while your organization may not be subject to PCI
    DSS requirements, many other frameworks that may be relevant will have similar
    requirements of your development and deployment processes.
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: 一个强大而全面的审计跟踪对于展示合规性所需的做法至关重要。尽管您的组织可能不受PCI DSS要求的影响，但许多其他相关框架可能对您的开发和部署过程有类似的要求。
- en: Your source control and CI/CD systems play a vital role here by capturing the
    granular details of every action taken within the delivery pipeline, from code
    commits and builds to test results, deployments, and environment configurations,
    along with the associated user, timestamp, and any relevant metadata. This includes
    logging user actions, system events, artifact tracking, configuration changes,
    and external integrations. By storing this information in a structured and accessible
    format, CI/CD tools provide a versatile audit trail that is adaptable to any number
    of security and regulatory frameworks.
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: 您的源代码控制和 CI/CD 系统在这里发挥着至关重要的作用，通过捕捉交付管道中每个动作的细粒度细节，从代码提交和构建到测试结果、部署和环境配置，以及相关的用户、时间戳和任何相关元数据。这包括记录用户操作、系统事件、工件跟踪、配置更改和外部集成。通过以结构化和可访问的格式存储这些信息，CI/CD
    工具提供了一种灵活的审计跟踪，可以适应任何数量的安全和监管框架。
- en: Tools that support a strong audit trail allow your organization to demonstrate
    compliance without maintaining separate logs for each framework. It also enables
    you to proactively address potential security or compliance concerns.
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: 支持强大审计跟踪的工具允许您的组织在不为每个框架维护单独日志的情况下证明合规性。它还使您能够积极应对潜在的安全或合规性问题。
- en: Managing enforcement with Policy as Code
  id: totrans-47
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 使用策略即代码进行管理
- en: 'Policy as Code (PaC) can be instrumental in automating your production deployments
    while maintaining robust governance. PaC is the practice of defining and managing
    security, compliance, and operational policies *as code*, allowing for automated
    enforcement. Policies are defined in a declarative language and can be managed
    like any other critical piece of code: versioned in source control, allowing for
    tracking, collaboration and required code reviews, and rollback capabilities.'
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: 策略即代码（PaC）在自动化生产部署的同时保持强大的治理能力方面可以发挥重要作用。PaC 是一种将安全、合规性和运营策略定义为代码并管理的实践，允许自动执行。策略以声明性语言定义，可以像其他任何关键代码片段一样进行管理：在源代码控制中进行版本控制，允许跟踪、协作和必要的代码审查，以及回滚功能。
- en: OPA is a popular open source policy engine used to implement PaC. With OPA,
    every deployment is automatically evaluated against your defined policies, ensuring
    consistent enforcement without slowing down your delivery process. Imagine your
    deployment policy requires all container images to be scanned for critical vulnerabilities
    before reaching production. Using OPA, you can express this PaC, and integrate
    it into your pipeline. Now, every time a deployment is triggered, OPA automatically
    scans the image and either allows the deployment to proceed if the image is clean
    or halts it if vulnerabilities are found. This eliminates manual security checks
    and ensures consistent adherence to your security standards without human intervention.
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: OPA 是一个流行的开源策略引擎，用于实现 PaC。使用 OPA，每次部署都会自动与您定义的策略进行评估，确保一致性的执行，而不会减慢您的交付流程。想象一下，您的部署策略要求所有容器镜像在达到生产之前都必须扫描关键漏洞。使用
    OPA，您可以表达这种 PaC，并将其集成到您的管道中。现在，每次触发部署时，OPA 都会自动扫描镜像，如果镜像干净，则允许部署继续进行；如果发现漏洞，则停止部署。这消除了手动安全检查，并确保在无需人工干预的情况下，始终一致地遵守您的安全标准。
- en: OPA’s versatility extends beyond security checks. You can codify various deployment
    policies, such as enforcing canary deployments, requiring approvals for specific
    changes, or validating resource configurations. By automating these checks, you
    gain confidence that every deployment adheres to your organization’s standards
    and regulatory requirements. This not only accelerates your delivery process but
    also reduces the risk of human error and noncompliance.
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: OPA 的多功能性不仅限于安全检查。您可以编码各种部署策略，例如强制执行金丝雀部署、要求对特定更改进行批准或验证资源配置。通过自动化这些检查，您可以获得信心，确保每次部署都符合您组织的标准和监管要求。这不仅加速了您的交付流程，还降低了人为错误和非合规的风险。
- en: Safeguarding the Deployment Process
  id: totrans-51
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 保护部署流程
- en: Tightly controlling your governance mechanisms helps protect your deployment.
    Developer empowerment is also critical in modern deployments. In practice, you
    need to strike a balance between the two. While you want to enable developers
    to adapt their deployment pipelines, you also need to safeguard against potential
    risks. Malicious actors can tamper with or bypass the very governance mechanisms
    you put in place, or they can be corrupted by human error. Alternatively, overly
    tight controls on deployments can create another obstacle to efficient deployments.
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: 严格控制你的治理机制有助于保护你的部署。在现代部署中，开发者赋权同样关键。在实践中，你需要在这两者之间找到平衡。虽然你希望让开发者能够调整他们的部署管道，但你还需要防范潜在的风险。恶意行为者可能会篡改或绕过你设置的治理机制，或者它们可能受到人为错误的破坏。或者，对部署的过度严格控制可能会成为高效部署的另一个障碍。
- en: OPA can help here too. With OPA you apply strict controls on the policy update
    process itself, ensuring that any changes to your governance framework are carefully
    vetted and compliant. By centralizing policy rules in OPA and applying them to
    pipelines, you create a separation of concerns. This makes it more difficult for
    individual developers to circumvent policies, as they would need to modify the
    central OPA policies, which can be subject to stricter access controls, peer reviews,
    and audit trails.
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: OPA在这里也能提供帮助。使用OPA，你对策略更新过程本身应用严格控制，确保对治理框架的任何更改都经过仔细审查并符合规定。通过在OPA中集中策略规则并将其应用于管道，你创建了一个关注点的分离。这使得个人开发者更难规避策略，因为他们需要修改中央OPA策略，这些策略可能受到更严格的访问控制、同行评审和审计跟踪的影响。
- en: As we increasingly rely on AI to generate our pipelines for us, OPA policies
    provide both directional input to the AI as to what we want, and protection ensuring
    that the output of the AI is in compliance with our standards.
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: 随着我们越来越多地依赖AI为我们生成管道，OPA策略既为AI提供方向性输入，说明我们想要什么，又提供保护，确保AI的输出符合我们的标准。
- en: Another important control in safeguarding your deployment process is implementing
    robust RBAC. As discussed in [Chapter 2](ch02.html#chapter_2_source_control_management_1749354010078326),
    RBAC allows you to granularly control who has access to modify pipelines and sensitive
    configuration settings within your CI/CD platform. This ensures that only authorized
    personnel can make changes to your deployment process, minimizing the risk of
    malicious activities.
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: 在保护部署流程方面，另一个重要的控制措施是实施强大的RBAC。如[第2章](ch02.html#chapter_2_source_control_management_1749354010078326)中所述，RBAC允许你细粒度地控制谁有权修改CI/CD平台内的管道和敏感配置设置。这确保只有授权人员才能更改你的部署流程，最大限度地降低恶意活动的风险。
- en: By combining these approaches, you can centralize policy enforcement, ensuring
    your deployments are tamper-proof and effectively monitored.
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: 通过结合这些方法，你可以集中执行策略，确保你的部署防篡改并得到有效监控。
- en: Future Trends in Deployment Governance
  id: totrans-57
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 部署治理的未来趋势
- en: As in nearly every area of software development, AI and ML will drive important
    future trends in deployment governance. Predictive analytics, for example, is
    a branch of data analytics that applies ML techniques for analyzing historical
    data to predict future outcomes. Applied to software deployments, predictive analytics
    can be used to identify patterns and risk factors to flag potential issues. Vendors
    are creating dashboards, such as Digital.ai’s “Change Risk Prediction,” based
    on trends like team failure rates and defects found in testing. Today, most of
    these solutions are relatively straightforward correlations found in broad sets.
    It’s not unreasonable to expect more insights from models as we go forward, especially
    from DevOps platforms with easy access to wider data sets.
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: 在软件开发的大多数领域，人工智能和机器学习将推动部署治理的重要未来趋势。例如，预测分析是数据分析的一个分支，它应用机器学习技术来分析历史数据以预测未来结果。应用于软件部署，预测分析可以用来识别模式和风险因素，以标记潜在问题。供应商正在创建仪表板，例如Digital.ai的“变更风险预测”，基于团队失败率和测试中发现的缺陷等趋势。今天，这些解决方案中的大多数都是在大范围内发现的相对简单的相关性。随着我们继续前进，期待模型提供更多见解是合理的，尤其是来自易于访问更大数据集的DevOps平台的模型。
- en: Your team can proactively address problems before they impact users. AI and
    ML can be used to automatically enforce governance policies in real time, analyzing
    code changes, configurations, and deployments to ensure compliance with security
    and operational standards. These advancements will empower organizations to deliver
    software with increased speed, confidence, and resilience.
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: 您的团队能够在问题影响用户之前主动解决问题。AI和ML可以用于实时自动执行治理政策，分析代码更改、配置和部署，以确保符合安全和操作标准。这些进步将使组织能够以更高的速度、信心和弹性交付软件。
- en: Reconciling Traditional and Modern Approaches
  id: totrans-60
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 调和传统与现代方法
- en: Within a traditional governance approach, ITIL defines a standard change as
    a pre-approved, low-risk change with a well-defined procedure, allowing for quicker
    implementation with minimal formal authorization. By using modern DevOps practices,
    relying on quality gates and modern policy enforcement, we can significantly de-risk
    even complex software deployments. This level of control and reliability allows
    these deployments to be treated as standard changes. Essentially, the inherent
    risk mitigation within modern DevOps practices aligns with ITIL’s goal of standardized,
    predictable change management, enabling faster and more frequent deployments without
    compromising stability or compliance.
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: 在传统的治理方法中，ITIL将标准变更定义为预先批准、低风险且程序定义良好的变更，允许以最小正式授权快速实施。通过使用现代DevOps实践，依靠质量门和现代政策执行，我们可以显著降低甚至复杂软件部署的风险。这种控制和可靠性水平使得这些部署可以被视为标准变更。本质上，现代DevOps实践内在的风险缓解与ITIL标准化、可预测的变更管理目标相一致，从而实现更快、更频繁的部署，而不会影响稳定性或合规性。
- en: In [“Production Deployment Strategies”](#chapter_7_production_deployment_strategies_1749354011063200)
    we’ll explore using progressive deployments to further de-risk production deployments.
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: 在[“生产部署策略”](#chapter_7_production_deployment_strategies_1749354011063200)中，我们将探讨如何使用渐进式部署进一步降低生产部署的风险。
- en: Production Deployment Strategies
  id: totrans-63
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 生产部署策略
- en: In [Chapter 4](ch04.html#chapter_4_deploying_to_test_environments_1749354010445896)
    we covered how to automate our deployment processes, and we have now looked at
    how to mitigate risk through deployment governance practices. Next we turn our
    attention to the actual business of deploying our software to production. In this
    section we’ll look at how to further mitigate risk with progressive deployment
    techniques. With even the strongest governance and the most cautious progressive
    deployments, our deployments may still fail. We must come prepared with a rollback
    strategy, so we’ll look at approaches to revert quickly. Lastly, we’ll look at
    tool selection. Choosing modern tools can help you make governance, progressive
    deployments, and rolling back easy.
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: 在[第4章](ch04.html#chapter_4_deploying_to_test_environments_1749354010445896)中，我们介绍了如何自动化我们的部署流程，现在我们已经探讨了如何通过部署治理实践来降低风险。接下来，我们将关注将我们的软件部署到生产环境的实际业务。在本节中，我们将探讨如何通过渐进式部署技术进一步降低风险。即使是最强大的治理和最谨慎的渐进式部署，我们的部署仍可能失败。我们必须准备好回滚策略，因此我们将探讨快速回滚的方法。最后，我们将探讨工具选择。选择现代工具可以帮助您使治理、渐进式部署和回滚变得简单。
- en: The Traditional Big-Bang Deployment
  id: totrans-65
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 传统的“大爆炸”部署
- en: Before we look at modern approaches, we can remind ourselves of the traditional
    approach—and what still may be required for some elements of stateful applications.
    Traditionally, we would take our application offline, upgrade every instance of
    every component of the application, and start the application back up. After a
    quick validation, we would expose it back to users, and watch it for a period
    of time to make sure it looked healthy before deeming the deployment a success.
    If there was a problem, we would take the application back offline and roll back
    the application to the best of our ability—often a daunting challenge.
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: 在我们探讨现代方法之前，我们可以提醒自己传统的做法——以及对于某些有状态应用程序的某些元素可能仍需要的元素。传统上，我们会将应用程序离线，升级应用程序每个组件的每个实例，然后重新启动应用程序。在快速验证后，我们会将其重新暴露给用户，并观察一段时间以确保其看起来健康，然后才认为部署成功。如果有问题，我们会将应用程序再次离线，并尽可能地将应用程序回滚到最佳状态——这通常是一个艰巨的挑战。
- en: This traditional approach required application downtime, introduced significant
    risk, and demanded significant attention from engineers. The opportunities to
    do better are abundant.
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: 这种传统方法需要应用程序停机，引入了重大风险，并要求工程师投入大量关注。改进的机会很多。
- en: Using a Progressive Delivery Strategy
  id: totrans-68
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 使用渐进式交付策略
- en: Software deployments can be like walking a tightrope—one wrong step and the
    consequences can be severe. But progressive deployment strategies offer you a
    safety net. By gradually rolling out changes and closely monitoring their impact,
    these strategies minimize risks and allow for quick course correction if problems
    arise. In this section we’ll look at a number of popular deployment strategies
    including rolling updates, blue-green deployments, canary deployments, and the
    use of feature flags.
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: 软件部署可能就像走钢丝一样——一步走错，后果可能非常严重。但是，渐进式部署策略为你提供了一个安全网。通过逐步推出更改并密切监控其影响，这些策略最小化了风险，并在出现问题时允许快速纠正方向。在本节中，我们将探讨包括滚动更新、蓝绿部署、金丝雀部署和功能标志使用在内的多种流行的部署策略。
- en: Deploying rolling updates
  id: totrans-70
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 部署滚动更新
- en: Rolling deployments are a very common delivery strategy in which you gradually
    update an application or service by incrementally replacing instances of the old
    version with the new version. This is done in a controlled manner, ensuring that
    a certain number of instances are always available to handle user traffic during
    the update process.
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: 滚动部署是一种非常常见的交付策略，通过逐步更新应用程序或服务，通过逐步用新版本的实例替换旧版本的实例来实现。这是以一种受控的方式进行，确保在更新过程中始终有一定数量的实例可用，以处理用户流量。
- en: Rolling deployments have distinct advantages. They minimize downtime as the
    application remains accessible throughout the update process. Importantly, rolling
    deployments reduce risk. By updating instances incrementally, potential issues
    with the new version can be detected and addressed early on, limiting their impact.
    And this type of deployment can be customized to fit specific application needs,
    allowing for endless adjustments to the speed and scale of the update process.
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: 滚动部署具有独特的优势。它们最小化了中断时间，因为应用程序在整个更新过程中始终保持可访问性。重要的是，滚动部署降低了风险。通过增量更新实例，可以早期发现并解决新版本中可能存在的问题，限制其影响。并且这种部署可以根据特定的应用程序需求进行定制，允许对更新过程的速度和规模进行无限调整。
- en: However, implementing and managing rolling deployments can be more complex than
    other deployment strategies, especially for large-scale or distributed systems.
    There is also potential for inconsistencies. During the update process, two different
    versions of the application, running simultaneously, could lead to differences
    in data or user experience. In addition, rolling back an ongoing deployment can
    be complicated, and additional steps to preserve data integrity are required.
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，实施和管理滚动部署可能比其他部署策略更复杂，尤其是对于大规模或分布式系统。也存在不一致性的可能性。在更新过程中，同时运行的两个不同版本的应用程序可能导致数据或用户体验的差异。此外，回滚正在进行的部署可能很复杂，并且需要额外的步骤来保护数据完整性。
- en: Implementation options are numerous. Kubernetes provides built-in support for
    rolling updates through its Deployment object. New pods with the updated version
    are gradually created, and old pods are terminated once the new ones are ready.
    Container orchestration platforms (e.g., Docker Swarm, Nomad) offer similar mechanisms
    for rolling updates, allowing for incremental replacement of containers or services.
    Load balancers can be used to implement rolling updates by gradually shifting
    traffic from old instances to new instances as they become available. In some
    cases, rolling deployments might be implemented using custom scripts or automation
    tools that manage the update process and monitor the health of the application.
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: 实施选项众多。Kubernetes通过其Deployment对象提供了内置的滚动更新支持。新版本的Pod逐渐创建，一旦新Pod就绪，旧Pod就会被终止。容器编排平台（例如，Docker
    Swarm，Nomad）提供了类似的滚动更新机制，允许逐步替换容器或服务。负载均衡器可以通过逐渐将流量从旧实例转移到新实例来实现滚动更新，新实例一旦可用。在某些情况下，滚动部署可能使用自定义脚本或自动化工具来实现，这些工具管理更新过程并监控应用程序的健康状况。
- en: While rolling deployments require effort to implement, they offer a valuable
    option for minimizing downtime and risk during application updates.
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然滚动部署需要实施的努力，但它们为最小化应用程序更新期间的中断和风险提供了一个有价值的选项。
- en: Using blue-green deployments
  id: totrans-76
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 使用蓝绿部署
- en: A blue-green deployment is a release strategy that involves maintaining two
    identical environments, typically referred to as “blue” and “green.” At any given
    time, only one of these environments (usually blue) is live, serving production
    traffic.
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: 蓝绿部署是一种涉及维护两个相同环境的发布策略，通常被称为“蓝”和“绿”。在任何给定时间，这两个环境中的一个（通常是蓝）是活跃的，负责处理生产流量。
- en: When a new version of your application is ready, it is deployed to the inactive
    environment (green). After testing and verification in the green environment,
    traffic is switched over from the blue environment to the green environment, making
    the new version live. Where a rolling deployment makes updates over time and different
    traffic will experience different versions of the service, a blue-green typically
    features a hard cutover. A switch is flipped and traffic, or at least new traffic,
    is moved immediately from the old to the new. [Figure 7-1](#chapter_7_figure_1_1749354011054693)
    depicts blue and green environments before and after deploying an update.
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: 当你的应用程序的新版本准备好时，它被部署到非活动环境（绿色）。在绿色环境中进行测试和验证后，流量从蓝色环境切换到绿色环境，使新版本变为实时。与滚动部署随着时间的推移进行更新，不同流量将体验不同的服务版本不同，蓝绿通常具有硬切换。一个开关被翻转，流量或至少是新流量立即从旧环境转移到新环境。[图7-1](#chapter_7_figure_1_1749354011054693)展示了部署更新前后的蓝绿环境。
- en: '![](assets/ansd_0701.png)'
  id: totrans-79
  prefs: []
  type: TYPE_IMG
  zh: '![](assets/ansd_0701.png)'
- en: Figure 7-1\. Blue-green deployments involve running two identical environments
    for seamless updates and rollback options (in the print book, blue appears in
    dark gray and green appears in light gray)
  id: totrans-80
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图7-1\. 蓝绿部署涉及运行两个相同的环境，以实现无缝更新和回滚选项（在印刷书中，蓝色以深灰色显示，绿色以浅灰色显示）
- en: The previous live environment (now blue) can be used for the next deployment,
    kept as a backup in case a rollback is needed, or decommissioned.
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: 之前的实时环境（现在是蓝色）可以用于下一次部署，作为备份以备回滚需要时使用，或者可以退役。
- en: 'A blue-green strategy offers distinct advantages:'
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: 蓝绿策略提供独特的优势：
- en: Reduced downtime
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: 减少停机时间
- en: Traffic is switched between environments, minimizing any disruption to users
    and reducing downtime.
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: 在环境之间切换流量，最小化对用户的任何干扰并减少停机时间。
- en: Easy rollbacks
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: 容易回滚
- en: If there are issues with the new deployment, traffic can be quickly switched
    back to the previous version.
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: 如果新部署存在问题，可以迅速将流量切换回之前的版本。
- en: Improved testing
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: 改进的测试
- en: The new version can be tested in a production-like environment before going
    live.
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: 在上线之前，可以在类似生产的环境中测试新版本。
- en: The main disadvantage lies in the increased infrastructure cost, as maintaining
    two separate, identical environments can be expensive. Additionally, blue-green
    deployments might not be suitable for applications with complex state management
    or database schema changes, because synchronizing data between environments can
    be challenging.
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: 主要的缺点在于基础设施成本的增加，因为维护两个完全相同的独立环境可能会很昂贵。此外，蓝绿部署可能不适合具有复杂状态管理或数据库模式变更的应用程序，因为在不同环境之间同步数据可能具有挑战性。
- en: A more advanced blue-green model can overcome most of the infrastructure cost
    challenge by integrating IaCM practices. During steady-state production, only
    one instance is in existence. At the start of the deployment, the deployment triggers
    an IaCM tool to provision a new instance, so both blue and green exist. At the
    conclusion of the process, the excess instance is de-provisioned. As a result,
    the excess infrastructure only needs to exist for the duration of the blue-green
    deployment.
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: 更高级的蓝绿模型可以通过整合IaCM（基础设施即代码管理）实践来克服大多数基础设施成本挑战。在稳态生产期间，只有一个实例存在。在部署开始时，部署会触发IaCM工具来配置一个新实例，因此蓝绿都存在。在过程结束时，多余的实例会被取消配置。因此，多余的基础设施只需在蓝绿部署期间存在。
- en: Using canary releases
  id: totrans-91
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 使用金丝雀发布
- en: Canary releases offer another progressive strategy similar to rolling updates.
    A new version of the application is rolled out to a small subset of users or servers.
    This “canary” group acts as a test bed, allowing you to monitor the new version’s
    performance and stability in a real-world production environment before making
    it available to all users.
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
  zh: 金丝雀发布提供了一种类似于滚动更新的渐进式策略。应用程序的新版本被部署到一小部分用户或服务器。这个“金丝雀”组充当测试平台，允许你在将新版本提供给所有用户之前，在实际的生产环境中监控其性能和稳定性。
- en: In a typical canary deployment, only a small portion of traffic (e.g., 5% to
    10%) might be directed to the newly deployed version. The performance, stability,
    and error rates of the new version are closely monitored and compared with those
    of the existing version. Metrics like response times, CPU usage, and error logs
    are analyzed to identify any potential issues. If the new version performs well
    in the canary environment, the percentage of traffic directed to it is gradually
    increased, allowing more users to access it. This process continues until the
    new version completely replaces the old one. If any issues or performance degradation
    are detected during the canary phase, the deployment can be rolled back quickly,
    minimizing the impact on users.
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: 在典型的金丝雀部署中，只有一小部分流量（例如，5% 到 10%）可能会被导向新部署的版本。新版本的性能、稳定性和错误率会被密切监控并与现有版本进行比较。响应时间、CPU
    使用率和错误日志等指标会被分析以识别任何潜在问题。如果新版本在金丝雀环境中表现良好，指向它的流量百分比会逐渐增加，允许更多用户访问。这个过程会持续到新版本完全取代旧版本。如果在金丝雀阶段检测到任何问题或性能下降，部署可以迅速回滚，最小化对用户的影响。
- en: Canary deployments may be implemented with simple metric thresholds, but they
    increasingly leverage AI or ML capabilities to determine whether the new version
    performs satisfactorily. Traditionally, canary deployments have focused on performance
    benchmarks, but we can expect that in the future they will increasingly also tap
    into business metrics, stopping the rollout if the new version of the application
    is harming the business, even if it is not crashing.
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: 金丝雀部署可以通过简单的指标阈值来实现，但它们越来越多地利用 AI 或 ML 能力来确定新版本是否表现满意。传统上，金丝雀部署专注于性能基准，但我们预计未来它们将越来越多地利用业务指标，如果新版本的应用程序损害了业务，即使它没有崩溃，也会停止发布。
- en: While both canary deployments and rolling updates aim for gradual and controlled
    software releases, they differ in their focus. Rolling updates solve for minimizing
    downtime and service disruption across a service infrastructure. Canary deployments
    focus on metric-guided decision making about whether to gradually increase traffic
    to a new release or roll back to the previous version.
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然金丝雀部署和滚动更新都旨在实现渐进和可控的软件发布，但它们在重点上有所不同。滚动更新旨在最小化服务基础设施中的停机时间和服务中断。金丝雀部署则专注于基于指标的决策，关于是否逐渐增加新版本的流量或回滚到上一个版本。
- en: Using feature flags
  id: totrans-96
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 使用特性标志
- en: Feature flags provide a strategy for deploying *features* in a progressive manner.
    Think of feature flags like hidden switches within your code, allowing you to
    turn features on or off for specific users or groups without deploying new code.
    This gives you granular control over who sees what, enabling A/B testing and targeted
    rollouts. Feature flags are similar to other progressive deployment strategies
    in that they allow you to monitor performance and gather feedback in a real-world
    environment and use this information to mitigate risks. However, feature flags
    operate at different levels; they control functionality within a single version.
    Other progressive strategies test an entirely new version.
  id: totrans-97
  prefs: []
  type: TYPE_NORMAL
  zh: 特性标志提供了一种以渐进方式部署 *特性* 的策略。想象一下特性标志就像你代码中的隐藏开关，允许你在不部署新代码的情况下，为特定用户或群体开启或关闭特性。这让你能够细粒度地控制谁看到什么，实现
    A/B 测试和定向发布。特性标志与其他渐进式部署策略类似，因为它们允许你在真实环境中监控性能并收集反馈，并使用这些信息来降低风险。然而，特性标志在不同的层面上运作；它们控制单个版本内的功能。其他渐进式策略则测试全新的版本。
- en: Feature flags offer benefits beyond deployment risk mitigation, and we’ll return
    to them in [Chapter 8](ch08.html#chapter_8_feature_management_and_experimentation_1749354011197288).
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: 特性标志除了降低部署风险之外，还有其他好处，我们将在[第 8 章](ch08.html#chapter_8_feature_management_and_experimentation_1749354011197288)中再次讨论。
- en: Rolling back
  id: totrans-99
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 回滚
- en: 'We’ve explored a few progressive deployment strategies, but your options are
    innumerable. Variations and hybrid approaches that blend elements of rolling updates,
    blue-green deployments, canary releases, and feature flags are all possibilities.
    The common thread among these strategies is a controlled rollout, allowing you
    to stop a deployment and roll back to a previous version if you need to. With
    a strategy like blue-green deployments, this is an easy proposition: your previous
    version stands at the ready. With a rolling update or a canary deployment, the
    rollback process is a matter of removing traffic from nodes with the defective
    software and then systematically replacing those nodes with the previous software
    version.'
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
  zh: 我们已经探索了几种渐进式部署策略，但你的选择是无穷无尽的。融合滚动更新、蓝绿部署、金丝雀发布和功能标志等元素的变体和混合方法都是可能的选择。这些策略的共同点是可控的发布，允许你在需要时停止部署并回滚到先前的版本。使用类似蓝绿部署的策略，这是一个简单的提议：你的先前的版本已经准备就绪。对于滚动更新或金丝雀部署，回滚过程就是从具有缺陷软件的节点中移除流量，然后系统地用先前的软件版本替换这些节点。
- en: Rolling back involves not only redeploying the previous stable version of software,
    but also its associated configurations, dependencies, and data. Rolling back to
    a previous state can be as complex or more complex than the deployment itself.
    Certain deployment approaches will facilitate dependable rollbacks. For example,
    if the deployment is idempotent, meaning it can be repeated and achieve the same,
    nondestructive results, a redeploy of a prior version will be equivalent to a
    rollback.
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: 回滚不仅涉及重新部署先前的稳定软件版本，还包括其关联的配置、依赖项和数据。回滚到先前的状态可能和部署本身一样复杂，甚至更复杂。某些部署方法将促进可靠的回滚。例如，如果部署是幂等的，意味着它可以重复并产生相同、非破坏性的结果，那么重新部署先前的版本将等同于回滚。
- en: Testing rollbacks is crucial to ensuring you can roll back without fear. It’s
    not enough to simply have a rollback mechanism in place; you need to regularly
    validate its readiness. This involves simulating various failure scenarios and
    then executing the rollback procedure to ensure it swiftly and reliably restores
    the previous stable version. Thorough rollback testing verifies that the application,
    its data, and its dependencies are correctly reverted. Depending on the application
    and its data storage mechanisms, rollbacks may require data restoration or migration
    to ensure data consistency. Regularly test procedures to ensure they work as expected
    in all scenarios.
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: 测试回滚对于确保你可以无忧地回滚至关重要。仅仅有回滚机制是不够的；你需要定期验证其准备就绪状态。这涉及到模拟各种故障场景，然后执行回滚程序以确保它迅速可靠地恢复先前的稳定版本。彻底的回滚测试验证了应用程序、其数据和其依赖项是否正确回滚。根据应用程序及其数据存储机制，回滚可能需要数据恢复或迁移以确保数据一致性。定期测试程序以确保它们在所有场景中都能按预期工作。
- en: With complete confidence in your rollback procedures, you can then configure
    rollbacks to trigger automatically based on deployment health. Verifying deployment
    health is a topic we’ll get into in the next section. Instead of relying on manual
    intervention, the system automatically reverts to the previous stable version
    when predefined thresholds are breached. This not only reduces the burden on your
    operations team but also takes human error out of the equation to minimize downtime.
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: 在对回滚程序充满信心之后，你可以配置回滚以根据部署健康自动触发。验证部署健康是我们将在下一节中讨论的主题。而不是依赖人工干预，当预定义的阈值被突破时，系统会自动回滚到先前的稳定版本。这不仅减轻了运维团队的工作负担，还排除了人为错误，以最小化停机时间。
- en: Special considerations for specific architectures
  id: totrans-104
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 针对特定架构的特殊考虑
- en: Deployment and rollback complexities vary significantly depending on the software
    architecture. Monoliths, with their tightly coupled codebase, often require complete
    deployments and rollbacks that impact the entire system. Microservices, on the
    other hand, offer more granular deployments and rollbacks, targeting individual
    services. However, this interconnectedness means that dependencies must be carefully
    managed to ensure consistency across services. Distributed monoliths share characteristics
    of both monolithic architecture and microservices and combine the deployment complexities
    of microservices with the interdependency issues of monoliths.
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
  zh: 部署和回滚的复杂性根据软件架构的不同而有很大差异。单体架构，由于其紧密耦合的代码库，通常需要完整的部署和回滚，这会影响整个系统。另一方面，微服务提供了更细粒度的部署和回滚，针对单个服务。然而，这种相互关联性意味着必须仔细管理依赖关系，以确保服务之间的一致性。分布式单体架构结合了单体架构和微服务的特征，将微服务的部署复杂性结合到单体架构的相互依赖问题上。
- en: Databases add another layer of complexity. When updates involve breaking changes
    to the structure of persistent data, strategies like “expand and contract” are
    needed. This strategy involves adding new database fields or tables alongside
    the existing ones, deploying the updated application to utilize the new structure,
    and eventually phasing out the old fields. The approach is complex to implement,
    but it is often required to ensure data integrity when supporting progressive
    deployment strategies and clean rollbacks.
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
  zh: 数据库增加了另一层复杂性。当更新涉及对持久数据结构的破坏性更改时，需要像“扩展和收缩”这样的策略。这种策略涉及在现有数据库字段或表旁边添加新的数据库字段或表，部署更新后的应用程序以利用新的结构，并最终逐步淘汰旧字段。这种方法实施起来很复杂，但通常需要确保在支持渐进式部署策略和干净的回滚时保持数据完整性。
- en: Choosing the Right Tools
  id: totrans-107
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 选择正确的工具
- en: Armed with a progressive deployment strategy and robust rollback capabilities,
    you can deploy to production with confidence. But to truly unlock the power of
    these strategies, you need the right tools at your disposal. Modern deployment
    tools make all the difference, offering seamless support for progressive deployment
    strategies out of the box.
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: 拥有渐进式部署策略和强大的回滚能力，您可以有信心地将代码部署到生产环境中。但为了真正释放这些策略的潜力，您需要拥有可用的正确工具。现代部署工具在提供无缝支持渐进式部署策略方面起着至关重要的作用。
- en: When selecting a tool to orchestrate your software deployments, it’s essential
    to look beyond the basics and consider how well a given tool aligns with your
    specific needs. If you’re planning a transition to automated deployment decisions
    alongside adopting new continuous delivery tools, understanding all the factors
    that go into your promotion decisions up front will help you choose the right
    tool with the required governance and gate capabilities. In addition, ensure that
    the deployment tool seamlessly integrates with your target environments, whether
    it’s the cloud, on-premise servers, or a hybrid setup. Equally important is the
    tool’s ability to handle your specific application types and architectures, including
    any complex database deployments or coordinated multiservice releases.
  id: totrans-109
  prefs: []
  type: TYPE_NORMAL
  zh: 在选择用于编排您的软件部署的工具时，重要的是要超越基础功能，并考虑特定工具与您的具体需求如何匹配。如果您计划在采用新的持续交付工具的同时过渡到自动化的部署决策，那么在事先了解所有影响您提升决策的因素将有助于您选择具有所需治理和门控能力的正确工具。此外，确保部署工具能够无缝集成到您的目标环境中，无论是云、本地服务器还是混合配置。同样重要的是，该工具能够处理您的特定应用程序类型和架构，包括任何复杂的数据库部署或协调的多服务发布。
- en: Beyond infrastructure and architecture compatibility, the deployment tool should
    include out-of-the-box support for your preferred progressive deployment strategies,
    ensuring you can easily implement canary releases, rolling updates, or other techniques.
    Robust rollback mechanisms should be a first-class concern, because they allow
    you to quickly revert to a previous stable version in case of unexpected issues.
    Furthermore, consider whether the tool integrates with your existing feature flag
    management system or offers its own feature flagging capabilities, giving you
    granular control over feature releases.
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
  zh: 除去基础设施和架构兼容性之外，部署工具应该包含对您首选的渐进式部署策略的原生支持，确保您能够轻松实现金丝雀发布、滚动更新或其他技术。强大的回滚机制应该是一个首要关注点，因为它们允许您在出现意外问题时快速回滚到先前的稳定版本。此外，考虑该工具是否与您现有的功能标志管理系统集成或提供自己的功能标志功能，这为您提供了对功能发布的细粒度控制。
- en: Verifying Production Deployments
  id: totrans-111
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 验证生产部署
- en: Even the most diligent governance doesn’t eliminate the need for robust practices
    to systematically verify your production deployments. In this section we’ll look
    at the role of observability. We’ll discuss modernizing your verification processes
    and look at testing strategies specific to production deployment verifications.
  id: totrans-112
  prefs: []
  type: TYPE_NORMAL
  zh: 即使是最勤奋的治理也无法消除系统性地验证生产部署的稳健实践的需求。在本节中，我们将探讨可观察性的作用。我们将讨论现代化您的验证流程，并查看针对生产部署验证的具体测试策略。
- en: Observability in Deployments
  id: totrans-113
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 部署的可观察性
- en: 'Verifying your deployment starts with observability. [Observability](https://oreil.ly/94AtC)
    simply refers to the ability to understand a system’s internal state by examining
    its external outputs. Observability gets you from knowing that something is wrong
    to understanding why it’s wrong, which enables faster troubleshooting and more
    effective root cause analysis. Observability data encompasses three key pillars:'
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
  zh: 验证您的部署从可观察性开始。[可观察性](https://oreil.ly/94AtC)简单地说是指通过检查系统的外部输出来理解系统内部状态的能力。可观察性让您从知道有问题到理解为什么有问题，这有助于更快地故障排除和更有效的根本原因分析。可观察性数据包括三个关键支柱：
- en: Metrics
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
  zh: 指标
- en: These provide quantitative measurements of system performance, such as response
    times, error rates, and resource utilization. By tracking trends and anomalies
    in these metrics, teams can quickly identify potential issues and assess the impact
    of a new deployment.
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: 这些提供了系统性能的定量测量，例如响应时间、错误率和资源利用率。通过跟踪这些指标的趋势和异常，团队可以快速识别潜在问题并评估新部署的影响。
- en: Logs
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
  zh: 日志
- en: Logs offer detailed records of events and errors occurring within the application
    and its infrastructure. Analyzing log data helps pinpoint the root cause of problems
    and understand the sequence of events leading to an issue.
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: 日志提供了应用程序及其基础设施中发生的事件和错误的详细记录。分析日志数据有助于确定问题的根本原因，并理解导致问题的事件序列。
- en: Traces
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
  zh: 跟踪
- en: Traces provide a visual representation of how requests flow through the system,
    highlighting bottlenecks, latency issues, and dependencies between different services.
    This helps identify performance issues and optimize application architecture.
  id: totrans-120
  prefs: []
  type: TYPE_NORMAL
  zh: 跟踪提供系统内请求流量的可视化表示，突出瓶颈、延迟问题和不同服务之间的依赖关系。这有助于识别性能问题并优化应用程序架构。
- en: Modernizing the War Room
  id: totrans-121
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 现代化作战室
- en: Traditional deployment verification often resembles a high-stakes war room scenario
    with engineers monitoring dashboards and logs, ready to manually intervene at
    the first sign of trouble. The process is highly manual, relying on human interpretation
    of observability data. It is also reactive, with teams often only scrambling to
    address issues after they have impacted users.
  id: totrans-122
  prefs: []
  type: TYPE_NORMAL
  zh: 传统的部署验证通常类似于高风险的作战室场景，工程师监控仪表板和日志，随时准备在出现任何问题时手动干预。这个过程高度手动，依赖于对可观察性数据的解释。它也是被动的，团队通常只有在问题影响了用户之后才会匆忙解决问题。
- en: This approach is not only stressful and inefficient but also prone to misses
    and slow response times. Moreover, it often leads to inconsistent verification
    procedures and limited visibility into the root cause of issues.
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
  zh: 这种方法不仅压力巨大且效率低下，而且容易出错和响应时间慢。此外，它往往导致验证程序不一致，并限制了了解问题根本原因的视野。
- en: Modernizing deployment verification involves automating these manual tasks and
    human decisions. Instead of relying on engineers to monitor dashboards and logs,
    automated systems take over, continuously analyzing telemetry data and triggering
    alerts when anomalies are detected. The shift from reactive to proactive monitoring
    reduces the need for human intervention and accelerates response times.
  id: totrans-124
  prefs: []
  type: TYPE_NORMAL
  zh: 现代化部署验证涉及自动化这些手动任务和人类决策。不再依赖工程师监控仪表板和日志，自动化系统接管，持续分析遥测数据，并在检测到异常时触发警报。从被动监控到主动监控的转变减少了人类干预的需求，并加速了响应时间。
- en: The trick to achieve this automation is to integrate your deployment tools with
    your observability platforms. The integration can take different forms depending
    on the tools used. In one approach, your CI/CD tool notifies the observability
    platform when a deployment is in progress, providing a “hook” that can be used
    to trigger a rollback. The observability platform then analyzes telemetry data
    and decides whether to initiate a rollback, calling the hook provided by the CD
    tool.
  id: totrans-125
  prefs: []
  type: TYPE_NORMAL
  zh: 实现这种自动化的技巧是将您的部署工具与可观察性平台集成。集成形式取决于使用的工具。在一种方法中，您的CI/CD工具在部署进行时通知可观察性平台，提供一个“钩子”，可以用来触发回滚。然后，可观察性平台分析遥测数据并决定是否启动回滚，调用CD工具提供的钩子。
- en: Alternatively, CD tools like Harness can be configured to watch one or more
    observability tools for signs of trouble during the deployment process. If issues
    are detected, the CD tool can automatically trigger its own rollback mechanism,
    halting the deployment and reverting to a previous stable version. This tight
    integration between deployment and observability tools enables a seamless and
    automated verification process, minimizing downtime and ensuring faster feedback
    loops.
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
  zh: 或者，像Harness这样的CD工具可以被配置为在部署过程中监视一个或多个可观察性工具的故障迹象。如果检测到问题，CD工具可以自动触发其自身的回滚机制，停止部署并回滚到先前的稳定版本。这种部署和可观察性工具之间的紧密集成使得验证过程无缝且自动化，最小化停机时间并确保更快的反馈循环。
- en: In either case, the industry no longer tolerates outages and seeks to detect
    indicators that trouble is brewing before an application fails. As a result, AI/ML
    is used to analyze multiple data sources to identify anomalies that indicate a
    likelihood of failure. AI anomaly detection has become a central component in
    modern deployment verification. Unlike traditional monitoring, which relies on
    predefined thresholds, these systems build statistical models of normal application
    behavior across hundreds of metrics and can detect complex, multidimensional anomalies
    that would be impossible to define with static rules. This capability is particularly
    valuable during the critical minutes following a production deployment, when subtle
    performance issues might otherwise go unnoticed until they escalate into user-impacting
    incidents.
  id: totrans-127
  prefs: []
  type: TYPE_NORMAL
  zh: 在任何情况下，行业都不再容忍中断，并寻求在应用程序失败之前检测到问题即将发生的迹象。因此，AI/ML被用来分析多个数据源，以识别可能发生故障的异常。AI异常检测已成为现代部署验证的核心组成部分。与传统监控不同，后者依赖于预定义的阈值，这些系统构建了正常应用程序行为在数百个指标上的统计模型，并能检测到复杂的多维异常，这些异常用静态规则定义是不可能的。这种能力在生产部署后的关键分钟内尤其有价值，否则微妙的性能问题可能直到它们升级为影响用户的重大事件才被发现。
- en: Deployment verification systems integrate these AI capabilities into automated
    verification gates, providing continuous assessment throughout the deployment
    process rather than point-in-time checks. When anomalies are detected, these systems
    can automatically pause progressive rollouts, or even automatically trigger the
    rollback process.
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
  zh: 部署验证系统将这些AI能力集成到自动化验证门中，在整个部署过程中提供持续评估，而不是点时间检查。当检测到异常时，这些系统可以自动暂停渐进式部署，甚至自动触发回滚过程。
- en: Testing Production Deployments
  id: totrans-129
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 测试生产部署
- en: We discussed testing at length in [Chapter 4](ch04.html#chapter_4_deploying_to_test_environments_1749354010445896).
    We return now to look at test strategies particularly suited to verifying in production.
    Verifying production deployments requires a layered testing approach.
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: 我们在[第4章](ch04.html#chapter_4_deploying_to_test_environments_1749354010445896)中详细讨论了测试。现在我们回到测试策略，特别是针对验证生产环境的策略。验证生产部署需要分层测试方法。
- en: Synthetic testing can be paired with phased or progressive deployments. By simulating
    typical user interactions and transactions in a production environment, synthetic
    tests run through scenarios to catch issues quickly. This allows teams to address
    problems early on, either by rolling back the deployment or by implementing necessary
    fixes.
  id: totrans-131
  prefs: []
  type: TYPE_NORMAL
  zh: 合成测试可以与分阶段或渐进式部署相结合。通过在生产环境中模拟典型用户交互和交易，合成测试运行通过场景来快速捕捉问题。这允许团队在早期解决问题，无论是通过回滚部署还是实施必要的修复。
- en: Beyond the initial deployment phase, ongoing testing in production is essential
    for ensuring long-term stability and performance. Synthetic testing continues
    to play a valuable role, providing continuous monitoring of critical user journeys
    and identifying any regressions or performance degradations. Chaos engineering,
    which we covered in [Chapter 6](ch06.html#chapter_6_chaos_engineering_and_service_reliability_1749354010916149),
    takes this a step further by deliberately injecting failures into the system to
    test its resilience and ability to recover.
  id: totrans-132
  prefs: []
  type: TYPE_NORMAL
  zh: 超过初始部署阶段，在生产环境中持续测试对于确保长期稳定性和性能至关重要。合成测试继续发挥着重要作用，提供对关键用户旅程的持续监控，并识别任何回归或性能下降。我们在[第6章](ch06.html#chapter_6_chaos_engineering_and_service_reliability_1749354010916149)中提到的混沌工程，通过故意向系统中注入故障来测试其弹性和恢复能力，将这一过程进一步推进。
- en: Another important aspect of ongoing testing is progressive feature disclosure.
    This involves gradually rolling out new features to a subset of users, allowing
    teams to gather feedback and monitor performance before a full release. Techniques
    like A/B testing enable comparisons between different versions of a feature, helping
    identify the most effective implementation. This controlled approach to feature
    releases minimizes risk and allows for data-driven decisions based on real user
    behavior. By combining synthetic testing, chaos engineering, and progressive feature
    disclosure, organizations can establish a comprehensive testing strategy that
    ensures continuous verification and improvement of their production deployments.
  id: totrans-133
  prefs: []
  type: TYPE_NORMAL
  zh: 持续测试的另一个重要方面是逐步功能披露。这涉及到逐步向用户子集推出新功能，允许团队在全面发布之前收集反馈并监控性能。像A/B测试这样的技术允许比较不同版本的功能，有助于确定最有效的实现方式。这种对功能发布的控制方法最小化了风险，并允许基于真实用户行为的数据驱动决策。通过结合合成测试、混沌工程和逐步功能披露，组织可以建立全面的测试策略，确保其生产部署的持续验证和改进。
- en: Summary
  id: totrans-134
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 摘要
- en: As AI continues to transform production deployments, the connection between
    deployment strategies and feature management becomes increasingly important. AI-powered
    deployment verification systems don’t just monitor overall application health;
    they can now track the impact of individual features within a deployment, providing
    granular insights that inform both rollback decisions and future feature releases.
    These systems create a continuous feedback loop where deployment data feeds into
    feature flag decisions, and feature behavior informs deployment strategies. Modern
    platforms analyze feature performance patterns across deployments to recommend
    which features should be gradually released through feature flags versus those
    that can be safely deployed traditionally. This intelligence helps teams balance
    development velocity with operational stability, creating a more sophisticated
    approach to managing both deployments and features in production environments.
    In [Chapter 8](ch08.html#chapter_8_feature_management_and_experimentation_1749354011197288),
    we will focus in depth on feature management.
  id: totrans-135
  prefs: []
  type: TYPE_NORMAL
  zh: 随着人工智能继续改变生产部署，部署策略与功能管理之间的联系变得越来越重要。人工智能驱动的部署验证系统不仅监控整体应用程序健康；现在它们可以跟踪部署中单个功能的影响，提供细粒度的洞察，这些洞察既用于回滚决策，也用于未来的功能发布。这些系统创建了一个持续反馈循环，其中部署数据流入功能标志决策，而功能行为则影响部署策略。现代平台分析部署中的功能性能模式，以推荐哪些功能应通过功能标志逐步发布，哪些可以安全地传统部署。这种智能帮助团队平衡开发速度与运营稳定性，创造了一种更复杂的方法来管理生产环境中的部署和功能。在[第8章](ch08.html#chapter_8_feature_management_and_experimentation_1749354011197288)中，我们将深入探讨功能管理。
