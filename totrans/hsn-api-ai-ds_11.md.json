["```py\nAWAL = (teams_outscored_in_week * (1/possible_opponents_in_week)) +\n(teams_tied_in_week * (0.5/L))\n```", "```py\n.../analytics-project (main) $ cd chapter9\n.../chapter9 (main) $ touch requirements.txt\n```", "```py\nlogging ![1](assets/1.png)\nhttpx>=0.27.0\nbackoff>=2.2.1 ![2](assets/2.png)\n```", "```py\n.../chapter9 (main) $ pip3 install -r requirements.txt\n```", "```py\n.../analytics-project (main) $ cd chapter9\n.../chapter9 (main) $ mkdir notebooks\n.../chapter9 (main) $ touch notebooks/swc_simple_client.py\n```", "```py\nimport backoff\nimport logging\nimport httpx\n\nHEALTH_CHECK_ENDPOINT = \"/\" ![1](assets/1.png)\nLIST_LEAGUES_ENDPOINT = \"/v0/leagues/\"\nLIST_PLAYERS_ENDPOINT = \"/v0/players/\"\nLIST_PERFORMANCES_ENDPOINT = \"/v0/performances/\"\nLIST_TEAMS_ENDPOINT = \"/v0/teams/\"\nLIST_WEEKS_ENDPOINT = \"/v0/weeks/\"\nGET_COUNTS_ENDPOINT = \"/v0/counts/\"\n\nlogger = logging.getLogger(__name__) ![2](assets/2.png)\n\n@backoff.on_exception( ![3](assets/3.png)\n    wait_gen=backoff.expo, \n    exception=(httpx.RequestError, httpx.HTTPStatusError),  \n    max_time=5,  \n    jitter=backoff.random_jitter  \n)\ndef call_api_endpoint(\n    base_url: str,\n    api_endpoint: str, \n    api_params: dict = None ![4](assets/4.png)\n) -> httpx.Response:\n\n    try:\n        with httpx.Client(base_url=base_url) as client: ![5](assets/5.png)\n            logger.debug(f\"base_url: {base_url}, api_endpoint: {api_endpoint}\")\n            response = client.get(api_endpoint, params=api_params)\n            response.raise_for_status()\n            logger.debug(f\"Response JSON: {response.json()}\") ![6](assets/6.png)\n            return response\n    except httpx.HTTPStatusError as e: \n        logger.error(f\"HTTP status error occurred: {e.response.text}\") ![7](assets/7.png)\nreturn httpx.Response(status_code=e.response.status_code,\n                             content=b\"API error\") ![8](assets/8.png)\n    except httpx.RequestError as e:\n        logger.error(f\"Request error occurred: {str(e)}\")\n        return httpx.Response(status_code=500, content=b\"Network error\")\n    except Exception as e:\n        logger.error(f\"Unexpected error occurred: {str(e)}\")\n        return httpx.Response(status_code=500, content=b\"Unexpected error\")\n```", "```py\n.../analytics-project (main) $ cd chapter9\n.../chapter9 (main) $ mkdir notebooks\n.../notebooks (main) $ touch notebooks/shark_league_notebook.ipynb\n```", "```py\n# Shark League Score\n## Import Python libraries\n```", "```py\nimport pandas as pd\nimport logging\nimport swc_simple_client as swc ![1](assets/1.png)\n```", "```py\n## Configure logging\n```", "```py\nfor handler in logging.root.handlers[:]: ![1](assets/1.png)\n    logging.root.removeHandler(handler)\n\nlogging.basicConfig(\n    filename='shark_notebook.log',\n    level=logging.INFO,  ![2](assets/2.png)\n)\n```", "```py\n## Setup notebook variables\n```", "```py\nbase_url = \"[insert your API base URL]\" ![1](assets/1.png)\n```", "```py\n## Get Max Scores\n### Use endpoint: LIST_WEEKS_ENDPOINT\n```", "```py\nweek_api_response = swc.call_api_endpoint(base_url,swc.LIST_WEEKS_ENDPOINT)\nweeks_df = pd.DataFrame(week_api_response.json()) ![1](assets/1.png)\nweeks_df['year'] = weeks_df['week_number'].str.slice(0, 4).astype(int) ![2](assets/2.png)\n\nmax_totals_grouped_df = weeks_df.groupby('year').agg( ![3](assets/3.png)\n    ppr_12_max_points=('ppr_12_max_points', 'sum'),\n    half_ppr_8_max_points=('half_ppr_8_max_points', 'sum'))\n\ndisplay(max_totals_grouped_df)\n\nOUTPUT:\nyear ppr_12_max_points  half_ppr_8_max_points\n2023            21048.0                14800.0\n```", "```py\n## Get League Scoring Type\n### Use Endpoint: LIST_LEAGUES_ENDPOINT\n```", "```py\nleague_api_response = swc.call_api_endpoint(base_url,swc.LIST_LEAGUES_ENDPOINT)\nleagues_df = pd.DataFrame(league_api_response.json())\nleagues_df = leagues_df.drop(columns=['teams','last_changed_date']) ![1](assets/1.png)\ndisplay(leagues_df)\n\nOUTPUT:\n    league_id                      league_name scoring_type  league_size\n0       5001  Pigskin Prodigal Fantasy League          PPR           12\n1       5002       Recurring Champions League     Half-PPR            8\n2       5003                      AHAHFZZFFFL     Half-PPR            8\n3       5004    Gridiron Gurus Fantasy League          PPR           12\n4       5005                 Best League Ever          PPR           12\n...\n```", "```py\n## Get Regular Season Scoring Totals - By Team\n### Use Endpoint: LIST_TEAMS_ENDPOINT\n```", "```py\nteam_api_response = swc.call_api_endpoint(base_url,swc.LIST_TEAMS_ENDPOINT)\n\nteams_parsed_df = pd.json_normalize(team_api_response.json(), 'weekly_scores',\n                                   ['league_id', 'team_id', 'team_name'])  ![1](assets/1.png)\n\nteams_parsed_df['year'] = (teams_parsed_df['week_number']\n                          .str.slice(0, 4).astype(int)) ![2](assets/2.png)\nteams_parsed_df['week'] = (teams_parsed_df['week_number']\n                          .str.slice(4, 6).astype(int))\n\n#get only regular season teams\nteams_regular_season_df = teams_parsed_df.query('week <= 14')\n\n#get team season totals\nteam_totals_df = teams_regular_season_df.groupby(\n   ['league_id', 'team_id', 'year'], as_index = False\n   )['fantasy_points'].sum() ![3](assets/3.png)\n\nteam_totals_df.head()\n```", "```py\n## League Balance Score\n### Using the Coefficient of Variation (CV) of league regular season totals\n```", "```py\nleague_stats_df = team_totals_df.groupby(['league_id','year']).agg(\n    league_points_sum=('fantasy_points', 'sum'), ![1](assets/1.png)\n    league_points_mean=('fantasy_points', 'mean'),\n    league_points_stdev=('fantasy_points', 'std'), ![2](assets/2.png)\n league_balance_score=('fantasy_points',\n                         lambda x: (100 -(x.std() / x.mean()) * 100)) ![3](assets/3.png)\n).reset_index()\n\ndisplay(league_stats_df.sort_values(by='league_balance_score',\n                                         ascending=False)) ![4](assets/4.png)\n```", "```py\n## League Juice Score\n### Compare league scoring to max potential scoring\n```", "```py\nleague_stats_with_league_max_df = (league_stats_df[\n   ['league_id','year', 'league_points_sum','league_balance_score']]\n              .merge(max_totals_grouped_df,left_on = 'year', right_on='year'))![1](assets/1.png)\n\ncombined_metrics_df = (leagues_df[\n   ['league_id','league_name','scoring_type', 'league_size']]![2](assets/2.png)\n   .merge(league_stats_with_league_max_df,\n          left_on = 'league_id', right_on = 'league_id'))\n\ncombined_metrics_df['league_juice_score'] = combined_metrics_df.apply(![3](assets/3.png)\n   lambda row: (\n       100 * (row['league_points_sum'] / row['ppr_12_max_points'])![4](assets/4.png)\n       if (row['scoring_type'] == 'PPR' and row['league_size'] == 12)\n       else (\n           100 * (row['league_points_sum'] / row['half_ppr_8_max_points'])\n           if (row['scoring_type'] == 'Half-PPR' and row['league_size'] == 8)\n           else None\n       )\n   ),\n   axis=1\n)\n\ncombined_metrics_df = (combined_metrics_df.drop(\n   columns=['scoring_type','league_size','league_points_sum'\n            ,'ppr_12_max_points','half_ppr_8_max_points',] )\n)\ndisplay(combined_metrics_df)\n```", "```py\n# Create Shark League Score\n## Shark League Score = (2 * League Juice Score) + League Balance Score\n```", "```py\ncombined_metrics_df['shark_league_score'] = combined_metrics_df.apply(\n    lambda league: (2 * league['league_juice_score']) +\n    league['league_balance_score'],\n    axis=1\n)\ndisplay(combined_metrics_df.sort_values(by='shark_league_score',\nascending=False))\n```"]