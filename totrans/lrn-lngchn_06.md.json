["```py\nTools:\nsearch: this tool accepts a web search query and returns the top results.\ncalculator: this tool accepts math expressions and returns their result.\n\nIf you want to use tools to arrive at the answer, output the list of tools and\ninputs in CSV format, with the header row: tool,input.\n\nThink step by step; if you need to make multiple tool calls to arrive at the\nanswer, return only the first one.\n\nHow old was the 30th president of the United States when he died?\n\ntool,input\n```", "```py\nsearch,30th president of the United States\n```", "```py\nadd example prompt and output for tool-calling model\n```", "```py\nCalvin Coolidge (born John Calvin Coolidge Jr.; /ˈkuːlɪdʒ/; July 4, 1872 – January \n5, 1933) was an American attorney and politician who served as the 30th president \nof the United States from 1923 to 1929\\. John Calvin Coolidge Jr.\n```", "```py\nTools:\nsearch: this tool accepts a web search query and returns the top results.\ncalculator: this tool accepts math expressions and returns their result.\noutput: this tool ends the interaction. Use it when you have the final answer.\n\nIf you want to use tools to arrive at the answer, output the list of tools and \ninputs in CSV format, with this header row: tool,input\n\nThink step by step; if you need to make multiple tool calls to arrive at \nthe answer, return only the first one.\n\nHow old was the 30th president of the United States when he died?\n\ntool,input\n\nsearch,30th president of the United States\n\nsearch: Calvin Coolidge (born John Calvin Coolidge Jr.; /ˈkuːlɪdʒ/; July 4, 1872 – \nJanuary 5, 1933) was an American attorney and politician who served as the 30th \npresident of the United States from 1923 to 1929\\. John Calvin Coolidge Jr.\n\ntool,input\n```", "```py\ncalculator,1933 - 1872\n```", "```py\nTools:\nsearch: this tool accepts a web search query and returns the top results.\ncalculator: this tool accepts math expressions and returns their result.\n\nIf you want to use tools to arrive at the answer, output the list of tools and \ninputs in CSV format, with this header row: tool,input.\noutput: this tool ends the interaction. Use it when you have the final answer.\n\nThink step by step; if you need to make multiple tool calls to arrive at \nthe answer, return only the first one.\n\nHow old was the 30th president of the United States when he died?\n\ntool,input\n\nsearch,30th president of the United States\n\nsearch: Calvin Coolidge (born John Calvin Coolidge Jr.; /ˈkuːlɪdʒ/; July 4, 1872 – \nJanuary 5, 1933) was an American attorney and politician who served as the 30th \npresident of the United States from 1923 to 1929\\. John Calvin Coolidge Jr.\ntool,input\n\ncalculator,1933-1872\n\ncalculator: 61\n\ntool, input\n```", "```py\noutput, 61\n```", "```py\npip install duckduckgo-search\n```", "```py\nnpm i duck-duck-scrape expr-eval\n```", "```py\nimport ast\nfrom typing import Annotated, TypedDict\n\nfrom langchain_community.tools import DuckDuckGoSearchRun\nfrom langchain_core.tools import tool\nfrom langchain_openai import ChatOpenAI\n\nfrom langgraph.graph import START, StateGraph\nfrom langgraph.graph.message import add_messages\nfrom langgraph.prebuilt import ToolNode, tools_condition\n\n@tool\ndef calculator(query: str) -> str:\n    \"\"\"A simple calculator tool. Input should be a mathematical expression.\"\"\"\n    return ast.literal_eval(query)\n\nsearch = DuckDuckGoSearchRun()\ntools = [search, calculator]\nmodel = ChatOpenAI(temperature=0.1).bind_tools(tools)\n\nclass State(TypedDict):\n    messages: Annotated[list, add_messages]\n\ndef model_node(state: State) -> State:\n    res = model.invoke(state[\"messages\"])\n    return {\"messages\": res}\n\nbuilder = StateGraph(State)\nbuilder.add_node(\"model\", model_node)\nbuilder.add_node(\"tools\", ToolNode(tools))\nbuilder.add_edge(START, \"model\")\nbuilder.add_conditional_edges(\"model\", tools_condition)\nbuilder.add_edge(\"tools\", \"model\")\n\ngraph = builder.compile()\n```", "```py\nimport {\n  DuckDuckGoSearch\n} from \"@langchain/community/tools/duckduckgo_search\";\nimport {\n  Calculator\n} from \"@langchain/community/tools/calculator\";\nimport {\n  StateGraph,\n  Annotation,\n  messagesStateReducer,\n  START,\n} from \"@langchain/langgraph\";\nimport {\n  ToolNode,\n  toolsCondition\n} from \"@langchain/langgraph/prebuilt\";\n\nconst search = new DuckDuckGoSearch();\nconst calculator = new Calculator();\nconst tools = [search, calculator];\nconst model = new ChatOpenAI({\n  temperature: 0.1\n}).bindTools(tools);\n\nconst annotation = Annotation.Root({\n  messages: Annotation({\n    reducer: messagesStateReducer,\n    default: () => []\n  }),\n});\n\nasync function modelNode(state) {\n  const res = await model.invoke(state.messages);\n  return { messages: res };\n}\n\nconst builder = new StateGraph(annotation)\n  .addNode(\"model\", modelNode)\n  .addNode(\"tools\", new ToolNode(tools))\n  .addEdge(START, \"model\")\n  .addConditionalEdges(\"model\", toolsCondition)\n  .addEdge(\"tools\", \"model\");\n\nconst graph = builder.compile();\n```", "```py\ninput = {\n    \"messages\": [\n        HumanMessage(\"\"\"How old was the 30th president of the United States \n when he died?\"\"\")\n    ]\n}\nfor c in graph.stream(input):\n    print(c)\n```", "```py\nconst input = {\n  messages: [\n    HumanMessage(`How old was the 30th president of the United States when he \n died?`)\n  ]\n}\nfor await (const c of await graph.stream(input)) {\n  console.log(c)\n}\n```", "```py\n{\n    \"model\": {\n        \"messages\": AIMessage(\n            content=\"\",\n            tool_calls=[\n                {\n                    \"name\": \"duckduckgo_search\",\n                    \"args\": {\n                        \"query\": \"30th president of the United States age at \n                            death\"\n                    },\n                    \"id\": \"call_ZWRbPmjvo0fYkwyo4HCYUsar\",\n                    \"type\": \"tool_call\",\n                }\n            ],\n        )\n    }\n}\n{\n    \"tools\": {\n        \"messages\": [\n            ToolMessage(\n                content=\"Calvin Coolidge (born July 4, 1872, Plymouth, Vermont, \n                    U.S.—died January 5, 1933, Northampton, Massachusetts) was \n                    the 30th president of the United States (1923-29). Coolidge \n                    acceded to the presidency after the death in office of \n                    Warren G. Harding, just as the Harding scandals were coming \n                    to light....\",\n                name=\"duckduckgo_search\",\n                tool_call_id=\"call_ZWRbPmjvo0fYkwyo4HCYUsar\",\n            )\n        ]\n    }\n}\n{\n    \"model\": {\n        \"messages\": AIMessage(\n            content=\"Calvin Coolidge, the 30th president of the United States, \n                died on January 5, 1933, at the age of 60.\",\n        )\n    }\n}\n```", "```py\nimport ast\nfrom typing import Annotated, TypedDict\nfrom uuid import uuid4\n\nfrom langchain_community.tools import DuckDuckGoSearchRun\nfrom langchain_core.messages import AIMessage, HumanMessage, ToolCall\nfrom langchain_core.tools import tool\nfrom langchain_openai import ChatOpenAI\n\nfrom langgraph.graph import START, StateGraph\nfrom langgraph.graph.message import add_messages\nfrom langgraph.prebuilt import ToolNode, tools_condition\n\n@tool\ndef calculator(query: str) -> str:\n    \"\"\"A simple calculator tool. Input should be a mathematical expression.\"\"\"\n    return ast.literal_eval(query)\n\nsearch = DuckDuckGoSearchRun()\ntools = [search, calculator]\nmodel = ChatOpenAI(temperature=0.1).bind_tools(tools)\n\nclass State(TypedDict):\n    messages: Annotated[list, add_messages]\n\ndef model_node(state: State) -> State:\n    res = model.invoke(state[\"messages\"])\n    return {\"messages\": res}\n\ndef first_model(state: State) -> State:\n    query = state[\"messages\"][-1].content\n    search_tool_call = ToolCall(\n        name=\"duckduckgo_search\", args={\"query\": query}, id=uuid4().hex\n    )\n    return {\"messages\": AIMessage(content=\"\", tool_calls=[search_tool_call])}\n\nbuilder = StateGraph(State)\nbuilder.add_node(\"first_model\", first_model)\nbuilder.add_node(\"model\", model_node)\nbuilder.add_node(\"tools\", ToolNode(tools))\nbuilder.add_edge(START, \"first_model\")\nbuilder.add_edge(\"first_model\", \"tools\")\nbuilder.add_conditional_edges(\"model\", tools_condition)\nbuilder.add_edge(\"tools\", \"model\")\n\ngraph = builder.compile()\n```", "```py\nimport {\n  DuckDuckGoSearch\n} from \"@langchain/community/tools/duckduckgo_search\";\nimport {\n  Calculator\n} from \"@langchain/community/tools/calculator\";\nimport {\n  AIMessage,\n} from \"@langchain/core/messages\";\nimport {\n  StateGraph,\n  Annotation,\n  messagesStateReducer,\n  START,\n} from \"@langchain/langgraph\";\nimport {\n  ToolNode,\n  toolsCondition\n} from \"@langchain/langgraph/prebuilt\";\n\nconst search = new DuckDuckGoSearch();\nconst calculator = new Calculator();\nconst tools = [search, calculator];\nconst model = new ChatOpenAI({ temperature: 0.1 }).bindTools(tools);\n\nconst annotation = Annotation.Root({\n  messages: Annotation({ reducer: messagesStateReducer, default: () => [] }),\n});\n\nasync function firstModelNode(state) {\n  const query = state.messages[state.messages.length - 1].content;\n  const searchToolCall = {\n    name: \"duckduckgo_search\",\n    args: { query },\n    id: Math.random().toString(),\n  };\n  return {\n    messages: [new AIMessage({ content: \"\", tool_calls: [searchToolCall] })],\n  };\n}\n\nasync function modelNode(state) {\n  const res = await model.invoke(state.messages);\n  return { messages: res };\n}\n\nconst builder = new StateGraph(annotation)\n  .addNode(\"first_model\", firstModelNode)\n  .addNode(\"model\", modelNode)\n  .addNode(\"tools\", new ToolNode(tools))\n  .addEdge(START, \"first_model\")\n  .addEdge(\"first_model\", \"tools\")\n  .addEdge(\"tools\", \"model\")\n  .addConditionalEdges(\"model\", toolsCondition);\n\nconst graph = builder.compile();\n```", "```py\ninput = {\n    \"messages\": [\n        HumanMessage(\"\"\"How old was the 30th president of the United States \n when he died?\"\"\")\n    ]\n}\nfor c in graph.stream(input):\nprint(c)\n```", "```py\nconst input = {\n  messages: [\n    HumanMessage(`How old was the 30th president of the United States when he \n died?`)\n  ]\n}\nfor await (const c of await graph.stream(input)) {\n  console.log(c)\n}\n```", "```py\n{\n    \"first_model\": {\n        \"messages\": AIMessage(\n            content=\"\",\n            tool_calls=[\n                {\n                    \"name\": \"duckduckgo_search\",\n                    \"args\": {\n                        \"query\": \"How old was the 30th president of the United \n                            States when he died?\"\n                    },\n                    \"id\": \"9ed4328dcdea4904b1b54487e343a373\",\n                    \"type\": \"tool_call\",\n                }\n            ],\n        )\n    }\n}\n{\n    \"tools\": {\n        \"messages\": [\n            ToolMessage(\n                content=\"Calvin Coolidge (born July 4, 1872, Plymouth, Vermont, \n                    U.S.—died January 5, 1933, Northampton, Massachusetts) was \n                    the 30th president of the United States (1923-29). Coolidge \n                    acceded to the presidency after the death in office of \n                    Warren G. Harding, just as the Harding scandals were coming \n                    to light....\",\n                name=\"duckduckgo_search\",\n                tool_call_id=\"9ed4328dcdea4904b1b54487e343a373\",\n            )\n        ]\n    }\n}\n{\n    \"model\": {\n        \"messages\": AIMessage(\n            content=\"Calvin Coolidge, the 30th president of the United States, \n                was born on July 4, 1872, and died on January 5, 1933\\. To \n                calculate his age at the time of his death, we can subtract his \n                birth year from his death year. \\n\\nAge at death = Death year - \n                Birth year\\nAge at death = 1933 - 1872\\nAge at death = 61 \n                years\\n\\nCalvin Coolidge was 61 years old when he died.\",\n        )\n    }\n}\n```", "```py\nimport ast\nfrom typing import Annotated, TypedDict\n\nfrom langchain_community.tools import DuckDuckGoSearchRun\nfrom langchain_core.documents import Document\nfrom langchain_core.messages import HumanMessage\nfrom langchain_core.tools import tool\nfrom langchain_core.vectorstores.in_memory import InMemoryVectorStore\nfrom langchain_openai import ChatOpenAI, OpenAIEmbeddings\n\nfrom langgraph.graph import START, StateGraph\nfrom langgraph.graph.message import add_messages\nfrom langgraph.prebuilt import ToolNode, tools_condition\n\n@tool\ndef calculator(query: str) -> str:\n    \"\"\"A simple calculator tool. Input should be a mathematical expression.\"\"\"\n    return ast.literal_eval(query)\n\nsearch = DuckDuckGoSearchRun()\ntools = [search, calculator]\n\nembeddings = OpenAIEmbeddings()\nmodel = ChatOpenAI(temperature=0.1)\n\ntools_retriever = InMemoryVectorStore.from_documents(\n    [Document(tool.description, metadata={\"name\": tool.name}) for tool in tools],\n    embeddings,\n).as_retriever()\n\nclass State(TypedDict):\n    messages: Annotated[list, add_messages]\n    selected_tools: list[str]\n\ndef model_node(state: State) -> State:\n    selected_tools = [\n        tool for tool in tools if tool.name in state[\"selected_tools\"]\n    ]\n    res = model.bind_tools(selected_tools).invoke(state[\"messages\"])\n    return {\"messages\": res}\n\ndef select_tools(state: State) -> State:\n    query = state[\"messages\"][-1].content\n    tool_docs = tools_retriever.invoke(query)\n    return {\"selected_tools\": [doc.metadata[\"name\"] for doc in tool_docs]}\n\nbuilder = StateGraph(State)\nbuilder.add_node(\"select_tools\", select_tools)\nbuilder.add_node(\"model\", model_node)\nbuilder.add_node(\"tools\", ToolNode(tools))\nbuilder.add_edge(START, \"select_tools\")\nbuilder.add_edge(\"select_tools\", \"model\")\nbuilder.add_conditional_edges(\"model\", tools_condition)\nbuilder.add_edge(\"tools\", \"model\")\n\ngraph = builder.compile()\n```", "```py\nimport { DuckDuckGoSearch } from \"@langchain/community/tools/duckduckgo_search\";\nimport { Calculator } from \"@langchain/community/tools/calculator\";\nimport { ChatOpenAI } from \"@langchain/openai\";\nimport { OpenAIEmbeddings } from \"@langchain/openai\";\nimport { Document } from \"@langchain/core/documents\";\nimport { MemoryVectorStore } from \"langchain/vectorstores/memory\";\nimport {\n  StateGraph,\n  Annotation,\n  messagesStateReducer,\n  START,\n} from \"@langchain/langgraph\";\nimport { ToolNode, toolsCondition } from \"@langchain/langgraph/prebuilt\";\nimport { HumanMessage } from \"@langchain/core/messages\";\n\nconst search = new DuckDuckGoSearch();\nconst calculator = new Calculator();\nconst tools = [search, calculator];\n\nconst embeddings = new OpenAIEmbeddings();\nconst model = new ChatOpenAI({ temperature: 0.1 });\n\nconst toolsStore = await MemoryVectorStore.fromDocuments(\n  tools.map(\n    (tool) =>\n      new Document({\n        pageContent: tool.description,\n        metadata: { name: tool.constructor.name },\n      })\n  ),\n  embeddings\n);\nconst toolsRetriever = toolsStore.asRetriever();\n\nconst annotation = Annotation.Root({\n  messages: Annotation({ reducer: messagesStateReducer, default: () => [] }),\n  selected_tools: Annotation(),\n});\n\nasync function modelNode(state) {\n  const selectedTools = tools.filter((tool) =>\n    state.selected_tools.includes(tool.constructor.name)\n  );\n  const res = await model.bindTools(selectedTools).invoke(state.messages);\n  return { messages: res };\n}\n\nasync function selectTools(state) {\n  const query = state.messages[state.messages.length - 1].content;\n  const toolDocs = await toolsRetriever.invoke(query as string);\n  return {\n    selected_tools: toolDocs.map((doc) => doc.metadata.name),\n  };\n}\n\nconst builder = new StateGraph(annotation)\n  .addNode(\"select_tools\", selectTools)\n  .addNode(\"model\", modelNode)\n  .addNode(\"tools\", new ToolNode(tools))\n  .addEdge(START, \"select_tools\")\n  .addEdge(\"select_tools\", \"model\")\n  .addConditionalEdges(\"model\", toolsCondition)\n  .addEdge(\"tools\", \"model\");\n```", "```py\ninput = {\n  \"messages\": [\n    HumanMessage(\"\"\"How old was the 30th president of the United States when \n he died?\"\"\")\n  ]\n}\nfor c in graph.stream(input):\nprint(c)\n```", "```py\nconst input = {\n  messages: [\n    HumanMessage(`How old was the 30th president of the United States when he \n died?`)\n  ]\n}\nfor await (const c of await graph.stream(input)) {\n  console.log(c)\n}\n```", "```py\n{\n    \"select_tools\": {\n        \"selected_tools': ['duckduckgo_search', 'calculator']\n    }\n}\n{\n    \"model\": {\n        \"messages\": AIMessage(\n            content=\"\",\n            tool_calls=[\n                {\n                    \"name\": \"duckduckgo_search\",\n                    \"args\": {\n                        \"query\": \"30th president of the United States\"\n                    },\n                    \"id\": \"9ed4328dcdea4904b1b54487e343a373\",\n                    \"type\": \"tool_call\",\n                }\n            ],\n        )\n    }\n}\n{\n    \"tools\": {\n        \"messages\": [\n            ToolMessage(\n                content=\"Calvin Coolidge (born July 4, 1872, Plymouth, Vermont, \n                    U.S.—died January 5, 1933, Northampton, Massachusetts) was \n                    the 30th president of the United States (1923-29). Coolidge \n                    acceded to the presidency after the death in office of \n                    Warren G. Harding, just as the Harding scandals were coming \n                    to light....\",\n                name=\"duckduckgo_search\",\n                tool_call_id=\"9ed4328dcdea4904b1b54487e343a373\",\n            )\n        ]\n    }\n}\n{\n    \"model\": {\n        \"messages\": AIMessage(\n            content=\"Calvin Coolidge, the 30th president of the United States, \n                was born on July 4, 1872, and died on January 5, 1933\\. To \n                calculate his age at the time of his death, we can subtract his \n                birth year from his death year. \\n\\nAge at death = Death year - \n                Birth year\\nAge at death = 1933 - 1872\\nAge at death = 61 \n                years\\n\\nCalvin Coolidge was 61 years old when he died.\",\n        )\n    }\n}\n```"]