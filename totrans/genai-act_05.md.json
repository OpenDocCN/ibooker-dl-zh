["```py\n# write a python function that takes a prompt and uses stability AI \n# to generate a image and save it to a file\ndef generate_image(prompt):\n    if api_key is None:\n        raise Exception(\"Missing Stability API key.\")\n\n    # Set the directory where we'll store the image\n    image_dir = os.path.join(os.curdir, 'images')\n\n    # Make sure the directory exists\n    if not os.path.isdir(image_dir):\n        os.mkdir(image_dir)\n\n    # Function to clean up filenames\n    def valid_filename(s):\n        s = re.sub(r'[^\\w_.)( -]', '', s).strip()\n        return re.sub(r'[\\s]+', '_', s)\n\n    response = requests.post(\n        f\"{api_host}/v1/generation/{engine_id}/text-to-image\",\n        headers={\n            \"Content-Type\": \"application/json\",\n            \"Accept\": \"application/json\",\n            \"Authorization\": f\"Bearer {api_key}\"\n        },\n        json={\n            \"text_prompts\": [{ \"text\": f\"{prompt}\", \"weight\": 1.0}],\n            \"cfg_scale\": 7, \"height\": 1024, \"width\": 1024,\n            \"samples\": 1, \"steps\": 50,\n        },\n    )\n\n    if response.status_code != 200:\n        raise Exception(\"Non-200 response: \" + str(response.text))\n\n    data = response.json()\n\n    for i, image in enumerate(data[\"artifacts\"]):\n\nfilename = f\"sd_{valid_filename(prompt)}_{i}_{\n                      ↪datetime.datetime.now().strftime(\n                      ↪'%Y%m%d_%H%M%S')}.png\"\n        image_path = os.path.join(image_dir, filename)\"\n        image_path = os.path.join(image_dir, filename)\n        with open(image_path, \"wb\") as f:\n            f.write(base64.b64decode(image[\"base64\"]))\n```"]