# ç¬¬7ç« ã€‚åŸºäºèƒ½é‡çš„æ¨¡å‹

åŸºäºèƒ½é‡çš„æ¨¡å‹æ˜¯ä¸€ç±»å¹¿æ³›çš„ç”Ÿæˆæ¨¡å‹ï¼Œå€Ÿé‰´äº†å»ºæ¨¡ç‰©ç†ç³»ç»Ÿçš„ä¸€ä¸ªå…³é”®æ€æƒ³â€”â€”å³ï¼Œäº‹ä»¶çš„æ¦‚ç‡å¯ä»¥ç”¨ç»å°”å…¹æ›¼åˆ†å¸ƒæ¥è¡¨ç¤ºï¼Œè¿™æ˜¯ä¸€ä¸ªç‰¹å®šå‡½æ•°ï¼Œå°†å®å€¼èƒ½é‡å‡½æ•°å½’ä¸€åŒ–åœ¨0åˆ°1ä¹‹é—´ã€‚è¿™ä¸ªåˆ†å¸ƒæœ€åˆæ˜¯ç”±è·¯å¾·ç»´å¸ŒÂ·ç»å°”å…¹æ›¼åœ¨1868å¹´æå‡ºçš„ï¼Œä»–ç”¨å®ƒæ¥æè¿°å¤„äºçƒ­å¹³è¡¡çŠ¶æ€çš„æ°”ä½“ã€‚

åœ¨æœ¬ç« ä¸­ï¼Œæˆ‘ä»¬å°†çœ‹åˆ°å¦‚ä½•ä½¿ç”¨è¿™ä¸ªæƒ³æ³•æ¥è®­ç»ƒä¸€ä¸ªç”Ÿæˆæ¨¡å‹ï¼Œç”¨äºç”Ÿæˆæ‰‹å†™æ•°å­—çš„å›¾åƒã€‚æˆ‘ä»¬å°†æ¢ç´¢å‡ ä¸ªæ–°æ¦‚å¿µï¼ŒåŒ…æ‹¬ç”¨äºè®­ç»ƒEBMçš„å¯¹æ¯”æ•£åº¦å’Œç”¨äºé‡‡æ ·çš„æœ—ä¹‹ä¸‡åŠ¨åŠ›å­¦ã€‚

# ä»‹ç»

æˆ‘ä»¬å°†ä»ä¸€ä¸ªç®€çŸ­çš„æ•…äº‹å¼€å§‹ï¼Œä»¥è¯´æ˜åŸºäºèƒ½é‡çš„æ¨¡å‹èƒŒåçš„å…³é”®æ¦‚å¿µã€‚

Diane Mixxå’ŒLong-au-Vinè·‘æ­¥ä¿±ä¹éƒ¨çš„æ•…äº‹æ•æ‰äº†åŸºäºèƒ½é‡å»ºæ¨¡çš„å…³é”®æ€æƒ³ã€‚ç°åœ¨è®©æˆ‘ä»¬æ›´è¯¦ç»†åœ°æ¢è®¨ç†è®ºï¼Œç„¶åæˆ‘ä»¬å°†ä½¿ç”¨Keraså®ç°ä¸€ä¸ªå®é™…ç¤ºä¾‹ã€‚

# åŸºäºèƒ½é‡çš„æ¨¡å‹

åŸºäºèƒ½é‡çš„æ¨¡å‹è¯•å›¾ä½¿ç”¨*ç»å°”å…¹æ›¼åˆ†å¸ƒ*ï¼ˆ[æ–¹ç¨‹å¼7-1](#boltzmann_equation)ï¼‰æ¥å»ºæ¨¡çœŸå®çš„æ•°æ®ç”Ÿæˆåˆ†å¸ƒï¼Œå…¶ä¸­ <math alttext="upper E left-parenthesis x right-parenthesis"><mrow><mi>E</mi> <mo>(</mo> <mi>x</mi> <mo>)</mo></mrow></math> è¢«ç§°ä¸ºè§‚å¯Ÿç»“æœ <math alttext="x"><mi>x</mi></math> çš„*èƒ½é‡å‡½æ•°*ï¼ˆæˆ–*åˆ†æ•°*ï¼‰ã€‚

##### æ–¹ç¨‹å¼7-1ã€‚ç»å°”å…¹æ›¼åˆ†å¸ƒ

<math alttext="p left-parenthesis bold x right-parenthesis equals StartFraction e Superscript minus upper E left-parenthesis bold x right-parenthesis Baseline Over integral Underscript ModifyingAbove bold x With bold caret element-of bold upper X Endscripts e Superscript minus upper E left-parenthesis ModifyingAbove bold x With bold caret right-parenthesis Baseline EndFraction" display="block"><mrow><mi>p</mi> <mrow><mo>(</mo> <mi>ğ±</mi> <mo>)</mo></mrow> <mo>=</mo> <mfrac><msup><mi>e</mi> <mrow><mo>-</mo><mi>E</mi><mo>(</mo><mi>ğ±</mi><mo>)</mo></mrow></msup> <mrow><msub><mo>âˆ«</mo> <mrow><mover accent="true"><mi>ğ±</mi> <mo>^</mo></mover><mo>âˆˆ</mo><mi>ğ—</mi></mrow></msub> <msup><mi>e</mi> <mrow><mo>-</mo><mi>E</mi><mo>(</mo><mover accent="true"><mi>ğ±</mi> <mo>^</mo></mover><mo>)</mo></mrow></msup></mrow></mfrac></mrow></math>

åœ¨å®è·µä¸­ï¼Œè¿™æ„å‘³ç€è®­ç»ƒä¸€ä¸ªç¥ç»ç½‘ç»œ <math alttext="upper E left-parenthesis x right-parenthesis"><mrow><mi>E</mi> <mo>(</mo> <mi>x</mi> <mo>)</mo></mrow></math>ï¼Œå¯¹å¯èƒ½çš„è§‚å¯Ÿè¾“å‡ºä½åˆ†æ•°ï¼ˆä½¿å¾— <math alttext="p bold x"><mrow><mi>p</mi> <mi>ğ±</mi></mrow></math> æ¥è¿‘äº1ï¼‰ï¼Œå¯¹ä¸å¤ªå¯èƒ½çš„è§‚å¯Ÿè¾“å‡ºé«˜åˆ†æ•°ï¼ˆä½¿å¾— <math alttext="p bold x"><mrow><mi>p</mi> <mi>ğ±</mi></mrow></math> æ¥è¿‘äº0ï¼‰ã€‚

ç”¨è¿™ç§æ–¹å¼å»ºæ¨¡æ•°æ®å­˜åœ¨ä¸¤ä¸ªæŒ‘æˆ˜ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬ä¸æ¸…æ¥šå¦‚ä½•ä½¿ç”¨æˆ‘ä»¬çš„æ¨¡å‹æ¥é‡‡æ ·æ–°çš„è§‚å¯Ÿç»“æœâ€”â€”æˆ‘ä»¬å¯ä»¥ç”¨å®ƒæ¥ç”Ÿæˆç»™å®šè§‚å¯Ÿç»“æœçš„åˆ†æ•°ï¼Œä½†å¦‚ä½•ç”Ÿæˆä¸€ä¸ªå¾—åˆ†ä½çš„è§‚å¯Ÿç»“æœï¼ˆå³ï¼Œä¸€ä¸ªå¯ä¿¡çš„è§‚å¯Ÿç»“æœï¼‰ï¼Ÿ

å…¶æ¬¡ï¼Œ[æ–¹ç¨‹å¼7-1](#boltzmann_equation)çš„æ ‡å‡†åŒ–åˆ†æ¯åŒ…å«ä¸€ä¸ªå¯¹äºé™¤äº†æœ€ç®€å•çš„é—®é¢˜å¤–éƒ½éš¾ä»¥è®¡ç®—çš„ç§¯åˆ†ã€‚å¦‚æœæˆ‘ä»¬æ— æ³•è®¡ç®—è¿™ä¸ªç§¯åˆ†ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±æ— æ³•ä½¿ç”¨æœ€å¤§ä¼¼ç„¶ä¼°è®¡æ¥è®­ç»ƒæ¨¡å‹ï¼Œå› ä¸ºè¿™è¦æ±‚ <math alttext="p bold x"><mrow><mi>p</mi> <mi>ğ±</mi></mrow></math> æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„æ¦‚ç‡åˆ†å¸ƒã€‚

åŸºäºèƒ½é‡çš„æ¨¡å‹çš„å…³é”®æ€æƒ³æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¿‘ä¼¼æŠ€æœ¯æ¥ç¡®ä¿æˆ‘ä»¬æ°¸è¿œä¸éœ€è¦è®¡ç®—éš¾ä»¥è®¡ç®—çš„åˆ†æ¯ã€‚è¿™ä¸æ ‡å‡†åŒ–æµå½¢å½¢æˆå¯¹æ¯”ï¼Œæ ‡å‡†åŒ–æµå½¢éœ€è¦æˆ‘ä»¬ä»˜å‡ºå¾ˆå¤§çš„åŠªåŠ›ï¼Œä»¥ç¡®ä¿æˆ‘ä»¬å¯¹æ ‡å‡†é«˜æ–¯åˆ†å¸ƒåº”ç”¨çš„å˜æ¢ä¸ä¼šæ”¹å˜è¾“å‡ºä»ç„¶æ˜¯æœ‰æ•ˆçš„æ¦‚ç‡åˆ†å¸ƒçš„äº‹å®ã€‚

æˆ‘ä»¬é€šè¿‡ä½¿ç”¨ä¸€ç§ç§°ä¸ºå¯¹æ¯”æ•£åº¦ï¼ˆç”¨äºè®­ç»ƒï¼‰å’Œä¸€ç§ç§°ä¸ºæœ—ä¹‹ä¸‡åŠ¨åŠ›å­¦ï¼ˆç”¨äºé‡‡æ ·ï¼‰çš„æŠ€æœ¯æ¥é¿å¼€æ£˜æ‰‹çš„éš¾ä»¥è®¡ç®—çš„åˆ†æ¯é—®é¢˜ï¼Œè¿™äº›æŠ€æœ¯éµå¾ªäº†æœå’Œè«è¾¾å¥‡åœ¨2019å¹´çš„è®ºæ–‡â€œåŸºäºèƒ½é‡çš„æ¨¡å‹çš„éšå¼ç”Ÿæˆå’Œå»ºæ¨¡â€çš„æ€æƒ³ã€‚æˆ‘ä»¬å°†åœ¨æœ¬ç« åé¢è¯¦ç»†æ¢è®¨è¿™äº›æŠ€æœ¯ï¼ŒåŒæ—¶æ„å»ºæˆ‘ä»¬è‡ªå·±çš„EBMã€‚

é¦–å…ˆï¼Œè®©æˆ‘ä»¬å‡†å¤‡ä¸€ä¸ªæ•°æ®é›†å¹¶è®¾è®¡ä¸€ä¸ªç®€å•çš„ç¥ç»ç½‘ç»œï¼Œæ¥è¡¨ç¤ºæˆ‘ä»¬çš„å®å€¼èƒ½é‡å‡½æ•° <math alttext="upper E left-parenthesis x right-parenthesis"><mrow><mi>E</mi> <mo>(</mo> <mi>x</mi> <mo>)</mo></mrow></math>ã€‚

# è¿è¡Œæ­¤ç¤ºä¾‹çš„ä»£ç 

æ­¤ç¤ºä¾‹çš„ä»£ç å¯ä»¥åœ¨ä¹¦ç±å­˜å‚¨åº“ä¸­çš„*notebooks/07_ebm/01_ebm/ebm.ipynb*ä¸­æ‰¾åˆ°ã€‚

è¿™æ®µä»£ç æ˜¯æ ¹æ®Philip Lippeçš„ä¼˜ç§€æ•™ç¨‹â€œæ·±åº¦åŸºäºèƒ½é‡çš„ç”Ÿæˆæ¨¡å‹â€è¿›è¡Œè°ƒæ•´çš„ã€‚

## MNISTæ•°æ®é›†

æˆ‘ä»¬å°†ä½¿ç”¨æ ‡å‡†çš„[MNISTæ•°æ®é›†](https://oreil.ly/mSvhc)ï¼Œå…¶ä¸­åŒ…å«æ‰‹å†™æ•°å­—çš„ç°åº¦å›¾åƒã€‚æ•°æ®é›†ä¸­çš„ä¸€äº›ç¤ºä¾‹å›¾åƒæ˜¾ç¤ºåœ¨[å›¾7-2](#mnist_examples)ä¸­ã€‚

![](Images/gdl2_0702.png)

###### å›¾7-2ã€‚MNISTæ•°æ®é›†ä¸­çš„å›¾åƒç¤ºä¾‹

æ•°æ®é›†å·²ç»é¢„å…ˆæ‰“åŒ…åˆ°TensorFlowä¸­ï¼Œå› æ­¤å¯ä»¥æŒ‰ç…§[ç¤ºä¾‹7-1](#mnist-ex)ä¸­æ‰€ç¤ºä¸‹è½½ã€‚

##### ç¤ºä¾‹7-1ã€‚åŠ è½½MNISTæ•°æ®é›†

```py
from tensorflow.keras import datasets
(x_train, _), (x_test, _) = datasets.mnist.load_data()
```

åƒå¾€å¸¸ä¸€æ ·ï¼Œæˆ‘ä»¬å°†åƒç´ å€¼ç¼©æ”¾åˆ°èŒƒå›´[-1, 1]ï¼Œå¹¶æ·»åŠ ä¸€äº›å¡«å……ä½¿å›¾åƒå¤§å°ä¸º32Ã—32åƒç´ ã€‚æˆ‘ä»¬è¿˜å°†å…¶è½¬æ¢ä¸ºTensorFlowæ•°æ®é›†ï¼Œå¦‚[ç¤ºä¾‹7-2](#mnist-preprocessing-ex)ä¸­æ‰€ç¤ºã€‚

##### ç¤ºä¾‹7-2ã€‚é¢„å¤„ç†MNISTæ•°æ®é›†

```py
def preprocess(imgs):
    imgs = (imgs.astype("float32") - 127.5) / 127.5
    imgs = np.pad(imgs , ((0,0), (2,2), (2,2)), constant_values= -1.0)
    imgs = np.expand_dims(imgs, -1)
    return imgs

x_train = preprocess(x_train)
x_test = preprocess(x_test)
x_train = tf.data.Dataset.from_tensor_slices(x_train).batch(128)
x_test = tf.data.Dataset.from_tensor_slices(x_test).batch(128)
```

ç°åœ¨æˆ‘ä»¬æœ‰äº†æ•°æ®é›†ï¼Œæˆ‘ä»¬å¯ä»¥æ„å»ºä»£è¡¨æˆ‘ä»¬èƒ½é‡å‡½æ•°<math alttext="ä¸Šæ ‡Eå·¦æ‹¬å·xå³æ‹¬å·"><mrow><mi>E</mi> <mo>(</mo> <mi>x</mi> <mo>)</mo></mrow></math>çš„ç¥ç»ç½‘ç»œã€‚

## èƒ½é‡å‡½æ•°

èƒ½é‡å‡½æ•°<math alttext="ä¸Šæ ‡Eä¸‹æ ‡Î¸å·¦æ‹¬å·xå³æ‹¬å·"><mrow><msub><mi>E</mi> <mi>Î¸</mi></msub> <mrow><mo>(</mo> <mi>x</mi> <mo>)</mo></mrow></mrow></math>æ˜¯ä¸€ä¸ªå…·æœ‰å‚æ•°<math alttext="Î¸"><mi>Î¸</mi></math>çš„ç¥ç»ç½‘ç»œï¼Œå¯ä»¥å°†è¾“å…¥å›¾åƒ<math alttext="x"><mi>x</mi></math>è½¬æ¢ä¸ºæ ‡é‡å€¼ã€‚åœ¨æ•´ä¸ªç½‘ç»œä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†ä¸€ä¸ªç§°ä¸º*swish*çš„æ¿€æ´»å‡½æ•°ï¼Œå¦‚ä¸‹é¢çš„ä¾§è¾¹æ æ‰€è¿°ã€‚

ç½‘ç»œæ˜¯ä¸€ç»„å †å çš„`Conv2D`å±‚ï¼Œé€æ¸å‡å°å›¾åƒçš„å°ºå¯¸åŒæ—¶å¢åŠ é€šé“æ•°ã€‚æœ€åä¸€å±‚æ˜¯ä¸€ä¸ªå…·æœ‰çº¿æ€§æ¿€æ´»çš„å•ä¸ªå®Œå…¨è¿æ¥å•å…ƒï¼Œå› æ­¤ç½‘ç»œå¯ä»¥è¾“å‡ºèŒƒå›´å†…çš„å€¼ï¼ˆ<math alttext="è´Ÿæ— ç©·"><mrow><mo>-</mo> <mi>âˆ</mi></mrow></math>ï¼Œ<math alttext="æ­£æ— ç©·"><mi>âˆ</mi></math>ï¼‰ã€‚æ„å»ºå®ƒçš„ä»£ç åœ¨[ç¤ºä¾‹7-3](#ebm-model)ä¸­ç»™å‡ºã€‚

##### ç¤ºä¾‹7-3ã€‚æ„å»ºèƒ½é‡å‡½æ•°<math alttext="ä¸Šæ ‡Eå·¦æ‹¬å·xå³æ‹¬å·"><mrow><mi>E</mi> <mo>(</mo> <mi>x</mi> <mo>)</mo></mrow></math>ç¥ç»ç½‘ç»œ

```py
ebm_input = layers.Input(shape=(32, 32, 1))
x = layers.Conv2D(
    16, kernel_size=5, strides=2, padding="same", activation = activations.swish
)(ebm_input) ![1](Images/1.png)
x = layers.Conv2D(
    32, kernel_size=3, strides=2, padding="same", activation = activations.swish
)(x)
x = layers.Conv2D(
    64, kernel_size=3, strides=2, padding="same", activation = activations.swish
)(x)
x = layers.Conv2D(
    64, kernel_size=3, strides=2, padding="same", activation = activations.swish
)(x)
x = layers.Flatten()(x)
x = layers.Dense(64, activation = activations.swish)(x)
ebm_output = layers.Dense(1)(x) ![2](Images/2.png)
model = models.Model(ebm_input, ebm_output) ![3](Images/3.png)
```

[![1](Images/1.png)](#co_energy_based_models_CO1-1)

èƒ½é‡å‡½æ•°æ˜¯ä¸€ç»„å †å çš„`Conv2D`å±‚ï¼Œå¸¦æœ‰swishæ¿€æ´»ã€‚

[![2](Images/2.png)](#co_energy_based_models_CO1-2)

æœ€åä¸€å±‚æ˜¯ä¸€ä¸ªå•ä¸ªå®Œå…¨è¿æ¥å•å…ƒï¼Œå…·æœ‰çº¿æ€§æ¿€æ´»å‡½æ•°ã€‚

[![3](Images/3.png)](#co_energy_based_models_CO1-3)

ä¸€ä¸ªå°†è¾“å…¥å›¾åƒè½¬æ¢ä¸ºæ ‡é‡èƒ½é‡å€¼çš„Keras `Model`ã€‚

## ä½¿ç”¨LangevinåŠ¨åŠ›å­¦è¿›è¡Œé‡‡æ ·

èƒ½é‡å‡½æ•°åªä¸ºç»™å®šè¾“å…¥è¾“å‡ºä¸€ä¸ªåˆ†æ•°â€”â€”æˆ‘ä»¬å¦‚ä½•ä½¿ç”¨è¿™ä¸ªå‡½æ•°ç”Ÿæˆèƒ½é‡åˆ†æ•°ä½çš„æ–°æ ·æœ¬ï¼Ÿ

æˆ‘ä»¬å°†ä½¿ç”¨ä¸€ç§ç§°ä¸º*LangevinåŠ¨åŠ›å­¦*çš„æŠ€æœ¯ï¼Œåˆ©ç”¨äº†æˆ‘ä»¬å¯ä»¥è®¡ç®—èƒ½é‡å‡½æ•°ç›¸å¯¹äºå…¶è¾“å…¥çš„æ¢¯åº¦çš„äº‹å®ã€‚å¦‚æœæˆ‘ä»¬ä»æ ·æœ¬ç©ºé—´ä¸­çš„ä¸€ä¸ªéšæœºç‚¹å¼€å§‹ï¼Œå¹¶æœç€è®¡ç®—å‡ºçš„æ¢¯åº¦çš„ç›¸åæ–¹å‘è¿ˆå‡ºå°æ­¥ï¼Œæˆ‘ä»¬å°†é€æ¸å‡å°èƒ½é‡å‡½æ•°ã€‚å¦‚æœæˆ‘ä»¬çš„ç¥ç»ç½‘ç»œè®­ç»ƒæ­£ç¡®ï¼Œé‚£ä¹ˆéšæœºå™ªå£°åº”è¯¥åœ¨æˆ‘ä»¬çœ¼å‰è½¬å˜æˆç±»ä¼¼äºè®­ç»ƒé›†ä¸­çš„è§‚å¯Ÿç»“æœçš„å›¾åƒï¼

# éšæœºæ¢¯åº¦LangevinåŠ¨åŠ›å­¦

é‡è¦çš„æ˜¯ï¼Œå½“æˆ‘ä»¬ç©¿è¶Šæ ·æœ¬ç©ºé—´æ—¶ï¼Œæˆ‘ä»¬è¿˜å¿…é¡»å‘è¾“å…¥æ·»åŠ å°‘é‡éšæœºå™ªå£°ï¼›å¦åˆ™ï¼Œæœ‰å¯èƒ½é™·å…¥å±€éƒ¨æœ€å°å€¼ã€‚å› æ­¤ï¼Œè¯¥æŠ€æœ¯è¢«ç§°ä¸ºéšæœºæ¢¯åº¦LangevinåŠ¨åŠ›å­¦ã€‚^([3](ch07.xhtml#idm45387012049200))

æˆ‘ä»¬å¯ä»¥å°†è¿™ç§æ¢¯åº¦ä¸‹é™å¯è§†åŒ–ä¸º [å›¾7-4](#langevin_diagram) ä¸­æ‰€ç¤ºï¼Œå¯¹äºä¸€ä¸ªå…·æœ‰èƒ½é‡å‡½æ•°å€¼çš„ä¸‰ç»´ç©ºé—´ã€‚è·¯å¾„æ˜¯ä¸€ä¸ªå˜ˆæ‚çš„ä¸‹é™ï¼Œæ²¿ç€èƒ½é‡å‡½æ•° <math alttext="upper E left-parenthesis x right-parenthesis"><mrow><mi>E</mi> <mo>(</mo> <mi>x</mi> <mo>)</mo></mrow></math> çš„è´Ÿæ¢¯åº¦ç›¸å¯¹äºè¾“å…¥ <math alttext="x"><mi>x</mi></math> ä¸‹é™ã€‚åœ¨MNISTå›¾åƒæ•°æ®é›†ä¸­ï¼Œæˆ‘ä»¬æœ‰1,024ä¸ªåƒç´ ï¼Œå› æ­¤åœ¨ä¸€ä¸ª1,024ç»´ç©ºé—´ä¸­å¯¼èˆªï¼Œä½†æ˜¯ç›¸åŒçš„åŸåˆ™é€‚ç”¨ï¼

![https://www.math3d.org/C1sQPhizZ](Images/gdl2_0704.png)

###### å›¾7-4\. ä½¿ç”¨æœ—ä¹‹ä¸‡åŠ¨åŠ›å­¦çš„æ¢¯åº¦ä¸‹é™

å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œè¿™ç§æ¢¯åº¦ä¸‹é™ä¸æˆ‘ä»¬é€šå¸¸ç”¨æ¥è®­ç»ƒç¥ç»ç½‘ç»œçš„æ¢¯åº¦ä¸‹é™ä¹‹é—´çš„åŒºåˆ«ã€‚

åœ¨è®­ç»ƒç¥ç»ç½‘ç»œæ—¶ï¼Œæˆ‘ä»¬ä½¿ç”¨åå‘ä¼ æ’­è®¡ç®—*æŸå¤±å‡½æ•°*ç›¸å¯¹äºç½‘ç»œçš„*å‚æ•°*ï¼ˆå³æƒé‡ï¼‰çš„æ¢¯åº¦ã€‚ç„¶åæˆ‘ä»¬å°†å‚æ•°åœ¨è´Ÿæ¢¯åº¦æ–¹å‘ä¸Šå¾®è°ƒï¼Œè¿™æ ·ç»è¿‡å¤šæ¬¡è¿­ä»£ï¼Œæˆ‘ä»¬é€æ¸æœ€å°åŒ–æŸå¤±ã€‚

ä½¿ç”¨æœ—ä¹‹ä¸‡åŠ¨åŠ›å­¦ï¼Œæˆ‘ä»¬ä¿æŒç¥ç»ç½‘ç»œæƒé‡*å›ºå®š*ï¼Œè®¡ç®—*è¾“å‡º*ç›¸å¯¹äº*è¾“å…¥*çš„æ¢¯åº¦ã€‚ç„¶åæˆ‘ä»¬å°†è¾“å…¥åœ¨è´Ÿæ¢¯åº¦æ–¹å‘ä¸Šå¾®è°ƒï¼Œè¿™æ ·ç»è¿‡å¤šæ¬¡è¿­ä»£ï¼Œæˆ‘ä»¬é€æ¸æœ€å°åŒ–è¾“å‡ºï¼ˆèƒ½é‡åˆ†æ•°ï¼‰ã€‚

è¿™ä¸¤ä¸ªè¿‡ç¨‹éƒ½åˆ©ç”¨äº†ç›¸åŒçš„æ€æƒ³ï¼ˆæ¢¯åº¦ä¸‹é™ï¼‰ï¼Œä½†æ˜¯åº”ç”¨äºä¸åŒçš„å‡½æ•°ï¼Œå¹¶ä¸”é’ˆå¯¹ä¸åŒçš„å®ä½“ã€‚

å½¢å¼ä¸Šï¼Œæœ—ä¹‹ä¸‡åŠ¨åŠ›å­¦å¯ä»¥ç”¨ä»¥ä¸‹æ–¹ç¨‹æè¿°ï¼š

<math alttext="x Superscript k Baseline equals x Superscript k minus 1 Baseline minus eta normal nabla Subscript x Baseline upper E Subscript theta Baseline left-parenthesis x Superscript k minus 1 Baseline right-parenthesis plus omega" display="block"><mrow><msup><mi>x</mi> <mi>k</mi></msup> <mo>=</mo> <msup><mi>x</mi> <mrow><mi>k</mi><mo>-</mo><mn>1</mn></mrow></msup> <mo>-</mo> <mi>Î·</mi> <msub><mi>âˆ‡</mi> <mi>x</mi></msub> <msub><mi>E</mi> <mi>Î¸</mi></msub> <mrow><mo>(</mo> <msup><mi>x</mi> <mrow><mi>k</mi><mo>-</mo><mn>1</mn></mrow></msup> <mo>)</mo></mrow> <mo>+</mo> <mi>Ï‰</mi></mrow></math>

å…¶ä¸­ <math alttext="omega tilde script upper N left-parenthesis 0 comma sigma right-parenthesis"><mrow><mi>Ï‰</mi> <mo>âˆ¼</mo> <mi>ğ’©</mi> <mo>(</mo> <mn>0</mn> <mo>,</mo> <mi>Ïƒ</mi> <mo>)</mo></mrow></math> å’Œ <math alttext="x Superscript 0 Baseline tilde script upper U"><mrow><msup><mi>x</mi> <mn>0</mn></msup> <mo>âˆ¼</mo> <mi>ğ’°</mi></mrow></math>ï¼ˆ-1,1ï¼‰ã€‚<math alttext="eta"><mi>Î·</mi></math> æ˜¯å¿…é¡»è°ƒæ•´çš„æ­¥é•¿è¶…å‚æ•°â€”â€”å¤ªå¤§ä¼šå¯¼è‡´æ­¥éª¤è·³è¿‡æœ€å°å€¼ï¼Œå¤ªå°åˆ™ç®—æ³•æ”¶æ•›é€Ÿåº¦å¤ªæ…¢ã€‚

###### æç¤º

<math alttext="x Superscript 0 Baseline tilde script upper U"><mrow><msup><mi>x</mi> <mn>0</mn></msup> <mo>âˆ¼</mo> <mi>ğ’°</mi></mrow></math>ï¼ˆ-1,1ï¼‰æ˜¯èŒƒå›´[-1,1]ä¸Šçš„å‡åŒ€åˆ†å¸ƒã€‚

æˆ‘ä»¬å¯ä»¥ç¼–å†™æˆ‘ä»¬çš„æœ—ä¹‹ä¸‡é‡‡æ ·å‡½æ•°ï¼Œå¦‚ [ç¤ºä¾‹7-4](#langevin-sampler) æ‰€ç¤ºã€‚

##### ç¤ºä¾‹7-4\. æœ—ä¹‹ä¸‡é‡‡æ ·å‡½æ•°

```py
def generate_samples(model, inp_imgs, steps, step_size, noise):
    imgs_per_step = []
    for _ in range(steps): ![1](Images/1.png)
        inp_imgs += tf.random.normal(inp_imgs.shape, mean = 0, stddev = noise) ![2](Images/2.png)
        inp_imgs = tf.clip_by_value(inp_imgs, -1.0, 1.0)
        with tf.GradientTape() as tape:
            tape.watch(inp_imgs)
            out_score = -model(inp_imgs) ![3](Images/3.png)
        grads = tape.gradient(out_score, inp_imgs) ![4](Images/4.png)
        grads = tf.clip_by_value(grads, -0.03, 0.03)
        inp_imgs += -step_size * grads ![5](Images/5.png)
        inp_imgs = tf.clip_by_value(inp_imgs, -1.0, 1.0)
        return inp_imgs
```

[![1](Images/1.png)](#co_energy_based_models_CO2-1)

å¾ªç¯æ‰§è¡Œç»™å®šæ•°é‡çš„æ­¥éª¤ã€‚

[![2](Images/2.png)](#co_energy_based_models_CO2-2)

å‘å›¾åƒä¸­æ·»åŠ å°‘é‡å™ªéŸ³ã€‚

[![3](Images/3.png)](#co_energy_based_models_CO2-3)

é€šè¿‡æ¨¡å‹ä¼ é€’å›¾åƒä»¥è·å¾—èƒ½é‡åˆ†æ•°ã€‚

[![4](Images/4.png)](#co_energy_based_models_CO2-4)

è®¡ç®—è¾“å‡ºç›¸å¯¹äºè¾“å…¥çš„æ¢¯åº¦ã€‚

[![5](Images/5.png)](#co_energy_based_models_CO2-5)

å‘è¾“å…¥å›¾åƒä¸­æ·»åŠ å°‘é‡æ¢¯åº¦ã€‚

## ä½¿ç”¨å¯¹æ¯”æ•£åº¦è¿›è¡Œè®­ç»ƒ

ç°åœ¨æˆ‘ä»¬çŸ¥é“å¦‚ä½•ä»æ ·æœ¬ç©ºé—´ä¸­é‡‡æ ·ä¸€ä¸ªæ–°çš„ä½èƒ½é‡ç‚¹ï¼Œè®©æˆ‘ä»¬å°†æ³¨æ„åŠ›è½¬å‘è®­ç»ƒæ¨¡å‹ã€‚

æˆ‘ä»¬æ— æ³•åº”ç”¨æœ€å¤§ä¼¼ç„¶ä¼°è®¡ï¼Œå› ä¸ºèƒ½é‡å‡½æ•°ä¸è¾“å‡ºæ¦‚ç‡ï¼›å®ƒè¾“å‡ºçš„æ˜¯ä¸€ä¸ªåœ¨æ ·æœ¬ç©ºé—´ä¸­ä¸ç§¯åˆ†ä¸º1çš„åˆ†æ•°ã€‚ç›¸åï¼Œæˆ‘ä»¬å°†åº”ç”¨ Geoffrey Hinton åœ¨2002å¹´é¦–æ¬¡æå‡ºçš„ä¸€ç§æŠ€æœ¯ï¼Œç§°ä¸º*å¯¹æ¯”æ•£åº¦*ï¼Œç”¨äºè®­ç»ƒéå½’ä¸€åŒ–è¯„åˆ†æ¨¡å‹ã€‚^([4](ch07.xhtml#idm45387011649104))

æˆ‘ä»¬å¸Œæœ›æœ€å°åŒ–çš„å€¼ï¼ˆä¸€å¦‚æ—¢å¾€ï¼‰æ˜¯æ•°æ®çš„è´Ÿå¯¹æ•°ä¼¼ç„¶ï¼š

<math alttext="script upper L equals minus double-struck upper E Subscript x tilde normal d normal a normal t normal a Baseline left-bracket log p Subscript theta Baseline left-parenthesis bold x right-parenthesis right-bracket" display="block"><mrow><mi>â„’</mi> <mo>=</mo> <mo>-</mo> <msub><mi>ğ”¼</mi> <mrow><mi>x</mi><mo>âˆ¼</mo> <mi>data</mi></mrow></msub> <mfenced separators="" open="[" close="]"><mo form="prefix">log</mo> <msub><mi>p</mi> <mi>Î¸</mi></msub> <mrow><mo>(</mo> <mi>ğ±</mi> <mo>)</mo></mrow></mfenced></mrow></math>

å½“ <math alttext="p Subscript theta Baseline left-parenthesis bold x right-parenthesis"><mrow><msub><mi>p</mi> <mi>Î¸</mi></msub> <mrow><mo>(</mo> <mi>ğ±</mi> <mo>)</mo></mrow></mrow></math> å…·æœ‰ç»å°”å…¹æ›¼åˆ†å¸ƒçš„å½¢å¼ï¼Œèƒ½é‡å‡½æ•°ä¸º <math alttext="upper E Subscript theta Baseline left-parenthesis bold x right-parenthesis"><mrow><msub><mi>E</mi> <mi>Î¸</mi></msub> <mrow><mo>(</mo> <mi>ğ±</mi> <mo>)</mo></mrow></mrow></math> ï¼Œå¯ä»¥è¯æ˜è¯¥å€¼çš„æ¢¯åº¦å¯ä»¥å†™æˆä»¥ä¸‹å½¢å¼ï¼ˆOliver Woodfordçš„â€œå¯¹æ¯”æ•£åº¦ç¬”è®°â€è¿›è¡Œå®Œæ•´æ¨å¯¼ï¼‰ï¼š^([5](ch07.xhtml#idm45387011627440))

<math alttext="StartLayout 1st Row 1st Column normal nabla Subscript theta Baseline script upper L 2nd Column equals 3rd Column double-struck upper E Subscript x tilde normal d normal a normal t normal a Baseline left-bracket normal nabla Subscript theta Baseline upper E Subscript theta Baseline left-parenthesis bold x right-parenthesis right-bracket minus double-struck upper E Subscript x tilde normal m normal o normal d normal e normal l Baseline left-bracket normal nabla Subscript theta Baseline upper E Subscript theta Baseline left-parenthesis bold x right-parenthesis right-bracket EndLayout" display="block"><mtable displaystyle="true"><mtr><mtd columnalign="right"><mrow><msub><mi>âˆ‡</mi> <mi>Î¸</mi></msub> <mi>â„’</mi></mrow></mtd> <mtd><mo>=</mo></mtd> <mtd columnalign="left"><mrow><msub><mi>ğ”¼</mi> <mrow><mi>x</mi><mo>âˆ¼</mo> <mi>data</mi></mrow></msub> <mfenced separators="" open="[" close="]"><msub><mi>âˆ‡</mi> <mi>Î¸</mi></msub> <msub><mi>E</mi> <mi>Î¸</mi></msub> <mrow><mo>(</mo> <mi>ğ±</mi> <mo>)</mo></mrow></mfenced> <mo>-</mo> <msub><mi>ğ”¼</mi> <mrow><mi>x</mi><mo>âˆ¼</mo> <mi>model</mi></mrow></msub> <mfenced separators="" open="[" close="]"><msub><mi>âˆ‡</mi> <mi>Î¸</mi></msub> <msub><mi>E</mi> <mi>Î¸</mi></msub> <mrow><mo>(</mo> <mi>ğ±</mi> <mo>)</mo></mrow></mfenced></mrow></mtd></mtr></mtable></math>

è¿™åœ¨ç›´è§‰ä¸Šæ˜¯æœ‰å¾ˆå¤šæ„ä¹‰çš„-æˆ‘ä»¬å¸Œæœ›è®­ç»ƒæ¨¡å‹è¾“å‡ºçœŸå®è§‚å¯Ÿçš„å¤§è´Ÿèƒ½é‡åˆ†æ•°ï¼Œå¹¶ä¸ºç”Ÿæˆçš„å‡è§‚å¯Ÿè¾“å‡ºå¤§æ­£èƒ½é‡åˆ†æ•°ï¼Œä»¥ä¾¿è¿™ä¸¤ä¸ªæç«¯ä¹‹é—´çš„å¯¹æ¯”å°½å¯èƒ½å¤§ã€‚

æ¢å¥è¯è¯´ï¼Œæˆ‘ä»¬å¯ä»¥è®¡ç®—çœŸå®å’Œå‡æ ·æœ¬çš„èƒ½é‡åˆ†æ•°ä¹‹é—´çš„å·®å¼‚ï¼Œå¹¶å°†å…¶ç”¨ä½œæˆ‘ä»¬çš„æŸå¤±å‡½æ•°ã€‚

è¦è®¡ç®—å‡æ ·æœ¬çš„èƒ½é‡åˆ†æ•°ï¼Œæˆ‘ä»¬éœ€è¦èƒ½å¤Ÿä»åˆ†å¸ƒ <math alttext="p Subscript theta Baseline left-parenthesis bold x right-parenthesis"><mrow><msub><mi>p</mi> <mi>Î¸</mi></msub> <mrow><mo>(</mo> <mi>ğ±</mi> <mo>)</mo></mrow></mrow></math> ä¸­ç²¾ç¡®æŠ½æ ·ï¼Œä½†ç”±äºä¸å¯è§£çš„åˆ†æ¯ï¼Œè¿™æ˜¯ä¸å¯èƒ½çš„ã€‚ç›¸åï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨Langeviné‡‡æ ·è¿‡ç¨‹ç”Ÿæˆä¸€ç»„èƒ½é‡åˆ†æ•°è¾ƒä½çš„è§‚å¯Ÿã€‚è¿™ä¸ªè¿‡ç¨‹éœ€è¦è¿è¡Œæ— é™å¤šæ­¥æ‰èƒ½äº§ç”Ÿå®Œç¾æ ·æœ¬ï¼ˆæ˜¾ç„¶æ˜¯ä¸åˆ‡å®é™…çš„ï¼‰ï¼Œå› æ­¤æˆ‘ä»¬è¿è¡Œä¸€äº›å°æ­¥æ•°ï¼Œå‡è®¾è¿™è¶³ä»¥äº§ç”Ÿæœ‰æ„ä¹‰çš„æŸå¤±å‡½æ•°ã€‚

æˆ‘ä»¬è¿˜ç»´æŠ¤ä¸€ä¸ªæ¥è‡ªå…ˆå‰è¿­ä»£çš„æ ·æœ¬ç¼“å†²åŒºï¼Œè¿™æ ·æˆ‘ä»¬å¯ä»¥å°†å…¶ç”¨ä½œä¸‹ä¸€æ‰¹çš„èµ·ç‚¹ï¼Œè€Œä¸æ˜¯çº¯éšæœºå™ªå£°ã€‚ç”Ÿæˆé‡‡æ ·ç¼“å†²åŒºçš„ä»£ç å¦‚[ç¤ºä¾‹7-5](#sampling_buffer)æ‰€ç¤ºã€‚

##### ç¤ºä¾‹7-5ã€‚`ç¼“å†²åŒº`

```py
class Buffer:
    def __init__(self, model):
        super().__init__()
        self.model = model
        self.examples = [
            tf.random.uniform(shape = (1, 32, 32, 1)) * 2 - 1
            for _ in range(128)
        ] ![1](Images/1.png)

    def sample_new_exmps(self, steps, step_size, noise):
        n_new = np.random.binomial(128, 0.05) ![2](Images/2.png)
        rand_imgs = (
            tf.random.uniform((n_new, 32, 32, 1)) * 2 - 1
        )
        old_imgs = tf.concat(
            random.choices(self.examples, k=128-n_new), axis=0
        ) ![3](Images/3.png)
        inp_imgs = tf.concat([rand_imgs, old_imgs], axis=0)
        inp_imgs = generate_samples(
            self.model, inp_imgs, steps=steps, step_size=step_size, noise = noise
        ) ![4](Images/4.png)
        self.examples = tf.split(inp_imgs, 128, axis = 0) + self.examples ![5](Images/5.png)
        self.examples = self.examples[:8192]
        return inp_imgs
```

[![1](Images/1.png)](#co_energy_based_models_CO3-1)

é‡‡æ ·ç¼“å†²åŒºç”¨ä¸€æ‰¹éšæœºå™ªå£°åˆå§‹åŒ–ã€‚

[![2](Images/2.png)](#co_energy_based_models_CO3-2)

å¹³å‡è€Œè¨€ï¼Œæ¯æ¬¡æœ‰5%çš„è§‚å¯Ÿæ˜¯ä»å¤´å¼€å§‹ç”Ÿæˆçš„ï¼ˆå³ï¼Œéšæœºå™ªå£°ï¼‰ã€‚

[![3](Images/3.png)](#co_energy_based_models_CO3-3)

å…¶ä½™çš„éšæœºä»ç°æœ‰ç¼“å†²åŒºä¸­æå–ã€‚

[![4](Images/4.png)](#co_energy_based_models_CO3-4)

è¿™äº›è§‚å¯Ÿè¢«è¿æ¥å¹¶é€šè¿‡Langeviné‡‡æ ·å™¨è¿è¡Œã€‚

[![5](Images/5.png)](#co_energy_based_models_CO3-5)

ç”Ÿæˆçš„æ ·æœ¬è¢«æ·»åŠ åˆ°ç¼“å†²åŒºä¸­ï¼Œç¼“å†²åŒºè¢«ä¿®å‰ªä¸ºæœ€å¤š8,192ä¸ªè§‚å¯Ÿã€‚

[å›¾7-5](#contrastive_divergence)æ˜¾ç¤ºäº†å¯¹æ¯”æ•£åº¦çš„ä¸€ä¸ªè®­ç»ƒæ­¥éª¤ã€‚çœŸå®è§‚å¯Ÿçš„åˆ†æ•°è¢«ç®—æ³•æ¨ä½ï¼Œè€Œå‡è§‚å¯Ÿçš„åˆ†æ•°è¢«æ‹‰é«˜ï¼Œæ¯ä¸€æ­¥ä¹‹åéƒ½ä¸è€ƒè™‘å¯¹è¿™äº›åˆ†æ•°è¿›è¡Œå½’ä¸€åŒ–ã€‚

![](Images/gdl2_0705.png)

###### å›¾7-5ã€‚å¯¹æ¯”æ•£åº¦çš„ä¸€æ­¥

æˆ‘ä»¬å¯ä»¥ç¼–å†™å¯¹æ¯”æ•£åº¦ç®—æ³•çš„è®­ç»ƒæ­¥éª¤ï¼Œå¦‚[ç¤ºä¾‹7-6](#contrastive_divergence_python)æ‰€ç¤ºï¼Œåœ¨è‡ªå®šä¹‰Kerasæ¨¡å‹ä¸­ã€‚ 

##### ç¤ºä¾‹7-6ã€‚ä½¿ç”¨å¯¹æ¯”æ•£åº¦è®­ç»ƒçš„EBM

```py
class EBM(models.Model):
    def __init__(self):
        super(EBM, self).__init__()
        self.model = model
        self.buffer = Buffer(self.model)
        self.alpha = 0.1
        self.loss_metric = metrics.Mean(name="loss")
        self.reg_loss_metric = metrics.Mean(name="reg")
        self.cdiv_loss_metric = metrics.Mean(name="cdiv")
        self.real_out_metric = metrics.Mean(name="real")
        self.fake_out_metric = metrics.Mean(name="fake")

    @property
    def metrics(self):
        return [
            self.loss_metric,
            self.reg_loss_metric,
            self.cdiv_loss_metric,
            self.real_out_metric,
            self.fake_out_metric
        ]

    def train_step(self, real_imgs):
        real_imgs += tf.random.normal(
            shape=tf.shape(real_imgs), mean = 0, stddev = 0.005
        ) ![1](Images/1.png)
        real_imgs = tf.clip_by_value(real_imgs, -1.0, 1.0)
        fake_imgs = self.buffer.sample_new_exmps(
            steps=60, step_size=10, noise = 0.005
        ) ![2](Images/2.png)
        inp_imgs = tf.concat([real_imgs, fake_imgs], axis=0)
        with tf.GradientTape() as training_tape:
            real_out, fake_out = tf.split(self.model(inp_imgs), 2, axis=0) ![3](Images/3.png)
            cdiv_loss = tf.reduce_mean(fake_out, axis = 0) - tf.reduce_mean(
                real_out, axis = 0
            ) ![4](Images/4.png)
            reg_loss = self.alpha * tf.reduce_mean(
                real_out ** 2 + fake_out ** 2, axis = 0
            ) ![5](Images/5.png)
            loss = reg_loss + cdiv_loss
        grads = training_tape.gradient(loss, self.model.trainable_variables) ![6](Images/6.png)
        self.optimizer.apply_gradients(
            zip(grads, self.model.trainable_variables)
        )
        self.loss_metric.update_state(loss)
        self.reg_loss_metric.update_state(reg_loss)
        self.cdiv_loss_metric.update_state(cdiv_loss)
        self.real_out_metric.update_state(tf.reduce_mean(real_out, axis = 0))
        self.fake_out_metric.update_state(tf.reduce_mean(fake_out, axis = 0))
        return {m.name: m.result() for m in self.metrics}

    def test_step(self, real_imgs): ![7](Images/7.png)
        batch_size = real_imgs.shape[0]
        fake_imgs = tf.random.uniform((batch_size, 32, 32, 1)) * 2 - 1
        inp_imgs = tf.concat([real_imgs, fake_imgs], axis=0)
        real_out, fake_out = tf.split(self.model(inp_imgs), 2, axis=0)
        cdiv = tf.reduce_mean(fake_out, axis = 0) - tf.reduce_mean(
            real_out, axis = 0
        )
        self.cdiv_loss_metric.update_state(cdiv)
        self.real_out_metric.update_state(tf.reduce_mean(real_out, axis = 0))
        self.fake_out_metric.update_state(tf.reduce_mean(fake_out, axis = 0))
        return {m.name: m.result() for m in self.metrics[2:]}

ebm = EBM()
ebm.compile(optimizer=optimizers.Adam(learning_rate=0.0001), run_eagerly=True)
ebm.fit(x_train, epochs=60, validation_data = x_test,)
```

[![1](Images/1.png)](#co_energy_based_models_CO4-1)

ä¸ºçœŸå®å›¾åƒæ·»åŠ å°‘é‡éšæœºå™ªå£°ï¼Œä»¥é¿å…æ¨¡å‹è¿‡åº¦æ‹Ÿåˆè®­ç»ƒé›†ã€‚

[![2](Images/2.png)](#co_energy_based_models_CO4-2)

ä¸€ç»„å‡å›¾åƒä»ç¼“å†²åŒºä¸­æŠ½æ ·ã€‚

[![3](Images/3.png)](#co_energy_based_models_CO4-3)

çœŸå®å’Œå‡å›¾åƒé€šè¿‡æ¨¡å‹è¿è¡Œä»¥äº§ç”ŸçœŸå®å’Œå‡åˆ†æ•°ã€‚

[![4](Images/4.png)](#co_energy_based_models_CO4-4)

å¯¹æ¯”æ•£åº¦æŸå¤±ç®€å•åœ°æ˜¯çœŸå®å’Œå‡è§‚å¯Ÿçš„åˆ†æ•°ä¹‹é—´çš„å·®å¼‚ã€‚

[![5](Images/5.png)](#co_energy_based_models_CO4-5)

æ·»åŠ æ­£åˆ™åŒ–æŸå¤±ä»¥é¿å…åˆ†æ•°å˜å¾—è¿‡å¤§ã€‚

[![6](Images/6.png)](#co_energy_based_models_CO4-6)

é€šè¿‡åå‘ä¼ æ’­è®¡ç®—ç½‘ç»œæƒé‡ç›¸å¯¹äºæŸå¤±å‡½æ•°çš„æ¢¯åº¦ã€‚

[![7](Images/7.png)](#co_energy_based_models_CO4-7)

`test_step` ç”¨äºåœ¨éªŒè¯è¿‡ç¨‹ä¸­è®¡ç®—ä¸€ç»„éšæœºå™ªå£°å’Œè®­ç»ƒé›†ä¸­çš„æ•°æ®ä¹‹é—´çš„å¯¹æ¯”æ•£åº¦ã€‚å®ƒå¯ä»¥ä½œä¸ºè¡¡é‡æ¨¡å‹è®­ç»ƒæ•ˆæœçš„æŒ‡æ ‡ï¼ˆè§ä¸‹ä¸€èŠ‚ï¼‰ã€‚

## èƒ½é‡åŸºæ¨¡å‹çš„åˆ†æ

è®­ç»ƒè¿‡ç¨‹ä¸­çš„æŸå¤±æ›²çº¿å’Œæ”¯æŒæŒ‡æ ‡æ˜¾ç¤ºåœ¨ [Figure 7-6](#ebm_loss_curves) ä¸­ã€‚

![](Images/gdl2_0706.png)

###### å›¾ 7-6\. EBM è®­ç»ƒè¿‡ç¨‹çš„æŸå¤±æ›²çº¿å’ŒæŒ‡æ ‡

é¦–å…ˆï¼Œæ³¨æ„åˆ°åœ¨è®­ç»ƒæ­¥éª¤ä¸­è®¡ç®—çš„æŸå¤±åœ¨å„ä¸ªå‘¨æœŸä¸­å¤§è‡´ä¿æŒä¸å˜ä¸”è¾ƒå°ã€‚è™½ç„¶æ¨¡å‹ä¸æ–­æ”¹è¿›ï¼Œä½†ä¸è®­ç»ƒé›†ä¸­çš„çœŸå®å›¾åƒè¿›è¡Œæ¯”è¾ƒçš„ç¼“å†²åŒºä¸­ç”Ÿæˆçš„å›¾åƒè´¨é‡ä¹Ÿåœ¨æé«˜ï¼Œå› æ­¤æˆ‘ä»¬ä¸åº”è¯¥æœŸæœ›è®­ç»ƒæŸå¤±æ˜¾è‘—ä¸‹é™ã€‚

å› æ­¤ï¼Œä¸ºäº†è¯„ä¼°æ¨¡å‹æ€§èƒ½ï¼Œæˆ‘ä»¬è¿˜å»ºç«‹äº†ä¸€ä¸ªéªŒè¯è¿‡ç¨‹ï¼Œè¯¥è¿‡ç¨‹ä¸ä»ç¼“å†²åŒºä¸­é‡‡æ ·ï¼Œè€Œæ˜¯å¯¹ä¸€ç»„éšæœºå™ªå£°è¿›è¡Œè¯„åˆ†ï¼Œå¹¶å°†å…¶ä¸è®­ç»ƒé›†ä¸­çš„ç¤ºä¾‹è¿›è¡Œæ¯”è¾ƒã€‚å¦‚æœæ¨¡å‹æ­£åœ¨æ”¹è¿›ï¼Œæˆ‘ä»¬åº”è¯¥çœ‹åˆ°å¯¹æ¯”æ•£åº¦éšç€å‘¨æœŸçš„å¢åŠ è€Œä¸‹é™ï¼ˆå³ï¼Œå®ƒåœ¨åŒºåˆ†éšæœºå™ªå£°å’ŒçœŸå®å›¾åƒæ–¹é¢å˜å¾—æ›´å¥½ï¼‰ï¼Œå¦‚ [Figure 7-6](#ebm_loss_curves) ä¸­æ‰€ç¤ºã€‚

ä» EBM ç”Ÿæˆæ–°æ ·æœ¬åªéœ€è¿è¡Œ Langevin é‡‡æ ·å™¨è¿›è¡Œå¤§é‡æ­¥éª¤ï¼Œä»ä¸€ä¸ªé™æ­¢çŠ¶æ€ï¼ˆéšæœºå™ªå£°ï¼‰å¼€å§‹ï¼Œå¦‚ [Example 7-7](#generating_ebm) ä¸­æ‰€ç¤ºã€‚è§‚æµ‹è¢«è¿« *ä¸‹å¡*ï¼Œæ²¿ç€ç›¸å¯¹äºè¾“å…¥çš„è¯„åˆ†å‡½æ•°çš„æ¢¯åº¦ï¼Œä»¥ä¾¿åœ¨å™ªå£°ä¸­å‡ºç°ä¸€ä¸ªåˆç†çš„è§‚æµ‹ã€‚

##### ç¤ºä¾‹ 7-7\. ä½¿ç”¨ EBM ç”Ÿæˆæ–°è§‚æµ‹

```py
start_imgs = np.random.uniform(size = (10, 32, 32, 1)) * 2 - 1
gen_img = generate_samples(
    ebm.model,
    start_imgs,
    steps=1000,
    step_size=10,
    noise = 0.005,
    return_img_per_step=True,
)
```

åœ¨ç»è¿‡ 50 ä¸ªå‘¨æœŸçš„è®­ç»ƒåï¼Œé‡‡æ ·å™¨ç”Ÿæˆçš„ä¸€äº›è§‚æµ‹ç¤ºä¾‹æ˜¾ç¤ºåœ¨ [Figure 7-7](#ebm_examples) ä¸­ã€‚

![](Images/gdl2_0707.png)

###### å›¾ 7-7\. ä½¿ç”¨ EBM æ¨¡å‹çš„ Langevin é‡‡æ ·å™¨ç”Ÿæˆçš„ç¤ºä¾‹ä»¥æŒ‡å¯¼æ¢¯åº¦ä¸‹é™

æˆ‘ä»¬ç”šè‡³å¯ä»¥å±•ç¤ºå•ä¸ªè§‚æµ‹æ˜¯å¦‚ä½•é€šè¿‡åœ¨ Langevin é‡‡æ ·è¿‡ç¨‹ä¸­æ‹æ‘„å½“å‰è§‚æµ‹çš„å¿«ç…§ç”Ÿæˆçš„â€”â€”è¿™åœ¨ [Figure 7-8](#langevin_examples) ä¸­å±•ç¤ºã€‚

![](Images/gdl2_0708.png)

###### å›¾ 7-8\. Langevin é‡‡æ ·è¿‡ç¨‹ä¸­ä¸åŒæ­¥éª¤çš„è§‚æµ‹å¿«ç…§

## å…¶ä»–èƒ½é‡åŸºæ¨¡å‹

åœ¨å‰é¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†ä½¿ç”¨å¯¹æ¯”æ•£åº¦å’Œ Langevin åŠ¨åŠ›å­¦é‡‡æ ·å™¨è®­ç»ƒçš„æ·±åº¦ EBMã€‚ç„¶è€Œï¼Œæ—©æœŸçš„ EBM æ¨¡å‹å¹¶æ²¡æœ‰ä½¿ç”¨ Langevin é‡‡æ ·ï¼Œè€Œæ˜¯ä¾èµ–äºå…¶ä»–æŠ€æœ¯å’Œæ¶æ„ã€‚

æœ€æ—©çš„èƒ½é‡åŸºæ¨¡å‹ä¹‹ä¸€æ˜¯ *Boltzmann æœº*ã€‚^([6](ch07.xhtml#idm45387010130976)) è¿™æ˜¯ä¸€ä¸ªå…¨è¿æ¥çš„æ— å‘ç¥ç»ç½‘ç»œï¼Œå…¶ä¸­äºŒè¿›åˆ¶å•å…ƒè¦ä¹ˆæ˜¯ *å¯è§*ï¼ˆ*v*ï¼‰ï¼Œè¦ä¹ˆæ˜¯ *éšè—*ï¼ˆ*h*ï¼‰ã€‚ç½‘ç»œçš„ç»™å®šé…ç½®çš„èƒ½é‡å®šä¹‰å¦‚ä¸‹ï¼š

<math alttext="upper E Subscript theta Baseline left-parenthesis v comma h right-parenthesis equals minus one-half left-parenthesis v Superscript upper T Baseline upper L v plus h Superscript upper T Baseline upper J h plus v Superscript upper T Baseline upper W h right-parenthesis" display="block"><mrow><msub><mi>E</mi> <mi>Î¸</mi></msub> <mrow><mo>(</mo> <mi>v</mi> <mo>,</mo> <mi>h</mi> <mo>)</mo></mrow> <mo>=</mo> <mo>-</mo> <mfrac><mn>1</mn> <mn>2</mn></mfrac> <mfenced separators="" open="(" close=")"><msup><mi>v</mi> <mi>T</mi></msup> <mi>L</mi> <mi>v</mi> <mo>+</mo> <msup><mi>h</mi> <mi>T</mi></msup> <mi>J</mi> <mi>h</mi> <mo>+</mo> <msup><mi>v</mi> <mi>T</mi></msup> <mi>W</mi> <mi>h</mi></mfenced></mrow></math>

å…¶ä¸­ <math alttext="upper W comma upper L comma upper J"><mrow><mi>W</mi> <mo>,</mo> <mi>L</mi> <mo>,</mo> <mi>J</mi></mrow></math> æ˜¯æ¨¡å‹å­¦ä¹ çš„æƒé‡çŸ©é˜µã€‚è®­ç»ƒé€šè¿‡å¯¹æ¯”æ•£åº¦å®ç°ï¼Œä½†ä½¿ç”¨ Gibbs é‡‡æ ·åœ¨å¯è§å±‚å’Œéšè—å±‚ä¹‹é—´äº¤æ›¿ï¼Œç›´åˆ°æ‰¾åˆ°å¹³è¡¡ã€‚å®é™…ä¸Šï¼Œè¿™æ˜¯éå¸¸ç¼“æ…¢çš„ï¼Œä¸é€‚ç”¨äºå¤§é‡éšè—å•å…ƒã€‚

###### æç¤º

è¯·æŸ¥çœ‹ Jessica Stringham çš„åšå®¢æ–‡ç«  [â€œPython ä¸­çš„ Gibbs é‡‡æ ·â€](https://oreil.ly/tXmOq) ä»¥è·å– Gibbs é‡‡æ ·çš„ä¼˜ç§€ç®€å•ç¤ºä¾‹ã€‚

è¿™ä¸ªæ¨¡å‹çš„æ‰©å±•ï¼Œ*å—é™ç»å°”å…¹æ›¼æœº*ï¼ˆRBMï¼‰ï¼Œç§»é™¤äº†ç›¸åŒç±»å‹å•å…ƒä¹‹é—´çš„è¿æ¥ï¼Œå› æ­¤åˆ›å»ºäº†ä¸€ä¸ªä¸¤å±‚çš„äºŒéƒ¨å›¾ã€‚è¿™ä½¿å¾—RBMå¯ä»¥å †å æˆ*æ·±åº¦ä¿¡å¿µç½‘ç»œ*ï¼Œä»¥å»ºæ¨¡æ›´å¤æ‚çš„åˆ†å¸ƒã€‚ç„¶è€Œï¼Œä½¿ç”¨RBMå¯¹é«˜ç»´æ•°æ®è¿›è¡Œå»ºæ¨¡ä»ç„¶æ˜¯ä¸åˆ‡å®é™…çš„ï¼Œå› ä¸ºä»ç„¶éœ€è¦é•¿æ··åˆæ—¶é—´çš„å‰å¸ƒæ–¯é‡‡æ ·ã€‚

ç›´åˆ°2000å¹´ä»£æœ«ï¼ŒEBMæ‰è¢«è¯æ˜å…·æœ‰å¯¹æ›´é«˜ç»´æ•°æ®é›†è¿›è¡Œå»ºæ¨¡çš„æ½œåŠ›ï¼Œå¹¶å»ºç«‹äº†ä¸€ä¸ªæ„å»ºæ·±åº¦EBMçš„æ¡†æ¶ã€‚^([7](ch07.xhtml#idm45387010525504)) LangevinåŠ¨åŠ›å­¦æˆä¸ºEBMçš„é¦–é€‰é‡‡æ ·æ–¹æ³•ï¼Œåæ¥æ¼”å˜æˆä¸€ç§ç§°ä¸º*å¾—åˆ†åŒ¹é…*çš„è®­ç»ƒæŠ€æœ¯ã€‚è¿™è¿›ä¸€æ­¥å‘å±•æˆä¸€ç§ç§°ä¸º*å»å™ªæ‰©æ•£æ¦‚ç‡æ¨¡å‹*çš„æ¨¡å‹ç±»ï¼Œä¸ºDALL.E 2å’ŒImageGenç­‰æœ€å…ˆè¿›çš„ç”Ÿæˆæ¨¡å‹æä¾›åŠ¨åŠ›ã€‚æˆ‘ä»¬å°†åœ¨[ç¬¬8ç« ](ch08.xhtml#chapter_diffusion)ä¸­æ›´è¯¦ç»†åœ°æ¢è®¨æ‰©æ•£æ¨¡å‹ã€‚

# æ‘˜è¦

åŸºäºèƒ½é‡çš„æ¨¡å‹æ˜¯ä¸€ç±»ç”Ÿæˆæ¨¡å‹ï¼Œåˆ©ç”¨èƒ½é‡è¯„åˆ†å‡½æ•°â€”â€”ä¸€ä¸ªç»è¿‡è®­ç»ƒçš„ç¥ç»ç½‘ç»œï¼Œç”¨äºä¸ºçœŸå®è§‚å¯Ÿè¾“å‡ºä½åˆ†æ•°ï¼Œä¸ºç”Ÿæˆè§‚å¯Ÿè¾“å‡ºé«˜åˆ†æ•°ã€‚è®¡ç®—ç”±è¯¥å¾—åˆ†å‡½æ•°ç»™å‡ºçš„æ¦‚ç‡åˆ†å¸ƒéœ€è¦é€šè¿‡ä¸€ä¸ªéš¾ä»¥å¤„ç†çš„åˆ†æ¯è¿›è¡Œå½’ä¸€åŒ–ã€‚EBMé€šè¿‡åˆ©ç”¨ä¸¤ä¸ªæŠ€å·§æ¥é¿å…è¿™ä¸ªé—®é¢˜ï¼šå¯¹æ¯”æ•£åº¦ç”¨äºè®­ç»ƒç½‘ç»œï¼ŒLangevinåŠ¨åŠ›å­¦ç”¨äºé‡‡æ ·æ–°è§‚å¯Ÿã€‚

èƒ½é‡å‡½æ•°é€šè¿‡æœ€å°åŒ–ç”Ÿæˆæ ·æœ¬å¾—åˆ†ä¸è®­ç»ƒæ•°æ®å¾—åˆ†ä¹‹é—´çš„å·®å¼‚æ¥è¿›è¡Œè®­ç»ƒï¼Œè¿™ç§æŠ€æœ¯ç§°ä¸ºå¯¹æ¯”æ•£åº¦ã€‚å¯ä»¥è¯æ˜è¿™ç­‰ä»·äºæœ€å°åŒ–è´Ÿå¯¹æ•°ä¼¼ç„¶ï¼Œè¿™æ˜¯æœ€å¤§ä¼¼ç„¶ä¼°è®¡æ‰€è¦æ±‚çš„ï¼Œä½†ä¸éœ€è¦æˆ‘ä»¬è®¡ç®—éš¾ä»¥å¤„ç†çš„å½’ä¸€åŒ–åˆ†æ¯ã€‚åœ¨å®è·µä¸­ï¼Œæˆ‘ä»¬è¿‘ä¼¼ä¸ºå‡æ ·æœ¬çš„é‡‡æ ·è¿‡ç¨‹ï¼Œä»¥ç¡®ä¿ç®—æ³•ä¿æŒé«˜æ•ˆã€‚

æ·±åº¦EBMçš„é‡‡æ ·æ˜¯é€šè¿‡LangevinåŠ¨åŠ›å­¦å®ç°çš„ï¼Œè¿™æ˜¯ä¸€ç§åˆ©ç”¨å¾—åˆ†ç›¸å¯¹äºè¾“å…¥å›¾åƒçš„æ¢¯åº¦é€æ¸å°†éšæœºå™ªå£°è½¬åŒ–ä¸ºåˆç†è§‚å¯Ÿçš„æŠ€æœ¯ï¼Œé€šè¿‡æ›´æ–°è¾“å…¥è¿›è¡Œå°æ­¥éª¤ï¼Œæ²¿ç€æ¢¯åº¦ä¸‹é™ã€‚è¿™æ”¹è¿›äº†æ—©æœŸçš„æ–¹æ³•ï¼Œå¦‚å—é™ç»å°”å…¹æ›¼æœºä½¿ç”¨çš„å‰å¸ƒæ–¯é‡‡æ ·ã€‚

^([1](ch07.xhtml#idm45387012482384-marker)) æœä¸€ä¼¦å’Œä¼Šæˆˆå°”Â·è«è¾¾å¥‡ï¼Œâ€œåŸºäºèƒ½é‡çš„æ¨¡å‹çš„éšå¼ç”Ÿæˆå’Œå»ºæ¨¡â€ï¼Œ2019å¹´3æœˆ20æ—¥ï¼Œ[*https://arxiv.org/abs/1903.08689*](https://arxiv.org/abs/1903.08689)ã€‚

^([2](ch07.xhtml#idm45387012241152-marker)) Prajit Ramachandranç­‰äººï¼Œâ€œæœç´¢æ¿€æ´»å‡½æ•°â€ï¼Œ2017å¹´10æœˆ16æ—¥ï¼Œ[*https://arxiv.org/abs/1710.05941v2*](https://arxiv.org/abs/1710.05941v2)ã€‚

^([3](ch07.xhtml#idm45387012049200-marker)) Max Wellingå’ŒYee Whye Tehï¼Œâ€œé€šè¿‡éšæœºæ¢¯åº¦LangevinåŠ¨åŠ›å­¦è¿›è¡Œè´å¶æ–¯å­¦ä¹ â€ï¼Œ2011å¹´ï¼Œ[*https://www.stats.ox.ac.uk/~teh/research/compstats/WelTeh2011a.pdf*](https://www.stats.ox.ac.uk/~teh/research/compstats/WelTeh2011a.pdf)

^([4](ch07.xhtml#idm45387011649104-marker)) Geoffrey E. Hintonï¼Œâ€œé€šè¿‡æœ€å°åŒ–å¯¹æ¯”æ•£åº¦è®­ç»ƒä¸“å®¶ä¹˜ç§¯â€ï¼Œ2002å¹´ï¼Œ[*https://www.cs.toronto.edu/~hinton/absps/tr00-004.pdf*](https://www.cs.toronto.edu/~hinton/absps/tr00-004.pdf)ã€‚

^([5](ch07.xhtml#idm45387011627440-marker)) Oliver Woodfordï¼Œâ€œå¯¹æ¯”æ•£åº¦ç¬”è®°â€ï¼Œ2006å¹´ï¼Œ[*https://www.robots.ox.ac.uk/~ojw/files/NotesOnCD.pdf*](https://www.robots.ox.ac.uk/~ojw/files/NotesOnCD.pdf)ã€‚

^([6](ch07.xhtml#idm45387010130976-marker)) David H. Ackleyç­‰äººï¼Œâ€œç»å°”å…¹æ›¼æœºçš„å­¦ä¹ ç®—æ³•â€ï¼Œ1985å¹´ï¼Œ*è®¤çŸ¥ç§‘å­¦* 9(1), 147-165ã€‚

^([7](ch07.xhtml#idm45387010525504-marker)) Yann Lecunç­‰äººï¼Œâ€œåŸºäºèƒ½é‡çš„å­¦ä¹ æ•™ç¨‹â€ï¼Œ2006å¹´ï¼Œ*[*https://www.researchgate.net/publication/200744586_A_tutorial_on_energy-based_learning*](https://www.researchgate.net/publication/200744586_A_tutorial_on_energy-based_learning)*.
