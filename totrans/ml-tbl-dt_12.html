<html><head></head><body>
  <h1 class="tochead" id="heading_id_2">10 <a id="idTextAnchor000"/><a id="idTextAnchor001"/><a id="idTextAnchor002"/><a id="idTextAnchor003"/><a id="idTextAnchor004"/><a id="idTextAnchor005"/><a id="idTextAnchor006"/>Model deployment</h1>

  <p class="co-summary-head">This chapter covers<a id="idIndexMarker000"/><a id="marker-359"/></p>

  <ul class="calibre5">
    <li class="co-summary-bullet">Deploying a deep learning model in a simple web application on our local system</li>

    <li class="co-summary-bullet">An introduction to key Google Cloud concepts</li>

    <li class="co-summary-bullet">An introduction to Vertex AI, the machine learning environment in Google Cloud</li>

    <li class="co-summary-bullet">Deploying a deep learning model with a Vertex AI endpoint</li>

    <li class="co-summary-bullet">Adapting the web application to use a Vertex AI endpoint</li>

    <li class="co-summary-bullet">Getting generative AI assistance with Gemini for Google Cloud</li>
  </ul>

  <p class="body">In chapter 9, we reviewed a set of best practices for training a deep learning model with tabular data and introduced the Kuala Lumpur real estate price prediction problem as a challenging tabular problem because of its mixed-type features. In this chapter, we will take the model we trained in chapter 9 and deploy it in a simple web application. First, we will deploy it local<a id="idTextAnchor007"/>ly—that is, having both the web server and the trained model on our local system. Next, we will introduce Google Cloud as an alternative way to deploy our model. In fact, we will take the trained model and deploy it with an endpoint in Vertex AI, the machine learning environment in Google Cloud. Finally, we will examine how to use Google’s generative AI assistant Gemini on Google Cloud. The code described in this chapter is available at <a class="url" href="https://mng.bz/6e1A">https://mng.bz/6e1A</a><a id="idTextAnchor008"/>.</p>

  <h2 class="fm-head" id="heading_id_3">10.1 A simple web deployment</h2>

  <p class="body">Once we have trained a deep learning model, having followed the best practices described in chapter 9, we have only just scratched the surface of the process of getting value out of the model. Take the example of the Kuala Lumpur real estate price prediction model we trained in chapter 9. This model could be useful for real estate agents who want to provide advice to their clients about the price they should set for new real estate listings. This model could also be useful for property owners who want to put their properties on the market to get an idea of what value they could expect to get from their properties. Finally, the model could also be useful for buyers who are interested in purchasing properties in Kuala Lumpur so they can get an idea of what kind of property they could buy in a particular location given a certain budget.<a id="marker-360"/><a id="idIndexMarker001"/><a id="idIndexMarker002"/></p>

  <p class="body">It’s evident that the model that we trained in chapter 9 has the potential to be useful to a variety of audiences. The dilemma we face is how to make the model available to all these audiences who have different business goals and potentially different computer proficiency. Later in this chapter, we will learn how to put a model into production on a public cloud environment, but what if we want to do an initial experiment to learn the characteristics of the model and run some tests with some beta clients? Do we need to implement the whole process of deploying a model in a public cloud? No, because we can take advantage of Flask, a Python web application library and set up a self-contained web deployment of the model. Flask was first released in 2010 by Armin Ronacher and has since become one of the most popular web frameworks for Python. It may sound a bit outdated, given the more recent packages such as Streamlit (<a class="url" href="https://streamlit.io/">https://streamlit.io/</a>) or Gradio (<a class="url" href="https://www.gradio.app/">https://www.gradio.app/</a>). However, despite its age, Flask remains a relevant choice for web development due to its lightweight and flexible nature, especially for small personal projects. We are not going to explore all the details of Flask in this book; we just provide the nuts and bolts to set up a demonstration for a model, but if you want to learn more about Flask, check out the documentation: <a class="url" href="https://flask.palletsprojects.com/en/2.3.x/">https://flask.palletsprojects.com/en/2.3.x/</a>.</p>

  <p class="body">Now that we have introduced the idea of a simple web deployment, we can get started. In this section, we will go over how to create a simple yet complete deployment of the model in a pair of web pages served by Fla<a id="idTextAnchor009"/>sk.</p>

  <h3 class="fm-head1" id="heading_id_4">10.1.1 Overview of web deployment</h3>

  <p class="body">So far in this book, we have examined a variety of libraries and frameworks for machine learning and deep learning. With the exception of configuration files defined in YAML, all of the code that we have looked at so far in this book has been Python. Like the examples we have seen so far, the web deployment of a machine learning or deep learning model does include Python, but it also requires handling HTML, JavaScript, and CSS scripts. Figure 10.1 shows an overview of the web deployment we have in mind.<a id="idTextAnchor010"/><a id="idIndexMarker003"/><a id="idIndexMarker004"/></p>

  <div class="figure">
    <p class="figure1"><img alt="" class="calibre4" src="../Images/CH10_F01_Ryan2.png"/></p>

    <p class="figurecaption">Figure 10.1 Overview of the web deployment</p>
  </div>

  <p class="body"><a id="marker-361"/>Let’s review the components that make up the web deployment depicted in figure 10.1:</p>

  <ul class="calibre5">
    <li class="fm-list-bullet">
      <p class="list"><i class="fm-italics">Trained model—</i>This is the model that we saved in the Keras with the preprocessing layers notebook. The model is actually saved as a directory structure (<a class="url" href="https://mng.bz/oKJp">https://mng.bz/oKJp</a>). In the Flask server module, the model is loaded using a reference to this directory.</p>
    </li>

    <li class="fm-list-bullet">
      <p class="list"><i class="fm-italics">Flask server module</i>—This is a Python module that loads the trained model and contains view functions for each of the solution’s HTML pages. The view functions specify the actions that the Flask server module takes when these HTML pages are loaded.</p>
    </li>

    <li class="fm-list-bullet">
      <p class="list"><i class="fm-italics">Flask server config file</i>—YAML file where you can specify parameters for the Flask server, such as the directory containing the trained model.</p>
    </li>

    <li class="fm-list-bullet">
      <p class="list"><code class="fm-code-in-text">home.html</code>—One of the HTML pages served by the Flask server. This page contains fields in which the user can specify the characteristics (such as location, number of rooms, and number of parking spaces) of the property for which they want to get a price prediction. This page also contains JavaScript functions that load default values into each of the fields on the page, specify the valid values that can be entered into each field, and package the values entered by the user so they can be sent back to the Flask server module.</p>
    </li>

    <li class="fm-list-bullet">
      <p class="list"><code class="fm-code-in-text">show-prediction.html</code>—One of the HTML pages served by the Flask server. This page displays the prediction made by the model for the property with the characteristics entered by the user on the <code class="fm-code-in-text">home.html</code> page.</p>
    </li>

    <li class="fm-list-bullet">
      <p class="list"><i class="fm-italics">CSS file</i>—Specifies how the HTML pages in the solution are rendered.</p>
    </li>
  </ul>

  <p class="body">Unlike the other examples in this book, the web deployment runs on your local system by default. When the Flask server is running, it serves <code class="fm-code-in-text">home.html</code> at <code class="fm-code-in-text">localhost:5000</code> so you can exercise the system in your browser.</p>

  <p class="body">Now that we have introduced the web deployment, we will look at the Flask server module and the HTML pages in more detail in the subsequent subsecti<a id="idTextAnchor011"/>ons.</p>

  <h3 class="fm-head1" id="heading_id_5">10.1.2 The Flask server module</h3>

  <p class="body">The Flask server module is the heart of web deployment. Unlike the other Python programs we have examined so far in this book, it is a standalone <code class="fm-code-in-text">.py</code> file rather than a Jupyter Notebook. <a id="idIndexMarker005"/><a id="idIndexMarker006"/><a id="idIndexMarker007"/><a id="marker-362"/></p>

  <p class="body">In this subsection, we will review the key pieces of code in the Flask server module and explain how they drive the web deployment. The following listing shows the first key section of the Flask server module: the code to load the saved Keras model from the file system into an object in the Python <a id="idTextAnchor012"/>module.</p>

  <p class="fm-code-listing-caption">Listing 10.1 Loading the saved Keras model</p>
  <pre class="programlisting">rawpath = os.getcwd()                                             <span class="fm-combinumeral">①</span>
model_path = os.path.abspath(os.path.join(rawpath, 'models'))
model_directory_name = \
os.path.join(model_path,config['file_names'] \
['saved_model'])                                                  <span class="fm-combinumeral">②</span>
loaded_model = \ 
tf.keras.models.load_model(model_directory_name)                  <span class="fm-combinumeral">③</span></pre>

  <p class="fm-code-annotation"><span class="fm-combinumeral">①</span> Gets the current directory</p>

  <p class="fm-code-annotation"><span class="fm-combinumeral">②</span> Gets the fully qualified model directory</p>

  <p class="fm-code-annotation"><span class="fm-combinumeral">③</span> Loads the model using the fully qualified model filename</p>

  <p class="body">In listing 10.1, the fully qualified model directory is built using the model filename loaded from the config file. The model directory is expected to be in a directory called <code class="fm-code-in-text">models</code>, in the same directory as the Flask server module. The model is loaded by the same <code class="fm-code-in-text">tf.keras.models.load_model</code> function that was used to load the model in the Keras preprocessing layers training notebook in chapter 9.</p>

  <p class="body">The most important parts of the Flask server module are the view functions which specify the actions taken for each of the HTML pages in the application. The following listing shows the view function for <code class="fm-code-in-text">home.html</code>, the code that gets invoked when <code class="fm-code-in-text">home.html</code> is the <a id="idTextAnchor013"/>target.</p>

  <p class="fm-code-listing-caption">Listing 10.2 <code class="fm-code-in-text">home.html</code> view function</p>
  <pre class="programlisting">@app.route('/')                                                 <span class="fm-combinumeral">①</span>
def home():   
    title_text = "web deployment of Keras model"
    title = {'titlename':title_text}
    return render_template('home.html',title=title)             <span class="fm-combinumeral">②</span></pre>

  <p class="fm-code-annotation"><span class="fm-combinumeral">①</span> Decorator to indicate that this view function is for home.html</p>

  <p class="fm-code-annotation"><span class="fm-combinumeral">②</span> Parameter sent to home.html for its rendering</p>

  <p class="body">The view function shown in listing 10.2 simply sends a title to the <code class="fm-code-in-text">home.html</code> page and renders the page.</p>

  <p class="body">Listing 10.3 shows the view function for <code class="fm-code-in-text">show-prediction.html</code>. The Flask module runs this code when <code class="fm-code-in-text">show_prediction.html</code> is the target. This view function processes the values that the user entered in <code class="fm-code-in-text">home.html</code> and invokes the model to get a prediction on these <a id="idTextAnchor014"/>values.<a id="marker-363"/></p>

  <p class="fm-code-listing-caption">Listing 10.3 <code class="fm-code-in-text">show-prediction.html</code> view function</p>
  <pre class="programlisting">@app.route('/show-prediction/')                                 <span class="fm-combinumeral">①</span>
def show_prediction():
    scoring_dict = {}
    for col in config['scoring_columns_cat']:
        print("value for "+col+" is: "+str(request.args.get(col))) 
        scoring_dict[col] = str(request.args.get(col))          <span class="fm-combinumeral">②</span>
    for col in config['scoring_columns_cont']:
        scoring_dict[col] = float(request.args.get(col))        <span class="fm-combinumeral">③</span>
    scoring_dict['size_type_bin'] = \
str(request.args.get('size_type'))+' 1'                         <span class="fm-combinumeral">④</span>
    input_dict = \
{name: tf.convert_to_tensor([value]) for name, \
value in scoring_dict.items()}                                  <span class="fm-combinumeral">⑤</span>
    predictions = loaded_model.predict(input_dict)              <span class="fm-combinumeral">⑥</span>
    prob = tf.nn.sigmoid(predictions[0])
    if prob &lt; 0.5:                                              <span class="fm-combinumeral">⑦</span>
        predict_string = "Prediction is: property has a price less than 
median"
    else:
        predict_string = "Prediction is: property has a price more than 
median"
    prediction = {'prediction_key':predict_string}
    return(render_template('show-prediction.html',\
prediction=prediction))                                         <span class="fm-combinumeral">⑧</span></pre>

  <p class="fm-code-annotation"><span class="fm-combinumeral">①</span> Decorator to indicate that this view function is for show-prediction.html</p>

  <p class="fm-code-annotation"><span class="fm-combinumeral">②</span> Loads categorical feature values from the query string into the scoring_dict dictionary</p>

  <p class="fm-code-annotation"><span class="fm-combinumeral">③</span> Loads continuous feature values from the query string into the scoring_dict dictionary</p>

  <p class="fm-code-annotation"><span class="fm-combinumeral">④</span> Sets the value of the size_type_bin parameter</p>

  <p class="fm-code-annotation"><span class="fm-combinumeral">⑤</span> Builds the input dictionary from scoring_dict</p>

  <p class="fm-code-annotation"><span class="fm-combinumeral">⑥</span> Gets the prediction from the loaded model for the loaded feature values</p>

  <p class="fm-code-annotation"><span class="fm-combinumeral">⑦</span> Sets the output prediction string based on the value of the prediction</p>

  <p class="fm-code-annotation"><span class="fm-combinumeral">⑧</span> Renders show-prediction.html using the prediction string</p>

  <p class="body">The view function shown in listing 10.3 takes the query string returned from <code class="fm-code-in-text">home.html</code>, loads all the values from the query string into the Python dictionary <code class="fm-code-in-text">scoring_dict</code>, and uses those values to invoke the model loaded by the code in listing 10.1 to get a prediction. The one exception is <code class="fm-code-in-text">size_type_bin</code>. For the purposes of this simple web deployment, we hard-code the bin value. As an exercise, consider how you would calculate the bin value to avoid this hard coding. The value of the prediction is used to set a string value that is sent to <code class="fm-code-in-text">show-prediction.html</code> to be displayed when the page is rendered.</p>

  <p class="body">Figure 10.2 illustrates how the view functions shown in listings 10.2 and 10.3 interact with the web pages <code class="fm-code-in-text">home.html</code> and <code class="fm-code-in-text">show-prediction.h<a class="calibre" id="idTextAnchor015"/>tml</code>.<a id="marker-364"/></p>

  <div class="figure">
    <p class="figure1"><img alt="" class="calibre4" src="../Images/CH10_F02_Ryan2.png"/></p>

    <p class="figurecaption">Figure 10.2 Interaction between the view functions and the web pages</p>
  </div>

  <p class="body">Figure 10.2 explains that the view function for <code class="fm-code-in-text">home.html</code> in the Flask server module renders <code class="fm-code-in-text">home.html</code>. The JavaScript functions in <code class="fm-code-in-text">home.html</code> build a query string containing the user’s feature values in <code class="fm-code-in-text">home.html</code>. This query string is returned to the <code class="fm-code-in-text">show-prediction</code> view function in the Flask server module. That view function loads the feature values from the query string and uses them to get a prediction for the property from the model. The model prediction is used to create a prediction string, which is passed to <code class="fm-code-in-text">show-prediction.html</code> when it is rendered. The prediction string is displayed in <code class="fm-code-in-text">show-prediction.html</code>.</p>

  <p class="body">Now that we have examined the key parts of the Python code in the Flask server module on the right side of figure 10.2, in the next section, we will move beyond Python to look at the HTML and JavaScript code that drives what’s happening on the left side of figure<a id="idTextAnchor016"/> 10.2.<a id="idIndexMarker008"/><a id="idIndexMarker009"/><a id="idIndexMarker010"/></p>

  <h3 class="fm-head1" id="heading_id_6">10.1.3 The home.html page</h3>

  <p class="body">There is a lot happening in the <code class="fm-code-in-text">home.html</code> page:<a id="idIndexMarker011"/><a id="idIndexMarker012"/><a id="marker-365"/><a id="idIndexMarker013"/></p>

  <ul class="calibre5">
    <li class="fm-list-bullet">
      <p class="list">Setting up fields where the user can enter values for the eight property characteristics that the prediction is based on</p>
    </li>

    <li class="fm-list-bullet">
      <p class="list">Setting default values and ranges for each of the fields</p>
    </li>

    <li class="fm-list-bullet">
      <p class="list">Gathering the input from the fields when the user clicks Get Prediction and sending them to the view function in the Flask server module</p>
    </li>
  </ul>

  <p class="body">Figure 10.3 summarizes the interaction between the JavaScript functions in <code class="fm-code-in-text">home.html</code> and the user interface elements in <code class="fm-code-in-text">h<a class="calibre" id="idTextAnchor017"/>ome.html</code>.</p>

  <div class="figure">
    <p class="figure1"><img alt="" class="calibre4" src="../Images/CH10_F03_Ryan2.png"/></p>

    <p class="figurecaption">Figure 10.3 Interaction between JavaScript and UI elements in <code class="fm-code-in-text">home.html</code> </p>
  </div>

  <p class="body">Having introduced what is happening in <code class="fm-code-in-text">home.html</code>, let’s examine the code for this web page. listing 10.4 shows examples of the definitions of the input fields in <code class="fm-code-in-text">home.html</code>. These are HTML fields where the user can enter input values to specify the details about the property for which they want to get a price <a id="idTextAnchor018"/>prediction.</p>

  <p class="fm-code-listing-caption">Listing 10.4 Examples of HTML definitions for fields</p>
  <pre class="programlisting">&lt;p&gt; 
    Location:                                              <span class="fm-combinumeral">①</span>
    &lt;select id="location" &gt;                                <span class="fm-combinumeral">②</span>
    &lt;/select&gt; 
&lt;/p&gt;
&lt;p&gt; 
    &lt;label for="rooms"&gt;
Number of rooms (1 - 20):&lt;/label&gt;                          <span class="fm-combinumeral">③</span>
        &lt;input type="number" id="rooms" name="rooms"       <span class="fm-combinumeral">④</span>
        min="1" max="20"&gt;                                  <span class="fm-combinumeral">⑤</span>
&lt;/p&gt;</pre>

  <p class="fm-code-annotation"><span class="fm-combinumeral">①</span> Label for the location field</p>

  <p class="fm-code-annotation"><span class="fm-combinumeral">②</span> Defines ID for location field</p>

  <p class="fm-code-annotation"><span class="fm-combinumeral">③</span> Defines label for rooms field</p>

  <p class="fm-code-annotation"><span class="fm-combinumeral">④</span> Defines ID for rooms field</p>

  <p class="fm-code-annotation"><span class="fm-combinumeral">⑤</span> Defines maximum and minimum values for the rooms field</p>

  <p class="body">Listing 10.4 shows examples of HTML definitions for a categorical field (<code class="fm-code-in-text">location</code>) and a continuous field (<code class="fm-code-in-text">rooms</code>). The HTML definitions for other fields follow the same pattern, with minimums and maximums set for all the continuous fields.</p>

  <p class="body">The <code class="fm-code-in-text">load-selections()</code> JavaScript function gets run when the page is loaded by the following statement near the beginning of the HTML page:<a id="idIndexMarker014"/></p>
  <pre class="programlisting">&lt;body onload="load_selections()"&gt;</pre>

  <p class="body">The following listing presents the key parts of the <code class="fm-code-in-text">load-selections()</code> JavaScript function, the function that sets up the page so it is ready for the user to select the characteristics of the property for which they want to get a<a id="idTextAnchor019"/><a id="marker-366"/> prediction.</p>

  <p class="fm-code-listing-caption">Listing 10.5 <code class="fm-code-in-text">load-selections()</code> JavaScript function</p>
  <pre class="programlisting">function load_selections(){
    // initialize all selections
    var select_location = 
document.getElementById("location");                        <span class="fm-combinumeral">①</span>
    var select_property_type = document.getElementById("property-type"); 
    var select_furnishing = document.getElementById("furnishing");
    var select_size_type = document.getElementById("size-type");
    var location_list = ["KLCC, Kuala Lumpur",..            <span class="fm-combinumeral">②</span>
    var property_type_list = 
["Serviced Residence","Bungalow",...                        <span class="fm-combinumeral">③</span>
    var furnishing_list = ["Fully Furnished","Partly Furnished",...;
    var size_type_list = ["Built-up" ,"Land area" ];        <span class="fm-combinumeral">④</span>
    document.getElementById("rooms").defaultValue  
= 1;                                                        <span class="fm-combinumeral">⑤</span>
    document.getElementById("bathrooms").defaultValue = 1;
    document.getElementById("car-parks").defaultValue = 0;
    document.getElementById("size").defaultValue = 500;
    // Populate location list:
    for(var i = 0; i &lt; location_list.length; i++) {         <span class="fm-combinumeral">⑥</span>
        var opt = location_list[i];
        select_location.innerHTML += 
"&lt;option value=\"" + opt + "\"&gt;" + opt + "&lt;/option&gt;";
        }
….
    };</pre>

  <p class="fm-code-annotation"><span class="fm-combinumeral">①</span> Defines identifier for the location field</p>

  <p class="fm-code-annotation"><span class="fm-combinumeral">②</span> Defines list containing values for the selection list in the location field</p>

  <p class="fm-code-annotation"><span class="fm-combinumeral">③</span> Defines list containing values for the selection list in the property type field</p>

  <p class="fm-code-annotation"><span class="fm-combinumeral">④</span> Defines list containing values for the selection list in the size type field</p>

  <p class="fm-code-annotation"><span class="fm-combinumeral">⑤</span> Sets the default value for the rooms field</p>

  <p class="fm-code-annotation"><span class="fm-combinumeral">⑥</span> Loops to populate the values in the selection list in the location field</p>

  <p class="body">From listing 10.5 we can see the main actions taken by the <code class="fm-code-in-text">load-selections()</code> JavaScript function:</p>

  <ul class="calibre5">
    <li class="fm-list-bullet">
      <p class="list">For continuous fields, set the default value. This is the value that appears in the field when the page is initially loaded and is passed along to the Flask server module if the user doesn’t change it.</p>
    </li>

    <li class="fm-list-bullet">
      <p class="list">For categorical fields, define the values from which the user can select and populate the field’s selection list with those values. In <code class="fm-code-in-text">home.html</code>, these values are defined in a hard-coded list. In a more robust web application, these values would be maintained in a control file separate from the code to make it easier to maintain the values and reduce the chance of adding regressions to the code.</p>
    </li>
  </ul>

  <p class="body">When the user has set the values they want for their property and clicks the Get Prediction button, the following code specifies that the <code class="fm-code-in-text">link_with_args()</code> JavaScript function gets run:<a id="idIndexMarker015"/><a id="marker-367"/></p>
  <pre class="programlisting">&lt;button&gt;
&lt;a onclick=
"link_with_args();" style="font-size : 20px; width: 100%; 
height: 100px;"&gt;Get prediction&lt;/a&gt;
&lt;/button&gt;</pre>

  <p class="body">Listing 10.6 shows the <code class="fm-code-in-text">link_with_args()</code> JavaScript function. This function is called when the user clicks the Get Prediction button in <code class="fm-code-in-text">home.html</code>. It invokes the rest of the code in <code class="fm-code-in-text">home.html</code>, which collects the user’s input values and packages them into a query string that is passed back to the <code class="fm-code-in-text">show_prediction()</code> view function in the <a id="idTextAnchor020"/>Flask module.</p>

  <p class="fm-code-listing-caption">Listing 10.6 <code class="fm-code-in-text">link_with_args()</code> JavaScript function</p>
  <pre class="programlisting">function link_with_args(){
    getOption();
    console.log("in link_with_args");
    console.log(window.output);                              <span class="fm-combinumeral">①</span>
    window.location.href = window.output;                    <span class="fm-combinumeral">②</span>
    }</pre>

  <p class="fm-code-annotation"><span class="fm-combinumeral">①</span> Echoes the query string to the console</p>

  <p class="fm-code-annotation"><span class="fm-combinumeral">②</span> Sets the page target</p>

  <p class="body">As listing 10.6 shows, the <code class="fm-code-in-text">link_with_args()</code> JavaScript function simply calls the <code class="fm-code-in-text">getOption()</code> function and sets the resulting query string as the target of the page in <code class="fm-code-in-text">window.output</code>.<a id="idIndexMarker016"/></p>

  <p class="body">Listing 10.7 shows the <code class="fm-code-in-text">getOption()</code> JavaScript function. This function loads all the values that the user has entered in <code class="fm-code-in-text">home.html</code> and packages them into a query string that is passed back to the <code class="fm-code-in-text">show_prediction()</code> view function in the<a id="idTextAnchor021"/> Flask module.</p>

  <p class="fm-code-listing-caption">Listing 10.7 <code class="fm-code-in-text">getOption()</code> JavaScript function</p>
  <pre class="programlisting">function getOption() { 
  selectElementlocation = 
document.querySelector('#location');                          <span class="fm-combinumeral">①</span>
  selectElementpropertytype = document.querySelector('#property-type');
  selectElementfurnishing = document.querySelector('#furnishing');
  selectElementsizetype = document.querySelector('#size-type');
  rooms_value = document.getElementById("rooms").value;       <span class="fm-combinumeral">②</span>
  bathrooms_value = document.getElementById("bathrooms").value;
  car_parks_value = document.getElementById("car-parks").value;
  size_value = document.getElementById("size").value;
  location_string = 
selectElementlocation.options\
[selectElementlocation.selectedIndex].value                   <span class="fm-combinumeral">③</span>
  property_type_string = 
selectElementpropertytype.\
options[selectElementpropertytype.selectedIndex].value
  furnishing_string = 
selectElementfurnishing.\
options[selectElementfurnishing.selectedIndex].value
  size_type_string = selectElementsizetype.\
options[selectElementsizetype.selectedIndex].value
  prefix = "/show-prediction/?"
  window.output = 
prefix.concat("location=",location_string,"&amp;rooms=",\
rooms_value,"&amp;property_type=",property_type_string,\
"&amp;furnishing=",furnishing_string,"&amp;size_type=
\",size_type_string,"&amp;bathrooms=\
",bathrooms_value,"&amp;car_parks=",car_parks_value,\
"&amp;size=",size_value);                                         <span class="fm-combinumeral">④</span>
  document.querySelector('.output').textContent = window.output; 
}</pre>

  <p class="fm-code-annotation"><span class="fm-combinumeral">①</span> Gets the selected entry in the selection list for the location field</p>

  <p class="fm-code-annotation"><span class="fm-combinumeral">②</span> Gets the value entered into the rooms field</p>

  <p class="fm-code-annotation"><span class="fm-combinumeral">③</span> Gets the value of the selected entry in the selection list for the location field</p>

  <p class="fm-code-annotation"><span class="fm-combinumeral">④</span> Sets the value of window.output to the query string</p>

  <p class="body">The <code class="fm-code-in-text">getOption()</code> JavaScript function shown in listing 10.7 performs the following actions:<a id="idIndexMarker017"/><a id="marker-368"/></p>

  <ul class="calibre5">
    <li class="fm-list-bullet">
      <p class="list">Loads the values from the continuous fields: <code class="fm-code-in-text">rooms</code>, <code class="fm-code-in-text">bathrooms</code>, <code class="fm-code-in-text">car-parks</code>, and <code class="fm-code-in-text">size</code>.</p>
    </li>

    <li class="fm-list-bullet">
      <p class="list">Loads the selected entries in the categorical fields: <code class="fm-code-in-text">location</code>, <code class="fm-code-in-text">property-type</code>, <code class="fm-code-in-text">furnishing</code>, and <code class="fm-code-in-text">size-type</code>.</p>
    </li>

    <li class="fm-list-bullet">
      <p class="list">Builds the query string. The query string looks as follows:</p>
    </li>
  </ul>
  <pre class="programlistinge">/show-prediction/?location=KLCC, Kuala Lumpur&amp;rooms=1
&amp;property_type=Serviced Residence&amp;furnishing=Fully Furnished
&amp;size_type=Built-up&amp;bathrooms=1&amp;car_parks=0&amp;size=500</pre>

  <p class="body">The query string consists of</p>

  <ul class="calibre5">
    <li class="fm-list-bullet">
      <p class="list">The URL <code class="fm-code-in-text">/show-prediction/</code>. Note that this URL matches the decorator that precedes the view function for <code class="fm-code-in-text">show-prediction</code> view function from the Flask server module shown in listing 10.3:</p>
    </li>
  </ul>
  <pre class="programlistinge">@app.route('/show-prediction/')</pre>

  <ul class="calibre5">
    <li class="fm-list-bullet">
      <p class="list"><code class="fm-code-in-text">?</code> to indicate the beginning of the query string.</p>
    </li>

    <li class="fm-list-bullet">
      <p class="list">A set of parameter and value pairs to indicate the values that have been set for each field in <code class="fm-code-in-text">home.html</code>, delineated by the separator <code class="fm-code-in-text">&amp;</code>. For example, the parameter and value pairs could look as follows:</p>
    </li>
  </ul>
  <pre class="programlistinge">location=KLCC, Kuala Lumpur
rooms=1
property_type=Serviced Residence
furnishing=Fully Furnished
size_type=Built-up
bathrooms=1
car_parks=0
size=500</pre>

  <p class="body">The query string is passed to the <code class="fm-code-in-text">show-prediction</code> view function in the Flask server module. As shown in listing 10.3, in that function, the query string is parsed to get the values entered in <code class="fm-code-in-text">home.html</code> for each feature, and those values are used to get a prediction <a id="idTextAnchor022"/>from the model.<a id="idIndexMarker018"/><a id="idIndexMarker019"/><a id="idIndexMarker020"/><a id="marker-369"/></p>

  <h3 class="fm-head1" id="heading_id_7">10.1.4 The show-prediction.html page</h3>

  <p class="body">Now that we have looked at the Flask server module and <code class="fm-code-in-text">home.html</code>, there is one more component of the web deployment to examine: <code class="fm-code-in-text">show-prediction.html</code>. This page displays the prediction that the model makes for the property that the user entered values for in <code class="fm-code-in-text">home.html</code> and has a button that takes the user back to <code class="fm-code-in-text">home.html</code>, where they can enter values for <a id="idTextAnchor023"/>another property. <a id="idIndexMarker021"/><a id="idIndexMarker022"/><a id="idIndexMarker023"/></p>

  <p class="fm-code-listing-caption">Listing 10.8 <code class="fm-code-in-text">show-prediction.html</code> </p>
  <pre class="programlisting">&lt;!DOCTYPE html&gt; 
&lt;head&gt; 
  &lt;title&gt; 
    Page for showing prediction                            <span class="fm-combinumeral">①</span>
  &lt;/title&gt; 
  &lt;link rel="stylesheet" href="{{ url_for('static', 
filename='css/main2.css') }}"&gt;                             <span class="fm-combinumeral">②</span>
&lt;/head&gt; 
 
&lt;body&gt; 
&lt;!-- display the prediction  --&gt;
&lt;div class="home"&gt;
    &lt;h1 style="color: green"&gt; 
        Here is the prediction for \
this Kuala Lumpur property:                                <span class="fm-combinumeral">③</span>
    &lt;/h1&gt; 
    &lt;h1 style="color: green"&gt; 
        {{ prediction.prediction_key }}
    &lt;/h1&gt;
 
&lt;!-- link back to home.html for entering 
scoring parameters for another prediction  --&gt;
    &lt;form action="{{ url_for('home') }}"&gt;
        &lt;input type="submit" 
value="Get another prediction" 
style="font-size : 20px; width: 40%; height: 30px;"/&gt;
    &lt;/form&gt;                                                <span class="fm-combinumeral">④</span>
 
&lt;/div&gt;
&lt;/body&gt;</pre>

  <p class="fm-code-annotation"><span class="fm-combinumeral">①</span> Sets the text that appears in the browser tab for this page</p>

  <p class="fm-code-annotation"><span class="fm-combinumeral">②</span> Sets the stylesheet for the page</p>

  <p class="fm-code-annotation"><span class="fm-combinumeral">③</span> Introductory text</p>

  <p class="fm-code-annotation"><span class="fm-combinumeral">④</span> Button to return to home.html</p>

  <p class="body">As shown in listing 10.8, <code class="fm-code-in-text">show-prediction.html</code> does not contain any JavaScript functions. The HTML for the page defines the text that appears on the page, and the button Get Another Prediction returns the user to <code class="fm-code-in-text">home.html</code>. Figure 10.4 shows how the elements we have discussed in this section appear in <code class="fm-code-in-text">sho<a class="calibre" id="idTextAnchor024"/>w-prediciton.html</code>.</p>

  <div class="figure">
    <p class="figure1"><img alt="" class="calibre4" src="../Images/CH10_F04_Ryan2.png"/></p>

    <p class="figurecaption">Figure 10.4 Key elements in <code class="fm-code-in-text">show-prediction.html</code> </p>
  </div>

  <p class="body"><a id="marker-370"/>Now that we have examined all the components of web deployment, we will review the rationale for deploying our model simply on the web <a id="idTextAnchor025"/>in the next section.</p>

  <h3 class="fm-head1" id="heading_id_8">10.1.5 Exercising the web deployment</h3>

  <p class="body">Now that we have gone through the components that make up the web deployment, the next step is to see the deployment in action. To exercise the web deployment,<a id="idIndexMarker024"/><a id="idIndexMarker025"/></p>

  <ol class="calibre7">
    <li class="fm-list-bullet">
      <p class="list">Create a new directory on your local system and clone the repo <a class="url" href="https://github.com/lmassaron/ml_on_tabular_data">https://github.com/lmassaron/ml_on_tabular_data</a>.</p>
    </li>

    <li class="fm-list-bullet">
      <p class="list">Make <code class="fm-code-in-text">chapter_10</code> your current directory and start the Flask server module:</p>
      <pre class="programlisting">python flask_endpoint_deploy.py</pre>
    </li>

    <li class="fm-list-bullet">
      <p class="list">Once the Flask server module is running, go to <code class="fm-code-in-text">localhost:5000</code> in a browser to exercise the deployment.</p>
    </li>
  </ol>

  <p class="body">Congratulations! You have exercised a deep learning model trained on tabular data in the context of a simple, local web application. This deployment is an efficient way for us to exercise the trained model and see if it behaves as we expect. However, this very basic deployment does not incorporate many of the characteristics we expect to have in a production deployment. For example, we don’t want the resources for serving the model to be limited by our local system. In the remainder of this chapter, we will examine how we can use this same web application to exercise the trained model deployed from an endpoint i<a id="idTextAnchor026"/>n a cloud environment.<a id="idIndexMarker026"/><a id="idIndexMarker027"/></p>

  <h2 class="fm-head" id="heading_id_9">10.2 Public clouds and machine learning operations</h2>

  <p class="body"><a id="marker-371"/>The simple web deployment that we reviewed in the previous section demonstrates some useful aspects of what it takes to put a trained model into production, but it has some serious limitations. It is running entirely on a local system, so it won’t be accessible to anyone who doesn’t have access to the local system. This is probably a good thing, because this deployment does not incorporate the characteristics that we want to have in a production deployment, including<a id="idIndexMarker028"/><a id="idIndexMarker029"/><a id="idIndexMarker030"/><a id="idIndexMarker031"/></p>

  <ul class="calibre5">
    <li class="fm-list-bullet">
      <p class="list"><i class="fm-italics">Scaling capacity to meet demand</i>. What happens if the interest rate drops and the demand for price predictions doubles?</p>
    </li>

    <li class="fm-list-bullet">
      <p class="list"><i class="fm-italics">Seamless model updates</i>. What if we retrain the model on the latest data and need to deploy it quickly, without any interruption to the service?</p>
    </li>

    <li class="fm-list-bullet">
      <p class="list"><i class="fm-italics">Serving multiple versions of the model at the same time</i>. What if we want to experiment with a version of the model that is trained on a different dataset by exposing the new model to a subset of the users? How do we serve multiple versions of the model and control what proportion of users see each version?</p>
    </li>

    <li class="fm-list-bullet">
      <p class="list"><i class="fm-italics">Model monitoring</i>. How do we track the accuracy of the model as the real estate market develops? How do we catch and correct problems before they impact our users?</p>
    </li>

    <li class="fm-list-bullet">
      <p class="list"><i class="fm-italics">Resiliency and up-time</i>. With this application implemented on a local system, what happens when the system needs maintenance or has an unplanned outage? How do we ensure that our users can continue to get access to the application?</p>
    </li>
  </ul>

  <p class="body">We could implement custom code to handle all of these scenarios, but there is a simpler solution. Public clouds provide complete, end-to-end machine learning and machine learning operations (MLOps) environments to address all the challenges listed here. The three most-used public clouds in the world are<a id="idIndexMarker032"/></p>

  <ul class="calibre5">
    <li class="fm-list-bullet">
      <p class="list">AWS</p>
    </li>

    <li class="fm-list-bullet">
      <p class="list">Azure</p>
    </li>

    <li class="fm-list-bullet">
      <p class="list">Google Cloud</p>
    </li>
  </ul>

  <p class="body">Many organizations will use one or more of these public clouds to put their models into production.</p>

  <p class="body">The public cloud concepts that we describe in this chapter and chapter 11 are available in all three of these public clouds, but we are going to use Google Cloud for the public cloud examples in this chapter. There are a few reasons for this. One of the authors is a Google employee, but, more importantly, our objective opinion is that Google Cloud provides an easy-to-use environment for deploying models trained with tabular data and exploring the key concepts of MLOps. In the remainder of this chapter, we will go through how to get started with Google Cloud and how to use it to deploy a model. In chapter 11, we will go beyond the simple deployment in this chapter to explore the features in Google Cloud that make it easy to re<a id="idTextAnchor027"/>train and redeploy the model.</p>

  <h2 class="fm-head" id="heading_id_10">10.3 Getting started with Google Cloud</h2>

  <p class="body">In this section, we will go through the initial steps of getting started with Google Cloud, including accessing Google Cloud for the first time, creating a project, and creating a Google Cloud Storage bucket, a data storage container. In the subsequent section, we will see how to use Vertex AI, the machine learning platform in Googl<a id="idTextAnchor028"/>e Cloud, to deploy our model.<a id="marker-372"/><a id="idIndexMarker033"/></p>

  <h3 class="fm-head1" id="heading_id_11">10.3.1 Accessing Google Cloud for the first time</h3>

  <p class="body">In this section, we will go through signing into Google Cloud for the first time and setting up a Google Cloud <i class="fm-italics">project</i>. Everything you do in Google Cloud is associated with a project. You can use projects to organize your work and to control the teams and individuals who have access to given Google Cloud resources. To get started, go to <a class="url" href="https://cloud.google.com">https://cloud.google.com</a> and click Sign I<a id="idTextAnchor029"/>n, as shown in figure 10.5.<a id="idIndexMarker034"/><a id="idIndexMarker035"/></p>

  <div class="figure">
    <p class="figure1"><img alt="" class="calibre4" src="../Images/CH10_F05_Ryan2.png"/></p>

    <p class="figurecaption">Figure 10.5 Signing into Google Cloud</p>
  </div>

  <p class="body">Once you have signed in, click Console to open up the Google Cloud conso<a id="idTextAnchor030"/>le, as shown in figure 10.6.</p>

  <p class="body">If you have not used Google Cloud before, you will need to set up your account for billing. You may be eligible for free credit, but you will need to enter credit card details to use the features that are described in this chapter and chapter 11. Once you have signed in and, if necessary, completed setting up your account with billing details, you will be at the consol<a id="idTextAnchor031"/>e, as shown in figure 10.7.</p>

  <div class="figure">
    <p class="figure1"><img alt="" class="calibre4" src="../Images/CH10_F06_Ryan2.png"/></p>

    <p class="figurecaption">Figure 10.6 Entering the Google Cloud console</p>
  </div>

  <div class="figure">
    <p class="figure1"><img alt="" class="calibre4" src="../Images/CH10_F07_Ryan2.png"/></p>

    <p class="figurecaption">Figure 10.7 Google Cloud console</p>
  </div>

  <p class="body"><a id="marker-373"/>The console is the user interface for Google Cloud. This is one of the interface choices for working with Google Cloud features, and it is what we will use for most of the actions we will take in Google Cloud in this chapter. In addition to the Cloud console, you can interact with Google Cloud features using</p>

  <ul class="calibre5">
    <li class="fm-list-bullet">
      <p class="list">Command-line interface</p>
    </li>

    <li class="fm-list-bullet">
      <p class="list">Client libraries</p>
    </li>
  </ul>

  <p class="fm-callout"><span class="fm-callout-head">NOTE</span> See <a class="url" href="https://cloud.google.com/docs/overview">https://cloud.google.com/docs/overview</a> for more details on the <a id="idTextAnchor032"/>interfaces for Google Cloud.</p>

  <h3 class="fm-head1" id="heading_id_12">10.3.2 Creating a Google Cloud project</h3>

  <p class="body">You can create a project once you have successfully logged into Google Cloud and accessed the Google Cloud Console. In this section, we will go through the steps to create a project. <a id="idIndexMarker036"/><a id="idIndexMarker037"/><a id="marker-374"/></p>

  <p class="body">In the Google Cloud console, click the Project Selection field, as shown in figure 10.8. In the Select a Project screen, select New Project, as shown in figure 10.9. Then, enter <code class="fm-code-in-text">first-project-ml-tabular</code> in the Project Name field and click on Creat<a id="idTextAnchor033"/>e, as shown in figure 10.10.</p>

  <div class="figure">
    <p class="figure1"><img alt="" class="calibre4" src="../Images/CH10_F08_Ryan2.png"/></p>

    <p class="figurecaption">Figu<a id="idTextAnchor034"/>re 10.8 Selecting a project</p>
  </div>

  <div class="figure">
    <p class="figure1"><img alt="" class="calibre4" src="../Images/CH10_F09_Ryan2.png"/></p>

    <p class="figurecaption">Figure 10.9 Selecting a project screen</p>
  </div>

  <div class="figure">
    <p class="figure1"><img alt="" class="calibre4" src="../Images/CH10_F10_Ryan2.png"/></p>

    <p class="figurecaption">Figure 10.10 Entering a project name</p>
  </div>

  <p class="body">Congratulations! You have created your first Google Cloud project.</p>

  <p class="body">Note that the project name needs to be unique for your set of projects. The project ID, which appears below the Project name field, must be universally unique, so if you have a project name that is shared with any other project in Google Cloud, the project ID for that project will be automat<a id="idTextAnchor035"/>ically updated to be unique.</p>

  <h3 class="fm-head1" id="heading_id_13">10.3.3 Creating a Google Cloud Storage bucket</h3>

  <p class="body">The primary way to store data in Google Cloud is to use Cloud Storage buckets. In this section, we will go through just what you need to know about Cloud Storage buckets for the purposes of deploying a model. If you are interested in more details on Cloud Storage buckets, see the documentation: <a class="url" href="https://cloud.google.com/storage/docs/buckets">https://cloud.google.com/storage/docs/buckets</a>. We will be using a bucket to store the model we trained in chapter 9. To create a Cloud Storage bucket, enter “cloud storage” in the search bar in the Cloud Console and select Cloud Storage, <a id="idTextAnchor036"/>as shown in figure 10.11.<a id="idIndexMarker038"/><a id="idIndexMarker039"/><a id="idIndexMarker040"/><a id="marker-375"/></p>

  <div class="figure">
    <p class="figure1"><img alt="" class="calibre4" src="../Images/CH10_F11_Ryan2.png"/></p>

    <p class="figurecaption">Figure 10.11 Searching for Cloud Storage</p>
  </div>

  <p class="body">The Cloud Storage Buckets page appears. Select Create to create a new Cloud Storage bucket<a id="idTextAnchor037"/>, as shown in figure 10.12.</p>

  <div class="figure">
    <p class="figure1"><img alt="" class="calibre4" src="../Images/CH10_F12_Ryan2.png"/></p>

    <p class="figurecaption">Figure 10.12 Cloud Storage view</p>
  </div>

  <p class="body">In the Create a bucket page, enter a unique name for your bucket (figure 10.13), click Continue, and select Region in Location Type, and select a region, as shown in figure 10.14. To work with the machine learning pipeline script code that we will explore in chapter 11, the bucket needs to be created in a region. For the purposes of this example, you can pick any region that you like. Click Create. Note that your bucket name has<a id="idTextAnchor038"/> to be universally unique.</p>

  <div class="figure">
    <p class="figure1"><img alt="" class="calibre4" src="../Images/CH10_F13_Ryan2.png"/></p>

    <p class="figurecaption">Figure 10.1<a id="idTextAnchor039"/>3 Setting the bucket name</p>
  </div>

  <div class="figure">
    <p class="figure1"><img alt="" class="calibre4" src="../Images/CH10_F14_Ryan2.png"/></p>

    <p class="figurecaption">Figure 10.14 Setting location type for the bucket</p>
  </div>

  <p class="body">The Bucket details page appears, showing your new bucket, a<a id="idTextAnchor040"/>s shown in figure 10.15.</p>

  <div class="figure">
    <p class="figure1"><img alt="" class="calibre4" src="../Images/CH10_F15_Ryan2.png"/></p>

    <p class="figurecaption">Figure 10.15 Bucket details showing the new bucket</p>
  </div>

  <p class="body">Congratulations! You have created your first Go<a id="idTextAnchor041"/>ogle Cloud Storage bucket.<a id="idIndexMarker041"/><a id="marker-376"/></p>

  <h2 class="fm-head" id="heading_id_14">10.4 Deploying a model in Vertex AI</h2>

  <p class="body">Earlier in this chapter, we deployed the Kuala Lumpur real estate price prediction model using a simple, Flask-based web application. In this section, we are going to deploy the same model using the Google Cloud Vertex AI environment. <a id="idIndexMarker042"/><a id="idIndexMarker043"/></p>

  <p class="body">Now that we have created a project in Google Cloud and created a Cloud Storage bucket in the new project, we are ready to deploy a model in Google Cloud. The following are the steps we will follow for this deployment (described in more detail in the Vertex AI documentation at <a class="url" href="https://mng.bz/nRJ2">https://mng.bz/nRJ2</a>):</p>

  <ol class="calibre7">
    <li class="fm-list-bullet">
      <p class="list">Upload the model we trained in chapter 9 to Google Cloud storage.</p>
    </li>

    <li class="fm-list-bullet">
      <p class="list">Import the model to the Vertex AI Model Registry.</p>
    </li>
  </ol>

  <p class="body">The following sections <a id="idTextAnchor042"/>describe each of these steps.</p>

  <h3 class="fm-head1" id="heading_id_15">10.4.1 Uploading the model to a Cloud Storage bucket</h3>

  <p class="body">The simplest way to get your trained model into Google Cloud Storage is to upload a folder containing the trained model. If you want to upload a version of the model that has already been trained, clone the repo at <a class="url" href="https://github.com/lmassaron/Advanced_Analytics_for_Business">https://github.com/lmassaron/Advanced_Analytics_for_Business</a>. The directory you want to upload is <code class="fm-code-in-text">chapter_10/models/kl_real_estate_keras_preprocessing_model</code>. <a id="idIndexMarker044"/><a id="marker-377"/><a id="idIndexMarker045"/></p>

  <p class="body">To upload the model that you created in chapter 9, select the Cloud Storage bucket you created in the Cloud Storage page, as shown in figure 10.16. In the Bucket Details page, select Upload Folder,<a id="idTextAnchor043"/> as shown in figure 10.17.</p>

  <div class="figure">
    <p class="figure1"><img alt="" class="calibre4" src="../Images/CH10_F16_Ryan2.png"/></p>

    <p class="figurecaption">Figure 10.16 Selecting your bucke<a id="idTextAnchor044"/>t in the Cloud Storage page</p>
  </div>

  <div class="figure">
    <p class="figure1"><img alt="" class="calibre4" src="../Images/CH10_F17_Ryan2.png"/></p>

    <p class="figurecaption">Figure 10.17 Uploading a folder in the Bucket details page</p>
  </div>

  <p class="body">Select the folder on your local system containing the trained model from chapter 9. When the upload is complete, the folder will appear on the Bucket details page,<a id="idTextAnchor045"/> as shown in figure 10.18.</p>

  <div class="figure">
    <p class="figure1"><img alt="" class="calibre4" src="../Images/CH10_F18_Ryan2.png"/></p>

    <p class="figurecaption">Figure 10.18 Your uploaded bucket in the Bucket details page</p>
  </div>

  <p class="body">Congratulations! You have uploaded<a id="idTextAnchor046"/> your model to Google Cloud.</p>

  <h3 class="fm-head1" id="heading_id_16">10.4.2 Importing the model to Vertex AI</h3>

  <p class="body">Now that we have uploaded the model to a Google Cloud Storage bucket, we can import it to the Vertex AI Model Registry. Enter “vertex ai” in the Google Cloud console search bar to get to the Vertex AI page. If this is the first time you have used Vertex AI, you will see Enable All Recommended API. If you see this button, click on it to enable the APIs that are required to use Vertex AI, a<a id="idTextAnchor047"/>s shown in figure 10.19. <a id="idIndexMarker046"/><a id="marker-378"/><a id="idIndexMarker047"/></p>

  <div class="figure">
    <p class="figure1"><img alt="" class="calibre4" src="../Images/CH10_F19_Ryan2.png"/></p>

    <p class="figurecaption">Figure 10.19 Enabling Vertex AI APIs</p>
  </div>

  <p class="body">Then select Model Registry in the left navigation panel, as shown in figure 10.20, and on the Model Registry page, click Import,<a id="idTextAnchor048"/> as shown in figure 10.21.</p>

  <div class="figure">
    <p class="figure1"><img alt="" class="calibre4" src="../Images/CH10_F20_Ryan2.png"/></p>

    <p class="figurecaption">Figure 10.20 Model Registry in the Vertex<a id="idTextAnchor049"/><a id="marker-379"/> AI page navigation panel</p>
  </div>

  <div class="figure">
    <p class="figure1"><img alt="" class="calibre4" src="../Images/CH10_F21_Ryan2.png"/></p>

    <p class="figurecaption">Figure 10.21 Model Registry import</p>
  </div>

  <p class="body">In the Import model page, select Import as New Model, enter “first-model-ml-tabular” in the Name field, and click Continue, a<a id="idTextAnchor050"/>s shown in figure 10.22.</p>

  <div class="figure">
    <p class="figure1"><img alt="" class="calibre4" src="../Images/CH10_F22_Ryan2.png"/></p>

    <p class="figurecaption">Figure 10.22 Specifying the name of the imported model in Model Registry</p>
  </div>

  <p class="body">On the Model settings tab of the Import model page, follow these steps:</p>

  <ol class="calibre7">
    <li class="fm-list-bullet">
      <p class="list">In Model Framework, select TensorFlow. Recall from chapter 8 TensorFlow is the low-level framework for Keras, the framework we used to train the model.</p>
    </li>

    <li class="fm-list-bullet">
      <p class="list">In Model Framework Version, select the TensorFlow level used to train the model. You can find this level from the output of <code class="fm-code-in-text">tf.__version__</code> in the notebook used to train the model:</p>
      <pre class="programlisting">tf.__version__ 
2.9.2</pre>
    </li>

    <li class="fm-list-bullet">
      <p class="list">In Model Artifact Location, click Browse and select the folder where you uploaded the model.</p>
    </li>

    <li class="fm-list-bullet">
      <p class="list">Click Continue and Import, as<a id="idTextAnchor051"/> shown in figure 10.23.</p>
    </li>
  </ol>

  <div class="figure">
    <p class="figure1"><img alt="" class="calibre4" src="../Images/CH10_F23_Ryan2.png"/></p>

    <p class="figurecaption">Figure 10.23 Specifying model settings</p>
  </div>

  <p class="body"><a id="marker-380"/>The model import process may take several minutes to complete. When the import is complete, you will see the new model name on the Model Registry page, as <a id="idTextAnchor052"/>shown in figure 10.24.</p>

  <div class="figure">
    <p class="figure1"><img alt="" class="calibre4" src="../Images/CH10_F24_Ryan2.png"/></p>

    <p class="figurecaption">Figure 10.24 Model Registry showing the imported model</p>
  </div>

  <p class="body">Congratulations! You have imported a model into Vertex AI. In the next section, we will go through the steps to make this model availa<a id="idTextAnchor053"/>ble through an endpoint.</p>

  <h3 class="fm-head1" id="heading_id_17">10.4.3 Deploying the model to an endpoint</h3>

  <p class="body">Now that we have imported the trained model into Vertex AI, we can deploy it to an endpoint. By deploying the model to an endpoint, we get a URL that we can use to invoke the model. In effect, the endpoint deployment can take the place of the model file in the local file system that the Flask server loaded in the simple web deployment that we did earlier in this chapter.<a id="idIndexMarker048"/><a id="marker-381"/><a id="idIndexMarker049"/></p>

  <p class="body">To deploy the model to an endpoint, on the Model Registry page, select the model we created in the previous section. In the model details page, select the version of the model (by default, 1), as shown in figure 10.25. In the version page for the model, click Deploy to Endpoint, as shown in figure 10.26. In the Deploy to Endpoint page, enter a name in Endpoint name and click Continue, as<a id="idTextAnchor054"/> shown in figure 10.27.</p>

  <div class="figure">
    <p class="figure1"><img alt="" class="calibre4" src="../Images/CH10_F25_Ryan2.png"/></p>

    <p class="figurecaption">Figure 10<a id="idTextAnchor055"/>.25 Model details page</p>
  </div>

  <div class="figure">
    <p class="figure1"><img alt="" class="calibre4" src="../Images/CH10_F26_Ryan2.png"/></p>

    <p class="figurecaption">Figure 10.26 Deploying your model</p>
  </div>

  <div class="figure">
    <p class="figure1"><img alt="" class="calibre4" src="../Images/CH10_F27_Ryan2.png"/></p>

    <p class="figurecaption">Figure 10.27 Deploying to endpoint page</p>
  </div>

  <p class="body"><a id="marker-382"/>In the Model Settings tab, under Advanced Scaling Options, select a minimal machine type, such as <code class="fm-code-in-text">n1-standard-2</code>, as shown in figure 10.28,<a id="idTextAnchor056"/> and click Continue.</p>

  <div class="figure">
    <p class="figure1"><img alt="" class="calibre4" src="../Images/CH10_F28_Ryan2.png"/></p>

    <p class="figurecaption">Figure 10.28 Setting the machine type for the deployment</p>
  </div>

  <p class="body">Because this is a test deployment of a simple model, we only need a minimal machine type. If we were deploying a more demanding model, or making a production deployment, we could choose a machine type with more memory or compute resources, depending on the requirements of our model. A minimal machine type is good enough for our test deployment, and it will cost us less than a more advanced machine type. When you are using a cloud environment, it’s a best practice to use the resources that are sufficient for your application and not more. Doing this will save you money.</p>

  <p class="fm-callout"><span class="fm-callout-head">TIP</span> For more details about machine types for Vertex AI endpoint deployments, see the documentation at <a class="url" href="https://mng.bz/vK14">https://mng.bz/vK14</a>.</p>

  <p class="body"><a id="marker-383"/>Click Deploy, as sho<a id="idTextAnchor057"/>wn in figure 10.29.</p>

  <div class="figure">
    <p class="figure1"><img alt="" class="calibre4" src="../Images/CH10_F29_Ryan2.png"/></p>

    <p class="figurecaption">Figure 10.29 Selecting Deploy in the Deploy to endpoint page</p>
  </div>

  <p class="body">Deployment can take several minutes to complete. When deployment is complete, the status of the deployment on the Model version details page changes to Active, as show<a id="idTextAnchor058"/>n in figure 10.30.</p>

  <div class="figure">
    <p class="figure1"><img alt="" class="calibre4" src="../Images/CH10_F30_Ryan2.png"/></p>

    <p class="figurecaption">Figure 10.30 Confirmation that the model has been deployed</p>
  </div>

  <p class="body">Congratulations! You have completed the deployment of a model in Vertex AI. In the next section, we will go through the steps to quickly <a id="idTextAnchor059"/>test the deployment.</p>

  <h3 class="fm-head1" id="heading_id_18">10.4.4 Initial test of the model deployment</h3>

  <p class="body">Now that we have deployed the model, we can do an initial test of the model deployment directly in the Google console. <a id="idIndexMarker050"/><a id="marker-384"/><a id="idIndexMarker051"/></p>

  <p class="body">Recall the test of the trained model that we did in chapter 9 to exercise the model in the context of a Jupyter Notebook. We defined a Python dictionary that contained all the features used to train the model, along with values for each of the features:</p>
  <pre class="programlisting">sample = {
    'location': 'Sentul, Kuala Lumpur',
    'rooms': 3.0,
    'property_type': 'Condominium For Sale',
    'furnishing': 'Partly Furnished',
    'size_type_bin': 'built-up 1',
    'bathrooms': 2.0,
    'car_parks': 0.0,
    'size': 950.0,
}</pre>

  <p class="body">We can reuse this sample to test the model deployment in Vertex AI. In the Model version details page, go to the Test Your Model section, as sho<a id="idTextAnchor060"/>wn in figure 10.31.</p>

  <div class="figure">
    <p class="figure1"><img alt="" class="calibre4" src="../Images/CH10_F31_Ryan2.png"/></p>

    <p class="figurecaption">Figure 10.31 Test Your Model section of the Deploy and Test tab</p>
  </div>

  <p class="body">Update the JSON request field to use the values from the sample from chapter 9, with each value being an entry in a list and double quotes being used throughout. When you have completed the update, the JSON request field should look <a id="idTextAnchor061"/>like figure 10.32.</p>

  <div class="figure">
    <p class="figure1"><img alt="" class="calibre4" src="../Images/CH10_F32_Ryan2.png"/></p>

    <p class="figurecaption">Figure 10.32 Test sample in JSON format</p>
  </div>

  <p class="body"><a id="marker-385"/>Note three differences between the format of the sample in the JSON request and the original sample from the chapter 9 Jupyter Notebook:</p>

  <ul class="calibre5">
    <li class="fm-list-bullet">
      <p class="list">Values in the key-value pairs are all arrays rather than single values. You will get an error if you have single values.</p>
    </li>

    <li class="fm-list-bullet">
      <p class="list">Double quotes (“ “) are used throughout rather than single quotes.</p>
    </li>

    <li class="fm-list-bullet">
      <p class="list">There is no comma after the last key-value pair.</p>
    </li>
  </ul>

  <p class="body">Once the JSON Request field contains valid JSON, the frame turns blue. Click Predict to see the output of the endpoint in the Response field, as shown<a id="idTextAnchor062"/> in figure 10.33.</p>

  <div class="figure">
    <p class="figure1"><img alt="" class="calibre4" src="../Images/CH10_F33_Ryan2.png"/></p>

    <p class="figurecaption">Figure 10.33 Response from the endpoint for the test sample</p>
  </div>

  <p class="body">Note that the prediction value is not a probability. Recall that when we got a prediction from the model in the model training notebook in chapter 9, and when we got a prediction from the model in the Flask server module, we needed to apply the sigmoid function to the output of the model to get the probability that the property has a price above the median:</p>
  <pre class="programlisting">predictions = loaded_model.predict(input_dict)
prob = tf.nn.sigmoid(predictions[0])</pre>

  <p class="body">We need to apply the sigmoid function to get the probability from the output provided by the endpoint. If we update the statements that we used in the training notebook so that the input to the sigmoid function is the output of the endpoint, then we get the same probability that we got for this property when we used it to exercise the model in chapter 9:</p>
  <pre class="programlisting">prob2 = tf.nn.sigmoid(-1.52191401)
print(
    "This property has a %.1f percent probability of "
    "having a price over the median." % (100 * prob2)
)
This property has a 17.9 percent probability 
of having a price over the median.</pre>

  <p class="body">Now, having validated that the endpoint works and that for the same property, we get the same results as when we applied the <a id="idTextAnchor063"/>model directly in <a id="idTextAnchor064"/>a Jupyter Notebook.<a id="idIndexMarker052"/><a id="idIndexMarker053"/></p>

  <h2 class="fm-head" id="heading_id_19">10.5 Using the Vertex AI deployment with Flask</h2>

  <p class="body"><a id="marker-386"/>In the previous section, we deployed the Kuala Lumpur property price prediction model to an endpoint in Vertex AI. In this section, we will adapt the Flask web deployment to use this endpoint. When we are done, we should have the same experience from the web pages <code class="fm-code-in-text">home.html</code> and <code class="fm-code-in-text">show-prediction.html</code>, with the model being served from the Vertex AI endpoint rather than from a local system.<a id="idIndexMarker054"/><a id="idIndexMarker055"/></p>

  <p class="body">To adapt the Flask deployment to work with the Vertex AI endpoint deployment, we will need to take the following steps:</p>

  <ol class="calibre7">
    <li class="fm-list-bullet">
      <p class="list">Set up the Vertex AI SDK.</p>
    </li>

    <li class="fm-list-bullet">
      <p class="list">Update the Flask server module to access the Vertex AI endpoint to get predictions from the model served there.</p>
    </li>
  </ol>

  <p class="body">Figure 10.34 shows the key components of the application that is adapted to use a Vertex AI endpoint depl<a id="idTextAnchor065"/>oyment of the model.</p>

  <p class="body">In the remainder of this section, we will go through the steps required to deploy the model with the Vertex AI endpoint usin<a id="idTextAnchor066"/>g the web application.</p>

  <div class="figure">
    <p class="figure1"><img alt="" class="calibre4" src="../Images/CH10_F34_Ryan2.png"/></p>

    <p class="figurecaption">Figure 10.34 Sample request link in the Deploy and Test tab</p>
  </div>

  <h3 class="fm-head1" id="heading_id_20">10.5.1 Setting up the Vertex AI SDK</h3>

  <p class="body">Vertex AI provides client libraries that allow you to access Vertex AI features via an API in Python, Java, and <code class="fm-code-in-text">node.js</code> applications. The client library for Python is included in the Python SDK for Vertex AI, so we will install the SDK to get the API access required to invoke the model via the endpoint. <a id="idIndexMarker056"/><a id="idIndexMarker057"/><a id="marker-387"/></p>

  <p class="fm-callout"><span class="fm-callout-head">NOTE</span> For full details on the Vertex AI SDK, see the documentation at <a class="url" href="https://mng.bz/4a1j">https://mng.bz/4a1j</a>.</p>

  <p class="body">You can use the following command to install the Vertex AI SDK:</p>
  <pre class="programlisting">pip install google-cloud-aiplatform</pre>

  <p class="body">Now that we have the Vertex AI SDK installed, we can proceed to the next step: updating <a id="idTextAnchor067"/>the Flask server module.</p>

  <h3 class="fm-head1" id="heading_id_21">10.5.2 Updating the Flask server module to call the endpoint</h3>

  <p class="body">To get an overview of how to use the Vertex AI API to access the model via the endpoint, click the Sample Request link in the Model version details page, as s<a id="idTextAnchor068"/>hown in figure 10.35.<a id="idIndexMarker058"/><a id="idIndexMarker059"/><a id="idIndexMarker060"/></p>

  <div class="figure">
    <p class="figure1"><img alt="" class="calibre4" src="../Images/CH10_F35_Ryan2.png"/></p>

    <p class="figurecaption">Figure 10.35 Sample request link in the Deploy and Test tab</p>
  </div>

  <p class="body">The first update to the Flask server module is to import the libraries required for Vertex AI:</p>
  <pre class="programlisting">from typing import Dict, List, Union
from google.cloud import aiplatform
from google.protobuf import json_format
from google.protobuf.struct_pb2 import Value</pre>

  <p class="body">Next, we add the <code class="fm-code-in-text">predict_custom_trained_model_sample()</code> function defined in <a class="url" href="https://mng.bz/QD8v">https://mng.bz/QD8v</a>. We need to make one update to this function so that it returns <code class="fm-code-in-text">predictions</code> (which contains the response from the endpoint) back to the <code class="fm-code-in-text">show-prediction.html</code> view function.</p>

  <p class="body">Listing 10.9 highlights the updates that we need to make to the <code class="fm-code-in-text">show-prediction.html</code> view function. These changes package the input values in the format expected by the Vertex AI endpoint deployment and invoke the model at the Vertex AI endpoint via the <code class="fm-code-in-text">predict_custom_traine<a class="calibre" id="idTextAnchor069"/>d_model_sample()</code> function.<a id="idIndexMarker061"/><a id="marker-388"/></p>

  <p class="fm-code-listing-caption">Listing 10.9 <code class="fm-code-in-text">show-prediction.html</code> view function for endpoints</p>
  <pre class="programlisting">def show_prediction():
    scoring_dict = {}
    for col in config['scoring_columns_cat']:
        print("value for "+col+" is: "+str(request.args.get(col))) 
        scoring_dict[col] = str(request.args.get(col))
    for col in config['scoring_columns_cont']:
        scoring_dict[col] = float(request.args.get(col))
    scoring_dict['size_type_bin'] = str(request.args.get('size_type'))+' 1'
    scoring_dict.pop('size_type')                            <span class="fm-combinumeral">①</span>
    input_dict = {name: [value] for name, \
value in scoring_dict.items()}                               <span class="fm-combinumeral">②</span>
    print("input_dict: ",input_dict)
    predictions = predict_custom_trained_model_sample(
    project = config['endpoint']['project'],
    endpoint_id = config['endpoint']['endpoint_id'],
    location = config['endpoint']['location'],
    instances = input_dict)                                  <span class="fm-combinumeral">③</span>
    prob = tf.nn.sigmoid(predictions[0])</pre>

  <p class="fm-code-annotation"><span class="fm-combinumeral">①</span> Removes size_type from the feature list</p>

  <p class="fm-code-annotation"><span class="fm-combinumeral">②</span> Converts the values in the scoring_dict to lists of values</p>

  <p class="fm-code-annotation"><span class="fm-combinumeral">③</span> Calls predict_custom_trained_model_sample</p>

  <p class="body">Listing 10.9 shows the following updates to the <code class="fm-code-in-text">show-prediction.html</code> view function:</p>

  <ul class="calibre5">
    <li class="fm-list-bullet">
      <p class="list">The call to the endpoint has to have the exact correct list of features and values, with no missing features or extra features. Since we don’t use <code class="fm-code-in-text">size_type</code> directly with the model, we need to explicitly remove it from the dictionary of features and values with the <code class="fm-code-in-text">scoring_dict.pop('size_type')</code> statement.</p>
    </li>

    <li class="fm-list-bullet">
      <p class="list">The endpoint expects to get the features and values in a dictionary with the same format as the JSON that we used to exercise the endpoint directly in the console in section 10.4.4. That means the values in the dictionary need to be converted to lists of values, each of which contains exactly one value. This statement converts the dictionary to lists of values:</p>
    </li>
  </ul>
  <pre class="programlistinge">input_dict = {name: [value] for name, value in scoring_dict.items()}</pre>

  <ul class="calibre5">
    <li class="fm-list-bullet">
      <p class="list">The <code class="fm-code-in-text">predict_custom_trained_model_sample()</code> function needs to be called with parameters specifying the project, endpoint, and key-value pairs for the features we want a prediction for.</p>
    </li>
  </ul>

  <p class="body"><a id="marker-389"/>In addition to these updates to the Flask server module, we can also remove the statements that loaded the model from the local file system since we don’t use the local model in this solution.</p>

  <p class="fm-callout"><span class="fm-callout-head">NOTE</span> An updated version of the Flask server module that uses the endpoint is available at <a class="url" href="https://mng.bz/Xx5a">https://mng.bz/Xx5a</a>.</p>

  <p class="body">To run this version of the Flask server module, follow these steps:</p>

  <p class="body-dialog">   1.  Authorize the account you used to access Google Cloud with this application by running the following command on the command line in the local system where you are running the Flask server module:</p>
  <pre class="programlistinge">gcloud auth application-default login</pre>

  <p class="body-dialog">   2.  Start the Flask server module:</p>
  <pre class="programlistinge">python flask_endpoint_deploy.py</pre>

  <p class="body-ind">If you get an error related to the protobuf (protocol buffer) level, try the following command:</p>
  <pre class="programlistinge">pip install protobuf==3.20.*n</pre>

  <p class="body-ind">This command adjusts the protobuf level to exactly what the endpoint requires.</p>

  <p class="fm-calloute"><span class="fm-callout-head">NOTE</span> You don’t need to know about the protobufs for the purposes of this application, but if you are curious, you can check out the documentation: <a class="url" href="https://protobuf.dev/">https://protobuf.dev/</a>.</p>

  <p class="body-dialog">   3.  Once the Flask server module is running, go to <code class="fm-code-in-text">localhost:5000</code> in a browser to exercise the deployment.</p>

  <p class="body">Now we have seen two kinds of deployments of the model: a web deployment run entirely from a local system and a web deployment that uses the model served<a id="idTextAnchor070"/> from a Vertex AI endpoint.<a id="idIndexMarker062"/><a id="idIndexMarker063"/><a id="idIndexMarker064"/></p>

  <h3 class="fm-head1" id="heading_id_22">10.5.3 Benefits of deploying a model to an endpoint</h3>

  <p class="body">If we get the same results from the model whether it is deployed in a simple web deployment or deployed to an endpoint, you may ask what the point is of deploying the model to an endpoint. There are a number of benefits that come from deploying to an endpoint:<a id="idIndexMarker065"/><a id="idIndexMarker066"/><a id="marker-390"/><a id="idIndexMarker067"/></p>

  <ul class="calibre5">
    <li class="fm-list-bullet">
      <p class="list">You can scale the endpoint instance to handle additional load.</p>
    </li>

    <li class="fm-list-bullet">
      <p class="list">You can deploy multiple models to the same endpoint. Imagine a situation where you need to replace one model in production with another. If you deploy both models to the same endpoint, you can gradually adjust how much of the traffic goes to the new model without making any changes to the application and without causing jarring changes to the users of the application.</p>
    </li>

    <li class="fm-list-bullet">
      <p class="list">You can deploy the same model to different endpoints, allowing you to optimize the machine resources. For example, if you have a production and a development environment, you can deploy the same model to two endpoints, with higher-spec machine resources for the production environment and cheaper machine resources for the development environment.</p>
    </li>

    <li class="fm-list-bullet">
      <p class="list">With an endpoint, you can enable Vertex AI monitoring to detect skew (differences in the distribution between training data and the data seen applying the model in production) and drift (changes in the distribution of data seen by the model in production over time). Model monitoring can help to ensure that the model’s performance does not degrade over time and that changes in the data the model is being applied to in production do not occur unexpectedly. For more details on monitoring, see the documentation at <a class="url" href="https://mng.bz/yWdd">https://mng.bz/yWdd</a>.</p>
    </li>
  </ul>

  <p class="body">Figure 10.36 shows examples of multiple models deployed to the same endpoint and one model d<a id="idTextAnchor071"/>eployed to multiple endpoints.</p>

  <p class="body">In figure 10.36, there are two scenarios:</p>

  <ul class="calibre5">
    <li class="fm-list-bullet">
      <p class="list"><i class="fm-italics">Multiple models are deployed to the same endpoint</i>—Model A is the version currently in production, and Model B is the next level of the model that we want to introduce to production. By adjusting the values of X and Y, we can control the proportion of traffic that goes to each model, gradually increasing the proportion that goes to the new level of the model.</p>
    </li>

    <li class="fm-list-bullet">
      <p class="list"><i class="fm-italics">Same model deployed to multiple endpoints</i>—Endpoint 1 has basic compute resources, and endpoint 2 has sufficient compute resources to handle our current production load. By doing this we can optimize the resource cost for the system to meet the needs of multiple groups of users.</p>
    </li>
  </ul>

  <div class="figure">
    <p class="figuree"><img alt="" class="calibre4" src="../Images/CH10_F36_Ryan2.png"/></p>

    <p class="figurecaptione">Figure 10.36 Relationship between models and endpoints</p>
  </div>

  <p class="fm-calloute"><span class="fm-callout-head">NOTE</span> For more details on model deployment in Vertex AI, see the docum<a id="idTextAnchor072"/>entation at <a class="url" href="https://mng.bz/MDlB">https://mng.bz/MDlB</a>.<a id="idIndexMarker068"/><a id="idIndexMarker069"/><a id="idIndexMarker070"/></p>

  <h2 class="fm-head" id="heading_id_23">10.6 Gemini for Google Cloud: Generative AI assistance in Google Cloud</h2>

  <p class="body"><a id="marker-391"/>As you worked through the steps in this chapter, you may have run into a roadblock or needed to clarify a question. To make progress, you may have referred to the documentation for Google Cloud, searched in Stack Overflow, or asked a colleague for help. In addition to these traditional sources of assistance, Google Cloud also includes an integrated, generative AI-driven source of assistance: Gemini for Google Cloud.<a id="idIndexMarker071"/></p>

  <p class="body">Gemini for Google Cloud is a set of generative AI capabilities for Google Cloud. Gemini for Google Workspace is a companion set of generative AI capabilities for Google Workspace (Google Docs, Sheets, Slides; see <a class="url" href="https://workspace.google.com/solutions/ai/">https://workspace.google.com/solutions/ai/</a>). In this chapter and chapter 11, we’ll show how you can use generative AI via Gemini for Google Cloud to simplify the deployment of tabular data models and to automate some of scripting for machine learning pipelines. Gemini for Google Cloud provides a variety of capabilities, including the following:</p>

  <ul class="calibre5">
    <li class="fm-list-bullet">
      <p class="list">Answering questions about Google Cloud</p>
    </li>

    <li class="fm-list-bullet">
      <p class="list">Generating code (including SQL and a variety of programming languages such as Python, Java, and JavaScript) from text</p>
    </li>

    <li class="fm-list-bullet">
      <p class="list">Explaining code</p>
    </li>
  </ul>

  <p class="fm-calloute"><span class="fm-callout-head">NOTE</span> See the Gemini for Google Cloud documentation for a more detailed overview of what Gemini for Google Cloud can do: <a class="url" href="https://cloud.google.com/gemini/docs/overview">https://cloud.google.com/gemini/docs/overview</a>.</p>

  <p class="body">In this section, we’ll cover setting up Gemini for Google Cloud and using it to answer questions about Google Cloud. We’ll also discuss some of the actions we completed in this chapter to deploy our model in a Vertex AI endpoint. In chapter 11, we’ll return to Gemini for Google Cloud to show how you can use it to generate and explain code.</p>

  <p class="body">Google Cloud is not the only cloud platform that harnesses generative AI to make it easier to use the platform and to automate some steps in the development workflow. Copilot in Azure and Code Whisperer in AWS are generative AI-based features that each provide a subset of the benefits <a id="idTextAnchor073"/>provided by Gemini for Google Cloud.</p>

  <h3 class="fm-head1" id="heading_id_24">10.6.1 Setting up Gemini for Google Cloud</h3>

  <p class="body">The following are instructions for setting up Gemini for Google Cloud:<a id="marker-392"/><a id="idIndexMarker072"/></p>

  <ul class="calibre5">
    <li class="fm-list-bullet">
      <p class="list">Setting up Gemini for Google Cloud for a project: <a class="url" href="https://cloud.google.com/gemini/docs/quickstart">https://cloud.google.com/gemini/docs/quickstart</a></p>
    </li>

    <li class="fm-list-bullet">
      <p class="list">Setting up Gemini Code Assist, the part of Gemini for Google Cloud that provides AI assistance for development, to be used in Cloud Shell Editor in Google Cloud: <a class="url" href="https://mng.bz/avMm">https://mng.bz/avMm</a></p>
    </li>
  </ul>

  <p class="body">Once you have set up Gemini for Google Cloud for a project, you will see the Gemini for Google Cloud icon <a id="idTextAnchor074"/>in the toolbar (see figure 10.37).</p>

  <div class="figure">
    <p class="figure1"><img alt="" class="calibre4" src="../Images/CH10_F37_Ryan2.png"/></p>

    <p class="figurecaption">Figure 10.37 Gemini for Google Cloud icon</p>
  </div>

  <p class="body">Now that we have done the basic setup for Gemini for Google Cloud, we’ll see how we can use it to get answers to questions abo<a id="idTextAnchor075"/>ut Google Cloud in the next section.</p>

  <h3 class="fm-head1" id="heading_id_25">10.6.1  Using Gemini for Google Cloud to answer questions about Google Cloud</h3>

  <p class="body">Gemini for Google Cloud manifests itself in various ways in Google Cloud, including<a id="idIndexMarker073"/></p>

  <ul class="calibre5">
    <li class="fm-list-bullet">
      <p class="list"><i class="fm-italics">In a chat pane that’s available throughout Google Cloud</i>—Figure 10.38 shows the Gemini for the Google Cloud chat pane.</p>
    </li>
  </ul>

  <div class="figure">
    <p class="figuree"><img alt="" class="calibre4" src="../Images/CH10_F38_Ryan2.png"/></p>

    <p class="figurecaptione">Figure 10.38 Gemini for Google Cloud chat pane</p>
  </div>

  <ul class="calibre5">
    <li class="fm-list-bullet">
      <p class="list"><i class="fm-italics">In a range of IDEs supported by Google Cloud, including VS Code, Cloud Workstations, and Cloud Shell Editor</i>—Figure 10.39 illustrates how Gemini for Google Cloud can generate a simple Python function from<a id="marker-393"/><a id="idTextAnchor076"/> a comment in Cloud Shell Editor.</p>
    </li>
  </ul>

  <div class="figure">
    <p class="figuree"><img alt="" class="calibre4" src="../Images/CH10_F39_Ryan2.png"/></p>

    <p class="figurecaptione">Figure 10.39 Gemini for Google Cloud generating Python in Cloud Shell Editor</p>
  </div>

  <ul class="calibre5">
    <li class="fm-list-bullet">
      <p class="list"><i class="fm-italics">In the query editors for Big Query and Spanner</i>—Figure 10.40 shows how Gemini for Google Cloud can generate SQL from a comm<a id="idTextAnchor077"/>ent in the Spanner query editor.</p>
    </li>
  </ul>

  <div class="figure">
    <p class="figuree"><img alt="" class="calibre4" src="../Images/CH10_F40_Ryan2.png"/></p>

    <p class="figurecaptione">Figure 10.40 Gemini for Google Cloud generating SQL in the query editor in Spanner</p>
  </div>

  <p class="body">Now that we have reviewed examples of where Gemini for Google Cloud can be used, let’s examine the Gemini for Google Cloud chat pane more to see how it can be used to get answers to questions about Google Cloud. You can click on the Gemini icon (see figure 10.37) to open the Gemini for Google Cloud chat <a id="marker-394"/><a id="idTextAnchor078"/>pane, as shown in figure 10.41.</p>

  <div class="figure">
    <p class="figure1"><img alt="" class="calibre4" src="../Images/CH10_F41_Ryan2.png"/></p>

    <p class="figurecaption">Figure 10.41 Gemini for Google Cloud chat pane</p>
  </div>

  <p class="body">Try out the Gemini for Google Cloud chat pane by entering an instruction prompt in the prompt field and clicking on the Send but<a id="idTextAnchor079"/>ton, as shown in figure 10.42.</p>

  <div class="figure">
    <p class="figure1"><img alt="" class="calibre4" src="../Images/CH10_F42_Ryan2.png"/></p>

    <p class="figurecaption">Figure 10.42 Gemini for Google Cloud chat pane Send button</p>
  </div>

  <p class="body"><a id="marker-395"/>The Gemini for Google Cloud chat pane is available whenever you need it in Google Cloud, and you can use it to ask all kinds of questions about Google Cloud. For example, suppose we want to create a Cloud Storage bucket and we forgot the steps listed earlier in this chapter. Figure 10.43 shows the response given by Gemini for Google Cloud to the prompt “How to crea<a id="idTextAnchor080"/>te a Google storage bucket.”</p>

  <div class="figure">
    <p class="figure1"><img alt="" class="calibre4" src="../Images/CH10_F43_Ryan2.png"/></p>

    <p class="figurecaption">Figure 10.43 Gemini for Google Cloud response to “how to create a Google Cloud storage bucket”</p>
  </div>

  <p class="body">Gemini for Google Cloud has been trained specifically to provide useful answers to questions about using Google Cloud. Try out Gemini for Google Cloud by giving it prompts related to some of the sections in this chapter. For example, try “how to import a custom model into Vertex AI” or “how to deploy a model to a Vertex AI endpoint” and see how the responses from Gemini for Google Cloud compare to the steps listed in the analo<a id="idTextAnchor081"/>gous sections in this chapter. <a id="idIndexMarker074"/></p>

  <h2 class="fm-head" id="heading_id_26">Summary</h2>

  <ul class="calibre5">
    <li class="fm-list-bullet">
      <p class="list">Deploying your model in a simple web application can give you a sense of its characteristics in production.</p>
    </li>

    <li class="fm-list-bullet">
      <p class="list">We can create a simple web application to deploy the model we trained in chapter 9. This application includes a Flask server module and two simple web pages.</p>
    </li>

    <li class="fm-list-bullet">
      <p class="list">A public cloud environment provides an environment for deploying a model that allows you to scale capacity and control availability.</p>
    </li>

    <li class="fm-list-bullet">
      <p class="list">To prepare to deploy the model we trained in chapter 9 in Google Cloud, we need to create a Google Cloud project, create a Google Cloud bucket, and upload the model to the bucket.</p>
    </li>

    <li class="fm-list-bullet">
      <p class="list">Once we have completed the steps to prepare for a Google Cloud model deployment, we can deploy a trained model to a Vertex AI endpoint.</p>
    </li>

    <li class="fm-list-bullet">
      <p class="list">We can test the Vertex AI endpoint deployment of the model by making a few simple updates to the Flask module from the web application that we created at the beginning of this chapter.</p>
    </li>

    <li class="fm-list-bullet">
      <p class="list">Deploying a model to an endpoint in Vertex AI makes the deployment more robust. In particular, we can specify the machine resources that are appropriate for our application, provide a mix of model levels, and monitor the model’s performance in production.</p>
    </li>

    <li class="fm-list-bullet">
      <p class="list">Gemini for Google Cloud provides generative AI capabilities that can be helpful for model development and deployment tasks in Google Cloud.<a id="marker-396"/></p>
    </li>
  </ul>
</body></html>