["```py\n{\"title\": [\"The Social Network\"],\n \"overview\": [\"On a fall night in 2003, Harvard undergrad and computer\n   ↪programming genius Mark Zuckerberg sits down at his computer and\n   ↪heatedly begins working on a new idea. In a fury of blogging and\n   ↪programming, what begins in his dorm room as a small site among\n   ↪friends soon becomes a global social network and a revolution in\n   ↪communication. A mere six years and 500 million friends later,\n   ↪Mark Zuckerberg is the youngest billionaire in history... but for\n   ↪this entrepreneur, success leads to both personal and legal\n   ↪complications.\"],\n \"tagline\": [\"You don't get to 500 million friends without making a few\n   ↪enemies.\"],\n \"release_year\": 2010}\n```", "```py\nkeywords = \"some example keywords\"\n{\"query\": f\"title:({keywords})^10 overview:({keywords})^20\n↪{!func}release_year^0.01\"}\n```", "```py\nfrom ltr.judgments import Judgment\nJudgment(grade=1, keywords=\"social network\", doc_id=37799)\n```", "```py\nsample_judgments = [\n  # for 'social network' query\n  Judgment(1, \"social network\", 37799),  # The Social Network\n  Judgment(0, \"social network\", 267752), # #chicagoGirl\n  Judgment(0, \"social network\", 38408),  # Life As We Know It\n  Judgment(0, \"social network\", 28303),  # The Cheyenne Social Club\n\n  # for 'star wars' query\n  Judgment(1, \"star wars\", 11),     # Star Wars\n  Judgment(1, \"star wars\", 1892),   # Return of the Jedi\n  Judgment(0, \"star wars\", 54138),  # Star Trek Into Darkness\n  Judgment(0, \"star wars\", 85783),  # The Star\n  Judgment(0, \"star wars\", 325553)  # Battlestar Galactica\n]\n```", "```py\n{\"query\": f\"title:({keywords})^10 overview:({keywords})^20\n↪{!func}release_year^0.01\"}\n```", "```py\nfeature_set = [\n  ltr.generate_query_feature(feature_name=\"title_bm25\",\n                             field_name=\"title\"),\n  ltr.generate_query_feature(feature_name=\"overview_bm25\",\n                             field_name=\"overview\"),\n  ltr.generate_field_value_feature(feature_name=\"release_year\",\n                                   field_name=\"release_year\")]\n\nltr.upload_features(features=feature_set, model_name=\"movie_model\")\ndisplay(feature_set)\n```", "```py\n[{\"name\": \"title_bm25\",  #1\n  \"store\": \"movies\",  #2\n  \"class\": \"org.apache.solr.ltr.feature.SolrFeature\",\n  \"params\": {\"q\": \"title:(${keywords})\"}},  #3\n {\"name\": \"overview_bm25\", #4\n  \"store\": \"movies\",\n  \"class\": \"org.apache.solr.ltr.feature.SolrFeature\",\n  \"params\": {\"q\": \"overview:(${keywords})\"}},\n {\"name\": \"release_year\", #5\n  \"store\": \"movies\",\n  \"class\": \"org.apache.solr.ltr.feature.SolrFeature\",\n  \"params\": {\"q\": \"{!func}release_year\"}}]  #6\n```", "```py\nids = [\"37799\", \"267752\", \"38408\", \"28303\"]  #1\noptions = {\"keywords\": \"social network\"}\nltr.get_logged_features(\"movie_model\", ids,  #2\n                        options=options, )  #2\n                        fields=[\"id\", \"title\"])  #2\ndisplay(response)\n```", "```py\n{\"query\": \"{!terms f=id}37799,267752,38408,28303\",\n \"fields\": [\"id\", \"title\",\n   '[features store=movies efi.keywords=\"social network\"]']}  #1\n```", "```py\n[{\"id\": \"37799\",\n  \"title\": \"The Social Network\",\n  \"[features]\": {\"title_bm25\": 8.243603, #1\n                 \"overview_bm25\": 3.8143613,  #1\n                 \"release_year\": 2010.0}},  #1\n {\"id\": \"267752\",\n  \"title\": \"#chicagoGirl\",\n  \"[features]\": {\"title_bm25\": 0.0,\n                 \"overview_bm25\": 6.0172443,\n                 \"release_year\": 2013.0}},\n {\"id\": \"38408\",\n  \"title\": \"Life As We Know It\",\n  \"[features]\": {\"title_bm25\": 0.0,\n                 \"overview_bm25\": 4.353118,\n                 \"release_year\": 2010.0}},\n {\"id\": \"28303\",\n  \"title\": \"The Cheyenne Social Club\",\n  \"[features]\": {\"title_bm25\": 3.4286604,\n                 \"overview_bm25\": 3.1086721,\n                 \"release_year\": 1970.0}}]\n```", "```py\n[Judgment(grade=1, keywords=\"social network\", doc_id=37799, qid=1,\n          features=[8.243603, 3.8143613, 2010.0], weight=1),  #1\n Judgment(0, \"social network\", 267752, 1, [0.0, 6.0172443, 2013.0], 1),\n Judgment(0, \"social network\", 38408, 1, [0.0, 4.353118, 2010.0],1), #2\n Judgment(0, \"social network\", 28303, 1, [3.4286604, 3.1086721, 1970.0], 1)]\n```", "```py\n[Judgment(1, \"star wars\", 11, 2, [6.7963624, 0.0, 1977.0], 1),\n Judgment(1, \"star wars\", 1892, 2, [0.0, 1.9681965, 1983.0], 1),\n Judgment(0, \"star wars\", 54138, 2, [2.444128, 0.0, 2013.0], 1),\n Judgment(0, \"star wars\", 85783, 2, [3.1871135, 0.0, 1952.0], 1),\n Judgment(0, \"star wars\", 325553, 2, [0.0, 0.0, 2003.0], 1)]\n```", "```py\nmeans, std_devs, normed_judgments = normalize_features(logged_judgments)\nprint(logged_judgments[360])\nprint(normed_judgments[360])\n```", "```py\n#Judgment(grade, keywords, doc_id,\n#         qid, features, weight)\nJudgment(1, \"social network\", 37799,  #1\n         11, [8.244, 3.814, 2010.0], 1)  #1\nJudgment(1, \"social network\", 37799,  #2\n         11, [4.483, 2.100, 0.835], 1)  #2\n```", "```py\nfor doc1_judgment in query_judgments:\n  for doc2_judgment in query_judgments:\n    j1_features = numpy.array(doc1_judgment.features)\n    j2_features = numpy.array(doc2_judgment.features)\n\n    if doc1_judgment.grade > doc2_judgment.grade:\n      predictor_deltas.append(+1)  #1\n      feature_deltas.append(j1_features -  #2\n                            j2_features)  #2\n    elif doc1_judgment.grade < doc2_judgment.grade: \n      predictor_deltas.append(-1)  #3\n      feature_deltas.append(j1_features - #4\n                            j2_features)  #4\n```", "```py\n#[title_bm25, overview_bm25]  #1\n[4.483, 2.100]  #1\n```", "```py\n#[title_bm25, overview_bm25]  #1\n[3.101, 1.443]  #1\n```", "```py\npredictor_deltas.append(+1)\nfeature_deltas.append([4.483, 2.100] - [3.101, 1.443]) #1\n```", "```py\npredictor_deltas.append(-1)\nfeature_deltas.append([3.101, 1.443] - [4.483, 2.100])  #1\n```", "```py\n# Positive example\npredictor_deltas.append(+1)\nfeature_deltas.append([4.483, 2.100] - [2.234, -0.444])  #1\n\n# Negative example\npredictor_deltas.append(-1)\nfeature_deltas.append([2.234, -0.444] - [4.483, 2.100])  #2\n```", "```py\n# Positive example\npredictor_deltas.append(+1)\nfeature_deltas.append([2.088, 1.024] - [1.808, -0.444])  #1\n\n# Negative example\npredictor_deltas.append(-1)\nfeature_deltas.append([1.808, -0.444] - [2.088, 1.024])  #2\n```", "```py\n[0.65, 0.40]\n```", "```py\nfrom sklearn import svm\nmodel = svm.LinearSVC(max_iter=10000  #1\nmodel.fit(feature_deltas, predictor_deltas)  #2\ndisplay(model.coef_) #3\n```", "```py\narray([0.40512169, 0.29006328, 0.14451715])\n```", "```py\n[5.9217176, 3.401492, 1982.0] #1\n```", "```py\n[3.099, 1.825, -0.568]  #1\n```", "```py\n(3.099 * 0.405) + (1.825 * 0.290) + (-0.568 * 0.1445) = 1.702  #1\n```", "```py\n[0.0, 0.0, 1984.0]  #1\n[-0.432, -0.444, -0.468]  #2\n(-0.432 * 0.405) + (-0.444 * 0.290) + (-0.468 * 0.1445) = -0.371  #3\n```", "```py\nall_qids = list(set([j.qid for j in normed_judgments]))\nrandom.shuffle(all_qids)  #1\nproportion_train = 0.1  #1\n  #1\nsplit_idx = int(len(all_qids) * proportion_train)  #1\ntest_qids = all_qids[:split_index]  #2\ntrain_qids = all_qids[split_index:]  #2\n\ntrain_data = []; test_data=[]\nfor j in normed_judgments:\n  if j.qid in train_qids:  #2\n    train_data.append(j)  #2\n  elif j.qid in test_qids:  #2\n    test_data.append(j)  #2\n```", "```py\ntrain_data_features, train_data_predictors = pairwise_transform(train_data)\n\nfrom sklearn import svm\nmodel = svm.LinearSVC(max_iter=10000, verbose=1)\nmodel.fit(train_data_features, train_data_predictors)  #1\ndisplay(model.coef_[0])\n```", "```py\narray([0.37486809, 0.28187458, 0.12097921])\n```", "```py\ndef score_one(features, model):\n  score = 0.0\n  for idx, f in enumerate(features):\n    this_coef = model.coef_[0][idx].item()\n    score += f * this_coef\n  return score\n\ndef rank(query_judgments, model):\n  for j in query_judgments:\n    j.score = score_one(j.features, model)\n  return sorted(query_judgments, key=lambda j: j.score, reverse=True)\n\ndef evaluate_model(test_data, model, k=5):\n  total_precision = 0\n  unique_queries = groupby(test_data, lambda j: j.qid)\n  num_groups = 0\n  for qid, query_judgments in unique_queries: #1\n    num_groups += 1\n    ranked = rank(list(query_judgments), model)  #2\n    total_relevant = len([j for j in ranked[:k]\n                            if j.grade == 1])  #3\n    total_precision += total_relevant / float(k)\n  return total_precision / num_groups\n\nevaluation = evaluate_model(test_data, model)\nprint(evaluation)\n```", "```py\n0.36\n```", "```py\n{\"query\": f\"title:({keywords})^10 overview:({keywords})^20\n↪{!func}release_year^0.01\"}\n```", "```py\nmodel_name = \"movie_model\"\nfeature_names = [\"title_bm25\", \"overview_bm25\", \"release_year\"]\nlinear_model = ltr.generate_model(model_name, feature_names,\n                                  means, std_devs, model.coef_[0])\nresponse = ltr.upload_model(linear_model)\ndisplay(linear_model)\n```", "```py\n{\"store\": \"movies\",  #1\n \"class\": \"org.apache.solr.ltr.model.LinearModel\",\n \"name\": \"movie_model\",\n \"features\": [\n   {\"name\": \"title_bm25\",  #2\n    \"norm\": {\"class\": \"org.apache.solr.ltr.norm.StandardNormalizer\", \n             \"params\": {\"avg\": \"0.7245440735518126\",  #3\n                        \"std\": \"1.6772600303613545\"}}},  #3\n   {\"name\": \"overview_bm25\",\n    \"norm\": {\"class\": \"org.apache.solr.ltr.norm.StandardNormalizer\",\n             \"params\": {\"avg\": \"0.6662927508611409\",\n                        \"std\": \"1.4990448120673643\"}}},\n   {\"name\": \"release_year\",\n    \"norm\": {\"class\": \"org.apache.solr.ltr.norm.StandardNormalizer\",\n             \"params\": {\"avg\": \"1993.3349740932642\",\n                        \"std\": \"19.964916628520722\"}}}],\n \"params\": {\n   \"weights\": {\n     \"title_bm25\": 0.3748679655554891,  #4\n     \"overview_bm25\": 0.28187459845467566,  #4\n     \"release_year\": 0.12097924576841014}}}  #4\n```", "```py\nrequest = {\"query_fields\": [\"title\", \"overview\"],\n           \"return_fields\": [\"title\", \"id\", \"score\"],\n           \"rerank_query\": \"harry potter\",\n           \"log\": True}\nresponse = ltr.search_with_model(\"movie_model\", **request)\ndisplay(response[\"docs\"])\n```", "```py\n{\"fields\": [\"title\", \"id\", \"score\"],\n \"limit\": 5,\n \"query\": \"{!ltr reRankDocs=9999999  #1\n ↪model=movie_model efi.keywords=\\\"harry potter\\\"}\"}\n```", "```py\n[{\"id\": \"570724\", \"title\": \"The Story of Harry Potter\", \"score\": 2.4261155},\n {\"id\": \"116972\", \"title\": \"Discovering the Real World of Harry Potter\",\n  \"score\": 2.247846},\n {\"id\": \"672\", \"title\": \"Harry Potter and the Chamber of Secrets\",\n  \"score\": 2.017499},\n {\"id\": \"671\", \"title\": \"Harry Potter and the Philosopher's Stone\",\n  \"score\": 1.9944705},\n {\"id\": \"54507\", \"title\": \"A Very Potter Musical\",\n  \"score\": 1.9833609}]\n```", "```py\nrequest = {\"query\": \"harry potter\",\n           \"query_fields\": [\"title\", \"overview\"],\n           \"return_fields\": [\"title\", \"id\", \"score\"],\n           \"rerank_query\": \"harry potter\",\n           \"rerank_count\": 500,\n           \"log\": True}\nresponse = ltr.search_with_model(\"movie_model\", **request)\ndisplay(response[\"docs\"])\n```", "```py\n{\"query\": \"harry potter\", #1\n \"fields\": [\"title\", \"id\", \"score\"],\n \"limit\": 5,\n \"params\": {\n   \"rq\": \"{!ltr reRankDocs=500 model=movie_model  #2\n   ↪efi.keywords=\\\"harry potter\\\"}\", #2\n   \"qf\": [\"title\", \"overview\"], #1\n   \"defType\": \"edismax\"}}  #1\n```", "```py\n[{\"id\": \"570724\", \"title\": \"The Story of Harry Potter\", \"score\": 2.4261155},\n {\"id\": \"116972\", \"title\": \"Discovering the Real World of Harry Potter\",\n  \"score\": 2.247846},\n {\"id\": \"672\", \"title\": \"Harry Potter and the Chamber of Secrets\",\n  \"score\": 2.017499},\n {\"id\": \"671\", \"title\": \"Harry Potter and the Philosopher's Stone\",\n  \"score\": 1.9944705},\n {\"id\": \"54507\", \"title\": \"A Very Potter Musical\", \"score\": 1.9833605}]\n```"]