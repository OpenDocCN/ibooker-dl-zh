<html><head></head><body>
<div id="book-content">
<div id="sbo-rt-content"><section data-type="chapter" epub:type="chapter" data-pdf-bookmark="Chapter 7. Batteries Included: Creating a Python SDK"><div class="chapter" id="chapter_7">
<h1><span class="label">Chapter 7. </span>Batteries Included: Creating a Python SDK</h1>

<blockquote>
<p>Make the right things easy and the wrong things hard.</p>
<p data-type="attribution">Kathy Sierra</p>
</blockquote>

<p>To create an API data scientists will love,<a data-type="indexterm" data-primary="SDK (software development kit)" data-secondary="about" id="id1480"/> you should give them a <em>software development kit</em> (SDK) to call the API with. This is an extra step that most API producers do not take, but it makes life much easier for your users. In this chapter, you will learn the value of SDKs and benefit from practical tips from several experts, and then you will create a Python SDK for the SWC Fantasy Football API. Building an SDK is the capstone of your Part I portfolio project.</p>

<p>SDKs can include code examples,<a data-type="indexterm" data-primary="APIs" data-secondary="SDK interacting with" data-seealso="SDK (software development kit)" id="id1481"/> debuggers, and documentation, but the term commonly refers to a custom software library that acts as a wrapper for your API. It allows developers and data scientists to interact with your API directly in their programming language, without requiring extra code to handle API communication.</p>

<p><a data-type="xref" href="#sdk_API_components_diagram">Figure 7-1</a> shows how your users will employ an SDK to call your API, instead of calling it directly.</p>

<figure><div id="sdk_API_components_diagram" class="figure">
<img src="assets/haad_0701.png" alt="SDK Interacting with the API" width="1417" height="287"/>
<h6><span class="label">Figure 7-1. </span>SDK interacting with the API</h6>
</div></figure>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="id1482">
<h1>SDK Perspectives: Zan Markan on SDK Fundamentals</h1>
<p>Zan Markan is an experienced<a data-type="indexterm" data-primary="Markan, Zan" id="id1483"/><a data-type="indexterm" data-primary="SDK (software development kit)" data-secondary="Zan Markan on fundamentals" id="id1484"/> software engineer and developer advocate from the United Kingdom. Zan has developed SDKs and other tools in his developer relations role. I talked to Zan about SDKs and followed up with additional questions.</p>

<p><em>What exactly is an SDK?</em></p>

<p>An SDK is a <a data-type="indexterm" data-primary="SDK (software development kit)" data-secondary="about" id="id1485"/>programming language–native means of exposing an API that would otherwise only be accessible as a REST endpoint. They usually bundle the common REST API calls in functions or classes that you can use directly in code by importing a library.</p>

<p><em>Can you share an example?</em></p>

<p>Let’s say you have your Premier League SDK. You just want to import your Premier League SDK. There would be a way to add an API key so that every subsequent call would be authenticated easily. Then, the developer can just use the SDK to get a list of fixtures for a day. Or get the scoreboard with a single function call. It takes a lot of complexity away to make building something faster.</p>

<p><em>How common is it for companies to provide an SDK?</em></p>

<p>It’s more common to provide SDKs if the core audience of your product is someone who codes, such as a developer or data scientist.</p>
</div></aside>






<section data-type="sect1" data-pdf-bookmark="SDKs Bridge the Gap"><div class="sect1" id="id70">
<h1>SDKs Bridge the Gap</h1>

<p>To learn the benefits of SDKs<a data-type="indexterm" data-primary="SDK (software development kit)" data-secondary="benefits of providing" id="ch7fund"/><a data-type="indexterm" data-primary="Python" data-secondary="SDKs" data-tertiary="benefits of providing" id="ch7fund2"/> and tips for implementing them, I spoke to several experienced SDK developers and followed up with written questions.</p>

<p>Joey Greco is a software engineer<a data-type="indexterm" data-primary="Greco, Joey" id="id1486"/><a data-type="indexterm" data-primary="Sleeper" data-secondary="open source SDK for" id="id1487"/> who has created open source SDKs for several fantasy football league hosts, including <a href="https://oreil.ly/8dXo_">Sleeper</a> and <a href="https://oreil.ly/SIPsV">MyFantasyLeague</a>. He explains how SDKs help users: “A well-built SDK takes care of all the nitty-gritty for you,” he said. “A well-built SDK gives me a few lines of code I can copy/paste on my machine along with a few examples of how to access and manipulate various data. It tells me what I need to do to authenticate (pass your API token into this function, etc.). It’s a great way to bridge the gap from an external service to the code that you’re writing.”</p>

<p>It’s useful to remember that developers and data scientists aren’t using your API out of an interest in APIs—they have a job to do, and the API helps do the job. Wrapping the API in prebuilt program code makes that even simpler. I once conducted a usability session with a data-focused user of an API developer portal. I was surprised (and maybe slightly insulted) when she told me she didn’t care about my APIs—she just wanted the data. For a user like that who just wants the data, an SDK will be a <span class="keep-together">time-saver.</span></p>

<p>Also, consider that your users may use multiple APIs and data sources from different providers. The time they spend learning how each API works and configuring their code for it is a diversion from their end goal. And not every developer or data scientist has experience in using APIs in a resilient and secure manner. A mature SDK can provide good software development practices to these users with a minimum of <span class="keep-together">trouble.</span></p>

<p>Simon Yu, cofounder of the<a data-type="indexterm" data-primary="Yu, Simon" id="id1488"/><a data-type="indexterm" data-primary="Speakeasy" id="id1489"/> SDK generation platform Speakeasy, shares additional benefits: “All the boilerplate code that API consumers needed to write before is already taken care of by the SDK library itself. Instead of every consumer re-inventing the wheel themselves (frustrating, time-consuming, error-prone), they simply import the SDK, call the correct method, and go.”</p>

<p>There’s another benefit too. When developers use an SDK in their IDE, they will get auto-complete and type hints while they code. This makes their development quicker and also enables generative AI tools such as GitHub CoPilot or AWS CodeWhisperer to generate accurate code for them.</p>

<p>Producers benefit from anything that makes it easier to use their APIs. Like good API docs, SDKs reduce the friction for new consumers, which reduces the time-to-hello-world metric discussed in <a data-type="xref" href="ch05.html#chapter_5">Chapter 5</a>. Simon Yu said SDKs can be a profitable investment for API producers: “An API consumer (who might also be another large enterprise!) often won’t want to pay for a service until they are up and running in production. For many API providers, therefore, unblocking API consumers also unblocks revenue.”</p>

<p>Yu said SDKs can also reduce API support expenses: “Since SDKs provide a ready-made way to integrate with the API and eliminate the need to write custom integration code from scratch, they dramatically reduce the support burden required of API producers.” He added, “Without SDKs, if an integration doesn’t work, API producers often get pulled into 1:1 support, which is extremely costly.”</p>

<p>An SDK is a good way to encourage users to use your APIs responsibly by conforming to call limits and sending correctly formatted requests. SDKs make doing the right thing the easy thing.</p>

<p>SDKs can be part of an <a data-type="indexterm" data-primary="SDK (software development kit)" data-secondary="benefits of providing" data-tertiary="API product strategy" id="id1490"/><a data-type="indexterm" data-primary="Python" data-secondary="SDKs" data-tertiary="API product strategy" id="id1491"/>overall API product strategy. One of the best examples I have seen is by<a data-type="indexterm" data-primary="StatsBomb" id="id1492"/> <a href="https://statsbomb.com">StatsBomb (now Hudl StatsBomb)</a>, a sports data and analytics provider. StatsBomb provides football and soccer data with a strong emphasis on supporting research and education in the sports field. StatsBomb hosts a <a href="https://oreil.ly/Orp-g">sports analytics platform</a> that provides in-depth analysis and visualizations about players and teams from around the world. <a data-type="indexterm" data-primary="subscription-based API for StatsBomb" id="id1493"/>StatsBomb also provides data through a <a href="https://oreil.ly/CzhyS">subscription-based API</a> that allows its customers to pull data into their own analytics software. <a data-type="indexterm" data-primary="GitHub" data-secondary="StatsBomb repository" id="id1494"/>To support researchers and students, it also provides some of its data for free download on its <a href="https://oreil.ly/LPGZM">open data GitHub repository</a>.</p>

<p>For StatsBomb, SDKs tie the paid and free services together. The company maintains two SDKs for its APIs: <a href="https://oreil.ly/IQO_f">statsbombr</a> and <a href="https://oreil.ly/0VOdS">statsbombpy</a>. As shown in <a data-type="xref" href="#Statsbombpy_repo">Figure 7-2</a>, paid subscribers can use the SDK to get live data, while nonsubscribers can use the SDK to access static data for free. Internally, the SDK gets the paid data from an API and the free data from a file download. But this complexity is shielded from the SDK users: they just know they get the data they want.<a data-type="indexterm" data-startref="ch7fund" id="id1495"/><a data-type="indexterm" data-startref="ch7fund2" id="id1496"/></p>

<figure><div id="Statsbombpy_repo" class="figure">
<img src="assets/haad_0702.png" alt="statsbombpy SDK documentation" width="1653" height="766"/>
<h6><span class="label">Figure 7-2. </span>The statsbombpy SDK documentation</h6>
</div></figure>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="id1497">
<h1>SDK Perspectives: Francisco Goitia on Implementing SDKs</h1>
<p>I talked to Francisco Goitia,<a data-type="indexterm" data-primary="Goitia, Francisco" id="id1498"/><a data-type="indexterm" data-primary="SDK (software development kit)" data-secondary="Francisco Goitia on implementation" id="id1499"/><a data-type="indexterm" data-primary="StatsBomb" data-secondary="Francisco Goitia on SDK implementation" id="id1500"/> lead machine learning engineer at StatsBomb and the developer of the statsbombpy SDK.</p>

<p><em>What motivated StatsBomb to create SDKs for your APIs?</em></p>

<p>Our philosophy is to understand the end user of our products. Our user might be a football analyst who doesn’t know how to query APIs. They just want to do a plot of the data to get their job done. So, if they can install a Python library with <code>pip install</code> and start using the data, it makes their life easier.</p>

<p><em>For the users of your APIs, why do you think SDKs make their life easier?</em></p>

<p>If I was writing client code to use our APIs, I would need to write something like the SDK to decouple the API from my software. That’s using good software practices. So, by using the SDK, they don’t have to do that extra work.</p>

<p class="less_space pagebreak-before"><em>Why did you decide to use R and Python for your SDKs?</em></p>

<p>Those are the languages<a data-type="indexterm" data-primary="SDK (software development kit)" data-secondary="language for" data-tertiary="StatsBomb using R and Python" id="id1501"/> that the football analyst community uses, with Python becoming more common recently. When I started in 2020, we already had <span class="keep-together">statsbombr.</span> In the first week I was here, I started creating statsbombpy and our customers started using it.</p>
</div></aside>
</div></section>






<section data-type="sect1" data-pdf-bookmark="Picking a Language for Your SDK"><div class="sect1" id="id71">
<h1>Picking a Language for Your SDK</h1>
<blockquote data-type="epigraph" epub:type="epigraph">
  <p>Your SDK journey starts by knowing your developer audience and how they will utilize your APIs.</p>
  <p data-type="attribution">SDKs.io</p>
</blockquote>

<p>The first decision that you<a data-type="indexterm" data-primary="SDK (software development kit)" data-secondary="language for" data-tertiary="picking a language" id="id1502"/> will make when developing an SDK is which programming languages you will support. The SDK does not need to be written in the same language that the API is developed in. Instead, it needs to be written in the language that the API’s consumers use. They will import the SDK in their code, and use it to interact with your API, instead of calling the API directly.</p>

<p>API producers sometimes provide SDKs in multiple languages for different consumers.<a data-type="indexterm" data-primary="Markan, Zan" id="id1503"/><a data-type="indexterm" data-primary="Python" data-secondary="SDKs" data-tertiary="Python used by data scientists" id="id1504"/><a data-type="indexterm" data-primary="R (programming language)" id="id1505"/><a data-type="indexterm" data-primary="SDK (software development kit)" data-secondary="language for" data-tertiary="Python most commonly used" id="id1506"/><a data-type="indexterm" data-primary="data scientists" data-secondary="Python most commonly used language" id="id1507"/> Zan Markan summarized this approach as “Go where the users are.” For data scientists, he said, “it’s going to be Python, and there might be some R. Python is so heavily used in that community that you want to focus on that.” His view is consistent with the “State of Data Science” survey discussed in <a data-type="xref" href="ch01.html#chapter_1">Chapter 1</a>, which listed Python as the most common language used by data scientists. <a data-type="indexterm" data-primary="SDK (software development kit)" data-secondary="language for" data-tertiary="OpenAPI Python Client" id="id1508"/><a data-type="indexterm" data-primary="Python" data-secondary="SDKs" data-tertiary="OpenAPI Python Client" id="id1509"/>To get started with a Python SDK, an open source tool like the <a href="https://oreil.ly/cnR-u">OpenAPI Python client</a> could be used to generate stubs that you could add more functionality to.</p>

<p>The more languages you create SDKs in, the more maintenance they require. <a data-type="indexterm" data-primary="SDK (software development kit)" data-secondary="language for" data-tertiary="tools generating SDKs in multiple languages" id="id1510"/><a data-type="indexterm" data-primary="Speakeasy" id="id1511"/><a data-type="indexterm" data-primary="APIMatic" id="id1512"/><a data-type="indexterm" data-primary="Fern" id="id1513"/><a data-type="indexterm" data-primary="SDK (software development kit)" data-secondary="auto-generation services" id="id1514"/><a data-type="indexterm" data-primary="SDKs.io" data-secondary="publisher APIMatic" id="id1515"/>Companies like <a href="https://oreil.ly/speasy">Speakeasy</a>, <a href="https://oreil.ly/bpMKs">APIMatic</a> (publisher of SDKs.io), and <a href="https://oreil.ly/fern">Fern</a> provide commercial tools that generate SDKs in multiple languages directly from the OpenAPI Specification (OAS) and keep them updated over time.</p>

<p>Simon Yu explained the benefits of auto-generation services: “Getting the SDK design and implementation right is difficult. Maintaining and supporting them is even harder. What happens if the team member responsible for updating the SDK leaves? Now multiply this problem across all the languages you want to offer the SDK in,” he said. “This is where Speakeasy and other SDK generators come in.”</p>
<aside data-type="sidebar" epub:type="sidebar" class="less_space pagebreak-before"><div class="sidebar" id="id1516">
<h1>You Can Start from Here</h1>
<p>The SDK code for your project is separate from the API that you created in earlier chapters. You can start here even if you have not completed earlier chapters in this book. Later in this chapter, you will execute the API code so that you can verify the SDK works with your API. Even if you have not completed the earlier chapters, the working API code is available in the<a data-type="indexterm" data-primary="resources online" data-secondary="chapter code" data-tertiary="chapter 6 complete" id="id1517"/> <em>chapter6/complete</em> folder.</p>
</div></aside>
</div></section>






<section data-type="sect1" data-pdf-bookmark="Starting with a Minimum Viable SDK"><div class="sect1" id="id72">
<h1>Starting with a Minimum Viable SDK</h1>

<p>The last piece of your Part I portfolio <a data-type="indexterm" data-primary="SDK (software development kit)" data-secondary="building minimal SDK" id="ch7min"/>project is to create a Python SDK. Throughout this chapter, you will learn tips and tricks from API experts and implement Python features inspired by them: <a data-type="indexterm" data-primary="statsbompy" id="id1518"/><a data-type="indexterm" data-primary="Goitia, Francisco" id="id1519"/><a data-type="indexterm" data-primary="Yu, Simon" id="id1520"/><a data-type="indexterm" data-primary="Speakeasy" id="id1521"/><a data-type="indexterm" data-primary="Greco, Joey" id="id1522"/><a data-type="indexterm" data-primary="Pymfl" id="id1523"/>Francisco Goitia’s <a href="https://oreil.ly/LUiJd">statsbompy</a>, SDKs from Simon Yu’s company Speakeasy, and Joey Greco’s <a href="https://oreil.ly/ut2nK">pymfl</a>, along with additional reference documentation.</p>

<p>You will start with a very simple working SDK to make sure the project packaging is working. I’ll call this your <em>minimum viable SDK</em>. After you verify the package works and can be installed, you will add additional features.</p>








<section data-type="sect2" data-pdf-bookmark="Expert Tip: Making Your SDK Easy to Install"><div class="sect2" id="id73">
<h2>Expert Tip: Making Your SDK Easy to Install</h2>
<blockquote data-type="epigraph" epub:type="epigraph">
  <p>...if they can install a Python library with pip install and start using the data, it makes their life easier.</p>
  <p data-type="attribution">Francisco Goitia, StatsBomb</p>
</blockquote>

<p>Many programming languages<a data-type="indexterm" data-primary="SDK (software development kit)" data-secondary="building minimal SDK" data-tertiary="easy installation" id="id1524"/> have a standard method of downloading and installing libraries from an external repository, such as npm for Node.js and Maven for Java. <a data-type="indexterm" data-primary="Python" data-secondary="SDKs" data-tertiary="Python Package Index" id="id1525"/><a data-type="indexterm" data-primary="SDK (software development kit)" data-secondary="language for" data-tertiary="Python Package Index" id="id1526"/><a data-type="indexterm" data-primary="SDK (software development kit)" data-secondary="building minimal SDK" data-tertiary="Python Package Index" id="id1527"/><a data-type="indexterm" data-primary="pip3 package manager" data-secondary="SDK installation" id="id1528"/>Python SDKs are commonly published on the <a href="https://pypi.org">Python Package Index (PyPI)</a>. Hosting an SDK on PyPI enables Python developers to install the SDK into their environment using the <code>pip3</code> tool, as you have done in earlier chapters with libraries such as FastAPI and SQLAlchemy.<a data-type="indexterm" data-primary="GitHub" data-secondary="pip3" id="id1529"/> The <code>pip3</code> tool can also install packages directly from a GitHub repository, if the project is structured correctly. This is how you will structure your SDK project and give instructions to users. As a bonus, this structure is what is needed to publish to PyPI if you choose to.</p>

<p>Change the directory to <em>chapter7</em> and <a data-type="indexterm" data-primary="pyproject.toml file" id="id1530"/><a data-type="indexterm" data-primary="SDK (software development kit)" data-secondary="building minimal SDK" data-tertiary="pyproject.toml file" id="id1531"/>create the <em>sdk</em> folder. Then, change to the <em>sdk</em> directory and create a file named <em>pyproject.toml</em>:</p>

<pre data-type="programlisting" data-code-language="shell">.../portfolio-project (main) $ cd chapter7
.../chapter7 (main) $ mkdir sdk
.../chapter7 (main) $ cd sdk
.../sdk (main) $ touch pyproject.toml</pre>

<p>The <em>pyproject.toml</em> file provides<a data-type="indexterm" data-primary="pip3 package manager" data-secondary="pyproject.toml to package and install" id="ch7pckg"/> all the settings that tools like <code>pip3</code> need to package your code and install it correctly in Python environments. Add all of the following text to your <em>pyproject.toml</em> file:</p>

<pre data-type="programlisting" data-code-language="toml">[build-system] <a class="co" id="co_batteries_included__creating_a_python_sdk_CO1-1" href="#callout_batteries_included__creating_a_python_sdk_CO1-1"><img src="assets/1.png" alt="1" width="12" height="12"/></a>
requires = ["setuptools&gt;=61.0"]
build-backend = "setuptools.build_meta"

[project] <a class="co" id="co_batteries_included__creating_a_python_sdk_CO1-2" href="#callout_batteries_included__creating_a_python_sdk_CO1-2"><img src="assets/2.png" alt="2" width="12" height="12"/></a>
name = "swcpy"
version = "0.0.1" <a class="co" id="co_batteries_included__creating_a_python_sdk_CO1-3" href="#callout_batteries_included__creating_a_python_sdk_CO1-3"><img src="assets/3.png" alt="3" width="12" height="12"/></a>
authors = [
  { name="[enter your name]" },
]
description = "Example SDK from Hands-On API Book for AI and Data Science"
requires-python = "&gt;=3.10" <a class="co" id="co_batteries_included__creating_a_python_sdk_CO1-4" href="#callout_batteries_included__creating_a_python_sdk_CO1-4"><img src="assets/4.png" alt="4" width="12" height="12"/></a>
classifiers = [
    "Development Status :: 3 - Alpha", <a class="co" id="co_batteries_included__creating_a_python_sdk_CO1-5" href="#callout_batteries_included__creating_a_python_sdk_CO1-5"><img src="assets/5.png" alt="5" width="12" height="12"/></a>
    "Programming Language :: Python :: 3",
    "License :: OSI Approved :: MIT License",
    "Operating System :: OS Independent",
]
dependencies = [ <a class="co" id="co_batteries_included__creating_a_python_sdk_CO1-6" href="#callout_batteries_included__creating_a_python_sdk_CO1-6"><img src="assets/6.png" alt="6" width="12" height="12"/></a>
       'pytest&gt;=8.1',
       'httpx&gt;=0.27.0',
]</pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_batteries_included__creating_a_python_sdk_CO1-1" href="#co_batteries_included__creating_a_python_sdk_CO1-1"><img src="assets/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>This section selects <a href="https://setuptools.pypa.io/en/latest/setuptools.html">setuptools</a> as the build backend for your project. The Python Packaging Guide lists several other choices for the build backend, including Hatchling, Flit, and PDM. I have chosen setuptools because all of the example SDKs referenced in this chapter use it, and it is simple to use.</p></dd>
<dt><a class="co" id="callout_batteries_included__creating_a_python_sdk_CO1-2" href="#co_batteries_included__creating_a_python_sdk_CO1-2"><img src="assets/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>This section gives the basics about the package, including name, version, description, and author. (You should put your name there—it’s your portfolio project, after all.)</p></dd>
<dt><a class="co" id="callout_batteries_included__creating_a_python_sdk_CO1-3" href="#co_batteries_included__creating_a_python_sdk_CO1-3"><img src="assets/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p>The version should be updated each time major changes are applied.</p></dd>
<dt><a class="co" id="callout_batteries_included__creating_a_python_sdk_CO1-4" href="#co_batteries_included__creating_a_python_sdk_CO1-4"><img src="assets/4.png" alt="4" width="12" height="12"/></a></dt>
<dd><p>This communicates the minimum Python version your package supports.</p></dd>
<dt><a class="co" id="callout_batteries_included__creating_a_python_sdk_CO1-5" href="#co_batteries_included__creating_a_python_sdk_CO1-5"><img src="assets/5.png" alt="5" width="12" height="12"/></a></dt>
<dd><p>The development status <code>Alpha</code> shows that this SDK is in the early stages of <span class="keep-together">development.</span></p></dd>
<dt><a class="co" id="callout_batteries_included__creating_a_python_sdk_CO1-6" href="#co_batteries_included__creating_a_python_sdk_CO1-6"><img src="assets/6.png" alt="6" width="12" height="12"/></a></dt>
<dd><p>This section lists the Python libraries that are required for your package to work. This is the only section in this chapter that will list dependencies—there is no <em>requirements.txt</em> file used for the SDK.</p></dd>
</dl>
</div></section>








<section data-type="sect2" data-pdf-bookmark="Expert Tip: Making the SDK Consistent and Idiomatic"><div class="sect2" id="id74">
<h2>Expert Tip: Making the SDK Consistent and Idiomatic</h2>

<p>Simon Yu said, “The SDK should<a data-type="indexterm" data-primary="Yu, Simon" id="id1532"/><a data-type="indexterm" data-primary="SDK (software development kit)" data-secondary="building minimal SDK" data-tertiary="consistent and predictable" id="ch7-cons"/> be consistent and predictable. Naming conventions, error handling, and response format should be the same throughout the SDK to avoid unnecessary confusion to users.” For example, your SDK functions returning a single item will begin with <code>get_</code> and functions returning lists will begin with <code>list_</code>.</p>

<p>Sdks.io says you should <a data-type="indexterm" data-primary="SDKs.io" data-secondary="idiomatic SDK that follows norms" id="id1533"/>make your SDK <em>idiomatic</em>, following the norms used by other programmers of that language. For a Python SDK, this means that your code should be <em>Pythonic</em>. This is a broad term, but it means that Python code should follow the conventions that other Python programmers and tools use. Python is a living language, with new features being added all the time, so the coding conventions try to keep up. <a data-type="indexterm" data-primary="Python" data-secondary="Python Enhancement Proposals" id="id1534"/><a data-type="indexterm" data-primary="Python Enhancement Proposals (PEPs)" id="id1535"/>Conventions are established in the Python community through Python Enhancement Proposals or PEPs. If you’d like to understand the process, check out <a href="https://oreil.ly/dgQ79">PEP 1 – PEP Purpose and Guidelines</a>.</p>

<p>For the overall style of your SDK, you will be using <a href="https://oreil.ly/oersV">PEP 8 – Style Guide for Python Code</a>. The <a href="https://oreil.ly/csNt5">official Python docs</a> provide a good summary of PEP 8 style: use 4-space indentations, keep lines to 79 characters or less, and use <code>UpperCamelCase</code> for classes and <code>lowercase_with_underscores</code> for functions and methods.</p>

<p>A few additional Pythonic conventions you will use in your SDK include <a href="https://oreil.ly/7rivi">PEP 202 – List Comprehensions</a>, <a href="https://oreil.ly/bgVdx">PEP 343 – Context Managers</a>, <a href="https://oreil.ly/q5zA2">PEP 257 – Docstrings</a>, <a href="https://oreil.ly/WLYFx">PEP 518 – Build System Requirements</a>, and <a href="https://oreil.ly/RkeOY">PEP 484 – Type Hints</a>. These items will be explained as they are added to the code in your SDK.</p>

<p>The <em>swc_client.py</em> file is the<a data-type="indexterm" data-primary="SDK (software development kit)" data-secondary="building minimal SDK" data-tertiary="swc_client.py file" id="id1536"/> primary client that will interact with your API. You will start with a very basic client. Create the directory structure, the package initialization file, and the starter Python client:</p>

<pre data-type="programlisting" data-code-language="shell">.../sdk (main) $ mkdir src
.../sdk (main) $ mkdir src/swcpy
.../sdk (main) $ touch src/swcpy/__init__.py <a class="co" id="co_batteries_included__creating_a_python_sdk_CO2-1" href="#callout_batteries_included__creating_a_python_sdk_CO2-1"><img src="assets/1.png" alt="1" width="12" height="12"/></a>
.../sdk (main) $ touch src/swcpy/swc_client.py</pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_batteries_included__creating_a_python_sdk_CO2-1" href="#co_batteries_included__creating_a_python_sdk_CO2-1"><img src="assets/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Because your SDK will be a Python package, each directory that contains code will contain a file named <em>__init__.py</em>. An empty file can do this job for now.</p></dd>
</dl>

<p>To begin creating the minimal SDK,<a data-type="indexterm" data-primary="health check" data-secondary="SDK with minimal functionality" id="id1537"/> give the <em>swc_client.py</em> file just enough functionality to call the health check of the SWC API:</p>

<pre data-type="programlisting" data-code-language="python">import httpx <a class="co" id="co_batteries_included__creating_a_python_sdk_CO3-1" href="#callout_batteries_included__creating_a_python_sdk_CO3-1"><img src="assets/1.png" alt="1" width="12" height="12"/></a>

class SWCClient:

    def __init__(self, swc_base_url: str): <a class="co" id="co_batteries_included__creating_a_python_sdk_CO3-2" href="#callout_batteries_included__creating_a_python_sdk_CO3-2"><img src="assets/2.png" alt="2" width="12" height="12"/></a>
        self.swc_base_url = swc_base_url <a class="co" id="co_batteries_included__creating_a_python_sdk_CO3-3" href="#callout_batteries_included__creating_a_python_sdk_CO3-3"><img src="assets/3.png" alt="3" width="12" height="12"/></a>

    def get_health_check(self): <a class="co" id="co_batteries_included__creating_a_python_sdk_CO3-4" href="#callout_batteries_included__creating_a_python_sdk_CO3-4"><img src="assets/4.png" alt="4" width="12" height="12"/></a>
        # make the API call
        with httpx.Client(base_url=self.swc_base_url) as client: <a class="co" id="co_batteries_included__creating_a_python_sdk_CO3-5" href="#callout_batteries_included__creating_a_python_sdk_CO3-5"><img src="assets/5.png" alt="5" width="12" height="12"/></a>
            return client.get("/") </pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_batteries_included__creating_a_python_sdk_CO3-1" href="#co_batteries_included__creating_a_python_sdk_CO3-1"><img src="assets/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>For now, your <code>import</code> statement<a data-type="indexterm" data-primary="httpx Python library" data-secondary="SDK core library" id="id1538"/> only contains <code>httpx</code>, which is the core Python library you will use to interact with the API. The rest of this file defines the <code>SWCClient</code> class. Users of the SDK will create an instance of the class when they call the SDK, by executing the <code>SWCClient()</code>  method.</p></dd>
<dt><a class="co" id="callout_batteries_included__creating_a_python_sdk_CO3-2" href="#co_batteries_included__creating_a_python_sdk_CO3-2"><img src="assets/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>This is the class constructor, which is executed one time when a client instance is created. The method can be used to initiate methods and variables that are unique to an individual instance of the class, in contrast to the constant variable defined earlier. The <code>self</code> parameter is passed as the first parameter to every class method in Python, including the constructor.</p></dd>
<dt><a class="co" id="callout_batteries_included__creating_a_python_sdk_CO3-3" href="#co_batteries_included__creating_a_python_sdk_CO3-3"><img src="assets/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p>The constructor also receives the string parameter <code>swc_base_url</code>, which is the base address of the API to call. You set the class variable <code>self.swc_base_url</code> so that this value can be used in the <code>get_health_check()</code> method.</p></dd>
<dt><a class="co" id="callout_batteries_included__creating_a_python_sdk_CO3-4" href="#co_batteries_included__creating_a_python_sdk_CO3-4"><img src="assets/4.png" alt="4" width="12" height="12"/></a></dt>
<dd><p>This function calls the API’s health check endpoint.</p></dd>
<dt><a class="co" id="callout_batteries_included__creating_a_python_sdk_CO3-5" href="#co_batteries_included__creating_a_python_sdk_CO3-5"><img src="assets/5.png" alt="5" width="12" height="12"/></a></dt>
<dd><p>The <code>httpx.Client</code> has quite<a data-type="indexterm" data-primary="httpx Python library" data-secondary="httpx.Client" data-tertiary="setting base URL to call health check" id="id1539"/><a data-type="indexterm" data-primary="URL of API" data-secondary="httpx.Client setting base URL" id="id1540"/> a few features available, but for now you are setting the base URL and using it to call the <code>"/"</code> endpoint, which is your API’s health check.</p></dd>
</dl>

<p>To ensure that you have configured<a data-type="indexterm" data-primary="SDK (software development kit)" data-secondary="building minimal SDK" data-tertiary="easy installation" id="id1541"/><a data-type="indexterm" data-primary="pip3 package manager" data-secondary="SDK installation" id="id1542"/> your SDK package correctly, it’s time to install it in your Codespace with <code>pip3</code>. This will use the new source code and configuration files you created and install it as a library that you can access in Python files. It will also install the dependencies from the <em>pyproject.toml</em> file’s <code>dependencies</code> section.</p>

<p>Now install your package locally with the <code>-e</code> option, which ensures that the package is updated locally as your code changes:</p>

<pre data-type="programlisting" data-code-language="shell">.../sdk (main) $ pip3 install -e .
Processing /workspaces/portfolio-project/chapter7/sdk
  Installing build dependencies ... done
  Getting requirements to build wheel ... done
  Preparing metadata (pyproject.toml) ... done
...
Successfully built swcpy
Installing collected packages: pluggy, iniconfig, pytest, swcpy
Successfully installed iniconfig-2.0.0 pluggy-1.5.0 pytest-8.2.2 swcpy-0.0.1</pre>

<p>The <code>pip</code> package adds the version number on your Python package from the <em>py​pro⁠ject.toml</em> file.</p>

<p>Congratulations, you have created and installed a Python package! Take a look at the files you have created for this minimal SDK. Use the <code>tree</code> command, with a few options to filter out temporary files created by the build process:<a data-type="indexterm" data-startref="ch7-cons" id="id1543"/><a data-type="indexterm" data-startref="ch7pckg" id="id1544"/></p>

<pre data-type="programlisting" data-code-language="shell">.../sdk (main) $ tree --prune -I 'build|*.egg-info|__pycache__'
.
├── pyproject.toml
├── src
    └── swcpy
        ├── __init__.py
        └── swc_client.py


2 directories, 3 files</pre>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="id1545">
<h1>Minimum Viable SDK as a Building-Block Skill</h1>
<p>The code you have created<a data-type="indexterm" data-primary="portfolio projects" data-secondary="SDK" data-tertiary="minimal version showing skills" id="id1546"/><a data-type="indexterm" data-primary="SDK (software development kit)" data-secondary="building minimal SDK" data-tertiary="building-block skill" id="id1547"/> at this point in the chapter is deceptively simple, only requiring two directories and three files. But as basic as this appears, consider that you have now learned the basics required to:</p>

<ul>
<li>
<p>Create a simple SDK wrapper for any API that is available on the internet.</p>
</li>
<li>
<p>Make a package from any Python library and install it using <code>pip3</code>. This will work for any Python code that you think is useful to share.</p>
</li>
</ul>

<p>As you will see later in the chapter, this package structure will allow you to share these files with other users on GitHub and install it in their environments using <code>pip3</code>. With a bit more effort, you can also publish this package on PyPI.</p>

<p>You have picked up a key building-block skill that you can use as a foundation to share your work with the community of data scientists and developers around the world.<a data-type="indexterm" data-startref="ch7min" id="id1548"/></p>
</div></aside>
</div></section>
</div></section>






<section data-type="sect1" data-pdf-bookmark="Building a Feature-Rich SDK"><div class="sect1" id="id193">
<h1>Building a Feature-Rich SDK</h1>

<p>Now it’s time to turn the minimum<a data-type="indexterm" data-primary="SDK (software development kit)" data-secondary="building robust and feature-rich SDK" id="ch7richdk"/> viable SDK into one that is robust and feature rich. As you learn expert tips, you can implement them in your code. The goal is to make your SDK <em>batteries included</em>, which means it comes with all the functionality that users need for interacting with your API. This is where an SDK becomes a major selling point to your users, and it gives them the ability to get the most from your API.</p>








<section data-type="sect2" data-pdf-bookmark="Expert Tip: Using Sane Defaults"><div class="sect2" id="id75">
<h2>Expert Tip: Using Sane Defaults</h2>

<p>A key to hiding complicated <a data-type="indexterm" data-primary="SDK (software development kit)" data-secondary="building robust and feature-rich SDK" data-tertiary="default values" id="ch7deflt"/>details is to implement sane defaults. This means that a user can use your SDK without specifying any parameters and it will work out of the box. One important default is that the SDK should know the base URL of the API without being told. This allows the user to <code>pip3</code> install it and use it without reading the documentation to know this address. If the SDK is a read-only wrapper for a public API, you’ll likely default the production API address. If the API requires authentication or is a read/write API, you may want to default to a sandbox environment to prevent accidents. The sane defaults will handle the <em>happy path</em>, the standard usage that 80% of your users will need. The remaining 20% can be handled by allowing the user to change the configuration to override the defaults for special situations they have.</p>

<p>You will add sane defaults that the<a data-type="indexterm" data-primary="SDK (software development kit)" data-secondary="building robust and feature-rich SDK" data-tertiary="configuration class" id="id1549"/> user can override by creating a configuration class. Create a file named <em>swc_config.py</em> as shown:</p>

<pre data-type="programlisting" data-code-language="shell">.../sdk (main) $ touch src/swcpy/swc_config.py</pre>

<p>This file defines the <code>SWCConfig</code> class. The user will instantiate an instance of this class with their configuration settings, and then pass it to the <code>SWCClient</code> constructor. Then, they will use the <code>SWCClient</code> to call the API.</p>

<p>Update <em>swc_config.py</em> with the following content:<a data-type="indexterm" data-primary="SDK (software development kit)" data-secondary="building robust and feature-rich SDK" data-tertiary="swc_config.py file" id="id1550"/></p>

<pre data-type="programlisting" data-code-language="python">import os
from dotenv import load_dotenv <a class="co" id="co_batteries_included__creating_a_python_sdk_CO4-1" href="#callout_batteries_included__creating_a_python_sdk_CO4-1"><img src="assets/1.png" alt="1" width="12" height="12"/></a>

load_dotenv() <a class="co" id="co_batteries_included__creating_a_python_sdk_CO4-2" href="#callout_batteries_included__creating_a_python_sdk_CO4-2"><img src="assets/2.png" alt="2" width="12" height="12"/></a>

class SWCConfig: 
    """Configuration class containing arguments for the SDK client.

    Contains configuration for the base URL and progressive backoff.
    """

    swc_base_url: str <a class="co" id="co_batteries_included__creating_a_python_sdk_CO4-3" href="#callout_batteries_included__creating_a_python_sdk_CO4-3"><img src="assets/3.png" alt="3" width="12" height="12"/></a>
    swc_backoff: bool <a class="co" id="co_batteries_included__creating_a_python_sdk_CO4-4" href="#callout_batteries_included__creating_a_python_sdk_CO4-4"><img src="assets/4.png" alt="4" width="12" height="12"/></a>
    swc_backoff_max_time: int <a class="co" id="co_batteries_included__creating_a_python_sdk_CO4-5" href="#callout_batteries_included__creating_a_python_sdk_CO4-5"><img src="assets/5.png" alt="5" width="12" height="12"/></a>
    swc_bulk_file_format: str <a class="co" id="co_batteries_included__creating_a_python_sdk_CO4-6" href="#callout_batteries_included__creating_a_python_sdk_CO4-6"><img src="assets/6.png" alt="6" width="12" height="12"/></a>

    def __init__( <a class="co" id="co_batteries_included__creating_a_python_sdk_CO4-7" href="#callout_batteries_included__creating_a_python_sdk_CO4-7"><img src="assets/7.png" alt="7" width="12" height="12"/></a>
        self,
        swc_base_url: str = None,
        backoff: bool = True,
        backoff_max_time: int = 30,
        bulk_file_format: str = "csv",
    ):
        """Constructor for configuration class.

        Contains initialization values to overwrite defaults.

        Args:
        swc_base_url (optional):
            The base URL to use for all the API calls. Pass this in or set 
            in environment variable.
        swc_backoff:
            A boolean that determines if the SDK should
            retry the call using backoff when errors occur.
        swc_backoff_max_time:
            The max number of seconds the SDK should keep
            trying an API call before stopping.
        swc_bulk_file_format:
            If bulk files should be in csv or parquet format.
        """

        self.swc_base_url = swc_base_url or os.getenv("SWC_API_BASE_URL") <a class="co" id="co_batteries_included__creating_a_python_sdk_CO4-8" href="#callout_batteries_included__creating_a_python_sdk_CO4-8"><img src="assets/8.png" alt="8" width="12" height="12"/></a>
        print(f"SWC_API_BASE_URL in SWCConfig init: {self.swc_base_url}")  


        if not self.swc_base_url: <a class="co" id="co_batteries_included__creating_a_python_sdk_CO4-9" href="#callout_batteries_included__creating_a_python_sdk_CO4-9"><img src="assets/9.png" alt="9" width="12" height="12"/></a>
            raise ValueError("Base URL is required. Set SWC_API_BASE_URL 
                              environment variable.")

        self.swc_backoff = backoff
        self.swc_backoff_max_time = backoff_max_time
        self.swc_bulk_file_format = bulk_file_format

    def __str__(self): <a class="co" id="co_batteries_included__creating_a_python_sdk_CO4-10" href="#callout_batteries_included__creating_a_python_sdk_CO4-10"><img src="assets/10.png" alt="10" width="12" height="12"/></a>
        """Stringify function to return contents of config object for logging"""
        return f"{self.swc_base_url} {self.swc_backoff} 
        {self.swc_backoff_max_time}  {self.swc_bulk_file_format}"</pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_batteries_included__creating_a_python_sdk_CO4-1" href="#co_batteries_included__creating_a_python_sdk_CO4-1"><img src="assets/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>This import will be used to get environment variables from the Python <span class="keep-together">environment.</span></p></dd>
<dt><a class="co" id="callout_batteries_included__creating_a_python_sdk_CO4-2" href="#co_batteries_included__creating_a_python_sdk_CO4-2"><img src="assets/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>This statement loads external variables from a <em>.env</em> file or the operating systems environment.</p></dd>
<dt><a class="co" id="callout_batteries_included__creating_a_python_sdk_CO4-3" href="#co_batteries_included__creating_a_python_sdk_CO4-3"><img src="assets/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p>The <code>swc_base_url</code> will be used to access the API.</p></dd>
<dt><a class="co" id="callout_batteries_included__creating_a_python_sdk_CO4-4" href="#co_batteries_included__creating_a_python_sdk_CO4-4"><img src="assets/4.png" alt="4" width="12" height="12"/></a></dt>
<dd><p>The <code>swc_backoff</code> determines if the SDK should retry the call using backoff when errors occur.</p></dd>
<dt><a class="co" id="callout_batteries_included__creating_a_python_sdk_CO4-5" href="#co_batteries_included__creating_a_python_sdk_CO4-5"><img src="assets/5.png" alt="5" width="12" height="12"/></a></dt>
<dd><p>The <code>swc_backoff_max_time</code> The max number of seconds the SDK should keep trying an API call before stopping.</p></dd>
<dt><a class="co" id="callout_batteries_included__creating_a_python_sdk_CO4-6" href="#co_batteries_included__creating_a_python_sdk_CO4-6"><img src="assets/6.png" alt="6" width="12" height="12"/></a></dt>
<dd><p>The <code>swc_bulk_file_format</code> sets the format for bulk files.</p></dd>
<dt><a class="co" id="callout_batteries_included__creating_a_python_sdk_CO4-7" href="#co_batteries_included__creating_a_python_sdk_CO4-7"><img src="assets/7.png" alt="7" width="12" height="12"/></a></dt>
<dd><p>The <code>__init__</code> method is executed onced when this class is created. It is used to set the class variables from the parameters the user passes in. Default values are set in this method.</p></dd>
<dt><a class="co" id="callout_batteries_included__creating_a_python_sdk_CO4-8" href="#co_batteries_included__creating_a_python_sdk_CO4-8"><img src="assets/8.png" alt="8" width="12" height="12"/></a></dt>
<dd><p>This line sets the internal URL from a parameter that passed in the constructor, or from the environment if there is no parameter in the constructor.</p></dd>
<dt><a class="co" id="callout_batteries_included__creating_a_python_sdk_CO4-9" href="#co_batteries_included__creating_a_python_sdk_CO4-9"><img src="assets/9.png" alt="9" width="12" height="12"/></a></dt>
<dd><p>This statement checks if a URL has been provided through one of the methods described previously. If none is present, this raises an exception and the loading stops. This class can’t be used without a URL to access the API.</p></dd>
<dt><a class="co" id="callout_batteries_included__creating_a_python_sdk_CO4-10" href="#co_batteries_included__creating_a_python_sdk_CO4-10"><img src="assets/10.png" alt="10" width="12" height="12"/></a></dt>
<dd><p>The <code>__str__</code> method is used by external programs to log the contents of this class. If you don’t provide a custom method like this, a default method would be created, but it might have less useful information.</p></dd>
</dl>

<p>Next, modify the <em>__init__.py</em> file in the <em>chapter7/sdk/src/swcpy</em> directory so that it looks like the following:</p>

<pre data-type="programlisting" data-code-language="python">from .swc_client import SWCClient
from .swc_config import SWCConfig</pre>

<p>These imports simplify the process of importing the classes in a user’s code.<a data-type="indexterm" data-startref="ch7deflt" id="id1551"/></p>
</div></section>








<section data-type="sect2" data-pdf-bookmark="Expert Tip: Providing Rich Functionality"><div class="sect2" id="id76">
<h2>Expert Tip: Providing Rich Functionality</h2>

<p>Simon Yu suggested that an SDK <a data-type="indexterm" data-primary="SDK (software development kit)" data-secondary="building robust and feature-rich SDK" data-tertiary="rich functionality" id="ch7rchfcn"/><a data-type="indexterm" data-primary="Yu, Simon" id="id1552"/>should be rich with features that save a significant amount of coding for developers. A survey of the SDKs I reviewed in this chapter found features such as handling versions, handling pagination, client-side caching, and authentication. You will include two advanced features: data type validation and retry/backoff logic.</p>

<p>It is time-consuming for <a data-type="indexterm" data-primary="SDK (software development kit)" data-secondary="building robust and feature-rich SDK" data-tertiary="data validation" id="id1553"/><a data-type="indexterm" data-primary="Pydantic" data-secondary="data validation" data-tertiary="SDK" id="id1554"/><a data-type="indexterm" data-primary="data validation" data-secondary="Pydantic for" data-tertiary="SDK" id="id1555"/>end users to add data validation in their code. They have to read the API documentation to determine valid data types and values, and then add a lot of code that checks values and throws errors. When SDK developers add data validation, this is a big benefit to users. The original API developers have detailed knowledge of the workings of the API, which makes it easier for them to add validations to the SDK. You have an additional advantage for this Python SDK: access to the original Pydantic classes the API was built with. You can reuse the Chapter 7 <em>schemas.py</em> file in your SDK, giving your SDK powerful data validation at a minimal effort.</p>

<p>Create a <em>schemas</em> folder and <em>__init__.py</em>file as follows:</p>

<pre data-type="programlisting" data-code-language="shell">.../sdk (main) $ mkdir src/swcpy/schemas
.../sdk (main) $ echo "from .schemas import *" &gt; src/swcpy/schemas/__init__.py</pre>

<p class="less_space pagebreak-before">Copy the schemas file from the <em>chapter6</em> directory (or <em>chapter6/complete</em> if you haven’t finished <a data-type="xref" href="ch06.html#chapter_6">Chapter 6</a>) into this chapter’s directories as follows:</p>

<pre data-type="programlisting" data-code-language="shell">.../sdk (main) $ cp ../../chapter6/complete/schemas.py src/swcpy/schemas</pre>

<p>Now you will rebuild the client<a data-type="indexterm" data-primary="SDK (software development kit)" data-secondary="building robust and feature-rich SDK" data-tertiary="swc_client.py file" id="id1556"/> from scratch, step by step. First, you will add the imports and the class constructor. Replace the entire <em>swc_client.py</em> file with the following content:</p>

<pre data-type="programlisting" data-code-language="python">import httpx
import swcpy.swc_config as config <a class="co" id="co_batteries_included__creating_a_python_sdk_CO5-1" href="#callout_batteries_included__creating_a_python_sdk_CO5-1"><img src="assets/1.png" alt="1" width="12" height="12"/></a>
from .schemas import League, Team, Player, Performance <a class="co" id="co_batteries_included__creating_a_python_sdk_CO5-2" href="#callout_batteries_included__creating_a_python_sdk_CO5-2"><img src="assets/2.png" alt="2" width="12" height="12"/></a>
from typing import List <a class="co" id="co_batteries_included__creating_a_python_sdk_CO5-3" href="#callout_batteries_included__creating_a_python_sdk_CO5-3"><img src="assets/3.png" alt="3" width="12" height="12"/></a>
import backoff <a class="co" id="co_batteries_included__creating_a_python_sdk_CO5-4" href="#callout_batteries_included__creating_a_python_sdk_CO5-4"><img src="assets/4.png" alt="4" width="12" height="12"/></a>
import logging <a class="co" id="co_batteries_included__creating_a_python_sdk_CO5-5" href="#callout_batteries_included__creating_a_python_sdk_CO5-5"><img src="assets/5.png" alt="5" width="12" height="12"/></a>
logger = logging.getLogger(__name__)

class SWCClient:
    """Interacts with the SportsWorldCentral API.

        This SDK class simplifies the process of using the SWC Fantasy
        Football API. It supports all the functions of the SWC API and returns
        validated data types.

    Typical usage example:

        client = SWCClient()
        response = client.get_health_check()

    """

    HEALTH_CHECK_ENDPOINT = "/" <a class="co" id="co_batteries_included__creating_a_python_sdk_CO5-6" href="#callout_batteries_included__creating_a_python_sdk_CO5-6"><img src="assets/6.png" alt="6" width="12" height="12"/></a>
    LIST_LEAGUES_ENDPOINT = "/v0/leagues/"
    LIST_PLAYERS_ENDPOINT = "/v0/players/"
    LIST_PERFORMANCES_ENDPOINT = "/v0/performances/"
    LIST_TEAMS_ENDPOINT = "/v0/teams/"
    GET_COUNTS_ENDPOINT = "/v0/counts/"

    BULK_FILE_BASE_URL = (
        "https://raw.githubusercontent.com/<em>[github ID]</em>" <a class="co" id="co_batteries_included__creating_a_python_sdk_CO5-7" href="#callout_batteries_included__creating_a_python_sdk_CO5-7"><img src="assets/7.png" alt="7" width="12" height="12"/></a>
        + "/portfolio-project/main/bulk/"
    )

    def __init__(self, input_config: config.SWCConfig): <a class="co" id="co_batteries_included__creating_a_python_sdk_CO5-8" href="#callout_batteries_included__creating_a_python_sdk_CO5-8"><img src="assets/8.png" alt="8" width="12" height="12"/></a>
        """Class constructor that sets variables from configuration object."""

        logger.debug(f"Bulk file base URL: {self.BULK_FILE_BASE_URL}")

        logger.debug(f"Input config: {input_config}")

        self.swc_base_url = input_config.swc_base_url
        self.backoff = input_config.swc_backoff
        self.backoff_max_time = input_config.swc_backoff_max_time
        self.bulk_file_format = input_config.swc_bulk_file_format

        self.BULK_FILE_NAMES = { <a class="co" id="co_batteries_included__creating_a_python_sdk_CO5-9" href="#callout_batteries_included__creating_a_python_sdk_CO5-9"><img src="assets/9.png" alt="9" width="12" height="12"/></a>
            "players": "player_data",
            "leagues": "league_data",
            "performances": "performance_data",
            "teams": "team_data",
            "team_players": "team_player_data",
        }

        if self.backoff: <a class="co" id="co_batteries_included__creating_a_python_sdk_CO5-10" href="#callout_batteries_included__creating_a_python_sdk_CO5-10"><img src="assets/10.png" alt="10" width="12" height="12"/></a>
            self.call_api = backoff.on_exception(
                wait_gen=backoff.expo,
                exception=(httpx.RequestError, httpx.HTTPStatusError),
                max_time=self.backoff_max_time,
                jitter=backoff.random_jitter,
            )(self.call_api)

        if self.bulk_file_format.lower() == "parquet": <a class="co" id="co_batteries_included__creating_a_python_sdk_CO5-11" href="#callout_batteries_included__creating_a_python_sdk_CO5-11"><img src="assets/11.png" alt="11" width="12" height="12"/></a>
            self.BULK_FILE_NAMES = {
                key: value + ".parquet" for key, value in 
                self.BULK_FILE_NAMES.items()
            }
        else:
            self.BULK_FILE_NAMES = {
                key: value + ".csv" for key, value in 
                self.BULK_FILE_NAMES.items()
            }

        logger.debug(f"Bulk file dictionary: {self.BULK_FILE_NAMES}")</pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_batteries_included__creating_a_python_sdk_CO5-1" href="#co_batteries_included__creating_a_python_sdk_CO5-1"><img src="assets/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>This imports the <em>swc_config.py</em> file you created.</p></dd>
<dt><a class="co" id="callout_batteries_included__creating_a_python_sdk_CO5-2" href="#co_batteries_included__creating_a_python_sdk_CO5-2"><img src="assets/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>This is used to import the Pydantic schemas.</p></dd>
<dt><a class="co" id="callout_batteries_included__creating_a_python_sdk_CO5-3" href="#co_batteries_included__creating_a_python_sdk_CO5-3"><img src="assets/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p>This is used for additional type hints for the Pydantic classes.</p></dd>
<dt><a class="co" id="callout_batteries_included__creating_a_python_sdk_CO5-4" href="#co_batteries_included__creating_a_python_sdk_CO5-4"><img src="assets/4.png" alt="4" width="12" height="12"/></a></dt>
<dd><p>This is used to implement exponential backoff.</p></dd>
<dt><a class="co" id="callout_batteries_included__creating_a_python_sdk_CO5-5" href="#co_batteries_included__creating_a_python_sdk_CO5-5"><img src="assets/5.png" alt="5" width="12" height="12"/></a></dt>
<dd><p>This import statement and the following line of code are used to log debug and error messages.</p></dd>
<dt><a class="co" id="callout_batteries_included__creating_a_python_sdk_CO5-6" href="#co_batteries_included__creating_a_python_sdk_CO5-6"><img src="assets/6.png" alt="6" width="12" height="12"/></a></dt>
<dd><p>This adds class constants for all the API’s endpoints.</p></dd>
<dt><a class="co" id="callout_batteries_included__creating_a_python_sdk_CO5-7" href="#co_batteries_included__creating_a_python_sdk_CO5-7"><img src="assets/7.png" alt="7" width="12" height="12"/></a></dt>
<dd><p>You need to replace the <code><em>[github ID]</em></code> with your GitHub ID so that the path to the bulk files works correctly.</p></dd>
<dt><a class="co" id="callout_batteries_included__creating_a_python_sdk_CO5-8" href="#co_batteries_included__creating_a_python_sdk_CO5-8"><img src="assets/8.png" alt="8" width="12" height="12"/></a></dt>
<dd><p>The <code>SWCClient</code> class constructor accepts an instance of <code>SWCConfig</code> now. The user puts all of their configuration in this object and passes it to the client.</p></dd>
<dt><a class="co" id="callout_batteries_included__creating_a_python_sdk_CO5-9" href="#co_batteries_included__creating_a_python_sdk_CO5-9"><img src="assets/9.png" alt="9" width="12" height="12"/></a></dt>
<dd><p>This creates a dictionary of bulk filenames without a file extension.</p></dd>
<dt><a class="co" id="callout_batteries_included__creating_a_python_sdk_CO5-10" href="#co_batteries_included__creating_a_python_sdk_CO5-10"><img src="assets/10.png" alt="10" width="12" height="12"/></a></dt>
<dd><p>This is a conditional decorator, which will update the <code>call_api()</code> method to have backoff functionality if the user configures it. The backoff will be explained further later.</p></dd>
<dt><a class="co" id="callout_batteries_included__creating_a_python_sdk_CO5-11" href="#co_batteries_included__creating_a_python_sdk_CO5-11"><img src="assets/11.png" alt="11" width="12" height="12"/></a></dt>
<dd><p>This code appends a file extension of <em>.csv</em> or <em>.parquet</em> to the filenames dictionary. It uses a dictionary comprehension, which is an efficient and Pythonic way to update all the elements in a dictionary.</p></dd>
</dl>

<p>The retry and backoff functionality you added in the client has a few unexpected twists and turns. When you make an API call from your SDK, sometimes it may fail due to a temporary network hiccup or slowdown in the API. It might be due to a load-balancing issue or a service that is in the middle of bringing more servers online to handle increased load. If you are running a process that uses the API, you can make it more resilient by retrying a few times before giving up.</p>

<p>However, the way you retry may cause some unexpected consequences on the API provider. For example, you could decide that if an API call fails, you will continually retry every microsecond until it succeeds. This would be the equivalent of a web user clicking Refresh continually until the web page is back up. One user doing that might not cause that much of a headache. But what about when hundreds or thousands of users are retrying the API continually in the middle of a network outage, or when an API provider is trying to bring more resources online? These users will be hitting it with a massive load at a time when it’s least able to respond.  This is like an accidental distributed denial-of-service (DDOS) attack from your own users.</p>

<p>API consumers and SDK developers<a data-type="indexterm" data-primary="SDK (software development kit)" data-secondary="building robust and feature-rich SDK" data-tertiary="exponential backoff instead of retries" id="id1557"/><a data-type="indexterm" data-primary="exponential backoff instead of simple retries" id="id1558"/><a data-type="indexterm" data-primary="backoff and retry process" data-secondary="exponential backoff instead of simple retries" id="id1559"/> can implement <em>exponential backoff</em> instead of simple retries. With this method, the time between retries gets exponentially longer with each failed attempt. This method recognizes that a service that is failing needs a break, and the more failures that happen, the more of a break it needs. For example, a client might double the time between retries each time it fails. Using this method, it would retry at 1 second, 2 seconds, 4 seconds, 8 seconds, and so on until it reached a preset stopping point.</p>

<p>This is an improvement, but can you see any issue with everyone using this method? <a data-type="indexterm" data-primary="exponential backoff instead of retries" data-secondary="article online" id="id1560"/><a data-type="indexterm" data-primary="resources online" data-secondary="exponential backoff article" id="id1561"/><a data-type="indexterm" data-primary="backoff and retry process" data-secondary="exponential backoff instead of simple retries" data-tertiary="article online" id="id1562"/>The problem is explained very clearly on AWS’s <em>Architecture</em> blog in <a href="https://oreil.ly/tSRCm">“Exponential Backoff And Jitter”</a>, and <a data-type="xref" href="#attempts_per_second_ch7">Figure 7-3</a> gives a simplified visualization. The numbers across the bottom are seconds after an outage, and the vertical bars are the number of retry attempts occurring in that second.</p>

<figure><div id="attempts_per_second_ch7" class="figure">
<img src="assets/haad_0703.png" alt="The problem with exponential backoff" width="563" height="330"/>
<h6><span class="label">Figure 7-3. </span>The problem with exponential backoff</h6>
</div></figure>

<p>As you can see from the image, if multiple people are using the same settings for exponential backoff (as they would be if they’re all using your SDK with defaults), they are likely to still cluster around the same intervals to retry. This is because, when an outage occurs, it will probably hit many users at the same time, starting their retry clock. This is not what you want. <a data-type="indexterm" data-primary="SDK (software development kit)" data-secondary="building robust and feature-rich SDK" data-tertiary="exponential backoff with jitters" id="id1563"/><a data-type="indexterm" data-primary="exponential backoff instead of retries" data-secondary="with jitters" id="id1564"/><a data-type="indexterm" data-primary="backoff and retry process" data-secondary="exponential backoff instead of simple retries" data-tertiary="with jitters" id="id1565"/>The solution is to introduce <em>jitter</em>, which is a somewhat random element that is combined with the backoff. Using this method, you get the benefit of backing off retries without the clustering of retries in the same intervals. The best of both worlds is exponential backoff with jitter.</p>

<p>The code you added to <em>swc_client.py</em> implemented<a data-type="indexterm" data-primary="backoff Python library" id="id1566"/> exponential backoff with random jitter using the <a href="https://oreil.ly/PUZbE">backoff Python library</a>. To use this library, you added the decorator <code>backoff.on_exception</code> onto the <code>call_api()</code> function. This wraps the function call with backoff, without having to make any changes to the function itself. If the SDK user uses backoff, the <code>call_api()</code> function will be 
<span class="keep-together">wrapped</span> with this additional functionality.</p>

<p>Take another look at the decorator you added to your code:</p>

<pre data-type="programlisting" data-code-language="python">        if self.backoff:
            self.get_url = backoff.on_exception(
                wait_gen=backoff.expo, <a class="co" id="co_batteries_included__creating_a_python_sdk_CO6-1" href="#callout_batteries_included__creating_a_python_sdk_CO6-1"><img src="assets/1.png" alt="1" width="12" height="12"/></a>
                exception=(httpx.RequestError, httpx.HTTPStatusError), <a class="co" id="co_batteries_included__creating_a_python_sdk_CO6-2" href="#callout_batteries_included__creating_a_python_sdk_CO6-2"><img src="assets/2.png" alt="2" width="12" height="12"/></a>
                max_time=self.backoff_max_time, <a class="co" id="co_batteries_included__creating_a_python_sdk_CO6-3" href="#callout_batteries_included__creating_a_python_sdk_CO6-3"><img src="assets/3.png" alt="3" width="12" height="12"/></a>
                jitter=backoff.random_jitter, <a class="co" id="co_batteries_included__creating_a_python_sdk_CO6-4" href="#callout_batteries_included__creating_a_python_sdk_CO6-4"><img src="assets/4.png" alt="4" width="12" height="12"/></a>
            )(self.call_api)</pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_batteries_included__creating_a_python_sdk_CO6-1" href="#co_batteries_included__creating_a_python_sdk_CO6-1"><img src="assets/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>If an exception occurs, retry starting at 1 second, then doubling every retry.</p></dd>
<dt><a class="co" id="callout_batteries_included__creating_a_python_sdk_CO6-2" href="#co_batteries_included__creating_a_python_sdk_CO6-2"><img src="assets/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>Look for <code>RequestError</code> and <code>HTTPStatusError</code> exceptions from the <code>call_api</code> function.<a data-type="indexterm" data-primary="httpx Python library" data-secondary="exceptions from call_api function" id="id1567"/></p></dd>
<dt><a class="co" id="callout_batteries_included__creating_a_python_sdk_CO6-3" href="#co_batteries_included__creating_a_python_sdk_CO6-3"><img src="assets/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p>Stop retrying after the <code>backoff_max_time</code> parameter (which defaults to 30 <span class="keep-together">seconds).</span></p></dd>
<dt><a class="co" id="callout_batteries_included__creating_a_python_sdk_CO6-4" href="#co_batteries_included__creating_a_python_sdk_CO6-4"><img src="assets/4.png" alt="4" width="12" height="12"/></a></dt>
<dd><p>Apply random jitter so that it varies slightly from the exact second.<a data-type="indexterm" data-startref="ch7rchfcn" id="id1568"/></p></dd>
</dl>
</div></section>








<section data-type="sect2" data-pdf-bookmark="Expert Tip: Performing Logging"><div class="sect2" id="id77">
<h2>Expert Tip: Performing Logging</h2>

<p>You don’t want your SDK<a data-type="indexterm" data-primary="SDK (software development kit)" data-secondary="building robust and feature-rich SDK" data-tertiary="logging" id="ch7log"/><a data-type="indexterm" data-primary="logging" data-secondary="SDK logging" id="ch7log2"/><a data-type="indexterm" data-primary="SDK (software development kit)" data-secondary="source code published" id="id1569"/> to be a black box—you want users to understand what’s occurring under the hood. One way to do this is by publishing the source code on a public repository. The other is by providing meaningful logging, which helps when the user is encountering errors or isn’t returning the results expected.</p>

<p>To be Pythonic, your SDK will use Python’s built-in <em>logging</em> library, <a data-type="indexterm" data-primary="logging" data-secondary="SDK logging" data-tertiary="levels of" id="id1570"/><a data-type="indexterm" data-primary="resources online" data-secondary="Python" data-tertiary="logging levels documentation" id="id1571"/>and allow the users to configure what level of logging they want to print. For example, they may only want to log serious errors in production logs while logging debug messages during development. <a data-type="xref" href="#python_logging_levels_ch7">Table 7-1</a> shows the logging levels available, according to the <a href="https://oreil.ly/CmUps">official Python docs</a>.</p>
<table id="python_logging_levels_ch7">
<caption><span class="label">Table 7-1. </span>Python logging levels</caption>
<thead>
<tr>
<th>Level</th>
<th>What it means/when to use it</th>
</tr>
</thead>
<tbody>
<tr>
<td><p><code>logging.DEBUG</code></p></td>
<td><p>Detailed information, typically only of interest to a developer trying to diagnose a problem.</p></td>
</tr>
<tr>
<td><p><code>logging.INFO</code></p></td>
<td><p>Confirmation that things are working as expected.</p></td>
</tr>
<tr>
<td><p>
<span class="keep-together"><code>logging.WARNING</code></span></p></td>
<td><p>An indication that something unexpected happened, or that a problem might occur in the near future (e.g., disk space low). The software is still working as expected.</p></td>
</tr>
<tr>
<td><p><code>logging.ERROR</code></p></td>
<td><p>Indicates that, due to a more serious problem, the software has not been able to perform some function.</p></td>
</tr>
<tr>
<td><p>
<span class="keep-together"><code>logging.CRITICAL</code></span></p></td>
<td><p>A serious error, indicating that the program itself may be unable to continue running.</p></td>
</tr>
</tbody>
</table>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>In this chapter, you will see<a data-type="indexterm" data-primary="pytest" data-secondary="logging messages in terminal" id="id1572"/> logging messages in the terminal when you run <code>pytest</code> if an error occurs. By default, any messages with a log level of <code>WARNING</code> or more severe will be displayed. If you want to see <code>INFO</code> or <code>DEBUG</code> messages, you can use the <code>--log-level</code> command-line option.</p>
</div>

<p>You added the import statements and created a <code>logger</code> object earlier in this chapter. You will see this functionality in action in a new method that you will create, named <code>call_api()</code>. Add the following code at the bottom of <em>swc_client.py</em>:<a data-type="indexterm" data-primary="SDK (software development kit)" data-secondary="building robust and feature-rich SDK" data-tertiary="swc_client.py file" id="id1573"/><a data-type="indexterm" data-primary="httpx Python library" data-secondary="httpx.Client" data-tertiary="API calls via" id="id1574"/></p>

<pre data-type="programlisting" data-code-language="python">    def call_api(self, <a class="co" id="co_batteries_included__creating_a_python_sdk_CO7-1" href="#callout_batteries_included__creating_a_python_sdk_CO7-1"><img src="assets/1.png" alt="1" width="12" height="12"/></a>
            api_endpoint: str, <a class="co" id="co_batteries_included__creating_a_python_sdk_CO7-2" href="#callout_batteries_included__creating_a_python_sdk_CO7-2"><img src="assets/2.png" alt="2" width="12" height="12"/></a>
            api_params: dict = None <a class="co" id="co_batteries_included__creating_a_python_sdk_CO7-3" href="#callout_batteries_included__creating_a_python_sdk_CO7-3"><img src="assets/3.png" alt="3" width="12" height="12"/></a>
        ) -&gt; httpx.Response: <a class="co" id="co_batteries_included__creating_a_python_sdk_CO7-4" href="#callout_batteries_included__creating_a_python_sdk_CO7-4"><img src="assets/4.png" alt="4" width="12" height="12"/></a>
        """Makes API call and logs errors."""

        if api_params: <a class="co" id="co_batteries_included__creating_a_python_sdk_CO7-5" href="#callout_batteries_included__creating_a_python_sdk_CO7-5"><img src="assets/5.png" alt="5" width="12" height="12"/></a>
            api_params = {key: val for key, val in api_params.items() if val 
            is not None}

        try:
            with httpx.Client(base_url=self.swc_base_url) as client:  <a class="co" id="co_batteries_included__creating_a_python_sdk_CO7-6" href="#callout_batteries_included__creating_a_python_sdk_CO7-6"><img src="assets/6.png" alt="6" width="12" height="12"/></a>
                logger.debug(f"base_url: {self.swc_base_url}, api_endpoint:
                 {api_endpoint}, api_params: {api_params}") <a class="co" id="co_batteries_included__creating_a_python_sdk_CO7-7" href="#callout_batteries_included__creating_a_python_sdk_CO7-7"><img src="assets/7.png" alt="7" width="12" height="12"/></a>
                response = client.get(api_endpoint, params=api_params)
                logger.debug(f"Response JSON: {response.json()}")
                return response
        except httpx.HTTPStatusError as e:
            logger.error(
                f"HTTP status error occurred: {e.response.status_code} 
                {e.response.text}"
            )
            raise
        except httpx.RequestError as e:
            logger.error(f"Request error occurred: {str(e)}")
            raise</pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_batteries_included__creating_a_python_sdk_CO7-1" href="#co_batteries_included__creating_a_python_sdk_CO7-1"><img src="assets/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Because this is a class method, the first parameter is always <code>self</code>, which represents the instance of this class.</p></dd>
<dt><a class="co" id="callout_batteries_included__creating_a_python_sdk_CO7-2" href="#co_batteries_included__creating_a_python_sdk_CO7-2"><img src="assets/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>The second parameter to this method is the individual endpoint you are calling.</p></dd>
<dt><a class="co" id="callout_batteries_included__creating_a_python_sdk_CO7-3" href="#co_batteries_included__creating_a_python_sdk_CO7-3"><img src="assets/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p>The query string parameters for the API call are passed in as an optional <span class="keep-together">dictionary.</span></p></dd>
<dt><a class="co" id="callout_batteries_included__creating_a_python_sdk_CO7-4" href="#co_batteries_included__creating_a_python_sdk_CO7-4"><img src="assets/4.png" alt="4" width="12" height="12"/></a></dt>
<dd><p>This is a type hint that the method should return an <code>httpx.Response</code> object.</p></dd>
<dt><a class="co" id="callout_batteries_included__creating_a_python_sdk_CO7-5" href="#co_batteries_included__creating_a_python_sdk_CO7-5"><img src="assets/5.png" alt="5" width="12" height="12"/></a></dt>
<dd><p>This dictionary comprehension removes any empty parameters before calling the API with them.</p></dd>
<dt><a class="co" id="callout_batteries_included__creating_a_python_sdk_CO7-6" href="#co_batteries_included__creating_a_python_sdk_CO7-6"><img src="assets/6.png" alt="6" width="12" height="12"/></a></dt>
<dd><p>This is a context manager that uses <code>httpx.Client</code> for the steps that follow.<a data-type="indexterm" data-primary="Python" data-secondary="context manager via Python object" id="id1575"/><a data-type="indexterm" data-primary="with…​as (Python)" id="id1576"/><a data-type="indexterm" data-primary="context manager" id="id1577"/><a data-type="indexterm" data-primary="httpx Python library" data-secondary="httpx.Client" data-tertiary="context manager" id="id1578"/></p></dd>
<dt><a class="co" id="callout_batteries_included__creating_a_python_sdk_CO7-7" href="#co_batteries_included__creating_a_python_sdk_CO7-7"><img src="assets/7.png" alt="7" width="12" height="12"/></a></dt>
<dd><p>This is logging at the <code>logging.DEBUG</code> level. The parameters are formatted with an F-string, which is a Pythonic way of formatting variable values.</p></dd>
</dl>

<p>The <code>call_api</code> function is used to make the API calls for each SDK function. <a data-type="indexterm" data-primary="try…​except (Python)" id="id1579"/>By centralizing this work, you can apply additional error handling and logging without making your code too long. It adds <code>try…​except</code> logic around the API call. If the API call works, this function logs a <code>logging.DEBUG</code> level message with the data from the response.</p>

<p>Let’s take a closer look at a key line of code in this method:</p>

<pre data-type="programlisting" data-code-language="python">    with httpx.Client(base_url=self.swc_base_url) as client:</pre>

<p>When a statement uses the <code>with…​as</code> format like this, it is using a Python object as a <em>context manager</em>, so that the object is initialized, then the statements inside it run, and then it is cleaned up along with any resources it used. Here, the <code>httpx.Client</code> is the context manager.</p>

<p>According to the <a href="https://oreil.ly/I-xln">HTTPX documentation</a>, the <code>httpx.Client</code> is <a data-type="indexterm" data-primary="httpx Python library" data-secondary="httpx.Client" data-tertiary="API calls via" id="id1580"/><a data-type="indexterm" data-primary="httpx Python library" data-secondary="httpx.Client" data-tertiary="documentation online" id="id1581"/><a data-type="indexterm" data-primary="resources online" data-secondary="httpx.Client documentation" id="id1582"/>an efficient way to make API calls using <em>httpx</em> because it pools resources between API calls. The <code>Client</code> constructor accepts the parameter <code>base_url</code> and will use it for all of the API calls it is used for.</p>

<p>This code is contained inside<a data-type="indexterm" data-primary="httpx Python library" data-secondary="exceptions from call_api function" id="id1583"/> at <code>try…​except</code> block, so if the API call doesn’t work, the <code>except</code> first handles <code>httpx.HTTPStatusError</code>, which is a type of error that will have an HTTP status code. For this type of exception, it logs a <code>logging.ERROR</code> level message and then re-raises the exception. If it’s not that type of exception, it handles <code>httpx.RequestError</code> next. This type of exception doesn’t have an HTTP status code, so it just puts the body of the exception in the log message. Then it re-raises the exception. Re-raising the exception is important because you will be adding retry and backoff logic later in this chapter, and it will be looking for those exceptions.<a data-type="indexterm" data-startref="ch7log" id="id1584"/><a data-type="indexterm" data-startref="ch7log2" id="id1585"/></p>
</div></section>








<section data-type="sect2" data-pdf-bookmark="Expert Tip: Hiding Your API’s Complicated Details"><div class="sect2" id="id78">
<h2>Expert Tip: Hiding Your API’s Complicated Details</h2>

<p>Joey Greco likes SDKs to <a data-type="indexterm" data-primary="SDK (software development kit)" data-secondary="building robust and feature-rich SDK" data-tertiary="hiding complicated details" id="id1586"/><a data-type="indexterm" data-primary="Greco, Joey" id="id1587"/>handle some of the complexities of the underlying API. “As a data consumer, I don’t want to have to worry about API versioning, headers, authentication, rate-limiting, or hunting down the correct endpoints to use,” he said. “I just want to call some function and be able to do things that are meaningful to me.”</p>

<p>Now add the <code>get_health_check</code> and <code>list_leagues</code> <a data-type="indexterm" data-primary="health check" data-secondary="SDK with robust functionality" id="id1588"/>methods to the bottom of the file. Endpoint methods like <code>get_health_check</code> and <code>list_leagues</code> wrap the API calls and shield users from complicated details such as endpoint names and return types. It’s not an exaggeration to say that methods like these are the reason that SDKs exist.</p>

<p>These both use the <code>call_api</code> function that you created. The <code>list_leagues</code> method also<a data-type="indexterm" data-primary="Pydantic" data-secondary="data validation" data-tertiary="SDK" id="id1589"/><a data-type="indexterm" data-primary="SDK (software development kit)" data-secondary="building robust and feature-rich SDK" data-tertiary="data validation" id="id1590"/><a data-type="indexterm" data-primary="data validation" data-secondary="Pydantic for" data-tertiary="SDK" id="id1591"/> uses Pydantic to validate the data returned from the API. If the data from the API does not match the Pydantic class definition, the client will throw an error that can be logged. Add the following code to the bottom of the <em>swc_client.py</em> file:</p>

<pre data-type="programlisting" data-code-language="python">    def get_health_check(self) -&gt; httpx.Response:
        """Checks if API is running and healthy.

        Calls the API health check endpoint and returns a standard
        message if the API is running normally. Can be used to check
        status of API before making more complicated API calls.

        Returns:
          An httpx.Response object that contains the HTTP status,
          JSON response and other information received from the API.

        """
        logger.debug("Entered health check")
        endpoint_url = self.HEALTH_CHECK_ENDPOINT <a class="co" id="co_batteries_included__creating_a_python_sdk_CO8-1" href="#callout_batteries_included__creating_a_python_sdk_CO8-1"><img src="assets/1.png" alt="1" width="12" height="12"/></a>
        return self.call_api(endpoint_url)

    def list_leagues(
        self,
        skip: int = 0, 
        limit: int = 100, 
        minimum_last_changed_date: str = None,
        league_name: str = None,
    ) -&gt; List[League]: <a class="co" id="co_batteries_included__creating_a_python_sdk_CO8-2" href="#callout_batteries_included__creating_a_python_sdk_CO8-2"><img src="assets/2.png" alt="2" width="12" height="12"/></a>
        """Returns a List of Leagues filtered by parameters.

        Calls the API v0/leagues endpoint and returns a list of
        League objects.

        Returns:
        A List of schemas.League objects. Each represents one
        SportsWorldCentral fantasy league.

        """
        logger.debug("Entered list leagues")

        params = {  <a class="co" id="co_batteries_included__creating_a_python_sdk_CO8-3" href="#callout_batteries_included__creating_a_python_sdk_CO8-3"><img src="assets/3.png" alt="3" width="12" height="12"/></a>
            "skip": skip,
            "limit": limit,
            "minimum_last_changed_date": minimum_last_changed_date,
            "league_name": league_name,
        }

        response = self.call_api(self.LIST_LEAGUES_ENDPOINT, params) <a class="co" id="co_batteries_included__creating_a_python_sdk_CO8-4" href="#callout_batteries_included__creating_a_python_sdk_CO8-4"><img src="assets/4.png" alt="4" width="12" height="12"/></a>
        return [League(**league) for league in response.json()] <a class="co" id="co_batteries_included__creating_a_python_sdk_CO8-5" href="#callout_batteries_included__creating_a_python_sdk_CO8-5"><img src="assets/5.png" alt="5" width="12" height="12"/></a></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_batteries_included__creating_a_python_sdk_CO8-1" href="#co_batteries_included__creating_a_python_sdk_CO8-1"><img src="assets/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>The new <code>get_health_check()</code> method uses the <code>call_api()</code> method, instead of calling the API directly as it did in the minimal SDK.</p></dd>
<dt><a class="co" id="callout_batteries_included__creating_a_python_sdk_CO8-2" href="#co_batteries_included__creating_a_python_sdk_CO8-2"><img src="assets/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>The type hint shows that the method should return a <code>List</code> of <code>League</code> objects. 
<span class="keep-together"><code>League</code></span> is a Pydantic class defined in the <em>schemas.py</em> file.</p></dd>
<dt><a class="co" id="callout_batteries_included__creating_a_python_sdk_CO8-3" href="#co_batteries_included__creating_a_python_sdk_CO8-3"><img src="assets/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p>The parameters will be passed in when users call this SDK method. This line of code builds a dictionary containing the parameters.</p></dd>
<dt><a class="co" id="callout_batteries_included__creating_a_python_sdk_CO8-4" href="#co_batteries_included__creating_a_python_sdk_CO8-4"><img src="assets/4.png" alt="4" width="12" height="12"/></a></dt>
<dd><p>This method also calls the <code>call_api</code> method and passes in the query string parameters as a dictionary.</p></dd>
<dt><a class="co" id="callout_batteries_included__creating_a_python_sdk_CO8-5" href="#co_batteries_included__creating_a_python_sdk_CO8-5"><img src="assets/5.png" alt="5" width="12" height="12"/></a></dt>
<dd><p>This looks through the list of dictionaries returned in the API response and populates a <code>List</code> of <code>League</code> objects.</p></dd>
</dl>

<p>Take a look at the final line of code in <code>list_leagues()</code>, which packs a lot into a short syntax:</p>

<pre data-type="programlisting" data-code-language="python">    return [League(**league) for league in response.json()]</pre>

<p>Your goal in this statement is to iterate through the list of dictionaries returned from the API and create a list of Pydantic <code>League</code> objects. <a data-type="indexterm" data-primary="list comprehension (Python)" id="id1592"/>You use a <a href="https://oreil.ly/Fpgem">list comprehension</a>, which is a Pythonic way to build lists without using a recursive loop. Using the general syntax <code>list = [expression for item in iterable]</code>, you can create lists from other lists very easily.</p>

<p>As you iterate through, you want to create a Pydantic <code>League</code> object from each dictionary in the original list. <a data-type="indexterm" data-primary="unpacking operator (Python)" id="id1593"/>You can do this with Python’s <em>unpacking operator</em>.  The statement <code>League(**league)</code> uses two asterisks to unpack the original dictionary into key-value pairs that are passed to the <code>League()</code> constructor. <a data-type="indexterm" data-primary="Pydantic" data-secondary="data validation" data-tertiary="SDK" id="id1594"/><a data-type="indexterm" data-primary="SDK (software development kit)" data-secondary="building robust and feature-rich SDK" data-tertiary="data validation" id="id1595"/><a data-type="indexterm" data-primary="data validation" data-secondary="Pydantic for" data-tertiary="SDK" id="id1596"/>Pydantic performs data validation during the process of creating these objects, so if any invalid data is in the API response, it will error out in this step. With this combination of list comprehension and the unpacking operator, you return a list of <code>League</code> objects that have been validated from the original list of dictionaries.</p>
</div></section>








<section data-type="sect2" data-pdf-bookmark="Expert Tip: Supporting Bulk Downloads"><div class="sect2" id="id79">
<h2>Expert Tip: Supporting Bulk Downloads</h2>
<blockquote>
<p>As a data scientist, I find the complexity of many open data services frustrating. I don’t want to have to learn how to query an endpoint, think about data types, or read through API documentation. Just give me the data!</p>
<p data-type="attribution">Robin Linacre</p>
</blockquote>

<p>Bulk downloads are valuable<a data-type="indexterm" data-primary="Linacre, Robin" id="id1597"/><a data-type="indexterm" data-primary="SDK (software development kit)" data-secondary="building robust and feature-rich SDK" data-tertiary="bulk download support" id="ch7blkdl"/><a data-type="indexterm" data-primary="bulk downloads" data-secondary="SDK capability" id="ch7blkdl2"/><a data-type="indexterm" data-primary="data pipelines" data-secondary="bulk downloads" data-tertiary="SDK capability" id="ch7blkdl3"/> for many API users, but data scientists especially like this feature. Data scientists often use full datasets for analysis and loading data, and they find it frustrating to call multiple endpoints to get subsets of the data. <a data-type="indexterm" data-primary="endpoints of APIs" data-secondary="bulk downloads via FastAPI StaticFiles" id="id1598"/><a data-type="indexterm" data-primary="API endpoints" data-secondary="bulk downloads via FastAPI StaticFiles" id="id1599"/><a data-type="indexterm" data-primary="FastAPI" data-secondary="StaticFiles for bulk downloads" id="id1600"/><a data-type="indexterm" data-primary="StaticFiles (FastAPI)" id="id1601"/>You could serve bulk downloads from an endpoint in your API using <a href="https://oreil.ly/58q0a">FastAPI’s Static Files</a>.</p>

<p>Instead, you will be serving<a data-type="indexterm" data-primary="GitHub" data-secondary="SDK bulk downloads" id="ch7ghblk"/> bulk downloads from SDK methods. Your SDK will access the files from their web-hosted location in your GitHub repository. The URL for each file will be built using the <code>BULK_FILE_BASE_URL</code> and the <code>BULK_FILE_NAMES</code> dictionaries. <a data-type="indexterm" data-primary="comma-separated values (CSV)" data-secondary="SDK data for bulk download" id="id1602"/><a data-type="indexterm" data-primary="Apache Parquet data format" data-secondary="SDK data for bulk download" id="id1603"/>Your repository contains two bulk files for each table you loaded in your SQLite database: one in <em>.csv</em> format and one in <em>.parquet</em> format. By providing these two options, your SDK serves a wide range of bulk data needs.</p>

<p class="less_space pagebreak-before">The bulk files are in the <em>bulk</em> folder of your repository. View the list of these files with the following commands:</p>

<pre data-type="programlisting" data-code-language="shell">.../sdk (main) $ ls /workspaces/portfolio-project/bulk
csv_to_parquet.py     performance_data.parquet  team_data.csv
league_data.csv       player_data.csv           team_data.parquet
league_data.parquet   player_data.parquet       team_player_data.csv
performance_data.csv  readme.md                 team_player_data.parquet</pre>

<p>The files with the <em>.csv</em> extension are <em>comma-separated values</em> files. The following shows the first two rows of the <em>player_data.csv</em> file:</p>

<pre data-type="programlisting">player_id,gsis_id,first_name,last_name,position,last_changed_date
1001,00-0023459,Aaron,Rodgers,QB,2024-04-18</pre>

<p>These are plain-text files with no compression of any kind. The first row contains the column names separated by commas. The remaining rows contain one row for each data record and the data values are separated by commas. CSV files are easily processed in Python libraries such as pandas or in software such as Microsoft Excel.</p>

<p><em>Parquet files</em> use an open source<a data-type="indexterm" data-primary="Apache Parquet data format" data-secondary="definition of" id="id1604"/><a data-type="indexterm" data-primary="Apache Parquet data format" data-secondary="project page online" id="id1605"/><a data-type="indexterm" data-primary="resources online" data-secondary="Apache Parquet" data-tertiary="project page" id="id1606"/> data format that is popular for a variety of data analysis tasks. Here is the official definition from the <a href="https://oreil.ly/K4_0_">Apache Parquet project page</a>: “Apache Parquet is an open source, column-oriented data file format designed for efficient data storage and retrieval. It provides high performance compression and encoding schemes to handle complex data in bulk and is supported in many programming language and analytics tools.”</p>

<p>You will create a separate method to retrieve each file, but the method will retrieve either <em>.csv</em> or <em>.parquet</em> format files based upon the options provided in the <code>bulk_file_format</code> parameter the user selects in the <code>SWCConfig</code> class. The default value is <em>.csv</em> if the user does not provide this parameter.</p>

<p>Add the following method at the bottom of <em>swc_client.py</em>:<a data-type="indexterm" data-primary="SDK (software development kit)" data-secondary="building robust and feature-rich SDK" data-tertiary="swc_client.py file" id="id1607"/></p>

<pre data-type="programlisting" data-code-language="python">    def get_bulk_player_file(self) -&gt; bytes: <a class="co" id="co_batteries_included__creating_a_python_sdk_CO9-1" href="#callout_batteries_included__creating_a_python_sdk_CO9-1"><img src="assets/1.png" alt="1" width="12" height="12"/></a>
        """Returns a bulk file with player data"""

        logger.debug("Entered get bulk player file")

        player_file_path = self.BULK_FILE_BASE_URL + self.BULK_FILE_NAMES
                           ["players"] <a class="co" id="co_batteries_included__creating_a_python_sdk_CO9-2" href="#callout_batteries_included__creating_a_python_sdk_CO9-2"><img src="assets/2.png" alt="2" width="12" height="12"/></a>

        response = httpx.get(player_file_path, follow_redirects=True) <a class="co" id="co_batteries_included__creating_a_python_sdk_CO9-3" href="#callout_batteries_included__creating_a_python_sdk_CO9-3"><img src="assets/3.png" alt="3" width="12" height="12"/></a>

        if response.status_code == 200:
            logger.debug("File downloaded successfully")
            return response.content <a class="co" id="co_batteries_included__creating_a_python_sdk_CO9-4" href="#callout_batteries_included__creating_a_python_sdk_CO9-4"><img src="assets/4.png" alt="4" width="12" height="12"/></a></pre>
<dl class="calloutlist less_space pagebreak-before">
<dt><a class="co" id="callout_batteries_included__creating_a_python_sdk_CO9-1" href="#co_batteries_included__creating_a_python_sdk_CO9-1"><img src="assets/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>The type hint for this method is <code>bytes</code> because the Parquet file is a binary file, not text.</p></dd>
<dt><a class="co" id="callout_batteries_included__creating_a_python_sdk_CO9-2" href="#co_batteries_included__creating_a_python_sdk_CO9-2"><img src="assets/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>This statement builds the URL to an individual file from the web-hosted location in your GitHub repository using the <code>BULK_FILE_BASE_URL</code> and <code>BULK_FILE_NAMES</code> dictionaries.</p></dd>
<dt><a class="co" id="callout_batteries_included__creating_a_python_sdk_CO9-3" href="#co_batteries_included__creating_a_python_sdk_CO9-3"><img src="assets/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p>Instead of using the <code>call_api</code> method, like the other methods do, this method uses the <code>httpx.get()</code> method. The <code>follow_redirects</code> parameter handles any web redirects that occur when retrieving the file.<a data-type="indexterm" data-primary="httpx Python library" data-secondary="httpx.get() method" id="id1608"/></p></dd>
<dt><a class="co" id="callout_batteries_included__creating_a_python_sdk_CO9-4" href="#co_batteries_included__creating_a_python_sdk_CO9-4"><img src="assets/4.png" alt="4" width="12" height="12"/></a></dt>
<dd><p>The method returns <code>response.content</code>, which will contain the binary file.</p></dd>
</dl>

<p>You have created methods that implement all the major functionality of your SDK, although you haven’t created methods for all the endpoints or bulk files yet. <a data-type="indexterm" data-primary="SDK (software development kit)" data-secondary="building robust and feature-rich SDK" data-tertiary="pyproject.toml file" id="id1609"/><a data-type="indexterm" data-primary="pyproject.toml file" id="id1610"/>Update your <em>pyproject.toml</em> file to contain all the new libraries you’ve added, and increment your version number:</p>

<pre data-type="programlisting" data-code-language="python">[build-system]
requires = ["setuptools&gt;=61.0"]
build-backend = "setuptools.build_meta"

[project]
name = "swcpy"
version = "0.0.2" <a class="co" id="co_batteries_included__creating_a_python_sdk_CO10-1" href="#callout_batteries_included__creating_a_python_sdk_CO10-1"><img src="assets/1.png" alt="1" width="12" height="12"/></a>
authors = [
  { name="[enter your name]" },
]
description = "Example Software Development Kit (SDK) from Hands-On API Book 
for AI and Data Science"
requires-python = "&gt;=3.10"
classifiers = [
    "Development Status :: 3 - Alpha",
    "Programming Language :: Python :: 3",
    "License :: OSI Approved :: MIT License",
    "Operating System :: OS Independent",
]
dependencies = [
       'pytest&gt;=8.1',
       'httpx&gt;=0.27.0',
       'pydantic&gt;=2.4.0', <a class="co" id="co_batteries_included__creating_a_python_sdk_CO10-2" href="#callout_batteries_included__creating_a_python_sdk_CO10-2"><img src="assets/2.png" alt="2" width="12" height="12"/></a>
       'backoff&gt;=2.2.1', <a class="co" id="co_batteries_included__creating_a_python_sdk_CO10-3" href="#callout_batteries_included__creating_a_python_sdk_CO10-3"><img src="assets/3.png" alt="3" width="12" height="12"/></a>
       'pyarrow&gt;=16.0', <a class="co" id="co_batteries_included__creating_a_python_sdk_CO10-4" href="#callout_batteries_included__creating_a_python_sdk_CO10-4"><img src="assets/4.png" alt="4" width="12" height="12"/></a>
]</pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_batteries_included__creating_a_python_sdk_CO10-1" href="#co_batteries_included__creating_a_python_sdk_CO10-1"><img src="assets/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Increment the version number of the library to reflect all the new functionality.</p></dd>
<dt><a class="co" id="callout_batteries_included__creating_a_python_sdk_CO10-2" href="#co_batteries_included__creating_a_python_sdk_CO10-2"><img src="assets/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>Import the Pydantic library for your data validation.</p></dd>
<dt><a class="co" id="callout_batteries_included__creating_a_python_sdk_CO10-3" href="#co_batteries_included__creating_a_python_sdk_CO10-3"><img src="assets/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p>Import the backoff library for your backoff and retry functionality.</p></dd>
<dt><a class="co" id="callout_batteries_included__creating_a_python_sdk_CO10-4" href="#co_batteries_included__creating_a_python_sdk_CO10-4"><img src="assets/4.png" alt="4" width="12" height="12"/></a></dt>
<dd><p>Import the PyArrow library for handling Parquet files.<a data-type="indexterm" data-startref="ch7blkdl" id="id1611"/><a data-type="indexterm" data-startref="ch7blkdl2" id="id1612"/><a data-type="indexterm" data-startref="ch7blkdl3" id="id1613"/><a data-type="indexterm" data-startref="ch7ghblk" id="id1614"/></p></dd>
</dl>
</div></section>








<section data-type="sect2" data-pdf-bookmark="Expert Tip: Documenting Your SDK"><div class="sect2" id="id80">
<h2>Expert Tip: Documenting Your SDK</h2>

<p>Just as APIs need documentation,<a data-type="indexterm" data-primary="SDK (software development kit)" data-secondary="building robust and feature-rich SDK" data-tertiary="documenting" id="ch7sdkdoc"/><a data-type="indexterm" data-primary="documentation" data-secondary="SDK" id="ch7sdkdoc2"/> so does your SDK. Since your SDK will be used directly in program code, the first step to documenting your SDK is to add comprehensive docstrings to the methods that will be used by programmers. This is an important part of writing Pythonic code, and it helps data scientists using your SDK in an IDE like VS Code to get hints and code completion that make their work faster and more accurate. As more data scientists use generative AI in their development process, it allows AI assistants and copilots to infer accurate coding suggestions. You provided extensive docstrings in the <em>swc_client.py</em> and <em>swc_config.py</em> files.</p>

<p>You also need to include<a data-type="indexterm" data-primary="README.md file" data-secondary="SDK" id="ch7readsdk"/><a data-type="indexterm" data-primary="SportsWorldCentral (SWC)" data-secondary="README.md updated" data-tertiary="SDK" id="ch7readsdk2"/> a well-written <em>README.md</em> file that explains how to install the SDK and provides examples of using it. This file will be displayed by default in the GitHub repository for your SDK, and it will be the home page for your SDK if you publish it to PyPI.</p>

<p>Create the <em>README.md</em> file as follows:</p>

<pre data-type="programlisting" data-code-language="shell">.../sdk (main) $ touch README.md</pre>

<p>Add the following contents to this file:</p>

<pre data-type="programlisting" data-code-language="markdown"># swcpy software development kit (SDK)
This is the Python SDK to interact with the SportsWorldCentral Football API, 
which was created for the book [Hands-On APIs for AI and Data Science]
(https://handsonapibook.com).

## Installing swcpy

To install this SDK in your environment, execute the following command:

`pip install swcpy@git+https://github.com/{owner of repo}/
 portfolio-project#subdirectory=sdk`

## Example usage

This SDK implements all the endpoints in the SWC API, in addition to providing 
bulk downloads of the SWC fantasy data in CSV format.

### Setting base URL for the API
The SDK looks for a value of `SWC_API_BASE_URL` in the environment. The preferred 
method for setting the base URL for the SWC API is by creating a Python 
`.env` file in your project directory with the following value:

```
SWC_API_BASE_URL={URL of your API}
```

You may also set this value as an environment variable in the environment you 
are using the SDK, or pass it as a parameter to the `SWCConfig()` method.


### Example of normal API functions

To call the SDK functions for normal API endpoints, here is an example:

```python
from swcpy import SWCClient
from swcpy import SWCConfig

config = SWCConfig(swc_base_url="http://0.0.0.0:8000",backoff=False)
client = SWCClient(config)    
leagues_response = client.list_leagues()
print(leagues_response)
```

### Example of bulk data functions

The build data endpoint returns a bytes object. Here is an example of saving 
a file locally from a bulk file endpoint:

```python
import csv
import os
from io import StringIO

config = SWCConfig()
    client = SWCClient(config)    

    """Tests bulk player download through SDK"""
    player_file = client.get_bulk_player_file()


    # Write the file to disk to verify file download
    output_file_path = data_dir + 'players_file.csv'
    with open(output_file_path, 'wb') as f:
        f.write(player_file)
```</pre>

<p>One key section to notice in this file is that it explains to users how they can install your SDK from your GitHub repository. Here is that section:</p>

<pre data-type="programlisting" data-code-language="markdown">## Installing swcpy

To install this SDK in your environment, execute the following command:

`pip install swcpy@git+https://github.com/{owner of repo}
/portfolio-project#subdirectory=sdk`</pre>

<p>You have now created all the files you need and completed all of the coding for the first few endpoints. To see the new structure of your project, run the <code>tree</code> command:</p>

<pre data-type="programlisting">.../sdk (main) $ tree --prune -I 'build|*.egg-info|__pycache__'
.
├── README.md
├── pyproject.toml
└── src
    └── swcpy
        ├── __init__.py
        ├── schemas
        │   ├── __init__.py
        │   └── schemas.py
        ├── swc_client.py
        └── swc_config.py

3 directories, 7 files</pre>

<p>To update your local system with the new version of the SDK using <code>pip</code>, you will use the <code>--upgrade</code> option:<a data-type="indexterm" data-startref="ch7sdkdoc" id="id1615"/><a data-type="indexterm" data-startref="ch7sdkdoc2" id="id1616"/><a data-type="indexterm" data-startref="ch7readsdk" id="id1617"/><a data-type="indexterm" data-startref="ch7readsdk2" id="id1618"/></p>

<pre data-type="programlisting" data-code-language="shell">.../sdk (main) $ pip3 install --upgrade .
Processing /workspaces/portfolio-project/chapter7/sdk
  Installing build dependencies ... done
  Getting requirements to build wheel ... done
  Preparing metadata (pyproject.toml) ... done
...
Successfully built swcpy
Installing collected packages: pydantic-core, backoff, annotated-types, pydantic,
swcpy
  Attempting uninstall: swcpy
    Found existing installation: swcpy 0.0.1
    Uninstalling swcpy-0.0.1:
      Successfully uninstalled swcpy-0.0.1
Successfully installed annotated-types-0.7.0 backoff-2.2.1 pyarrow-16.1.0
pydantic-2.4.2 pydantic-core-2.10.1 swcpy-0.0.2</pre>
</div></section>








<section data-type="sect2" data-pdf-bookmark="Testing Your SDK"><div class="sect2" id="id81">
<h2>Testing Your SDK</h2>

<p>Now you will test the SDK with pytest.<a data-type="indexterm" data-primary="SDK (software development kit)" data-secondary="building robust and feature-rich SDK" data-tertiary="testing" id="ch7test"/><a data-type="indexterm" data-primary="test_swcpy.py" id="ch7test2"/><a data-type="indexterm" data-primary="SDK (software development kit)" data-secondary="building robust and feature-rich SDK" data-tertiary="test_swcpy.py" id="ch7test3"/><a data-type="indexterm" data-primary="pytest" data-secondary="testing SDK" id="ch7test4"/> Create a new directory and file with the following commands:</p>

<pre data-type="programlisting" data-code-language="shell">.../sdk (main) $ mkdir tests
.../sdk (main) $ touch tests/test_swcpy.py</pre>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>There are different pytest layouts you can use to include the tests in your package. <a data-type="indexterm" data-primary="pytest" data-secondary="Good Integration Practices online" id="id1619"/><a data-type="indexterm" data-primary="resources online" data-secondary="pytest Good Integration Practices" id="id1620"/>In this case, you are using the pytest layout style named “tests outside application” that is described in <a href="https://oreil.ly/GM3HU">pytest’s Good Integration Practices</a>. This means that when you run your tests, you are testing against the installed module instead of code in your local path.</p>
</div>

<p>Update <em>test_swcpy.py</em> with the following contents:</p>

<pre data-type="programlisting" data-code-language="python">import pytest
from swcpy import SWCClient <a class="co" id="co_batteries_included__creating_a_python_sdk_CO11-1" href="#callout_batteries_included__creating_a_python_sdk_CO11-1"><img src="assets/1.png" alt="1" width="12" height="12"/></a>
from swcpy import SWCConfig
from swcpy.schemas import League, Team, Player, Performance
from io import BytesIO <a class="co" id="co_batteries_included__creating_a_python_sdk_CO11-2" href="#callout_batteries_included__creating_a_python_sdk_CO11-2"><img src="assets/2.png" alt="2" width="12" height="12"/></a>
import pyarrow.parquet as pq <a class="co" id="co_batteries_included__creating_a_python_sdk_CO11-3" href="#callout_batteries_included__creating_a_python_sdk_CO11-3"><img src="assets/3.png" alt="3" width="12" height="12"/></a>
import pandas as pd <a class="co" id="co_batteries_included__creating_a_python_sdk_CO11-4" href="#callout_batteries_included__creating_a_python_sdk_CO11-4"><img src="assets/4.png" alt="4" width="12" height="12"/></a>
 
def test_health_check(): <a class="co" id="co_batteries_included__creating_a_python_sdk_CO11-5" href="#callout_batteries_included__creating_a_python_sdk_CO11-5"><img src="assets/5.png" alt="5" width="12" height="12"/></a>
    """Tests health check from SDK"""
    config = SWCConfig(swc_base_url="http://0.0.0.0:8000",backoff=False)
    client = SWCClient(config)    
    response = client.get_health_check()
    assert response.status_code == 200
    assert response.json() == {"message": "API health check successful"}

def test_list_leagues(): <a class="co" id="co_batteries_included__creating_a_python_sdk_CO11-6" href="#callout_batteries_included__creating_a_python_sdk_CO11-6"><img src="assets/6.png" alt="6" width="12" height="12"/></a>
    """Tests get leagues from SDK"""
    config = SWCConfig(swc_base_url="http://0.0.0.0:8000",backoff=False)
    client = SWCClient(config)    
    leagues_response = client.list_leagues()
    # Assert the endpoint returned a list object
    assert isinstance(leagues_response, list)
    # Assert each item in the list is an instance of a Pydantic League object
    for league in leagues_response:
        assert isinstance(league, League)
    # Asset that 5 League objects are returned
    assert len(leagues_response) == 5

def test_bulk_player_file_parquet(): <a class="co" id="co_batteries_included__creating_a_python_sdk_CO11-7" href="#callout_batteries_included__creating_a_python_sdk_CO11-7"><img src="assets/7.png" alt="7" width="12" height="12"/></a>
    """Tests bulk player download through SDK - Parquet"""

    config = SWCConfig(bulk_file_format = "parquet") <a class="co" id="co_batteries_included__creating_a_python_sdk_CO11-8" href="#callout_batteries_included__creating_a_python_sdk_CO11-8"><img src="assets/8.png" alt="8" width="12" height="12"/></a>
    client = SWCClient(config)    

    player_file_parquet = client.get_bulk_player_file()

    # Assert the file has the correct number of records (including header)
    player_table = pq.read_table(BytesIO(player_file_parquet)) <a class="co" id="co_batteries_included__creating_a_python_sdk_CO11-9" href="#callout_batteries_included__creating_a_python_sdk_CO11-9"><img src="assets/9.png" alt="9" width="12" height="12"/></a>
    player_df = player_table.to_pandas()
    assert len(player_df) == 1018</pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_batteries_included__creating_a_python_sdk_CO11-1" href="#co_batteries_included__creating_a_python_sdk_CO11-1"><img src="assets/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>The import statement is referencing the package that you installed locally in your environment.</p></dd>
<dt><a class="co" id="callout_batteries_included__creating_a_python_sdk_CO11-2" href="#co_batteries_included__creating_a_python_sdk_CO11-2"><img src="assets/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>This library is used for handling binary files like the Parquet file.</p></dd>
<dt><a class="co" id="callout_batteries_included__creating_a_python_sdk_CO11-3" href="#co_batteries_included__creating_a_python_sdk_CO11-3"><img src="assets/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p>This library is specifically used to process Parquet files.</p></dd>
<dt><a class="co" id="callout_batteries_included__creating_a_python_sdk_CO11-4" href="#co_batteries_included__creating_a_python_sdk_CO11-4"><img src="assets/4.png" alt="4" width="12" height="12"/></a></dt>
<dd><p>You will use the pandas library to read the length of the Parquet files.</p></dd>
<dt><a class="co" id="callout_batteries_included__creating_a_python_sdk_CO11-5" href="#co_batteries_included__creating_a_python_sdk_CO11-5"><img src="assets/5.png" alt="5" width="12" height="12"/></a></dt>
<dd><p>This test method tests health check endpoints.</p></dd>
<dt><a class="co" id="callout_batteries_included__creating_a_python_sdk_CO11-6" href="#co_batteries_included__creating_a_python_sdk_CO11-6"><img src="assets/6.png" alt="6" width="12" height="12"/></a></dt>
<dd><p>This test method tests the method calling your API.</p></dd>
<dt><a class="co" id="callout_batteries_included__creating_a_python_sdk_CO11-7" href="#co_batteries_included__creating_a_python_sdk_CO11-7"><img src="assets/7.png" alt="7" width="12" height="12"/></a></dt>
<dd><p>This test method tests the Parquet bulk file download.</p></dd>
<dt><a class="co" id="callout_batteries_included__creating_a_python_sdk_CO11-8" href="#co_batteries_included__creating_a_python_sdk_CO11-8"><img src="assets/8.png" alt="8" width="12" height="12"/></a></dt>
<dd><p>This sets the configuration option for Parquet files.</p></dd>
<dt><a class="co" id="callout_batteries_included__creating_a_python_sdk_CO11-9" href="#co_batteries_included__creating_a_python_sdk_CO11-9"><img src="assets/9.png" alt="9" width="12" height="12"/></a></dt>
<dd><p>These lines of code use PyArrow and pandas to read the Parquet file and count the records.</p></dd>
</dl>

<p>Now you will run your API in another terminal session so that your SDK can call it. <a data-type="indexterm" data-primary="terminal window of GitHub Codespace" data-secondary="split terminal for second session" id="id1621"/>Open a second terminal session in Codespaces using the split terminal command, as shown in <a data-type="xref" href="#split_terminal_ch7">Figure 7-4</a>.</p>

<figure><div id="split_terminal_ch7" class="figure">
<img src="assets/haad_0704.png" alt="Opening second terminal session" width="281" height="159"/>
<h6><span class="label">Figure 7-4. </span>Opening a second terminal session</h6>
</div></figure>

<p>When you have added the second terminal, you should see it in the split screen, as shown in <a data-type="xref" href="#split_terminal_2_ch7">Figure 7-5</a>.</p>

<figure><div id="split_terminal_2_ch7" class="figure">
<img src="assets/haad_0705.png" alt="Split terminal session" width="793" height="104"/>
<h6><span class="label">Figure 7-5. </span>The split terminal session</h6>
</div></figure>
<div data-type="tip"><h6>Tip</h6>
<p>If you haven’t installed the API in your Codespace previously, you will need to run the command <strong><code>pip3 install -r</code></strong> <strong><code>require⁠ments​.txt</code></strong> in the <em>chapter6/complete</em> directory before running the API.</p>
</div>

<p class="less_space pagebreak-before">In the second window, change directories to <em>chapter6/complete</em> to use the completed API from the repository. Launch the API as shown:<a data-type="indexterm" data-primary="FastAPI" data-secondary="CLI" data-tertiary="fastapi run" id="id1622"/></p>

<pre data-type="programlisting" data-code-language="shell">.../sdk (main) $ cd ../../chapter6/complete
.../chapter6 (main) $ fastapi run main.py
...
INFO:     Started server process [9999]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
INFO:     Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit) <a class="co" id="co_batteries_included__creating_a_python_sdk_CO12-1" href="#callout_batteries_included__creating_a_python_sdk_CO12-1"><img src="assets/1.png" alt="1" width="12" height="12"/></a></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_batteries_included__creating_a_python_sdk_CO12-1" href="#co_batteries_included__creating_a_python_sdk_CO12-1"><img src="assets/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>The <em>test_swcpy.py</em> file should use this address in the <code>swc_base_url=</code> parameter. If it doesn’t have that address, update <em>test_swcpy.py</em> to match the address here.</p></dd>
</dl>

<p>You don’t need to click “Open in Browser” as in previous chapters, because you will be testing the API from the terminal using your SDK.</p>

<p>In the left terminal window, enter the <strong><code>pytest tests/test_swcpy.py</code></strong> command and you should see an output that looks similar to this:</p>

<pre data-type="programlisting" data-code-language="shell">.../sdk (main) $ pytest tests/test_swcpy.py
=========== test session starts ===========
platform linux -- Python 3.10.13, pytest-8.1.2, pluggy-1.5.0
rootdir: /workspaces/portfolio-project/chapter7/sdk
configfile: pyproject.toml
plugins: anyio-4.4.0
collected 3 items

tests/test_swcpy.py ...                  [100%]

============ 3 passed in 0.68s ============</pre>

<p>You have added a lot of great functionality to your SDK. Way to go! Take a moment to consider expert tips and features that you have implemented for your SDK:</p>
<dl>
<dt>Make your SDK easy to install.</dt>
<dd>
<p>You configured your project so that it can be installed using <code>pip3</code> directly from GitHub. You could also publish it to PyPI if you choose.</p>
</dd>
<dt>Be consistent and idiomatic.</dt>
<dd>
<p>You used PEP 8 style and consistent function naming. You used Pythonic techniques like list comprehensions, dictionary comprehensions, and context managers. And you used the Python standard logging function.</p>
</dd>
<dt>Use sane defaults.</dt>
<dd>
<p>You implemented the <code>SWCConfig</code> that will work out of the box with default values but can be customized with URL and other settings.</p>
</dd>
<dt>Provide extra functionality.</dt>
<dd>
<p>You provided data validation, exponential backoff with jitter, and bulk downloads.</p>
</dd>
<dt>Perform logging.</dt>
<dd>
<p>You implemented logging with multiple levels using Python’s built-in logging library.</p>
</dd>
<dt>Hide your API’s complicated details.</dt>
<dd>
<p>You implemented methods that allow users to call the API endpoints without reading the API documentation.</p>
</dd>
<dt>Provide bulk downloads.</dt>
<dd>
<p>You made bulk files available for all your database tables in both <em>.csv</em> and <em>.parquet</em> formats.</p>
</dd>
<dt>Document your SDK.</dt>
<dd>
<p>You provided a <em>README.md</em> file that explains how to install and use the SDK.</p>
</dd>
</dl>

<p>Only one expert tip remains for your SDK, but it’s a big one. You will tackle it next.<a data-type="indexterm" data-startref="ch7test" id="id1623"/><a data-type="indexterm" data-startref="ch7test2" id="id1624"/><a data-type="indexterm" data-startref="ch7test3" id="id1625"/><a data-type="indexterm" data-startref="ch7test4" id="id1626"/></p>
</div></section>








<section data-type="sect2" data-pdf-bookmark="Expert Tip: Supporting Every Task the API Supports"><div class="sect2" id="id82">
<h2>Expert Tip: Supporting Every Task the API Supports</h2>

<p>Ideally, users should be able<a data-type="indexterm" data-primary="SDK (software development kit)" data-secondary="building robust and feature-rich SDK" data-tertiary="supporting every API task" id="id1627"/><a data-type="indexterm" data-primary="endpoints of APIs" data-secondary="SDK supporting every endpoint" id="id1628"/><a data-type="indexterm" data-primary="API endpoints" data-secondary="SDK supporting every endpoint" id="id1629"/> to accomplish any task with the SDK that they could accomplish by directly using the API. This means every API endpoint and parameter should be supported by the SDK. You’ve probably noticed at this point that you’ve only implemented SDK functions for a couple of the API endpoints and one bulk file download. Unfortunately, there’s no room in this chapter to walk you through the remaining code. However, you are prepared to code the rest of the endpoints using the helper functions and naming standards I have demonstrated so far.</p>

<p>I don’t want to leave you hanging completely, so here is some additional information you can use to continue building your SDK. To start with, here are the functions you need to create to cover all the API endpoints:</p>

<ul class="less_space pagebreak-after">
<li>
<p><code>get_health_check</code> (completed)</p>
</li>
<li>
<p><code>list_leagues</code> (completed)</p>
</li>
<li>
<p><code>get_league_by_id</code></p>
</li>
<li>
<p><code>get_counts</code></p>
</li>
<li>
<p><code>list_teams</code></p>
</li>
<li>
<p><code>list_players</code></p>
</li>
<li>
<p><code>get_player_by_id</code></p>
</li>
<li>
<p><code>list_performances</code></p>
</li>
</ul>

<p>Here are the bulk download functions you need to create:</p>

<ul>
<li>
<p><code>get_bulk_player_file</code> (completed)</p>
</li>
<li>
<p><code>get_bulk_league_file</code></p>
</li>
<li>
<p><code>get_bulk_performance_file</code></p>
</li>
<li>
<p><code>get_bulk_team_file</code></p>
</li>
<li>
<p><code>get_bulk_team_player_file</code></p>
</li>
</ul>

<p>I encourage you to take a shot at creating these endpoints following the examples I have given you. Be consistent and idiomatic. <a data-type="indexterm" data-primary="resources online" data-secondary="chapter code" data-tertiary="chapter 7 complete" id="id1630"/>As with earlier chapters, the full completed code is available in the <em>chapter7/complete</em> directory if you would like to check your work.<a data-type="indexterm" data-startref="ch7richdk" id="id1631"/></p>
</div></section>
</div></section>






<section data-type="sect1" data-pdf-bookmark="Completing Your Part I Portfolio Project"><div class="sect1" id="id83">
<h1>Completing Your Part I Portfolio Project</h1>

<p>With the creation of your SDK,<a data-type="indexterm" data-primary="portfolio projects" data-secondary="Part I project ready to share" id="ch7share"/><a data-type="indexterm" data-primary="GitHub" data-secondary="Part I project ready to share" id="ch7share2"/><a data-type="indexterm" data-primary="Codespaces (GitHub)" data-secondary="Part I project ready to share" id="ch7share3"/><a data-type="indexterm" data-primary="publishing" data-secondary="Part I project ready to share" id="ch7share4"/> you have finished all the coding you need for your portfolio project. Congratulations! Hopefully, you have been committing your code with frequent small commits, but be sure to commit any remaining changes you have.</p>

<p>To get your project repository ready to share, you are going to be moving the Chapters  <a data-type="xref" data-xrefstyle="select:labelnumber" href="ch06.html#chapter_6">6</a> and <a data-type="xref" data-xrefstyle="select:labelnumber" href="#chapter_7">7</a>  content to the root folder of your repository, and then removing all the previous chapters.</p>

<p>Before you make these changes, <a data-type="indexterm" data-primary="GitHub" data-secondary="Part I project ready to share" data-tertiary="creating new branch" id="id1632"/><a data-type="indexterm" data-primary="Codespaces (GitHub)" data-secondary="Part I project ready to share" data-tertiary="creating new branch" id="id1633"/>you’ll save a copy of your files to a separate GitHub <em>branch</em>, which is an isolated area in your repository. This will keep the original directory structure you used while working through your code. (You have been doing all your coding in the <em>main</em> branch so far.)  Create the new branch from the command line as follows:</p>

<pre data-type="programlisting" data-code-language="shell">.../sdk (main) $ cd ../.. <a class="co" id="co_batteries_included__creating_a_python_sdk_CO13-1" href="#callout_batteries_included__creating_a_python_sdk_CO13-1"><img src="assets/1.png" alt="1" width="12" height="12"/></a>
.../portfolio-project/ (main) $ git checkout -b learning-branch <a class="co" id="co_batteries_included__creating_a_python_sdk_CO13-2" href="#callout_batteries_included__creating_a_python_sdk_CO13-2"><img src="assets/2.png" alt="2" width="12" height="12"/></a>
Switched to a new branch 'learning-branch'
.../portfolio-project/ (main) $ git push -u origin learning-branch <a class="co" id="co_batteries_included__creating_a_python_sdk_CO13-3" href="#callout_batteries_included__creating_a_python_sdk_CO13-3"><img src="assets/3.png" alt="3" width="12" height="12"/></a>
 * [new branch]      learning-branch -&gt; learning-branch
branch 'learning-branch' set up to track 'origin/learning-branch'.</pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_batteries_included__creating_a_python_sdk_CO13-1" href="#co_batteries_included__creating_a_python_sdk_CO13-1"><img src="assets/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Change to the root directory.</p></dd>
<dt><a class="co" id="callout_batteries_included__creating_a_python_sdk_CO13-2" href="#co_batteries_included__creating_a_python_sdk_CO13-2"><img src="assets/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>Create a new branch named <em>learning-branch</em> locally based on the <em>main</em> branch.</p></dd>
<dt><a class="co" id="callout_batteries_included__creating_a_python_sdk_CO13-3" href="#co_batteries_included__creating_a_python_sdk_CO13-3"><img src="assets/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p>Push this new branch to your remote repository on GitHub.com.</p></dd>
</dl>

<p>To verify that the branch was created on GitHub, go to your GitHub repository and click main. You should see a new branch, as shown in <a data-type="xref" href="#new_branch_ch7">Figure 7-6</a>.</p>

<figure><div id="new_branch_ch7" class="figure">
<img src="assets/haad_0706.png" alt="New branch created." width="499" height="446"/>
<h6><span class="label">Figure 7-6. </span>Newly created branch</h6>
</div></figure>

<p>Back in Codespaces, <a data-type="indexterm" data-primary="GitHub" data-secondary="Part I project ready to share" data-tertiary="moving files" id="id1634"/><a data-type="indexterm" data-primary="Codespaces (GitHub)" data-secondary="Part I project ready to share" data-tertiary="moving files" id="id1635"/>you will move the Chapters  <a data-type="xref" data-xrefstyle="select:labelnumber" href="ch06.html#chapter_6">6</a> and <a data-type="xref" data-xrefstyle="select:labelnumber" href="#chapter_7">7</a>  files to the root of your repository. <a data-type="xref" href="ch06.html#chapter_6">Chapter 6</a> contains the final API files and <a data-type="xref" href="#chapter_7">Chapter 7</a> has the SDK files. Enter the following commands:</p>

<pre data-type="programlisting" data-code-language="shell">.../portfolio-project/ (learning-branch) $ git checkout main <a class="co" id="co_batteries_included__creating_a_python_sdk_CO14-1" href="#callout_batteries_included__creating_a_python_sdk_CO14-1"><img src="assets/1.png" alt="1" width="12" height="12"/></a>
Switched to branch 'main'
Your branch is up to date with 'origin/main'.
.../portfolio-project/ (main) $ rm -rf chapter6/complete
.../portfolio-project/ (main) $ rm -rf chapter7/complete
.../portfolio-project/ (main) $ rm
.../portfolio-project/ (main) $ mv chapter6/* . <a class="co" id="co_batteries_included__creating_a_python_sdk_CO14-2" href="#callout_batteries_included__creating_a_python_sdk_CO14-2"><img src="assets/2.png" alt="2" width="12" height="12"/></a>
.../portfolio-project/ (main) $ mv chapter7/sdk . <a class="co" id="co_batteries_included__creating_a_python_sdk_CO14-3" href="#callout_batteries_included__creating_a_python_sdk_CO14-3"><img src="assets/3.png" alt="3" width="12" height="12"/></a>
.../portfolio-project/ (main) $ rm -rf chapter3 <a class="co" id="co_batteries_included__creating_a_python_sdk_CO14-4" href="#callout_batteries_included__creating_a_python_sdk_CO14-4"><img src="assets/4.png" alt="4" width="12" height="12"/></a>
.../portfolio-project/ (main) $ rm -rf chapter4
.../portfolio-project/ (main) $ rm -rf chapter5
.../portfolio-project/ (main) $ rm -rf chapter6
.../portfolio-project/ (main) $ rm -rf chapter7</pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_batteries_included__creating_a_python_sdk_CO14-1" href="#co_batteries_included__creating_a_python_sdk_CO14-1"><img src="assets/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Switch your Codespace back to the <em>main</em> branch of your repository.</p></dd>
<dt><a class="co" id="callout_batteries_included__creating_a_python_sdk_CO14-2" href="#co_batteries_included__creating_a_python_sdk_CO14-2"><img src="assets/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>Move the API files into your root directory.</p></dd>
<dt><a class="co" id="callout_batteries_included__creating_a_python_sdk_CO14-3" href="#co_batteries_included__creating_a_python_sdk_CO14-3"><img src="assets/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p>Move the SDK files into your <em>sdk</em> directory.</p></dd>
<dt><a class="co" id="callout_batteries_included__creating_a_python_sdk_CO14-4" href="#co_batteries_included__creating_a_python_sdk_CO14-4"><img src="assets/4.png" alt="4" width="12" height="12"/></a></dt>
<dd><p>Remove all the subdirectories and their files.</p></dd>
</dl>

<p class="less_space pagebreak-before">To see the directory structure of the completed project, run the following command:</p>

<pre data-type="programlisting" data-code-language="shell">.../portfolio-project (main) $ tree -d  --prune -I 'build|*.egg-info|__pycache__'
.
├── bulk
└── sdk
    ├── src
    │   └── swcpy
    │       └── schemas
    └── tests
6 directories</pre>

<p>To update your API documentation<a data-type="indexterm" data-primary="Codespaces (GitHub)" data-secondary="Part I project ready to share" data-tertiary="updating README.md" id="id1636"/><a data-type="indexterm" data-primary="GitHub" data-secondary="Part I project ready to share" data-tertiary="updating README.md" id="id1637"/> to mention your SDK, replace the bottom “Software Development Kit (SDK)” section of <em>README.md</em> with the following:</p>

<pre data-type="programlisting" data-code-language="markdown">## Software Development Kit (SDK)

If you are a Python user, you can use the swcpy SDK to interact with our API. 
Full information is available [here](sdk/README.md). </pre>

<p>You’ve performed some serious surgery to your <em>main</em> branch. Make one last commit to GitHub, and you’re all done. Congratulations on completing your Part I capstone!<a data-type="indexterm" data-startref="ch7share" id="id1638"/><a data-type="indexterm" data-startref="ch7share2" id="id1639"/><a data-type="indexterm" data-startref="ch7share3" id="id1640"/><a data-type="indexterm" data-startref="ch7share4" id="id1641"/></p>
</div></section>






<section data-type="sect1" data-pdf-bookmark="Additional Resources"><div class="sect1" id="id84">
<h1>Additional Resources</h1>

<p>For advice on creating an SDK, see the <a href="https://sdks.io">SDKs.io website</a> by APIMatic.<a data-type="indexterm" data-primary="SDKs.io" data-secondary="information source" id="id1642"/><a data-type="indexterm" data-primary="SDKs.io" data-secondary="publisher APIMatic" id="id1643"/><a data-type="indexterm" data-primary="resources online" data-secondary="SDKs.io" id="id1644"/></p>

<p>For more advice from Speakeasy on creating a Python SDK, read <a href="https://oreil.ly/B-vKL">“How to Build a Best in Class Python SDK” by Tristan Cartledge</a>.<a data-type="indexterm" data-primary="Speakeasy" data-secondary="“How to Build a Best in Class Python SDK” online" data-secondary-sortas="How to Build a Best in Class" id="id1645"/><a data-type="indexterm" data-primary="“How to Build a Best in Class Python SDK” (Speakeasy)" data-primary-sortas="How to Build a Best in Class" id="id1646"/></p>

<p>For more advice on writing Pythonic code, check out <a href="https://oreil.ly/ddReB"><em>The Hitchhiker’s Guide to Python</em></a>.<a data-type="indexterm" data-primary="Python" data-secondary="advice on writing Pythonic code" id="id1647"/><a data-type="indexterm" data-primary="The Hitchhiker’s Guide to Python online" data-primary-sortas="Hitchhiker’s Guide to Python" id="id1648"/><a data-type="indexterm" data-primary="resources online" data-secondary="Python" data-tertiary="The Hitchhiker’s Guide to Python" data-tertiary-sortas="Hitchhiker’s Guide to Python" id="id1649"/></p>

<p>To review the benefits of Parquet files for bulk data, read <a href="https://oreil.ly/OmtmF">“Why parquet files are my preferred API for bulk open data” by Robin Linacre</a>.<a data-type="indexterm" data-primary="bulk downloads" data-secondary="parquet file advantages online" id="id1650"/><a data-type="indexterm" data-primary="data pipelines" data-secondary="bulk downloads" data-tertiary="parquet file advantages online" id="id1651"/><a data-type="indexterm" data-primary="Apache Parquet data format" data-secondary="bulk download advantages online" id="id1652"/><a data-type="indexterm" data-primary="resources online" data-secondary="Apache Parquet" data-tertiary="parquet files advantages for bulk download" id="id1653"/><a data-type="indexterm" data-primary="“Why parquet files are my preferred API for bulk open data” (Linacre)" data-primary-sortas="Why parquet files are" id="id1654"/><a data-type="indexterm" data-primary="Linacre, Robin" id="id1655"/></p>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="id1656">
<h1>Extending Your Portfolio Project</h1>
<p>Here are a few ideas to extend your SDK project:<a data-type="indexterm" data-primary="portfolio projects" data-secondary="SDK" data-tertiary="extending portfolio project" id="id1657"/><a data-type="indexterm" data-primary="SDK (software development kit)" data-secondary="portfolio project extended" id="id1658"/><a data-type="indexterm" data-primary="endpoints of APIs" data-secondary="SDK supporting every endpoint" id="id1659"/><a data-type="indexterm" data-primary="API endpoints" data-secondary="SDK supporting every endpoint" id="id1660"/><a data-type="indexterm" data-primary="PyPI Test Repository" data-secondary="publishing SDK" data-tertiary="extending portfolio project" id="id1661"/><a data-type="indexterm" data-primary="SDK (software development kit)" data-secondary="publishing on PyPI Test Repository" id="id1662"/><a data-type="indexterm" data-primary="publishing" data-secondary="SDK on PyPI Test Repository" data-tertiary="extending portfolio project" id="id1663"/></p>

<ul>
<li>
<p>Finish all the endpoint functions remaining. (You didn’t think I forgot, did you?)</p>
</li>
<li>
<p>Publish your SDK on the <a href="https://test.pypi.org">PyPI Test Repository</a> to learn the process of deploying packages. You’re more than halfway there—continue from the <a href="https://oreil.ly/IaQad">“Generating distribution archives”</a> section on the Python packaging tutorial.</p>
</li>
<li>
<p>If you are creating your own portfolio project, create a minimum viable SDK for it using this chapter as a guide.</p>
</li>
</ul>
</div></aside>
</div></section>






<section data-type="sect1" data-pdf-bookmark="Summary"><div class="sect1" id="id385">
<h1>Summary</h1>

<p>In this chapter, you learned from experts in SDK development to identify the features that make a great Python SDK. Then, you went out and coded it! SDKs like the one you developed make life much easier for data scientists and other Python-centric users of your API. While coding the SDK, you applied PEP 8 code style and used a variety of Pythonic techniques such as list comprehensions and context managers.</p>

<p>In <a data-type="xref" href="ch08.html#chapter_8">Chapter 8</a>, you will start looking at APIs from the perspective of the consumer instead of the producer. You will start by learning the skills that data scientists should know about APIs.</p>
</div></section>
</div></section></div>
</div>
</body></html>