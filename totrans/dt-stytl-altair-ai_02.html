<html><head></head><body>
<div id="sbo-rt-content"><div class="readable-text" id="p1">
<h1 class="readable-text-h1"><span class="chapter-title-numbering"><span class="num-string">2</span></span> <span class="chapter-title-text">Running your first data story in Altair and GitHub Copilot</span></h1>
</div>
<div class="introduction-summary">
<h3 class="introduction-header">This chapter covers</h3>
<ul>
<li class="readable-text" id="p2">Introducing Altair</li>
<li class="readable-text" id="p3">A relevant use case: Describing the scenario</li>
<li class="readable-text" id="p4">Using Altair</li>
<li class="readable-text" id="p5">Using Copilot</li>
</ul>
</div>
<div class="readable-text" id="p6">
<p>One of my peculiarities is getting my hands dirty right away. If I don’t feel something right away, I’m not happy. To start using software, or anything in general, I immediately go to the “Getting Started” section. As I need more details, I consult the documentation. This chapter was born with the same idea: to see how things work immediately. We’ll look at a rough but complete sketch of what you’ll learn in the book. In this chapter, we will look at the basic concepts behind Altair, and then we will implement a practical use case, which will allow us to transform a raw dataset into a story. We will progressively apply the data, information, knowledge, wisdom (DIKW) pyramid principles in Altair and see the results achieved step by step. In the second part of the chapter, we will use Copilot to automate some steps of the story creation process. We will focus only on Copilot as a generative AI tool to keep the chapter simple and the flow understandable. In the following chapters, we will introduce ChatGPT and DALL-E to the DIKW pyramid.</p>
</div>
<div class="readable-text" id="p7">
<h2 class="readable-text-h2"><span class="num-string">2.1</span> Introducing Altair</h2>
</div>
<div class="readable-text" id="p8">
<p>The Vega-Altair library (Altair, for short) is a declarative Python library for statistical visualization based on the Vega and Vega-Lite visualization grammars. Vega is a visualization grammar for creating expressive and interactive data visualizations. Vega-Lite is a high-level declarative language built on top of Vega, designed to simplify the creation of common data visualizations with concise and intuitive syntax. We will discuss Vega and Vega-Lite in the next chapter. </p>
</div>
<div class="readable-text intended-text" id="p9">
<p>Altair is a declarative library, meaning you can describe the intended chart outcome rather than needing to manually program every step, defining a concise and intuitive syntax for creating interactive visualizations. We use declarative libraries to specify what we want to see in a chart. We can specify the data and the type of visualization we want, and the library creates the visualization for us automatically. Declarative libraries stand in contrast to imperative libraries, which instead focus on building a visualization manually (e.g., specifying the desired axis, size, legend, and labels). Matplotlib is an example of an imperative library. </p>
</div>
<div class="readable-text intended-text" id="p10">
<p>Every Altair chart has at least three main elements: a chart, a mark, and encodings. We will cover each of these briefly in the following pages. Refer to appendix A for instructions on how to install Altair and the other Python libraries described in this chapter. Refer to appendix B for more details on the pandas DataFrame methods used in this chapter. </p>
</div>
<div class="readable-text" id="p11">
<h3 class="readable-text-h3"><span class="num-string">2.1.1</span> Chart</h3>
</div>
<div class="readable-text" id="p12">
<p>In Altair, a chart is an object that acts as a starting point for constructing and customizing interactive visualizations in Altair. Use the <code>alt.Chart()</code> method to input the dataset you would like to represent visually, as shown in listing 2.1 You can find this example in the GitHub repository for the book under 02/bar-chart.py. Start by cloning the GitHub repository for the book: <a href="https://mng.bz/PZVP">https://mng.bz/PZVP</a>. To get started with GitHub, follow the procedure described in appendix A of the book or the GitHub official documentation (<a href="https://mng.bz/1Geg">https://mng.bz/1Geg</a>). </p>
</div>
<div class="browsable-container listing-container" id="p13">
<h5 class="listing-container-h5 browsable-container-h5"><span class="num-string">Listing 2.1</span> Charts in Altair</h5>
<div class="code-area-container">
<pre class="code-area">import altair as alt
import pandas as pd

data = {'Name': ['Alice', 'Bob', 'Charlie'],
'Age': [25, 30, 35],
'City': ['New York', 'Paris', 'London']
}                                       <span class="aframe-location"/> #1


df = pd.DataFrame(data)    <span class="aframe-location"/> #2

print(df)         <span class="aframe-location"/> #3

chart = alt.Chart(df)    <span class="aframe-location"/> #4</pre>
<div class="code-annotations-overlay-container">
     #1 Creates data for the DataFrame
     <br/>#2 Creates the DataFrame from the data
     <br/>#3 Prints the DataFrame
     <br/>#4 Creates the chart
     <br/>
</div>
</div>
</div>
<div class="readable-text print-book-callout" id="p14">
<p><span class="print-book-callout-head">Note</span>  First, import the required libraries, then build the DataFrame containing your data. Finally, pass the DataFrame to <code>alt.Chart()</code>. The example does not create any visualization because we have not specified what we want to represent. Note that the code is still incomplete, so if you try to run it, it will not work. Be patient. In the next section, you’ll add other pieces to run it!</p>
</div>
<div class="readable-text" id="p15">
<h3 class="readable-text-h3"><span class="num-string">2.1.2</span> Mark</h3>
</div>
<div class="readable-text" id="p16">
<p>A mark defines how to represent data. Examples of marks include bar charts, line charts, area charts, and many others. To specify a mark, append it to the Altair chart. For example, in the following listing, we will specify that we want to use a bar chart.</p>
</div>
<div class="browsable-container listing-container" id="p17">
<h5 class="listing-container-h5 browsable-container-h5"><span class="num-string">Listing 2.2</span> Mark in Altair</h5>
<div class="code-area-container">
<pre class="code-area">chart = alt.Chart(df).mark_bar()</pre>
</div>
</div>
<div class="readable-text print-book-callout" id="p18">
<p><span class="print-book-callout-head">Note</span>  Use <code>mark_bar()</code> to create a bar chart in Altair. </p>
</div>
<div class="readable-text" id="p19">
<p>The chart is not ready yet because you need other pieces before showing it. However, to get an idea, figure 2.1 shows how the final chart will look.<span class="aframe-location"/></p>
</div>
<div class="browsable-container figure-container" id="p20">
<img alt="figure" height="275" src="../Images/2-1.png" width="1041"/>
<h5 class="figure-container-h5"><span class="num-string">Figure 2.1</span> An example of a bar chart</h5>
</div>
<div class="readable-text" id="p21">
<p>There are other examples of marks, such as <code>mark_line()</code>, to plot a line chart (figure 2.2). Additionally, <code>mark_circle()</code> plots a scatter plot (figure 2.3).<span class="aframe-location"/><span class="aframe-location"/></p>
</div>
<div class="browsable-container figure-container" id="p22">
<img alt="figure" height="983" src="../Images/2-2.png" width="950"/>
<h5 class="figure-container-h5"><span class="num-string">Figure 2.2</span> An example of a line chart</h5>
</div>
<div class="browsable-container figure-container" id="p23">
<img alt="figure" height="983" src="../Images/2-3.png" width="958"/>
<h5 class="figure-container-h5"><span class="num-string">Figure 2.3</span> An example of a scatter plot</h5>
</div>
<div class="readable-text" id="p24">
<h3 class="readable-text-h3"><span class="num-string">2.1.3</span> Encodings</h3>
</div>
<div class="readable-text" id="p25">
<p>Encodings specify the mapping between the DataFrame columns and their visual representation in the Altair chart. In practice, encodings define where to represent data in the chart, such as their position, size, and color. In practice, encodings define how data attributes are mapped to visual properties in a chart. For example, you can encode a dataset’s <em>x</em> values as positions on the <em>x</em>-axis and <em>y</em> values as positions on the y-axis. A <em>channel</em> in Altair refers to a visual property, like <code>x</code>, <code>y</code>, <code>color</code>, <code>size</code>, and <code>shape</code>, which can be used to represent data attributes in a chart. </p>
</div>
<div class="readable-text intended-text" id="p26">
<p>Each channel is associated with a data type, which describes the type of data an attribute contains, such as <em>quantitative</em> for numerical data, <em>ordinal</em> for ordered categorical data, or <em>nominal</em> for categorical data with no inherent order. For example, in the following listing, we use encodings to specify which columns of the DataFrame we must use in the x- and y-axes. </p>
</div>
<div class="browsable-container listing-container" id="p27">
<h5 class="listing-container-h5 browsable-container-h5"><span class="num-string">Listing 2.3</span> Encodings in Altair</h5>
<div class="code-area-container">
<pre class="code-area">import pandas as pd
import altair as alt

data = {'Name': ['Alice', 'Bob', 'Charlie'],
        'Age': [25, 30, 35],
        'City': ['New York', 'Paris', 'London']
}                                  <span class="aframe-location"/> #1

df = pd.DataFrame(data)     <span class="aframe-location"/> #2

# Create the chart
chart = alt.Chart(df).mark_bar(
).encode(
    x = 'Age:Q',     
    y = 'Name:N' 
)

chart.save('bar-chart.xhtml')</pre>
<div class="code-annotations-overlay-container">
     #1 Creates data for the DataFrame
     <br/>#2 Creates the DataFrame from the data
     <br/>
</div>
</div>
</div>
<div class="readable-text print-book-callout" id="p28">
<p><span class="print-book-callout-head">Note</span>  Use <code>encode()</code> to define encodings in Altair. Place the <code>Age</code> variable of <code>df</code> on the x-axis and the <code>Name</code> variable of <code>df</code> on the y-axis. Interpret <code>Age</code> as a quantity (<code>Q</code>) and <code>Name</code> as a nominal value (<code>N</code>). To show the chart, save it as an HTML file using the <code>save()</code> method. Alternatively, if you are using a Jupyter Notebook, simply write the name of the chart variable to show the chart inline. </p>
</div>
<div class="readable-text" id="p29">
<p>Figure 2.4 shows the chart produced by the code contained in listing 2.4. Now that you have learned the basic concepts behind Altair, we will review the prerequisites for implementing a practical scenario in Altair and Copilot.<span class="aframe-location"/></p>
</div>
<div class="browsable-container figure-container" id="p30">
<img alt="figure" height="227" src="../Images/2-4.png" width="1100"/>
<h5 class="figure-container-h5"><span class="num-string">Figure 2.4</span> The chart produced by listing 2.3</h5>
</div>
<div class="readable-text" id="p31">
<h4 class="readable-text-h4">Exercise 1</h4>
</div>
<div class="readable-text" id="p32">
<p>Draw the charts in figures 2.2 (line chart) and 2.3 (scatter plot) using the DataFrame in listing 2.4.</p>
</div>
<div class="browsable-container listing-container" id="p33">
<h5 class="listing-container-h5 browsable-container-h5"><span class="num-string">Listing 2.4</span></h5>
<div class="code-area-container">
<pre class="code-area">df = pd.DataFrame({
   'X' : [2,3,5,6,7,9,4,5,5,6],
   'Y' : [4,5,6,7,8,9,5,6,3,5]
})</pre>
</div>
</div>
<div class="readable-text" id="p34">
<p>The solutions to the exercises are in the GitHub repository for the book under 02/line-chart.py and 02/scatter-plot.py.</p>
</div>
<div class="readable-text" id="p35">
<h2 class="readable-text-h2"><span class="num-string">2.2</span> Use case: Describing the scenario</h2>
</div>
<div class="readable-text" id="p36">
<p>Suppose we are at the end of 2019, before the COVID-19 pandemic. You work as a data analyst at a Portuguese hotel. Your boss has experienced increased tourist arrivals at their hotel and wants to invest money in building a new swimming pool. Before investing money, they ask you to study the phenomenon to understand whether their investment will be successful. The objective of your task is to see whether Portugal is seeing an increased number of tourist arrivals in recent years relative to global trends.</p>
</div>
<div class="readable-text intended-text" id="p37">
<p>You start your searches and find a dataset about arrivals at tourist accommodation establishments (<a href="https://mng.bz/2KOX">https://mng.bz/2KOX</a>), released as open data by Eurostat. For simplicity, in this chapter, you consider only one dataset, but in a real use case scenario, you should consider more data, including the popularity of swimming pools among tourists visiting Portugal, the cost of building a new swimming pool at the hotel, and the potential revenue that the new swimming pool could generate for the hotel.</p>
</div>
<div class="readable-text intended-text" id="p38">
<p>The dataset contains the number of arrivals at tourist accommodation establishments since 2019 in all European countries. For simplicity, focus only on the following countries: Portugal, France, Italy, Germany, Spain, and the United Kingdom. The code described in this chapter can be found under CaseStudies/tourist-arrivals in the GitHub repository and the dataset under CaseStudies/tourist-arrivals/source.</p>
</div>
<div class="readable-text" id="p39">
<h3 class="readable-text-h3"><span class="num-string">2.2.1</span> The dataset</h3>
</div>
<div class="readable-text" id="p40">
<p>Table 2.1 shows a sample of the dataset we will analyze. The dataset contains the tourist arrivals at establishments from 1994 to 2019 for Italy (IT), France (FR), Germany (DE), Portugal (PT), Spain (ES), and the United Kingdom (UK).</p>
</div>
<div class="browsable-container browsable-table-container framemaker-table-container" id="p41">
<h5 class="browsable-container-h5"><span class="num-string">Table 2.1</span> Arrivals at tourist arrivals establishments since 1994</h5>
<table>
<thead>
<tr>
<th>
<div>
         Date 
       </div></th>
<th>
<div>
         IT 
       </div></th>
<th>
<div>
         FR 
       </div></th>
<th>
<div>
         DE 
       </div></th>
<th>
<div>
         PT 
       </div></th>
<th>
<div>
         ES 
       </div></th>
<th>
<div>
         UK 
       </div></th>
</tr>
</thead>
<tbody>
<tr>
<td>  1990-01-01 <br/></td>
<td>  2,543,920 <br/></td>
<td/>
<td>  3,185,877 <br/></td>
<td>  325,138 <br/></td>
<td>  1723,786 <br/></td>
<td>  1,776,000 <br/></td>
</tr>
<tr>
<td>  1990-02-01 <br/></td>
<td>  2,871,632 <br/></td>
<td/>
<td>  3,588,879 <br/></td>
<td>  381,539 <br/></td>
<td>  1,885,718 <br/></td>
<td>  2,250,000 <br/></td>
</tr>
<tr>
<td>  1990-03-01 <br/></td>
<td>  3,774,702 <br/></td>
<td/>
<td>  4,272,437 <br/></td>
<td>  493,957 <br/></td>
<td>  2,337,847 <br/></td>
<td>  2,662,000 <br/></td>
</tr>
<tr>
<td>  … <br/></td>
<td>  … <br/></td>
<td>  … <br/></td>
<td>  … <br/></td>
<td>  … <br/></td>
<td>  … <br/></td>
<td>  … <br/></td>
</tr>
<tr>
<td>  2019-08-01 <br/></td>
<td>  11,649,500 <br/></td>
<td>  13,692,822 <br/></td>
<td>  14,570,339 <br/></td>
<td>  2,531,809 <br/></td>
<td>  12,893,366 <br/></td>
<td>  8,889,049 <br/></td>
</tr>
<tr>
<td>  2019-09-01 <br/></td>
<td>  9,888,817 <br/></td>
<td>  11,684,845 <br/></td>
<td>  14,373,815 <br/></td>
<td>  2,263,748 <br/></td>
<td/>
<td>  5,858,984 <br/></td>
</tr>
<tr>
<td>  2019-10-01 <br/></td>
<td>  7,692,388 <br/></td>
<td>  10,401,793 <br/></td>
<td>  13,780,441 <br/></td>
<td>  1,995,942 <br/></td>
<td/>
<td>  7,455,781 <br/></td>
</tr>
</tbody>
</table>
</div>
<div class="readable-text" id="p42">
<p>The table contains some missing values for some countries and some years, so we should pay attention if, for example, we want to combine data by year, because aggregating incomplete years could lead to wrong results. Load the dataset as a pandas DataFrame, as described in the file from-data-to-information/raw-chart.py of the GitHub repository for the book and the following listing.</p>
</div>
<div class="browsable-container listing-container" id="p43">
<h5 class="listing-container-h5 browsable-container-h5"><span class="num-string">Listing 2.5</span> Loading the dataset as a pandas DataFrame</h5>
<div class="code-area-container">
<pre class="code-area">import pandas as pd

df = pd.read_csv('../source/tourist_arrivals_countries.csv', parse_dates=['Date'])</pre>
</div>
</div>
<div class="readable-text print-book-callout" id="p44">
<p><span class="print-book-callout-head">Note</span>  Use pandas to load the dataset as a DataFrame. Use the <code>parse_dates</code> parameter to load the <code>Date</code> field as a date.</p>
</div>
<div class="readable-text" id="p45">
<p>Now, you are ready to perform basic data exploration.</p>
</div>
<div class="readable-text" id="p46">
<h3 class="readable-text-h3"><span class="num-string">2.2.2</span> Data exploration</h3>
</div>
<div class="readable-text" id="p47">
<p>EDA is a mandatory phase to extract insights from your data, but you cannot use its output to build raw data stories. In fact, EDA aims to analyze and visualize data to extract insights and understand its underlying patterns, distributions, and relationships. You may even use generative AI to perform EDA. Performing a complete data exploration is outside of the scope of this book. You can refer to the bibliography at the end of this chapter to learn how to perform EDA. However, you can use an existing EDA library for quick data exploration, such as ydata-profiling (<a href="https://pypi.org/project/ydata-profiling/">https://pypi.org/project/ydata-profiling/</a>) or sweetviz (<a href="https://pypi.org/project/sweetviz/">https://pypi.org/project/sweetviz/</a>). In this chapter, we’ll use ydata-profiling. Import the library, create a <code>ProfileReport()</code> object, and pass the pandas DataFrame as an input argument. Finally, build the report by invoking the <code>to_file()</code> method.</p>
</div>
<div class="browsable-container listing-container" id="p48">
<h5 class="listing-container-h5 browsable-container-h5"><span class="num-string">Listing 2.6</span> Building a summary report</h5>
<div class="code-area-container">
<pre class="code-area">from ydata_profiling import ProfileReport
import pandas as pd

df = pd.read_csv('../source/tourist_arrivals_countries.csv', parse_dates=['Date'])

eda = ProfileReport(df)
eda.to_file(output_file='eda.xhtml')</pre>
</div>
</div>
<div class="readable-text print-book-callout" id="p49">
<p><span class="print-book-callout-head">Note</span>  Use ydata-profiling to build a summary report of the dataset.</p>
</div>
<div class="readable-text" id="p50">
<p>As a result, the <code>to_file()</code> method produces an HTML file that contains the report. Figure 2.5 shows a snapshot of the produced report.<span class="aframe-location"/></p>
</div>
<div class="browsable-container figure-container" id="p51">
<img alt="figure" height="546" src="../Images/2-5.png" width="1100"/>
<h5 class="figure-container-h5"><span class="num-string">Figure 2.5</span> A snapshot of the report produced by ydata-profiling </h5>
</div>
<div class="readable-text" id="p52">
<p>The report contains many sections, as shown in the top-right menu of figure 2.5. The report may help you do the following:</p>
</div>
<ul>
<li class="readable-text" id="p53"> <em>Understand the data. </em>The report provides an overview of the dataset, including the number of observations, variables, and missing values. Use this information to understand the data quality. </li>
<li class="readable-text" id="p54"> <em>Identify data types.</em> The report identifies the data types of each variable and provides a summary of their distribution, including measures such as mean, median, standard deviation, and range. Use this information to identify variables that may require further preprocessing. </li>
<li class="readable-text" id="p55"> <em>Identify correlations.</em> The report provides a correlation matrix, heatmap, and scatter plot matrix, which can help identify variables that are highly correlated or related. </li>
<li class="readable-text" id="p56"> <em>Identify distributions.</em> The report provides distribution plots, including histograms and density plots, to help identify each variable’s distribution shape and spread. Use this information to understand the underlying patterns, trends, and data quality problems in the data. </li>
</ul>
<div class="readable-text" id="p57">
<p>In your case, the Missing Values section describes the presence of missing values for some countries (France, Spain, and the United Kingdom), as shown in figure 2.6.<span class="aframe-location"/></p>
</div>
<div class="browsable-container figure-container" id="p58">
<img alt="figure" height="562" src="../Images/2-6.png" width="1100"/>
<h5 class="figure-container-h5"><span class="num-string">Figure 2.6</span> The report highlights missing values for France, Spain, and the United Kingdom.</h5>
</div>
<div class="readable-text" id="p59">
<p>Now that we have quickly explored the dataset, you are ready to build a data story from that dataset. Let’s start with the first approach: using Altair.</p>
</div>
<div class="readable-text" id="p60">
<h2 class="readable-text-h2"><span class="num-string">2.3</span> First approach: Altair</h2>
</div>
<div class="readable-text" id="p61">
<p>To transform data into a story, we will proceed step by step. First, we’ll build a basic chart, and then we’ll gradually enrich it with the elements necessary to transform the chart into a story in its own right. We’ll use the principles of the DIKW pyramid to implement this progressive enrichment:</p>
</div>
<ul>
<li class="readable-text" id="p62"> From data to information </li>
<li class="readable-text" id="p63"> From information to knowledge </li>
<li class="readable-text" id="p64"> From knowledge to wisdom </li>
</ul>
<div class="readable-text" id="p65">
<p>Let’s start with the first step of the DIKW pyramid: turning data into information. In this section, we’ll use the code under CaseStudies/tourist-arrivals in the book’s GitHub repository.</p>
</div>
<div class="readable-text" id="p66">
<h3 class="readable-text-h3"><span class="num-string">2.3.1</span> From data to information</h3>
</div>
<div class="readable-text" id="p67">
<p>Turning data into information means extracting some insights from data. Start by drawing the raw chart, shown in the following code, and the file from-data-to-information/ raw-chart.py.</p>
</div>
<div class="browsable-container listing-container" id="p68">
<h5 class="listing-container-h5 browsable-container-h5"><span class="num-string">Listing 2.7</span> Building the raw chart in Altair</h5>
<div class="code-area-container">
<pre class="code-area">import altair as alt
import pandas as pd
from ydata_profiling import ProfileReport

df = pd.read_csv('../source/tourist_arrivals_countries.csv', parse_dates=['Date'])

df = pd.melt(df, id_vars='Date', value_name='Tourist Arrivals', var_name='Country')

chart = alt.Chart(df).mark_line().encode(
    x = 'Date:T',                      <span class="aframe-location"/> #1
    y = 'Tourist Arrivals:Q',      <span class="aframe-location"/> #2
    color=alt.Color('Country:N')   <span class="aframe-location"/> #3
)

chart.save('raw-chart.xhtml')</pre>
<div class="code-annotations-overlay-container">
     #1 Uses the notation :T to specify that the data type is temporal
     <br/>#2 Uses the notation :Q to specify that the data type is quantitative
     <br/>#3 Uses the notation :N to specify that the data type is nominal
     <br/>
</div>
</div>
</div>
<div class="readable-text print-book-callout" id="p69">
<p><span class="print-book-callout-head">Note</span>  Use the <code>mark_line()</code> property to build the raw chart in Altair. Draw the number of tourist arrivals on the y-axis and the date on the x-axis.</p>
</div>
<div class="readable-text" id="p70">
<p>Use the <code>melt()</code> function to unpivot the dataset (i.e., transform data rows into columns). For more details about the <code>melt()</code> function, refer to appendix B. Then, build the chart. The chart uses three channels: <code>x</code> and <code>y</code> to describe the axes, and <code>color</code> to group by countries. For each channel, specify the column in the dataset (e.g., <code>Date</code> for the <code>x</code> channel) and the data type (<code>T</code> for temporal data, <code>Q</code> for quantitative data, and <code>N</code> for nominal data). Figure 2.7 shows the produced chart.<span class="aframe-location"/></p>
</div>
<div class="browsable-container figure-container" id="p71">
<img alt="figure" height="701" src="../Images/2-7.png" width="1100"/>
<h5 class="figure-container-h5"><span class="num-string">Figure 2.7</span> The raw chart produced in Altair without any manipulation</h5>
</div>
<div class="readable-text" id="p72">
<p>The chart is difficult to read because all countries overlap. However, you can extract the following highlight: all the trend lines have increased since 1990. This is a positive message to communicate to your boss. From 1990 until 2019, there has been a progressive increase in the arrival of tourists. Let’s focus more on this information. </p>
</div>
<div class="readable-text intended-text" id="p73">
<p>In all cases, you are not interested in knowing the intermediate data, as there are no outliers, only the starting point (1990) and the final point of the time series (2019). However, we note that for some countries, there is no data for 1990, and 2019 is incomplete (the data goes up to October). In this case, the question is, what should we do in the presence of missing values? The answer is, it depends. In your case, you are dealing with a time series that grows progressively (seasonality excluded), so you can restrict the analysis range to only the dates for which you have data. Thus, you narrow your search to the range 1994–2018. </p>
</div>
<div class="readable-text intended-text" id="p74">
<p>Let’s implement this strategy in Altair. Start by filtering out missing years from the dataset, as described in the script from-data-to-information/grouped-chart.py and in the following listing.</p>
</div>
<div class="browsable-container listing-container" id="p75">
<h5 class="listing-container-h5 browsable-container-h5"><span class="num-string">Listing 2.8</span> Removing missing years from the dataset</h5>
<div class="code-area-container">
<pre class="code-area">df.loc[:, 'Year'] = df['Date'].dt.year  <span class="aframe-location"/> #1
df = df[(df['Year'] &gt;= 1994) &amp; (df['Year'] &lt;= 2018)]  <span class="aframe-location"/> #2</pre>
<div class="code-annotations-overlay-container">
     #1 Extract the year from the date.
     <br/>#2 Filter out years before 1994 and after 2018.
     <br/>
</div>
</div>
</div>
<div class="readable-text print-book-callout" id="p76">
<p><span class="print-book-callout-head">Note</span>  First, extract the year from the date column, and then filter out all the years before 1994 and after 2018. Use <code>loc</code> to access a group of rows and columns by labels and <code>iloc</code> to access group rows and columns by numerical indices. </p>
</div>
<div class="readable-text" id="p77">
<p>Then, group data by year and calculate the sum. </p>
</div>
<div class="browsable-container listing-container" id="p78">
<h5 class="listing-container-h5 browsable-container-h5"><span class="num-string">Listing 2.9</span> Grouping by year and calculating the sum</h5>
<div class="code-area-container">
<pre class="code-area">df = df.groupby(['Year', 'Country'])['Tourist Arrivals'].sum().reset_index()<span class="aframe-location"/> #1</pre>
<div class="code-annotations-overlay-container">
     #1 Group by year and country.
     <br/>
</div>
</div>
</div>
<div class="readable-text print-book-callout" id="p79">
<p><span class="print-book-callout-head">Note</span>  Use <code>group_by()</code> to group data by year and country, and calculate the sum through the <code>sum()</code> function. Finally, reset the index to retrieve the year.</p>
</div>
<div class="readable-text" id="p80">
<p>Use the <code>reset_index()</code> function to create a new index column starting from 0, and move the current index values to a new column.</p>
</div>
<div class="readable-text intended-text" id="p81">
<p>Finally, build the chart in Altair.</p>
</div>
<div class="browsable-container listing-container" id="p82">
<h5 class="listing-container-h5 browsable-container-h5"><span class="num-string">Listing 2.10</span> Building the chart in Altair</h5>
<div class="code-area-container">
<pre class="code-area">chart = alt.Chart(df).mark_line().encode(
    x = 'Year:O',
    y = 'Tourist Arrivals:Q',
    color=alt.Color('Country:N')
)

chart.save(‘chart.xhtml’)</pre>
</div>
</div>
<div class="readable-text print-book-callout" id="p83">
<p><span class="print-book-callout-head">Note</span>  Use the <code>mark_line()</code> property to build a line chart in Altair.</p>
</div>
<div class="readable-text" id="p84">
<p>Figure 2.8 shows the produced chart.<span class="aframe-location"/></p>
</div>
<div class="browsable-container figure-container" id="p85">
<img alt="figure" height="611" src="../Images/2-8.png" width="1100"/>
<h5 class="figure-container-h5"><span class="num-string">Figure 2.8</span> The produced chart after calculating the sum for each year and filtering out the boundary years</h5>
</div>
<div class="readable-text" id="p86">
<p>The chart is clearer than that in figure 2.7; you can easily distinguish the trend line for each country. However, the presence of too many colors and countries does not transmit the message. Your objective is to focus on Portugal, which is the country about which your boss has asked for information.</p>
</div>
<div class="readable-text intended-text" id="p87">
<p>The increase in the number of tourists over time in the other countries is greater than that of Portugal. However, you are not interested in knowing the absolute values but rather the percentage increase for each country over time. If we use absolute values, instead, we can’t answer the following questions immediately:</p>
</div>
<ul>
<li class="readable-text" id="p88"> For each country, what is the percentage increase since 1994? </li>
<li class="readable-text" id="p89"> Which of the two nations experiences the greater percentage increase? </li>
</ul>
<div class="readable-text" id="p90">
<p>If you use the percentage increases, we can put the two countries on a more comparable level, and you can answer the previous questions. Let’s calculate the percentage increase since 1994 for each country and then plot the chart of percentage increases instead of that of absolute values.</p>
</div>
<div class="readable-text intended-text" id="p91">
<p>Calculate the percentage increase using the following formula:</p>
</div>
<div class="readable-text indented-paragraph" id="p92">
<p>Percentage Increase = (Final Value – Starting Value) / Starting Value * 100</p>
</div>
<div class="readable-text" id="p93">
<p>In your case, calculate the percentage increase for each country as shown in the following listing and in the script from-data-to-information/chart.py.</p>
</div>
<div class="browsable-container listing-container" id="p94">
<h5 class="listing-container-h5 browsable-container-h5"><span class="num-string">Listing 2.11</span> Calculating the percentage increase for each country</h5>
<div class="code-area-container">
<pre class="code-area">for country in df['Country'].unique():
    current = df[df['Country'] == country]['Tourist Arrivals']
    base = df[(df['Country'] == country) &amp; (df['Year'] == 1994)]['Tourist Arrivals'].values[0]
    df.loc[df['Country'] == country, 'PI'] = (current - base)/ base*100  <span class="aframe-location"/> #1</pre>
<div class="code-annotations-overlay-container">
     #1 Add a new column containing the difference for each country between the number of tourist arrivals in the current year and 1994.
     <br/>
</div>
</div>
</div>
<div class="readable-text print-book-callout" id="p95">
<p><span class="print-book-callout-head">Note</span>  For each country, calculate the difference between the number of tourist arrivals in each year and that in 1994.</p>
</div>
<div class="readable-text" id="p96">
<p>Now, build the chart again.</p>
</div>
<div class="browsable-container listing-container" id="p97">
<h5 class="listing-container-h5 browsable-container-h5"><span class="num-string">Listing 2.12</span> Drawing the chart of percentage increases</h5>
<div class="code-area-container">
<pre class="code-area">base = alt.Chart(df).encode(
    x = alt.X('Year:O', title=''),
    y = alt.Y('PI:Q', title='Percentage Increase since 1994'),
    color=alt.Color('Country:N',
                    scale=alt.Scale(scheme='set2'), 
                    legend=None),
    strokeWidth=alt.condition(alt.datum.Country == 'PT', alt.value(7), alt.value(0.5))
).properties(
    title='Tourist Arrivals in Portugal (1994-2018)'
)

chart = base.mark_line()

chart.save('chart.xhtml')</pre>
</div>
</div>
<div class="readable-text print-book-callout" id="p98">
<p><span class="print-book-callout-head">Note</span>  First, create a new DataFrame with the required values. Then, draw the chart. Use <code>title</code> to modify the title of the y-axis. Use the <code>scale</code> property to select the range of colors. In your case, you used a default scheme (<code>set2</code>). For the complete list of schemes, you can refer to the D3 documentation (<a href="https://observablehq.com/@d3/color-schemes">https://observablehq.com/@d3/color-schemes</a>). The chart also uses the <code>strokeWidth</code> channel, which enables us to configure the stroke width of each line. We use a conditional statement to set the stroke width. To access a column value directly within a conditional statement, use <code>alt.datum.&lt;column&gt;</code>. To set the value to a specific string or number, use <code>alt.value()</code>.</p>
</div>
<div class="readable-text" id="p99">
<p>To encode the<em> </em><code>x</code> channel, you used the <code>alt.X()</code> object—rather than a simple string, like we did before—the same as you did for the <code>y</code> and <code>color</code> channels. When you want to specify the channel details, you can use the channel object instead of a simple string. For example, you can use <code>alt.Y()</code> for the<em> </em><code>y</code> channel, <code>alt.Color()</code> for the <code>color</code> channel, and so on. Within a channel object, you can set different properties that depend on the channel. For example, for the <code>x</code> and <code>y</code> channels, you can set the axis property. You can define a value or an additional object for each property within a channel. In practice, the same strategy of channels applies to the channel properties. For example, <code>axis</code> is a property of the <code>x</code> and <code>y</code> channels. You can use <code>alt.Axis()</code> to set additional properties of the axis. In the example, you have set the <code>legend</code> property of the <code>color</code> channel.</p>
</div>
<div class="readable-text intended-text" id="p100">
<p>To build the chart, you have also used the <code>properties()</code> function, which configures the chart’s general properties, such as the title. Figure 2.9 shows the resulting chart.<span class="aframe-location"/></p>
</div>
<div class="browsable-container figure-container" id="p101">
<img alt="figure" height="720" src="../Images/2-9.png" width="1100"/>
<h5 class="figure-container-h5"><span class="num-string">Figure 2.9</span> The chart produced after calculating percentage increases and highlighting Portugal</h5>
</div>
<div class="readable-text" id="p102">
<p>You removed the legend voluntarily because you will add it as an annotation following each line. The chart shows that Portugal has experienced a larger percentage increase in tourist arrivals than the other countries. This is an extraordinary discovery, and it answers your boss’s question. You have extracted information from the data. To highlight your discovery, add an annotation to the chart that precisely describes the percentage increase value in correspondence of 2018.</p>
</div>
<div class="browsable-container listing-container" id="p103">
<h5 class="listing-container-h5 browsable-container-h5"><span class="num-string">Listing 2.13</span> Adding an annotation to the chart</h5>
<div class="code-area-container">
<pre class="code-area">annotation = base.mark_text(
    dx=10,              <span class="aframe-location"/> #1
    align='left',    <span class="aframe-location"/> #2
    fontSize=12      <span class="aframe-location"/> #3
).encode(

    text='label:N'
).transform_filter(
    alt.datum.Year == 2018
).transform_calculate(
    label='datum.Country + "(" + format(datum.PI, ".2f") + "%)"'  <span class="aframe-location"/> #4
)

chart = (chart + annotation
)

chart.save('chart.xhtml')</pre>
<div class="code-annotations-overlay-container">
     #1 Sets the offset in pixel from the x coordinate
     <br/>#2 Sets the text alignment
     <br/>#3 Sets the text font size
     <br/>#4 Formats the text to show only 2 decimal places and adds a percentage sign
     <br/>
</div>
</div>
</div>
<div class="readable-text print-book-callout" id="p104">
<p><span class="print-book-callout-head">Note</span>  Use the <code>mark_text()</code> property to draw the text. Next, combine the previous chart and the text annotation through the <code>+</code> operator. Use <code>transform _filter()</code> to select only 2018 (the position near which you want to place the annotation) and <code>transform_calculate()</code> to add a new column to the dataset containing the formatted percentage. </p>
</div>
<div class="readable-text" id="p105">
<p>The <code>mark_text()</code> function (and the other <code>mark_*()</code> functions) can receive as input some parameters that define some static properties of the chart. For example, if you want to use a static color for all the texts in the chart, set the color in the <code>mark_*()</code> function. If, instead, the color of the text depends on a column in the DataFrame, set it in the <code>encode()</code> function. Figure 2.10 shows the resulting chart at the end of the first step, turning data into information.<span class="aframe-location"/></p>
</div>
<div class="browsable-container figure-container" id="p106">
<img alt="figure" height="637" src="../Images/2-10.png" width="1100"/>
<h5 class="figure-container-h5"><span class="num-string">Figure 2.10</span> The chart produced at the end of the first step, turning data into information</h5>
</div>
<div class="readable-text intended-text" id="p107">
<p>The chart is clear and easy to understand. Adding information means extracting only the relevant data and representing it in a way that is easy for the audience to understand without further calculation. Now that you have turned data into information, it’s time to move to the next step of the DIKW pyramid: turning information into knowledge.</p>
</div>
<div class="readable-text" id="p108">
<h4 class="readable-text-h4">Exercise 2</h4>
</div>
<div class="readable-text" id="p109">
<p>Modify the chart from figure 2.10 as follows:</p>
</div>
<ol>
<li class="readable-text" id="p110"> Build a slope graph, which is a line chart showing only the first and the last values (1994 and 2018). </li>
<li class="readable-text" id="p111"> On the y-axis, show the number of tourist arrivals, not the percentage increase. </li>
</ol>
<div class="readable-text" id="p112">
<p>As an output, you should produce the chart shown in figure 2.11. You can find the solution of the exercise under CaseStudies/tourist-arrivals/exercises/exercise1.py.<span class="aframe-location"/></p>
</div>
<div class="browsable-container figure-container" id="p113">
<img alt="figure" height="571" src="../Images/2-11.png" width="1100"/>
<h5 class="figure-container-h5"><span class="num-string">Figure 2.11</span> The output of exercise 1</h5>
</div>
<div class="readable-text" id="p114">
<h4 class="readable-text-h4">Exercise 3</h4>
</div>
<div class="readable-text" id="p115">
<p>Transform the slope chart of figure 2.11 into a stacked bar chart. The solution of this exercise is under CaseStudies/tourist-arrivals/exercises/exercise2.py.</p>
</div>
<div class="readable-text" id="p116">
<h3 class="readable-text-h3"><span class="num-string">2.3.2</span> From information to knowledge</h3>
</div>
<div class="readable-text" id="p117">
<p>Turning information into knowledge means adding context to the extracted information. Usually, context answers the following question: Why does this situation happen? If possible, extend your search, or look at the same dataset to answer this question. In our case, the question is as follows: Why has Portugal experienced such an incredible increase in tourist arrivals over 25 years? To answer this question, you researched and discovered that Portugal (and other countries) introduced many low-cost flights in the early 1990s (Dobruszkes, 2013). This allowed for a much greater development of tourism. </p>
</div>
<div class="readable-text intended-text" id="p118">
<p>This finding is the context for your graph; thanks to the introduction of low-cost flights, Portugal has experienced an increase in tourist arrivals of over 200% in 25 years, even surpassing the increase in the other countries. Add this discovery as an annotation in the chart, as described in the script from-information-to-knowledge/ chart.py.</p>
</div>
<div class="browsable-container listing-container" id="p119">
<h5 class="listing-container-h5 browsable-container-h5"><span class="num-string">Listing 2.14</span> Adding the context to the chart</h5>
<div class="code-area-container">
<pre class="code-area">text_comm = f"""Thanks to the introduction 
of low-cost flights, 
Portugal has experienced 
an increase 
in tourist arrivals 
of over 200% in 25 years, 
even surpassing the increase 
in the other countries."""

df_commentary = pd.DataFrame([{'text' : text_comm}])

commentary = alt.Chart(df_commentary
).mark_text(
    lineBreak='\n',
    align='left',
    fontSize=20,
    y=0,
    x=0,
    color='#81c01e'
).encode(
    text='text:N'
).properties(
    width=200
)</pre>
</div>
</div>
<div class="readable-text print-book-callout" id="p120">
<p><span class="print-book-callout-head">Note</span>  First, build a DataFrame with the text to add to the chart. Then, use <code>mark_text()</code> to draw the text. Also, specify the line break symbol (<code>lineBreak='\n'</code>), how to align the text (<code>align='left'</code>), the font size (<code>fontSize=20</code>), the position (<code>y=100</code>), and the color (<code>color='orange'</code>). Finally, combine the text with the previous chart through the + operator.</p>
</div>
<div class="readable-text" id="p121">
<p>To reinforce the text we have inserted into the chart, let’s add an additional, very lean chart, showing passenger traffic in Portugal over time. Use a World Bank dataset relating to air traffic (<a href="https://mng.bz/RZRP">https://mng.bz/RZRP</a>, released under the CC BY-4.0 license) in the various countries of the world. The following listing shows how to add the line chart to your main chart.</p>
</div>
<div class="browsable-container listing-container" id="p122">
<h5 class="listing-container-h5 browsable-container-h5"><span class="num-string">Listing 2.15</span> Adding the call to action to the chart</h5>
<div class="code-area-container">
<pre class="code-area">df_airports = pd.read_csv('../source/airports.csv')

df_airports = df_airports.melt(id_vars='Country Name', var_name='Year', value_name='Value')
df_airports.dropna(inplace=True)
df_airports = df_airports[df_airports['Country Name'] == 'Portugal']

airports = alt.Chart(df_airports).mark_line(
    color='#81c01e',
    strokeWidth=6
).encode(
    x=alt.X('Year', axis=alt.Axis(labels=False, ticks=False, grid=False), title='Year range: 1994-2018'),
    y=alt.Y('Value', axis=alt.Axis(labels=False, ticks=False, grid=False), title='Air Passengers range: 4.3M-17.3M')
).properties(
    title='Air passengers in Portugal',
    width=200,
    height=200
)


chart = ((commentary &amp; airports) | (chart + annotation)
)

chart.save('chart.xhtml')</pre>
</div>
</div>
<div class="readable-text print-book-callout" id="p123">
<p><span class="print-book-callout-head">Note</span>  First, load the airport dataset as a pandas DataFrame. Next, format the dataset to be consumable by Altair. Then, use the <code>mark_line()</code> method to build a trend line. Remove the labels, ticks, and grid from the x-axis and y-axis. Finally, combine the airport chart and the text using the <code>&amp;</code> operator, which corresponds to a vertical alignment. Also, use the <code>|</code> operator to combine charts horizontally.</p>
</div>
<div class="readable-text" id="p124">
<p>Figure 2.12 shows the chart resulting from the second step, turning information into knowledge.<span class="aframe-location"/></p>
</div>
<div class="browsable-container figure-container" id="p125">
<img alt="figure" height="560" src="../Images/2-12.png" width="1100"/>
<h5 class="figure-container-h5"><span class="num-string">Figure 2.12</span> The chart produced after the second step: turning information into knowledge</h5>
</div>
<div class="readable-text intended-text" id="p126">
<p>Thanks to context, the chart answers why this happens. Now that you have turned information into knowledge, it’s time to move to the final step of the DIKW pyramid: turning knowledge into wisdom.</p>
</div>
<div class="readable-text" id="p127">
<h3 class="readable-text-h3"><span class="num-string">2.3.3</span> From knowledge to wisdom</h3>
</div>
<div class="readable-text" id="p128">
<p>Turning knowledge into wisdom means adding a call to action to the chart and proposing the next steps. In this chapter, we focus only on adding a call to action. We’ll see how to add the next steps in the following chapters. The call to action invites the audience to do something. In your case, the call to action should answer your boss’s original question: Should I build a new swimming pool?</p>
</div>
<div class="readable-text intended-text" id="p129">
<p>Given the results of the previous analysis, formulate the following call to action: since the number of tourists arriving in Portugal is constantly expanding, you can think about building a new swimming pool! Add the call to action below the main chart, as shown in the following listing and the from-knowledge-to-wisdom/chart.py script.</p>
</div>
<div class="browsable-container listing-container" id="p130">
<h5 class="listing-container-h5 browsable-container-h5"><span class="num-string">Listing 2.16</span> Adding the call to action to the chart</h5>
<div class="code-area-container">
<pre class="code-area">text_cta = f"""Since the number of tourists arriving in Portugal is constantly expanding, 
you can think about building a new swimming pool!"""
df_cta = pd.DataFrame([{'text' : text_cta}])

cta = alt.Chart(df_cta
).mark_text(
    lineBreak='\n',
    align='left',
    fontSize=20,
    y=0,
    x=0,
    color='#81c01e'
).encode(
    text='text:N'
).properties(
    width=200
)


final_chart = ((commentary &amp; airports) | ((chart + annotation) &amp; cta)
)

final_chart.save('chart.xhtml')</pre>
</div>
</div>
<div class="readable-text print-book-callout" id="p131">
<p><span class="print-book-callout-head">Note</span>  Add a new textual annotation to the chart to formulate the call to action.</p>
</div>
<div class="readable-text" id="p132">
<p>You can run your code locally or on a web server if it includes images (as we will see in the next chapters). If you don’t have a web server, you can run a local and temporary web server from the command line, running the following command in the directory containing the produced HTML file: <code>python</code> <code>-m</code> <code>http.server.</code> The server should listen at port 8000 and should serve all the files contained in the directory from which it is started. Point your browser to http:<span class="link-like">//</span>localhost:8000/chart.xhtml to access the chart.xhtml file. Figure 2.13 shows the chart produced by the final step, turning knowledge into wisdom.<span class="aframe-location"/></p>
</div>
<div class="browsable-container figure-container" id="p133">
<img alt="figure" height="560" src="../Images/2-13.png" width="1100"/>
<h5 class="figure-container-h5"><span class="num-string">Figure 2.13</span> The chart produced by the final step: turning knowledge into wisdom</h5>
</div>
<div class="readable-text" id="p134">
<p>The chart contains the answer to your boss’s question. If you compare this chart with figure 2.5, you will probably notice a big difference: the charts in figures 2.9 and 2.10 show that the audience doesn’t have to do any calculations or processing. They can just read the result. If, on the other hand, they look at the chart in figure 2.5, the audience has to extract the information by themselves.</p>
</div>
<div class="readable-text intended-text" id="p135">
<p>Some may argue that a lot of information was lost in the process, such as what happened to the other European countries and what happened between 1994 and 2018. Thus, the boss wouldn’t want to make a big investment based only on the numbers shown in the chart. This observation is correct. However, we have simplified the example to show the workflow used to turn data into a story. In a more complex scenario, you must consider additional factors and build an appropriate story, where each factor is a single scene of your data story.</p>
</div>
<div class="readable-text intended-text" id="p136">
<p>To get an idea of the differences between Altair and Matplotlib, we will build the same chart using Matplotlib in the next section. If you are unfamiliar with Matplotlib, jump directly to section 2.4, which covers the second approach: using Copilot.</p>
</div>
<div class="readable-text" id="p137">
<h3 class="readable-text-h3"><span class="num-string">2.3.4</span> Comparing Altair and Matplotlib</h3>
</div>
<div class="readable-text" id="p138">
<p>You might wonder why there is a section on Matplotlib in a book about Altair. The answer is simple: the methodology described in this book, including the techniques of using generative AI and the DIKW pyramid, can be applied to all data visualization libraries, not just Altair. Indeed, you could also think about using them in other languages, such as R. As an example, in this section, we see a brief comparison between Altair and Matplotlib, highlighting the differences and similarities.</p>
</div>
<div class="readable-text intended-text" id="p139">
<p>Matplotlib is a popular Python library for data visualization. Quite likely, it was the first Python library you used to plot your data quickly. If you use Matplotlib as an alternative to Altair, consider that Matplotlib is an imperative library, so you must define all the steps to produce the chart. In Altair, you focus only on the desired output. Regardless, all the concepts related to data storytelling described in this book are also valid for Matplotlib, so use it if you prefer the imperative approach.</p>
</div>
<div class="readable-text intended-text" id="p140">
<p>You can find the complete code in Matplotlib in the book’s GitHub repository under CaseStudies/tourist-arrivals/matplotlib/chart.py and in the following listing.</p>
</div>
<div class="browsable-container listing-container" id="p141">
<h5 class="listing-container-h5 browsable-container-h5"><span class="num-string">Listing 2.17</span> Generating the chart in Matplotlib</h5>
<div class="code-area-container">
<pre class="code-area">import matplotlib.pyplot as plt

df = pd.read_csv('../source/tourist_arrivals_countries.csv', parse_dates=['Date'])
df = pd.melt(df, id_vars='Date', value_name='Tourist Arrivals', var_name='Country')

df.loc[:, 'Year'] = df['Date'].dt.year    <span class="aframe-location"/> #1

df = df.groupby(['Year', 'Country'])['Tourist Arrivals'].sum().reset_index()<span class="aframe-location"/> #2

df = df[(df['Year'] &gt;= 1994) &amp; (df['Year'] &lt;= 2018)]   <span class="aframe-location"/> #3

for country in df['Country'].unique():
    current = df[df['Country'] == country]['Tourist Arrivals']
    base = df[(df['Country'] == country) &amp; (df['Year'] == 1994)]['Tourist Arrivals'].values[0]
    df.loc[df['Country'] == country, 'PI'] = (current - base)/ base*100   <span class="aframe-location"/> #4

fig, ax = plt.subplots(figsize=(10, 6))  <span class="aframe-location"/> #5

for country in df['Country'].unique():
    current = df[df['Country'] == country]['Tourist Arrivals']
    base = df[(df['Country'] == country) &amp; (df['Year'] == 1994)]['Tourist Arrivals'].values[0]
    pi = (current - base)/ base*100
    ax.plot(df[df['Country'] == country]['Year'], pi, label=country)  <span class="aframe-location"/> #6

ax.set_title('Tourist Arrivals in Portugal (1994-2018)')   <span class="aframe-location"/> #7
ax.set_xlabel('')                                           #7
ax.set_ylabel('Percentage Increase since 1994')             #7

ax.legend()      <span class="aframe-location"/> #8

plt.savefig('chart.png', dpi=300)    <span class="aframe-location"/> #9</pre>
<div class="code-annotations-overlay-container">
     #1 Extracts year from date
     <br/>#2 Groups by year and country
     <br/>#3 Filters out years before 1994 and after 2018
     <br/>#4 Adds a new column containing the difference for each country between the number of tourist arrivals in the current year and 1994
     <br/>#5 Creates a figure and axis
     <br/>#6 Plots the data
     <br/>#7 Sets the title and axis labels
     <br/>#8 Adds a legend
     <br/>#9 Saves the plot
     <br/>
</div>
</div>
</div>
<div class="readable-text print-book-callout" id="p142">
<p><span class="print-book-callout-head">Note</span>  Build a separate line for each country.</p>
</div>
<div class="readable-text" id="p143">
<p>Figure 2.14 shows the produced chart in Matplotlib. The chart could be improved by adding chart lines, data points, or labels for easy reading and good presentation.<span class="aframe-location"/></p>
</div>
<div class="browsable-container figure-container" id="p144">
<img alt="figure" height="669" src="../Images/2-14.png" width="1100"/>
<h5 class="figure-container-h5"><span class="num-string">Figure 2.14</span> The produced chart in Matplotlib</h5>
</div>
<div class="readable-text" id="p145">
<p>The Altair code is more verbose than that in Matplotlib. However, in Matplotlib, you must draw each line or text separately, while in Altair, you pass the DataFrame and the library draws a line or a mark in general for you. Now that you have turned your data into wisdom by hand and seen the differences between Altair and Matplotlib, we will move to the alternative method: using GitHub Copilot to build the chart semi-automatically.</p>
</div>
<div class="readable-text" id="p146">
<h2 class="readable-text-h2"><span class="num-string">2.4</span> A second approach: Copilot</h2>
</div>
<div class="readable-text" id="p147">
<p>Copilot enables you to write code to implement something automatically. We’ll enable Copilot as an extension of Visual Studio Code (VSC). To install VSC, refer to its official documentation (<a href="https://code.visualstudio.com/docs/introvideos/basics">https://code.visualstudio.com/docs/introvideos/basics</a>), and to configure Copilot, please refer to appendix A.</p>
</div>
<div class="readable-text intended-text" id="p148">
<p>To use Copilot, it is sufficient to describe the sequence of operations to be implemented in an orderly manner, and Copilot will do the rest for us, even proposing different implementation options. In this section, we will use Copilot to build the framework of the graph (i.e., its main parts). Then, we will add the details by hand, using colors and font size. The main difficulty in using Copilot is describing what the code needs to implement in natural language. The clearer the text is, the more consistent Copilot will be in implementation.</p>
</div>
<div class="readable-text intended-text" id="p149">
<p>In this section, we’ll describe how to translate the code written in the previous sections into a sequence of texts understandable by Copilot. We will focus only on translating the framework of the graph into the natural language without considering the details, such as the font size and colors used. Find the code generated by GitHub Copilot in the book’s repository under CaseStudies/tourist-arrivals/copilot/chart.py.</p>
</div>
<div class="readable-text intended-text" id="p150">
<p>We will break the problem down into steps:</p>
</div>
<ol>
<li class="readable-text" id="p151"> Loading and cleaning the dataset </li>
<li class="readable-text" id="p152"> Calculating the percentage increase </li>
<li class="readable-text" id="p153"> Plotting the basic chart in Altair </li>
<li class="readable-text" id="p154"> Enriching the chart </li>
</ol>
<div class="readable-text" id="p155">
<p>We’ll cover each step in the coming sections.</p>
</div>
<div class="readable-text" id="p156">
<h3 class="readable-text-h3"><span class="num-string">2.4.1</span> Loading and cleaning the dataset</h3>
</div>
<div class="readable-text" id="p157">
<p>Before using the dataset, you must load the required libraries, open the dataset as a pandas DataFrame, and calculate the percentage increases. The idea is to prepare data to build the chart in figure 2.13. </p>
</div>
<div class="readable-text intended-text" id="p158">
<p>Open VSC, and write the following comments.</p>
</div>
<div class="browsable-container listing-container" id="p159">
<h5 class="listing-container-h5 browsable-container-h5"><span class="num-string">Listing 2.18</span> Loading and filtering the dataset</h5>
<div class="code-area-container">
<pre class="code-area"># Import the necessary libraries.
# Read the following dataset into a pandas DataFrame, '../source/tourist_
arrivals_countries.csv', and parse the Date field as a date.
# Filter out rows before 1994 and after 2018.
# Extract the year from the Date field and create a new column called Year.
# Group the data by Year and calculate the sum of tourist arrivals for each year.</pre>
</div>
</div>
<div class="readable-text print-book-callout" id="p160">
<p><span class="print-book-callout-head">Note</span>  Describe the sequence of operations to load and filter the dataset.</p>
</div>
<div class="readable-text" id="p161">
<p>If you press Enter at the end of the last comment and start writing <code>import</code>, Copilot will propose to complete the statement. Just press Enter to accept the generated code. Alternatively, hover over the proposed text with the mouse, and open Copilot, as shown in figure 2.15.<span class="aframe-location"/></p>
</div>
<div class="browsable-container figure-container" id="p162">
<img alt="figure" height="374" src="../Images/2-15.png" width="1100"/>
<h5 class="figure-container-h5"><span class="num-string">Figure 2.15</span> How to open Copilot in VSC</h5>
</div>
<div class="readable-text" id="p163">
<p>Depending on the generated code, Copilot may propose different solutions, as shown in figure 2.16. Click Accept Solution to accept a solution. In our case, the second solution implements the described steps. Note that every time you run Copilot, it may generate different solutions, even if you rerun the same text.<span class="aframe-location"/></p>
</div>
<div class="browsable-container figure-container" id="p164">
<img alt="figure" height="890" src="../Images/2-16.png" width="1100"/>
<h5 class="figure-container-h5"><span class="num-string">Figure 2.16</span> The different solutions proposed by Copilot in VSC</h5>
</div>
<div class="readable-text" id="p165">
<h3 class="readable-text-h3"><span class="num-string">2.4.2</span> Calculating the percentage increase</h3>
</div>
<div class="readable-text" id="p166">
<p>The next step involves building a new dataset, starting from the previously cleaned dataset. The new dataset will contain the percentage increase values for Portugal and Germany. Write the following operation.</p>
</div>
<div class="browsable-container listing-container" id="p167">
<h5 class="listing-container-h5 browsable-container-h5"><span class="num-string">Listing 2.19</span> Building a new DataFrame with percentage increase</h5>
<div class="code-area-container">
<pre class="code-area"># Add a new column to the DataFrame called PI containing the difference for each country between the number of tourist arrivals in the year and 1994.</pre>
</div>
</div>
<div class="readable-text print-book-callout" id="p168">
<p><span class="print-book-callout-head">Note</span>  Describe how to calculate the percentage increase.</p>
</div>
<div class="readable-text" id="p169">
<p>As in the previous case, Copilot could propose multiple solutions. Open Copilot to check the possible solutions, and accept the one that best implements your operations. If you don’t find any solution that implements your text, rewrite the text by adding more details. If, even after rewriting the text, you can’t find a solution that implements your operations, accept the solution closest to your requests and modify it according to your needs.</p>
</div>
<div class="readable-text" id="p170">
<h3 class="readable-text-h3"><span class="num-string">2.4.3</span> Plotting the basic chart in Altair</h3>
</div>
<div class="readable-text" id="p171">
<p>Now, we’ll instruct Copilot to build a chart similar to what we saw in figure 2.12 (except the airport dataset chart) regarding the percentage increase.</p>
</div>
<div class="browsable-container listing-container" id="p172">
<h5 class="listing-container-h5 browsable-container-h5"><span class="num-string">Listing 2.20</span> Building the chart in Altair</h5>
<div class="code-area-container">
<pre class="code-area"># Use the Altair library to plot the PI column for each country versus the Year.</pre>
</div>
</div>
<div class="readable-text print-book-callout" id="p173">
<p><span class="print-book-callout-head">Note</span>  Describe how the hart should look.</p>
</div>
<div class="readable-text" id="p174">
<p>Copilot could propose multiple solutions. Open Copilot to check the possible solutions, and accept the one that best implements your operations. </p>
</div>
<div class="readable-text" id="p175">
<h3 class="readable-text-h3"><span class="num-string">2.4.4</span> Enriching the chart</h3>
</div>
<div class="readable-text" id="p176">
<p>Instruct Copilot to add the context. In addition, save the resulting chart into an HTML file named output.xhtml.</p>
</div>
<div class="browsable-container listing-container" id="p177">
<h5 class="listing-container-h5 browsable-container-h5"><span class="num-string">Listing 2.21</span> Enriching the chart </h5>
<div class="code-area-container">
<pre class="code-area"># Create a new chart with the following text: 'Thanks to the introduction\n of low-cost flights,\nPortugal has experienced\\nan increase\\nin tourist arrivals\nof over 200% in 25 years,\\neven surpassing the increase\\nin the other countries.' Use the \n as a line break to format the text. Set the font size to 14. 
# Place the two graphs side by side. Set title to 'Tourist Arrivals in Portugal (1994-2018)'.
# Save the chart as an HTML. Name the file chart.xhtml.</pre>
</div>
</div>
<div class="readable-text print-book-callout" id="p178">
<p><span class="print-book-callout-head">Note</span>  Write the annotation and title to show in the chart.</p>
</div>
<div class="readable-text" id="p179">
<p>Once the code is complete, save and run the script. Figure 2.17 shows the resulting chart.<span class="aframe-location"/></p>
</div>
<div class="browsable-container figure-container" id="p180">
<img alt="figure" height="492" src="../Images/2-17.png" width="1100"/>
<h5 class="figure-container-h5"><span class="num-string">Figure 2.17</span> The chart produced by Copilot</h5>
</div>
<div class="readable-text" id="p181">
<p>The chart is a good starting point, but it still needs improvement. To improve the chart, you can run the following steps manually: </p>
</div>
<ol>
<li class="readable-text" id="p182"> Increase the font size of the annotation. </li>
<li class="readable-text" id="p183"> Increase the stroke width of the PT line. </li>
</ol>
<div class="readable-text" id="p184">
<p>Using Copilot may seem pointless, since some elements still need to be managed manually. However, with practice, you will realize how valuable Copilot is for speeding up the writing times of the simplest parts of your code. Copilot will remember your previous code and adapt to your programming style as you use it. With practice, it will likely become your programming companion, just like it is for me!</p>
</div>
<div class="readable-text intended-text" id="p185">
<p>In this chapter, you have learned how to turn a raw dataset into a data story using Altair and Copilot. In the next chapter, we will review Altair’s basic concepts.</p>
</div>
<div class="readable-text" id="p186">
<h2 class="readable-text-h2">Summary</h2>
</div>
<ul>
<li class="readable-text" id="p187"> Altair is a declarative library for data manipulation and visualization. It provides three main elements to build a chart: a chart, a mark, and encodings. Use the chart element to specify the dataset to plot. Use the mark to specify the type of chart to draw, and encodings to set the channels, such as the x- and y-axes. </li>
<li class="readable-text" id="p188"> To turn raw data into a data story, use the DIKW principles progressively. Start by cleaning your dataset, and then extract only meaningful information. Draw the extracted information. Then, add a context and a call to action as annotations. </li>
<li class="readable-text" id="p189"> Copilot is a powerful tool for speeding up code generation. To make Copilot generate your code, split the problem into small steps and describe each step using natural language. Although Copilot is not perfect, it can assist you in building the framework of your code. </li>
<li class="readable-text" id="p190"> Use Copilot to automatically generate your code’s framework, and then manually improve the code. </li>
</ul>
<div class="readable-text" id="p191">
<h2 class="readable-text-h2">References</h2>
</div>
<div class="readable-text" id="p192">
<h3 class="readable-text-h3">EDA</h3>
</div>
<div class="readable-text" id="p193">
<h4 class="readable-text-h4">General approach</h4>
</div>
<ul>
<li class="readable-text" id="p194"> Gupta, D., Bhattacharyya, S., Khanna, A., and Sagar, K. (Eds.). (2020). <em>Intelligent Data Analysis: From Data Gathering to Data Comprehension</em>. John Wiley &amp; Sons. </li>
<li class="readable-text" id="p195"> Rasmussen, R., Gulati, H., Joseph, C., Stanier, C., and Umegbolu, O. (2019). <em>Data Analyst: Careers in Data Analysis</em>. BCS Publishing. </li>
<li class="readable-text" id="p196"> Khalil, M. (2024). <em>Effective Data Analysis: Hard and Soft Skills</em>. Manning Publications. </li>
</ul>
<div class="readable-text" id="p197">
<h4 class="readable-text-h4">Python</h4>
</div>
<ul>
<li class="readable-text" id="p198"> Mukhiya, S. K. and Ahmed, U. (2020). <em>Hands-On Exploratory Data Analysis with Python</em>. Packt Publishing. </li>
<li class="readable-text" id="p199"> Oluleye, A. (2023). <em>Exploratory Data Analysis with Python Cookbook</em>. Packt Publishing. </li>
</ul>
<div class="readable-text" id="p200">
<h3 class="readable-text-h3">Tools and libraries</h3>
</div>
<ul>
<li class="readable-text" id="p201"> <em>Altair: Declarative Visualization in Python</em>. (n.d.). <a href="https://altair-viz.github.io/">https://altair-viz.github.io/</a> </li>
<li class="readable-text" id="p202"> <em>GitHub</em>. (n.d.). <em>GitHub Copilot: Your AI Pair Programmer</em>. <a href="https://github.com/features/copilot">https://github.com/features/copilot</a>. </li>
</ul>
<div class="readable-text" id="p203">
<h3 class="readable-text-h3">Other</h3>
</div>
<ul>
<li class="readable-text" id="p204"> Dobruszkes, F. (2013). The Geography of European Low-Cost Airline Networks: A Contemporary Analysis. <em>Journal of Transport Geography</em>, <em>28</em>, 75–88. </li>
</ul>
</div></body></html>