["```py\nsqlite3 --version\n```", "```py\n3.33.0 2020-08-14 13:23:32 fca8...\n```", "```py\nsqlite3 games.db\n```", "```py\nCREATE TABLE games(             #1\nrank int, name text, platform text,                    #2\nyear int, genre text, publisher text, americasales numeric, \neusales numeric, japansales numeric, othersales numeric, \nglobalsales numeric);\n```", "```py\n.mode csv                           #1\n.import /Downloads/videogames.csv games  #2\n```", "```py\nSELECT count(*) FROM games;\n```", "```py\nSELECT [Columns or Aggregates]  #1\nFROM [List of tables]           #2\nWHERE [List of conditions]      #3\n```", "```py\nSELECT Count(*)\nFROM games\nWHERE year = 2017\n```", "```py\nSELECT name, eusales + japansales\nFROM games\nWHERE year = 2017 AND publisher = 'Activision'\n```", "```py\nSELECT genre, name, eusales + japansales\nFROM games\nWHERE year = 2017 AND publisher = 'Activision'\nGROUP BY genre\n```", "```py\nDatabase:                                          #1\nCREATE TABLE games(rank int, name text, platform text,\nyear int, genre text, publisher text, americasales numeric,\neusales numeric, japansales numeric, othersales numeric,\nglobalsales numeric);\nTranslate this question into SQL query:  #2\n[Question]                          #3\n```", "```py\ndef create_prompt(question):\n    parts = []\n     #1\n    parts += ['Database:']\n    parts += ['create table games(rank int, name text, platform text,']\n    parts += ['year int, genre text, publisher text, americasales numeric,']  \n    parts += ['eusales numeric, japansales numeric, othersales numeric,'] \n    parts += ['globalsales numeric);']\n     #2\n    parts += ['Translate this question into SQL query:']\n    parts += [question]      #3\n    return '\\n'.join(parts)  #4\n```", "```py\nimport argparse\nimport openai\nimport re\nimport time\n\nclient = openai.OpenAI()\n\ndef create_prompt(question):                #1\n    \"\"\" Generate prompt to translate question into SQL query.\n\n    Args:\n        question: question about data in natural language.\n\n    Returns:\n        prompt for question translation.\n    \"\"\"\n    parts = []\n    parts += ['Database:']\n    parts += ['create table games(rank int, name text, platform text,']\n    parts += ['year int, genre text, publisher text, americasales numeric,']  \n    parts += ['eusales numeric, japansales numeric, othersales numeric,'] \n    parts += ['globalsales numeric);']\n    parts += ['Translate this question into SQL query:']\n    parts += [question]\n    return '\\n'.join(parts)\n\ndef call_llm(prompt):                             #2\n    \"\"\" Query large language model and return answer.\n\n    Args:\n        prompt: input prompt for language model.\n\n    Returns:\n        Answer by language model.\n    \"\"\"\n    for nr_retries in range(1, 4):\n        try:\n            response = client.chat.completions.create(\n                model='gpt-4o',\n                messages=[\n                    {'role':'user', 'content':prompt}\n                    ]\n                )\n            return response.choices[0].message.content\n        except:\n            time.sleep(nr_retries * 2)\n    raise Exception('Cannot query OpenAI model!')\n\nif __name__ == '__main__':       #3\n\n    parser = argparse.ArgumentParser()\n    parser.add_argument('question', type=str, help='A question about games')\n    args = parser.parse_args()\n\n    prompt = create_prompt(args.question)  #4\n    answer = call_llm(prompt)         #5\n     #6\n    query = re.findall('\\verb|```", "```py|', answer, re.DOTALL)[0]\n\n    print(f'SQL: {query}')\n```", "```py` ```", "```py` and ```", "```py ```", "```py` ```", "```py ```", "```py\npython listing1.py \"How many games are stored?\"\n```", "```py\nSELECT COUNT(*) FROM games;\n```", "```py\nsqlite3 games.db\n```", "```py\nimport sqlite3\n\nwith sqlite3.connect(data_path) as connection:\n    ...\n```", "```py\nimport sqlite3\n\nwith sqlite3.connect(data_path) as connection:\n    cursor = connection.cursor()\n    cursor.execute(query)\n```", "```py\ndef process_query(data_path, query):\n    with sqlite3.connect(data_path) as connection:  #1\n        cursor = connection.cursor()           #2\n        cursor.execute(query)    #3\n        table_rows = cursor.fetchall()  #4\n         #5\n        table_strings = [str(r) for r in table_rows]\n        return '\\n'.join(table_strings)          #6\n```", "```py\nselect sql from sqlite_master where type = 'table';\n```", "```py\nimport sqlite3\n\ndef get_structure(data_path):\n    with sqlite3.connect(data_path) as connection:  #1\n        cursor = connection.cursor()          #2\n        cursor.execute(\"select sql from sqlite_master where type =\n        â†ª 'table';\")             #3\n        table_rows = cursor.fetchall()      #4\n        table_ddls = [r[0] for r in table_rows]  #5\n        return '\\n'.join(table_ddls)        #6\n```", "```py\nimport argparse\nimport openai\nimport re\nimport sqlite3\nimport time\n\nclient = openai.OpenAI()\n\ndef get_structure(data_path):               #1\n    \"\"\" Extract structure from SQLite database.\n\n    Args:\n        data_path: path to SQLite data file.\n\n    Returns:\n        text description of database structure.\n    \"\"\"\n    with sqlite3.connect(data_path) as connection:\n        cursor = connection.cursor()\n        cursor.execute(\"select sql from sqlite_master where type = 'table';\")\n        table_rows = cursor.fetchall()\n        table_ddls = [r[0] for r in table_rows]\n        return '\\n'.join(table_ddls)\n\ndef create_prompt(description, question):     #2\n    \"\"\" Generate prompt to translate a question into an SQL query.\n\n    Args:\n        description: text description of database structure.\n        question: question about data in natural language.\n\n    Returns:\n        prompt for question translation.\n    \"\"\"\n    parts = []\n    parts += ['Database:']\n    parts += [description]\n    parts += ['Translate this question into SQL query:']\n    parts += [question]\n    return '\\n'.join(parts)\n\ndef call_llm(prompt):                             #3\n    \"\"\" Query large language model and return answer.\n\n    Args:\n        prompt: input prompt for language model.\n\n    Returns:\n        Answer by language model.\n    \"\"\"\n    for nr_retries in range(1, 4):\n        try:\n            response = client.chat.completions.create(\n                model='gpt-4o',\n                messages=[\n                    {'role':'user', 'content':prompt}\n                    ]\n                )\n            return response.choices[0].message.content\n        except:\n            time.sleep(nr_retries * 2)\n    raise Exception('Cannot query OpenAI model!')\n\ndef process_query(data_path, query):        #4\n    \"\"\" Processes SQL query and returns result.\n\n    Args:\n        data_path: path to SQLite data file.\n        query: process this query on database.\n\n    Returns:\n        query result.\n    \"\"\"\n    with sqlite3.connect(data_path) as connection:\n        cursor = connection.cursor()\n        cursor.execute(query)\n        table_rows = cursor.fetchall()\n        table_strings = [str(r) for r in table_rows]\n        return '\\n'.join(table_strings)\n\nif __name__ == '__main__':\n\n    parser = argparse.ArgumentParser()\n    parser.add_argument('dbpath', type=str, help='Path to SQLite data')\n    args = parser.parse_args()\n\n    data_structure = get_structure(args.dbpath)  #5\n\n    while True:           #6\n        user_input = input('Enter question:')\n        if user_input == 'quit':\n            break\n\n        prompt = create_prompt(data_structure, user_input)\n        answer = call_llm(prompt)\n        query = re.findall('```", "```py', answer, re.DOTALL)[0]\n        print(f'SQL: {query}')\n\n        try:                               #7\n            result = process_query(args.dbpath, query)\n            print(f'Result: {result}')\n        except:\n            print('Error processing query! Try to reformulate.')\n```", "```py\npython listing3.py games.db\n```", "```py\nEnter question:How many games are stored in total?\nSQL: SELECT COUNT(*) FROM games;\nAnswer: (16599,)\nEnter question:How many games did Activision create?\nSQL: SELECT COUNT(*) FROM games WHERE publisher = 'Activision'\nAnswer: (975,)\nEnter question:Name one game that was released in 2017!\nSQL: SELECT name\nFROM games\nWHERE year = 2017\nLIMIT 1\nAnswer: ('Phantasy Star Online 2 Episode 4: Deluxe Package',)\nEnter question:How many games were released for each genre?\nSQL: SELECT genre, COUNT(*) as num_games\nFROM games\nGROUP BY genre\nAnswer: ('Action', 3316)\n('Adventure', 1286)\n('Fighting', 848)\n('Genre', 1)\n('Misc', 1739)\n('Platform', 886)\n('Puzzle', 582)\n('Racing', 1249)\n('Role-Playing', 1488)\n('Shooter', 1310)\n('Simulation', 867)\n('Sports', 2346)\n('Strategy', 681)\nEnter question:Which three games sold more copies in Japan than in Europe?\nSQL: SELECT name\nFROM games\nWHERE japansales > eusales\nORDER BY japansales DESC\nLIMIT 3;\nAnswer: ('Name',)\n('Pokemon Red/Pokemon Blue',)\n('Pokemon Gold/Pokemon Silver',)\nEnter question:Break down game sales in America by the platform!\nSQL: SELECT platform, sum(americasales) AS total_sales\nFROM games\nGROUP BY platform\nAnswer: ('2600', 90.59999999999992)\n('3DO', 0)\n('3DS', 78.86999999999996)\n('DC', 5.43)\n('DS', 390.7099999999977)\n('GB', 114.32000000000001)\n('GBA', 187.54000000000033)\n('GC', 133.46000000000004)\n('GEN', 19.27)\n('GG', 0)\n('N64', 139.02000000000015)\n('NES', 125.94000000000005)\n('NG', 0)\n('PC', 93.2800000000005)\n('PCFX', 0)\n('PS', 336.509999999998)\n('PS2', 583.8399999999925)\n('PS3', 392.2599999999998)\n('PS4', 96.79999999999998)\n('PSP', 108.98999999999975)\n('PSV', 16.200000000000006)\n('Platform', 0.0)\n('SAT', 0.7200000000000001)\n('SCD', 1)\n('SNES', 61.22999999999998)\n('TG16', 0)\n('WS', 0)\n('Wii', 507.7099999999991)\n('WiiU', 38.31999999999999)\n('X360', 601.0499999999992)\n('XB', 186.6900000000008)\n('XOne', 83.19000000000003)\nEnter question:quit\n```", "```py\nMATCH (p:Person)  #1\nRETURN p.name     #2\n```", "```py\n #1\nMATCH (p:Person {name: 'Tom Cruise'})-[:ACTED_IN]->(m:Movie)\nRETURN m.title                                       #2\n```", "```py\n #1\nMATCH (p:Person {name: 'Tom Cruise'})-[:ACTED_IN]->(m:Movie) \nRETURN count(*)                                 #2\n```", "```py\nNeo4j Database:        #1\nNode labels: Movie, Person\nRelationship types: ACTED_IN, DIRECTED,\nFOLLOWS, PRODUCED, REVIEWED, WROTE\nProperty keys: born, name, rating, released\nroles, summary, tagline, title\n[Question]                 #2\nCypher Query:              #3\n```", "```py\ndef create_prompt(question):\n    parts = []\n    parts += ['Neo4j Database:']\n    parts += ['Node labels: Movie, Person']\n    parts += ['Relationship types: ACTED_IN, DIRECTED,']  \n    parts += ['FOLLOWS, PRODUCED, REVIEWED, WROTE'] \n    parts += ['Property keys: born, name, rating, released']\n    parts += ['roles, summary, tagline, title']\n    parts += [question]\n    parts += ['Cypher Query:']\n    return '\\n'.join(parts)\n```", "```py\nimport argparse\nimport openai\nimport re\nimport time\n\nclient = openai.OpenAI()\n\ndef create_prompt(question):                 #1\n    \"\"\" Generate prompt to translate a question into Cypher query.\n\n    Args:\n        question: question about data in natural language.\n\n    Returns:\n        prompt for question translation.\n    \"\"\"\n    parts = []\n    parts += ['Neo4j Database:']\n    parts += ['Node labels: Movie, Person']\n    parts += ['Relationship types: ACTED_IN, DIRECTED,']  \n    parts += ['FOLLOWS, PRODUCED, REVIEWED, WROTE'] \n    parts += ['Property keys: born, name, rating, released']\n    parts += ['roles, summary, tagline, title']\n    parts += [question]\n    parts += ['Cypher Query:']\n    return '\\n'.join(parts)\n\ndef call_llm(prompt):                             #2\n    \"\"\" Query large language model and return answer.\n\n    Args:\n        prompt: input prompt for language model.\n\n    Returns:\n        Answer by language model.\n    \"\"\"\n    for nr_retries in range(1, 4):\n        try:\n            response = client.chat.completions.create(\n                model='gpt-4o',\n                messages=[\n                    {'role':'user', 'content':prompt}\n                    ]\n                )\n            return response.choices[0].message.content\n        except:\n            time.sleep(nr_retries * 2)\n    raise Exception('Cannot query OpenAI model!')\n\nif __name__ == '__main__':\n\n    parser = argparse.ArgumentParser()\n    parser.add_argument('question', type=str, help='A question about movies')\n    args = parser.parse_args()\n\n    prompt = create_prompt(args.question)  #3\n    answer = call_llm(prompt)         #4\n    #5\n    query = re.findall('```", "```py', answer, re.DOTALL)[0]\n\n    print(f'Cyper Query: {query}')\n```", "```py\npython listing3.py \"How many movies are stored?\"\n```", "```py\nMATCH (m:Movie)\nRETURN COUNT(m) AS numberOfMovies\n```"]