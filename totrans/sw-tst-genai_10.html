<html><head></head><body>
<div class="calibre1" id="sbo-rt-content"><h1 class="tochead" id="heading_id_2">9 <a id="idTextAnchor000"/><a id="idTextAnchor001"/><a id="idTextAnchor002"/><a id="idTextAnchor003"/>AI agents as testing assistants</h1>
<p class="co-summary-head">This chapter covers<a id="idIndexMarker000"/><a id="marker-181"/></p>
<ul class="calibre5">
<li class="co-summary-bullet">Understanding how AI agents can be built using LLMs</li>
<li class="co-summary-bullet">Creating a basic AI agent to demonstrate their value</li>
</ul>
<p class="body">Over the previous few chapters, we saw how large language models (LLMs) can assist us in testing. We also learned how to employ various prompt techniques to get the most out of LLMs and curate different prompts that can be utilized when required. This is a great position to be in, but what if we could take our new understanding one step further to create custom-made AI testing assistants?</p>
<p class="body">As LLMs have advanced, so have the opportunities to create AI agents, applications that can take a goal and autonomously interact with other systems, collect data, analyze information, and adapt a suitable response to achieve said goal. In the field of AI, an agent can be implemented in many ways, but the goal tends to be the same—to create something that we can give a task to be solved. The scope of designing and building AI agents is large, but in this chapter, we’ll learn a bit more about their potential and how they work in the context of generative AI. We’ll also create our own basic test data AI agent to demonstrate the power and potential of this technology.</p>
<h2 class="fm-head" id="heading_id_3">9.1 Understanding AI agents and LLMs</h2>
<p class="body">When we discuss AI agents, we need to specify what we mean. AI agents can be implemented in different ways, depending on the field of AI we are working in. But that’s not to say that there aren’t expected behaviors of an agent regardless of how it works. So, before we begin to implement our agents, let’s first define what these expected behaviors might look like and then how agents might be built in the context of generative AI.<a id="idIndexMarker001"/></p>
<h3 class="fm-head1" id="heading_id_4">9.1.1 What defines an AI agent?</h3>
<p class="body"><a id="marker-182"/>To comprehend what defines an agent, we have to focus more on the characteristics that are imbued within it than on its implementation. There is no explicit list of characteristics an agent is expected to meet, but the following attributes are usually found:<a id="idIndexMarker002"/></p>
<ul class="calibre5">
<li class="fm-list-bullet">
<p class="list"><i class="fm-italics">Being goal-driven</i>—An agent must be able to receive a goal that it can ultimately achieve. The goal itself can be something that is either specific, such as “Make me a hotel booking for X,” or more abstract, such as “Determine the most successful stock to buy next month based on current trends.” Regardless of the scope of the goal, some sort of direction is required to help us evaluate whether the actions an agent is taking are bringing it closer to completing its task.<a id="idIndexMarker003"/></p>
</li>
<li class="fm-list-bullet">
<p class="list"><i class="fm-italics">Being perceptive—</i>An agent must also be able to interact with the wider world. This might mean extracting information, or interacting with a system to produce results. Examples might include making an HTTP request to a web API to get data for processing or running web automation code to complete a booking form. Whatever we want our agent to achieve, we have to give it the ability to interact with the world outside so that it can solve problems for us.<a id="idIndexMarker004"/></p>
</li>
<li class="fm-list-bullet">
<p class="list"><i class="fm-italics">Have autonomy</i>—Perhaps most crucially, an agent must be able to autonomously decide how a problem is solved. Instead of following a clear, algorithmic path that we set out, it can pick and choose what tasks to do and in what order. This is where the core element of an agent is usually found. By evaluating the goal it has been given, it can interact with the world, carry out tasks, and evaluate whether said tasks align with the goal it’s been set.<a id="idIndexMarker005"/></p>
</li>
<li class="fm-list-bullet">
<p class="list"><i class="fm-italics">Being adaptive</i>—Finally, agents must also be able to learn from actions. For example, agents that can complete video games do so by learning from the mistakes they make. But it can just mean reacting to specific information that is retrieved at a given point in time. Much like in autonomy, the goal that has been set plays a role in determining if an agent has been successful when carrying out a specific task. If it has not, we want our agent to be able to react to that failure not to repeat it or to work around it to achieve its set goal.<a id="idIndexMarker006"/></p>
</li>
</ul>
<p class="body">This is not an exhaustive list of characteristics. Depending on the problem an agent is being asked to solve will determine which characteristics matter more. However, the examples provided give us a sense of what an AI agent might look like and how it behaves. Thus, an agent is an autonomous piece of software thar can be given a relatively complex task and solve it for us.</p>
<h3 class="fm-head1" id="heading_id_5">9.1.2 How an agent works with LLMs</h3>
<p class="body">So, how are these characteristics created when using LLMs to drive an agent? The answer is, “through the use of an LLM feature called <i class="fm-italics">function calling</i>,” which allows us to encapsulate code into functions that an LLM can trigger for us when it is prompted to complete a task. To help us better understand this process, figure 9.1 outlines the general process of how function calling works.<a id="idIndexMarker007"/><a id="idIndexMarker008"/><a id="idIndexMarker009"/><a id="marker-183"/></p>
<div class="figure">
<p class="figure1"><img alt="" class="calibre36" src="../../OEBPS/Images/CH09_F01_Winteringham2.png"/></p>
<p class="figurecaption">Figure 9.1 An outline of an LLM agent using function calling</p>
</div>
<p class="body">As described in the figure, function calling works by providing both a prompt and encapsulated code to an LLM. The LLM can then determine which function to run to achieve the goal set within our prompt. Inside each function, there will be code built by us that will process information or interact with the outside world in some shape, form, or manner. For example, a function might extract data from a web API, scrape a web page, or gather information from a sensor. A function may also be sent parameters from the LLM to apply further processing on received data before sending it back to the LLM for future use.</p>
<p class="body">What gives our agents their autonomous characteristic is an LLM’s ability to determine which functions are called when and with what data. Each function we create is provided with some additional instructions to help the LLM determine what our code within the function does. When given a task to complete, the LLM can process the initial prompt, select the right function to call first, and store any information that is returned by a function into the prompt itself.</p>
<p class="body">This autonomy is what distinguishes an agent from a tool that executes an ordered list of functions that interacts with different APIs or services. An agent may be given a large collection of various functions that process information and interact with the world in different ways, utilizing only the necessary functions to solve a problem.</p>
<h2 class="fm-head" id="heading_id_6">9.2 Creating an AI Test Assistant</h2>
<p class="body">Now that we have a grounding in what agents are and how they work in the context of generative AI, let’s build our own. For this example, we’ll be building an AI agent that will read and create data for us when given instructions. This might feel like a somewhat simple agent, but to get into more advanced topics around agents would require another whole book. However, with this example, we’ll get a better understanding of how an agent can be built with the use of LLMs so that we can take both our prompt engineering and agent building to the next level. We’ll go through the process of creating our AI agent step by step, but you can check our completed version for reference at: <a class="url" href="https://mng.bz/aVlJ">https://mng.bz/aVlJ</a>.<a id="idIndexMarker010"/><a id="marker-184"/><a id="idIndexMarker011"/></p>
<h3 class="fm-head1" id="heading_id_7">9.2.1 Setting up our dummy AI agent</h3>
<p class="body">We begin by creating a Maven project, and within our <code class="fm-code-in-text">pom.xml</code> file, we add the following dependencies:<a id="idIndexMarker012"/></p>
<pre class="programlisting">&lt;dependencies&gt;
 
    &lt;dependency&gt;                                                    <span class="fm-combinumeral">❶</span>
        &lt;groupId&gt;dev.langchain4j&lt;/groupId&gt;                          <span class="fm-combinumeral">❶</span>
        &lt;artifactId&gt;langchain4j-open-ai&lt;/artifactId&gt;                <span class="fm-combinumeral">❶</span>
        &lt;version&gt;0.31.0&lt;/version&gt;                                   <span class="fm-combinumeral">❶</span>
    &lt;/dependency&gt;                                                   <span class="fm-combinumeral">❶</span>
 
    &lt;dependency&gt;                                                    <span class="fm-combinumeral">❷</span>
        &lt;groupId&gt;dev.langchain4j&lt;/groupId&gt;                          <span class="fm-combinumeral">❷</span>
        &lt;artifactId&gt;langchain4j&lt;/artifactId&gt;                        <span class="fm-combinumeral">❷</span>
        &lt;version&gt;0.31.0&lt;/version&gt;                                   <span class="fm-combinumeral">❷</span>
    &lt;/dependency&gt;                                                   <span class="fm-combinumeral">❷</span>
 
    &lt;dependency&gt;                                                    <span class="fm-combinumeral">❸</span>
        &lt;groupId&gt;com.h2database&lt;/groupId&gt;                           <span class="fm-combinumeral">❸</span>
        &lt;artifactId&gt;h2&lt;/artifactId&gt;                                 <span class="fm-combinumeral">❸</span>
        &lt;version&gt;2.2.224&lt;/version&gt;                                  <span class="fm-combinumeral">❸</span>
    &lt;/dependency&gt;                                                   <span class="fm-combinumeral">❸</span>
&lt;/dependencies&gt;                                                     <span class="fm-combinumeral">❸</span></pre>
<p class="fm-code-annotation"><span class="fm-combinumeral">❶</span> Functions to quickly connect to OpenAI platform</p>
<p class="fm-code-annotation"><span class="fm-combinumeral">❷</span> AI services to create our AI agent</p>
<p class="fm-code-annotation"><span class="fm-combinumeral">❸</span> Database to manipulate with our agent</p>
<p class="body">We’ll be using LangChain4J (h<a class="url" href="https://docs.langchain4j.dev">ttps://docs.langchain4j.dev</a>) to manage both the communication with our LLM and the necessary functions we want our agent to execute. This will become clearer when we implement said functions, but first, let’s establish our connection to LLM by creating a new class called <code class="fm-code-in-text">DataAssistant</code> with a <code class="fm-code-in-text">main</code> function:<a id="idIndexMarker013"/><a id="idIndexMarker014"/></p>
<pre class="programlisting">public class DataAssistant {
 
    public static void main(String[] args) {
        
    }
    
}</pre>
<p class="body">Now we can update the class with the necessary code to send a basic prompt to a gpt-3.5-turbo model:</p>
<pre class="programlisting">public class DataAssistant {
 
    static interface DataAssistantService {                          <span class="fm-combinumeral">❶</span>
        String sendPrompt(String userPrompt);                        <span class="fm-combinumeral">❶</span>
    }                                                                <span class="fm-combinumeral">❶</span>
 
    public static void main(String[] args) {                         <span class="fm-combinumeral">❶</span>
 
        OpenAiChatModel model = OpenAiChatModel                      <span class="fm-combinumeral">❷</span>
                .builder()                                           <span class="fm-combinumeral">❷</span>
                .apiKey("API-KEY-HERE")                              <span class="fm-combinumeral">❷</span>
                .modelName(OpenAiChatModelName.GPT_3_5_TURBO)        <span class="fm-combinumeral">❷</span>
                .build();                                            <span class="fm-combinumeral">❷</span>
 
        DataAssistantService dataAssistantChat =                     <span class="fm-combinumeral">❸</span>
   <span class="fm-code-continuation-arrow">➥</span> AiServices.builder(DataAssistantService.class)                 <span class="fm-combinumeral">❸</span>
                .chatLanguageModel(model)                            <span class="fm-combinumeral">❸</span>
                .build();                                            <span class="fm-combinumeral">❸</span>
 
        String response = dataAssistantChat.sendPrompt("Hi, can you  <span class="fm-combinumeral">❹</span>
        <span class="fm-code-continuation-arrow">➥</span>introduce yourself?");                                     <span class="fm-combinumeral">❹</span>
        System.out.printf(response);                                 <span class="fm-combinumeral">❹</span>
    }                                                                <span class="fm-combinumeral">❹</span>
 
}                                                                    <span class="fm-combinumeral">❹</span></pre>
<p class="fm-code-annotation"><span class="fm-combinumeral">❶</span> Creates an interface to add our AI services into</p>
<p class="fm-code-annotation"><span class="fm-combinumeral">❷</span> Sets up access to our OpenAI model and model preference</p>
<p class="fm-code-annotation"><span class="fm-combinumeral">❸</span> Uses AiServices.builder to add our model to our DataAssistantService</p>
<p class="fm-code-annotation"><span class="fm-combinumeral">❹</span> Sends a basic prompt to OpenAI, stores the response, and outputs it</p>
<p class="body"><a id="marker-185"/>The <code class="fm-code-in-text">OpenAiChatModel</code> portion of the code establishes which model we want to connect and our authorization method. Within the <code class="fm-code-in-text">.apiKey</code> method, we provide an API key from OpenAI that can be generated via their API keys page found at <a class="url" href="https://platform.openai.com/api-keys">https://platform.openai.com/api-keys</a>. We then provide the model as a parameter when setting up our <code class="fm-code-in-text">DataAssistantService</code> using the <code class="fm-code-in-text">AiServices</code> library. This lets us keep our model choice and our AI services separate, allowing us to easily change the model we want to use. The <code class="fm-code-in-text">DataAssistantService</code> interface helps to configure the method we want to use to send our prompt, as well as add other advanced features if we desire, such as system prompts that contextualize the user prompts that we want to send once our service is established. We’ll start to see how <code class="fm-code-in-text">AiServices</code> comes into its own shortly, but for now, we can test our implemented code out by running it and getting a response similar to the following:<a id="idIndexMarker015"/><a id="idIndexMarker016"/><a id="idIndexMarker017"/><a id="idIndexMarker018"/><a id="idIndexMarker019"/></p>
<table border="0" class="contenttable-0-table" width="100%">
<colgroup class="contenttable-0-colgroup">
<col class="contenttable-0-col" span="1" width="7%"/>
<col class="contenttable-0-col" span="1" width="93%"/>
</colgroup>
<tbody class="contenttable-0-tbody">
<tr class="contenttable-0-tr">
<td class="contenttable-0-td">
<div class="figure2">
<p class="figure1"><img alt="" class="calibre7" height="40" src="../../OEBPS/Images/logo-openai.png" width="40"/></p>
</div>
</td>
<td class="contenttable-0-td">
<p class="body-table">Hello, I am a language model AI assistant created by OpenAI. I am here to help answer your questions and assist you with any information you may need. How can I help you today?</p>
</td>
</tr>
</tbody>
</table>
<p class="body">Now that we are connected to our LLM, we can begin to build out the tasks we want our agent to trigger to give our assistant some agency. To do this, we create a new class called <code class="fm-code-in-text">DataAssistantTools</code> and add the following code:<a id="idIndexMarker020"/><a id="marker-186"/></p>
<pre class="programlisting">public class DataAssistantTools {
 
    @Tool("Create room records")
    public void createRooms(@P("Amount of room records to create")
    <span class="fm-code-continuation-arrow">➥</span>int count) {
        System.out.println("You want me to create " + count + "
        <span class="fm-code-continuation-arrow">➥</span>rooms.");
    }
 
    @Tool("Create booking records")
    public void createBookings(@P("Amount of booking records to
    <span class="fm-code-continuation-arrow">➥</span>create") int count) {
        System.out.println("You want me to create " + count + "
        <span class="fm-code-continuation-arrow">➥</span>bookings.");
    }
 
    @Tool("Show results of database")
    public void displayDatabase() {
        System.out.println("I'll then share current database
        <span class="fm-code-continuation-arrow">➥</span>details");
    }
 
}</pre>
<p class="body">We’ve now created three functions that our LLM can choose to trigger when prompted. But how does the LLM determine which function to trigger at a given time? This is achieved by using the <code class="fm-code-in-text">@Tool</code> annotation provided by <code class="fm-code-in-text">LangChain4J</code>. The <code class="fm-code-in-text">@Tool</code> annotation not only identifies what method to trigger, but also indicates to the LLM in natural language what the code does, so that the LLM can determine if it’s a function that is worth calling. For example, our first tool has the annotation <code class="fm-code-in-text">@Tool("Create</code> <code class="fm-code-in-text">room records")</code>. If we send a prompt to our LLM, along with our tool, asking it to create some rooms, then the LLM will determine that our tool should be executed. If we were to send a prompt with an entirely different message, then the tool might not be used. We’ll see this in action shortly, but first, let’s update our <code class="fm-code-in-text">AiServices</code> builder so that it incorporates our newly created <code class="fm-code-in-text">DataAssistantTools</code>:<a id="idIndexMarker021"/><a id="idIndexMarker022"/><a id="idIndexMarker023"/><a id="idIndexMarker024"/></p>
<pre class="programlisting">DataAssistantService dataAssistantChat =
<span class="fm-code-continuation-arrow">➥</span>AiServices.builder(DataAssistantService.class)
                .chatLanguageModel(model)
 
                .tools(new DataAssistantTools())                      <span class="fm-combinumeral">❶</span>
                .build();                                             <span class="fm-combinumeral">❶</span>
 
        while(true){                                                  <span class="fm-combinumeral">❷</span>
            Scanner scanner = new Scanner(System.in);                 <span class="fm-combinumeral">❷</span>
            System.out.println("What do you need?");                  <span class="fm-combinumeral">❷</span>
 
            String query = scanner.nextLine();                        <span class="fm-combinumeral">❷</span>
            String response = dataAssistantChat.sendPrompt(query);    <span class="fm-combinumeral">❷</span>
            System.out.println(response);                             <span class="fm-combinumeral">❷</span>
        }                                                             <span class="fm-combinumeral">❷</span></pre>
<p class="fm-code-annotation"><span class="fm-combinumeral">❶</span> Adds our tools via the tools() method within the builder</p>
<p class="fm-code-annotation"><span class="fm-combinumeral">❷</span> Sets up a Scanner to keep the app running and receive prompts</p>
<p class="body"><a id="marker-187"/>As we can see, the <code class="fm-code-in-text">AiServices</code> builder begins to demonstrate its value by allowing us to set both the model we want to use and the tools we want the agent to use. We’ve also updated our means of inputting prompts so that the application stays up and running continuously and we can test out our new agent with different instructions. So, when we run the agent and are asked<a id="idIndexMarker025"/></p>
<table border="0" class="contenttable-0-table" width="100%">
<colgroup class="contenttable-0-colgroup">
<col class="contenttable-0-col" span="1" width="7%"/>
<col class="contenttable-0-col" span="1" width="93%"/>
</colgroup>
<tbody class="contenttable-0-tbody">
<tr class="contenttable-0-tr">
<td class="contenttable-0-td">
<div class="figure2">
<p class="figure1"><img alt="" class="calibre7" height="40" src="../../OEBPS/Images/logo-openai.png" width="40"/></p>
</div>
</td>
<td class="contenttable-0-td">
<p class="body-table">What do you need?</p>
</td>
</tr>
</tbody>
</table>
<p class="body">we can submit our prompt:</p>
<table border="0" class="contenttable-0-table" width="100%">
<colgroup class="contenttable-0-colgroup">
<col class="contenttable-0-col" span="1" width="7%"/>
<col class="contenttable-0-col" span="1" width="93%"/>
</colgroup>
<tbody class="contenttable-0-tbody">
<tr class="contenttable-0-tr">
<td class="contenttable-0-td">
<div class="figure2">
<p class="figure1"><img alt="" class="calibre7" height="40" src="../../OEBPS/Images/logo-MW.png" width="40"/></p>
</div>
</td>
<td class="contenttable-0-td">
<p class="body-table">Can you create me 4 rooms and 2 bookings and tell me what’s in the db</p>
</td>
</tr>
</tbody>
</table>
<p class="body">to be returned the following response:</p>
<table border="0" class="contenttable-0-table" width="100%">
<colgroup class="contenttable-0-colgroup">
<col class="contenttable-0-col" span="1" width="7%"/>
<col class="contenttable-0-col" span="1" width="93%"/>
</colgroup>
<tbody class="contenttable-0-tbody">
<tr class="contenttable-0-tr">
<td class="contenttable-0-td">
<div class="figure2">
<p class="figure1"><img alt="" class="calibre7" height="40" src="../../OEBPS/Images/logo-openai.png" width="40"/></p>
</div>
</td>
<td class="contenttable-0-td">
<p class="body-table">You want me to create 4 rooms.</p>
<p class="body-table">You want me to create 2 bookings.</p>
<p class="body-table">I’ll then share current database details</p>
</td>
</tr>
</tbody>
</table>
<p class="body">Let’s break down how this output has been generated. First, we’ve sent our prompt and tools to gpt-3.5-turbo to process. The model then evaluates the details of the prompts and looks through the list of tools we’ve tagged using the <code class="fm-code-in-text">@Tool</code> annotation to find which tools are relevant to our instructions. At the start of the prompt, we requested “Can you create me 4 rooms,” and the LLM has determined that our <code class="fm-code-in-text">createRooms</code> tool should be run because of its relevance to the annotation <code class="fm-code-in-text">@Tool("Create</code> <code class="fm-code-in-text">room records")</code>. Next, we can see that the output correctly stated that we want to create four rooms. This is because we passed a parameter into our <code class="fm-code-in-text">createRooms</code> method using LangChain’s <code class="fm-code-in-text">@P</code> annotation in the form of <code class="fm-code-in-text">@P("Amount</code> <code class="fm-code-in-text">of</code> <code class="fm-code-in-text">room</code> <code class="fm-code-in-text">records</code> <code class="fm-code-in-text">to</code> <code class="fm-code-in-text">create") int</code> <code class="fm-code-in-text">count</code>. Notice how we provide natural language context again to the <code class="fm-code-in-text">@P</code> annotation in a similar fashion to the <code class="fm-code-in-text">@Tool</code> annotation. This allows the LLM to do a similar relevancy match, extract what it believes is the necessary data from our prompt, and provide it as a parameter to be output.<a id="idIndexMarker026"/><a id="idIndexMarker027"/><a id="idIndexMarker028"/><a id="idIndexMarker029"/><a id="idIndexMarker030"/><a id="idIndexMarker031"/><a id="idIndexMarker032"/></p>
<p class="body">We can now also test our agent’s ability to determine which tool to use autonomously by giving it different instructions. This time, when asked for a prompt, we sent</p>
<table border="0" class="contenttable-0-table" width="100%">
<colgroup class="contenttable-0-colgroup">
<col class="contenttable-0-col" span="1" width="7%"/>
<col class="contenttable-0-col" span="1" width="93%"/>
</colgroup>
<tbody class="contenttable-0-tbody">
<tr class="contenttable-0-tr">
<td class="contenttable-0-td">
<div class="figure2">
<p class="figure1"><img alt="" class="calibre7" height="40" src="../../OEBPS/Images/logo-MW.png" width="40"/></p>
</div>
</td>
<td class="contenttable-0-td">
<p class="body-table">Can you tell me what’s in the database currently</p>
</td>
</tr>
</tbody>
</table>
<p class="body">Running this would return the response:</p>
<table border="0" class="contenttable-0-table" width="100%">
<colgroup class="contenttable-0-colgroup">
<col class="contenttable-0-col" span="1" width="7%"/>
<col class="contenttable-0-col" span="1" width="93%"/>
</colgroup>
<tbody class="contenttable-0-tbody">
<tr class="contenttable-0-tr">
<td class="contenttable-0-td">
<div class="figure2">
<p class="figure1"><img alt="" class="calibre7" height="40" src="../../OEBPS/Images/logo-openai.png" width="40"/></p>
</div>
</td>
<td class="contenttable-0-td">
<p class="body-table">I’ll then share current database details</p>
</td>
</tr>
</tbody>
</table>
<p class="body">In this case, the LLM has triggered only one of our tools, specifically <code class="fm-code-in-text">displayDatabase</code> annotated as <code class="fm-code-in-text">@Tool("Show</code> <code class="fm-code-in-text">results</code> <code class="fm-code-in-text">of</code> <code class="fm-code-in-text">database")</code>. Since we’ve not mentioned creating rooms or bookings in our prompt, the related tools are deemed not relevant to our instructions and are therefore ignored. This demonstrates the power of agents. Imagine if we had not just 3 tools, but 10, 20, or more. The more we add, the more ways we give an agent the ability to react to our instructions and solve our requested problems.<a id="idIndexMarker033"/></p>
<h3 class="fm-head1" id="heading_id_8">9.2.2 Giving our AI agent functions to execute</h3>
<p class="body"><a id="marker-188"/>We have the decision-making process wired up, so now let’s complete our agent and give it the ability to carry out some database queries for us. For this, we’re going to create a dummy database using <code class="fm-code-in-text">h2</code> with some basic tables to demonstrate how we can have our LLM execute actions for us. To do this, we’ll start by creating a new class <code class="fm-code-in-text">QueryTools</code> and adding the following code:<a id="idIndexMarker034"/><a id="idIndexMarker035"/></p>
<pre class="programlisting">public class QueryTools {
 
    private final Connection connection;
 
    public QueryTools() throws SQLException {                            <span class="fm-combinumeral">❶</span>
        connection = DriverManager.getConnection("jdbc:h2:mem:testdb");  <span class="fm-combinumeral">❶</span>
        Statement st = connection.createStatement();                     <span class="fm-combinumeral">❶</span>
        st.executeUpdate("""                                             <span class="fm-combinumeral">❶</span>
            CREATE TABLE BOOKINGS (                                      <span class="fm-combinumeral">❶</span>
                bookingid int NOT NULL AUTO_INCREMENT,                   <span class="fm-combinumeral">❶</span>
                roomid int,                                              <span class="fm-combinumeral">❶</span>
                firstname varchar(255),                                  <span class="fm-combinumeral">❶</span>
                lastname varchar(255),                                   <span class="fm-combinumeral">❶</span>
                depositpaid boolean,                                     <span class="fm-combinumeral">❶</span>
                checkin date,                                            <span class="fm-combinumeral">❶</span>
                checkout date,                                           <span class="fm-combinumeral">❶</span>
                primary key (bookingid)                                  <span class="fm-combinumeral">❶</span>
            );                                                           <span class="fm-combinumeral">❶</span>
            CREATE TABLE ROOMS (                                         <span class="fm-combinumeral">❶</span>
                roomid int NOT NULL AUTO_INCREMENT,                      <span class="fm-combinumeral">❶</span>
                room_name varchar(255),                                  <span class="fm-combinumeral">❶</span>
                type varchar(255),                                       <span class="fm-combinumeral">❶</span>
                beds int,                                                <span class="fm-combinumeral">❶</span>
                accessible boolean,                                      <span class="fm-combinumeral">❶</span>
                image varchar(2000),                                     <span class="fm-combinumeral">❶</span>
                description varchar(2000),                               <span class="fm-combinumeral">❶</span>
                features varchar(100) ARRAY,                             <span class="fm-combinumeral">❶</span>
                roomPrice int,                                           <span class="fm-combinumeral">❶</span>
                primary key (roomid)                                     <span class="fm-combinumeral">❶</span>
            );                                                           <span class="fm-combinumeral">❶</span>
        """);                                                            <span class="fm-combinumeral">❶</span>
    }                                                                    <span class="fm-combinumeral">❶</span>
 
    public void createRoom() throws SQLException {                       <span class="fm-combinumeral">❷</span>
        Statement st = connection.createStatement();                     <span class="fm-combinumeral">❷</span>
        st.executeUpdate("""                                             <span class="fm-combinumeral">❷</span>
            INSERT INTO ROOMS (room_name, type, beds, accessible,        <span class="fm-combinumeral">❷</span>
            <span class="fm-code-continuation-arrow">➥</span>image, description, features, roomPrice)                   <span class="fm-combinumeral">❷</span>
            VALUES (                                                     <span class="fm-combinumeral">❷</span>
                '101',                                                   <span class="fm-combinumeral">❷</span>
                'single',                                                <span class="fm-combinumeral">❷</span>
                1,                                                       <span class="fm-combinumeral">❷</span>
                true,                                                    <span class="fm-combinumeral">❷</span>
                '/images/room2.jpg',                                     <span class="fm-combinumeral">❷</span>
                'A generated description',                               <span class="fm-combinumeral">❷</span>
                ARRAY['TV', 'WiFi', 'Safe'],                             <span class="fm-combinumeral">❷</span>
                100);                                                    <span class="fm-combinumeral">❷</span>
        """);                                                            <span class="fm-combinumeral">❷</span>
    }                                                                    <span class="fm-combinumeral">❷</span>
 
    public void createBooking() throws SQLException {                    <span class="fm-combinumeral">❸</span>
        Statement st = connection.createStatement();                     <span class="fm-combinumeral">❸</span>
        st.executeUpdate("""                                             <span class="fm-combinumeral">❸</span><a id="marker-189"/>
            INSERT INTO BOOKINGS (roomid, firstname, lastname,           <span class="fm-combinumeral">❸</span>
            <span class="fm-code-continuation-arrow">➥</span>depositpaid, checkin, checkout)                            <span class="fm-combinumeral">❸</span>
            VALUES (                                                     <span class="fm-combinumeral">❸</span>
                1,                                                       <span class="fm-combinumeral">❸</span>
                'James',                                                 <span class="fm-combinumeral">❸</span>
                'Dean',                                                  <span class="fm-combinumeral">❸</span>
                true,                                                    <span class="fm-combinumeral">❸</span>
                '2022-02-01',                                            <span class="fm-combinumeral">❸</span>
                '2022-02-05'                                             <span class="fm-combinumeral">❸</span>
            );                                                           <span class="fm-combinumeral">❸</span>
        """);                                                            <span class="fm-combinumeral">❸</span>
    }                                                                    <span class="fm-combinumeral">❸</span>
 
    public void outputTables(String query) throws SQLException {         <span class="fm-combinumeral">❹</span>
        Statement st = connection.createStatement();                     <span class="fm-combinumeral">❹</span>
        ResultSet rs = st.executeQuery(query);                           <span class="fm-combinumeral">❹</span>
        ResultSetMetaData rsmd = rs.getMetaData();                       <span class="fm-combinumeral">❹</span>
 
        int columnsNumber = rsmd.getColumnCount();                       <span class="fm-combinumeral">❹</span>
        while (rs.next()) {                                              <span class="fm-combinumeral">❹</span>
            for(int i = 1 ; i &lt;= columnsNumber; i++){                    <span class="fm-combinumeral">❹</span>
                System.out.print(rs.getString(i) + " ");                 <span class="fm-combinumeral">❹</span>
 
            }                                                            <span class="fm-combinumeral">❹</span>
            System.out.println();                                        <span class="fm-combinumeral">❹</span>
        }                                                                <span class="fm-combinumeral">❹</span>
    }                                                                    <span class="fm-combinumeral">❹</span>
}                                                                        <span class="fm-combinumeral">❹</span></pre>
<p class="fm-code-annotation"><span class="fm-combinumeral">❶</span> On startup, creates a database with the necessary tables</p>
<p class="fm-code-annotation"><span class="fm-combinumeral">❷</span> A basic method to create rooms</p>
<p class="fm-code-annotation"><span class="fm-combinumeral">❸</span> A basic method to create bookings</p>
<p class="fm-code-annotation"><span class="fm-combinumeral">❹</span> A basic method to output the contents of each table</p>
<p class="body">With our <code class="fm-code-in-text">QueryTools</code> class created, we can then expand our tools to interact with the database how we like by updating <code class="fm-code-in-text">DataAssistantTools</code>:<a id="marker-190"/><a id="idIndexMarker036"/></p>
<pre class="programlisting">public class DataAssistantTools [
 
    QueryTools queryTools = new QueryTools();                            <span class="fm-combinumeral">❶</span>
 
    public DataAssistantTools() throws SQLException {                    <span class="fm-combinumeral">❶</span>
    }                                                                    <span class="fm-combinumeral">❶</span>
 
    @Tool("Create room records")                                         <span class="fm-combinumeral">❶</span>
    public void createRooms(@P("Amount of room records to create")       <span class="fm-combinumeral">❶</span>
    <span class="fm-code-continuation-arrow">➥</span>int count) throws SQLException {                                   <span class="fm-combinumeral">❶</span>
 
        for(int i = 1; i &lt;= count; i++){                                 <span class="fm-combinumeral">❷</span>
            queryTools.createRoom();                                     <span class="fm-combinumeral">❷</span>
        }                                                                <span class="fm-combinumeral">❷</span>
    }                                                                    <span class="fm-combinumeral">❷</span>
 
    @Tool("Create booking records")                                      <span class="fm-combinumeral">❷</span>
    public void createBookings(@P("Amount of booking records to          <span class="fm-combinumeral">❷</span>
    <span class="fm-code-continuation-arrow">➥</span>create") int count) throws SQLException {                          <span class="fm-combinumeral">❷</span>
 
        for(int i = 1; i &lt;= count; i++){                                 <span class="fm-combinumeral">❸</span>
            queryTools.createBooking();q                                 <span class="fm-combinumeral">❸</span>
        }                                                                <span class="fm-combinumeral">❸</span>
    }                                                                    <span class="fm-combinumeral">❸</span>
 
    @Tool("Show results of database")                                    <span class="fm-combinumeral">❸</span>
    public void displayDatabase() throws SQLException {                  <span class="fm-combinumeral">❸</span>
 
        System.out.println("Current ROOM database state:");              <span class="fm-combinumeral">❹</span>
        queryTools.outputTables("SELECT * FROM ROOMS");                  <span class="fm-combinumeral">❹</span>
 
        System.out.println("Current BOOKING database state:");           <span class="fm-combinumeral">❹</span>
        queryTools.outputTables("SELECT * FROM BOOKINGS");               <span class="fm-combinumeral">❹</span>
    }                                                                    <span class="fm-combinumeral">❹</span>
 
}                                                                        <span class="fm-combinumeral">❹</span></pre>
<p class="fm-code-annotation"><span class="fm-combinumeral">❶</span> Creates a new instance of our database on startup</p>
<p class="fm-code-annotation"><span class="fm-combinumeral">❷</span> Creates rooms by looping through the number of rooms requested</p>
<p class="fm-code-annotation"><span class="fm-combinumeral">❸</span> Creates bookings by looping through the amount of bookings requested</p>
<p class="fm-code-annotation"><span class="fm-combinumeral">❹</span> Outputs the contents of each table</p>
<p class="body">Finally, we update our <code class="fm-code-in-text">main</code> method within our <code class="fm-code-in-text">DataAssistant</code> class to handle <code class="fm-code-in-text">SQLException</code>, resulting in the following completed code:<a id="idIndexMarker037"/></p>
<pre class="programlisting">public static void main(String[] args) throws SQLException 
 
        OpenAiChatModel model = OpenAiChatModel
                .builder()
                .apiKey("API-KEY-HERE")
                .modelName(OpenAiChatModelName.GPT_3_5_TURBO)
                .build();
 
        DataAssistantService dataAssistantChat =
        <span class="fm-code-continuation-arrow">➥</span>AiServices.builder(DataAssistantService.class)
                .chatLanguageModel(model)
                .tools(new DataAssistantTools())
                .build();
 
        while(true){
            Scanner scanner = new Scanner(System.in);
            System.out.println("What do you need?");
 
            String query = scanner.nextLine();
            String response = dataAssistantChat.sendPrompt(query);
            System.out.println(response);
        }
    }</pre>
<p class="body">With everything in place, we can now test the agent by first requesting it create our desired data:</p>
<table border="0" class="contenttable-0-table" width="100%">
<colgroup class="contenttable-0-colgroup">
<col class="contenttable-0-col" span="1" width="7%"/>
<col class="contenttable-0-col" span="1" width="93%"/>
</colgroup>
<tbody class="contenttable-0-tbody">
<tr class="contenttable-0-tr">
<td class="contenttable-0-td">
<div class="figure2">
<p class="figure1"><img alt="" class="calibre7" height="40" src="../../OEBPS/Images/logo-MW.png" width="40"/></p>
</div>
</td>
<td class="contenttable-0-td">
<p class="body-table">Create me 2 rooms and 3 bookings</p>
</td>
</tr>
</tbody>
</table>
<p class="body">It then results in a response such as:</p>
<table border="0" class="contenttable-0-table" width="100%">
<colgroup class="contenttable-0-colgroup">
<col class="contenttable-0-col" span="1" width="7%"/>
<col class="contenttable-0-col" span="1" width="93%"/>
</colgroup>
<tbody class="contenttable-0-tbody">
<tr class="contenttable-0-tr">
<td class="contenttable-0-td">
<div class="figure2">
<p class="figure1"><img alt="" class="calibre7" height="40" src="../../OEBPS/Images/logo-openai.png" width="40"/></p>
</div>
</td>
<td class="contenttable-0-td">
<p class="body-table">Two rooms and three bookings have been successfully created.</p>
</td>
</tr>
</tbody>
</table>
<p class="body">We can then confirm that our data has been created by sending additional instructions to the agent</p>
<table border="0" class="contenttable-0-table" width="100%">
<colgroup class="contenttable-0-colgroup">
<col class="contenttable-0-col" span="1" width="7%"/>
<col class="contenttable-0-col" span="1" width="93%"/>
</colgroup>
<tbody class="contenttable-0-tbody">
<tr class="contenttable-0-tr">
<td class="contenttable-0-td">
<div class="figure2">
<p class="figure1"><img alt="" class="calibre7" height="40" src="../../OEBPS/Images/logo-MW.png" width="40"/></p>
</div>
</td>
<td class="contenttable-0-td">
<p class="body-table">List me the database contents</p>
</td>
</tr>
</tbody>
</table>
<p class="body">resulting in an output that looks similar to</p>
<table border="0" class="contenttable-0-table" width="100%">
<colgroup class="contenttable-0-colgroup">
<col class="contenttable-0-col" span="1" width="7%"/>
<col class="contenttable-0-col" span="1" width="93%"/>
</colgroup>
<tbody class="contenttable-0-tbody">
<tr class="contenttable-0-tr">
<td class="contenttable-0-td">
<div class="figure2">
<p class="figure1"><img alt="" class="calibre7" height="40" src="../../OEBPS/Images/logo-openai.png" width="40"/></p>
</div>
</td>
<td class="contenttable-0-td">
<p class="body-table">Current ROOM database state:</p>
<p class="body-table">101 single 1 TRUE /images/room2.jpg A generated description [TV, WiFi, Safe] 100</p>
<p class="body-table">101 single 1 TRUE /images/room2.jpg A generated description [TV, WiFi, Safe] 100</p>
<p class="body-table-space">  </p>
<p class="body-table">Current BOOKING database state:</p>
<p class="body-table">1 James Dean TRUE 2022-02-01 2022-02-05</p>
<p class="body-table">1 James Dean TRUE 2022-02-01 2022-02-05</p>
<p class="body-table">1 James Dean TRUE 2022-02-01 2022-02-05</p>
</td>
</tr>
</tbody>
</table>
<p class="body"><a id="marker-191"/>With our database queries now wired into our tools, we can interact with our agents and have them carry out our tasks. However, let’s go one step further with our agent and give it the capability to run multiple tools in a chain, utilizing data created in one tool in another.</p>
<h3 class="fm-head1" id="heading_id_9">9.2.3 Chaining tools together</h3>
<p class="body">Currently, our tools are independent of one another. The room tool creates rooms that generate unique <code class="fm-code-in-text">roomid</code> keys for each row, but we’re not using them when we create new bookings. We’re simply hardcoding our values. So, to make our agent more dynamic, and to give it a more complex problem, let’s look at how we could pass the <code class="fm-code-in-text">roomid</code> of the most recently created room to the booking tool.<a id="idIndexMarker038"/><a id="idIndexMarker039"/></p>
<p class="body">To begin, we need to create an additional method in our <code class="fm-code-in-text">QueryTools</code> class that will either return the <code class="fm-code-in-text">roomid</code> of the most recently created room or an <code class="fm-code-in-text">id</code> of <code class="fm-code-in-text">0</code> if there are no rooms currently in the database:<a id="idIndexMarker040"/><a id="marker-192"/></p>
<pre class="programlisting">public int getRoomId() throws SQLException 
    Statement st = connection.createStatement();
    ResultSet rs = st.executeQuery("SELECT roomid FROM ROOMS
    <span class="fm-code-continuation-arrow">➥</span>ORDER BY roomid DESC");
  
    if(rs.next()){
        return rs.getInt("roomid");
    } else {
        return 0;
    }
}</pre>
<p class="body">With our new method in place, we next create a new tool with <code class="fm-code-in-text">DataAssistantTools</code>:</p>
<pre class="programlisting">@Tool("Get most recent roomid from database after
<span class="fm-code-continuation-arrow">➥</span>rooms have been created")
public int getRoomId() throws SQLException {
        return queryTools.getRoomId();
}</pre>
<p class="body">Notice how we have set out within the <code class="fm-code-in-text">@Tool</code> annotation that we expect this prompt to be run after rooms have been created. Although this doesn’t guarantee the order in which tools are run by our LLM, it acts as a guardrail if we want rooms and bookings to be created in a specific order. Additionally, we are returning the <code class="fm-code-in-text">roomid</code> integer to the LLM. This is then stored in the context of our original prompt for future use, which we’ll establish by updating our <code class="fm-code-in-text">createBookings</code> method to the following:<a id="idIndexMarker041"/><a id="idIndexMarker042"/></p>
<pre class="programlisting">@Tool("Create booking records")
public void createBookings(@P("Amount of booking records to create")
<span class="fm-code-continuation-arrow">➥</span>int count, @P("Most recent roomid") int roomid) throws SQLException {
    System.out.println("I will create the bookings for room: " +
    <span class="fm-code-continuation-arrow">➥</span>roomid);
    for(int i = 1; i &lt;= count; i++){
        queryTools.createBooking(roomid);
    }
}</pre>
<p class="body">In this updated method, we’ve added a new parameter in the form of <code class="fm-code-in-text">@P("Most recent</code> <code class="fm-code-in-text">roomid")</code> <code class="fm-code-in-text">int</code> <code class="fm-code-in-text">roomid</code>. To see the <code class="fm-code-in-text">roomid</code> extraction in action, we <code class="fm-code-in-text">System.out</code> the <code class="fm-code-in-text">roomid</code> before passing it <code class="fm-code-in-text">createBooking</code> for use in our <code class="fm-code-in-text">INSERT</code> statement. To use the <code class="fm-code-in-text">roomid</code>, we return to <code class="fm-code-in-text">QueryTools</code> and update the <code class="fm-code-in-text">createBooking</code> method to take <code class="fm-code-in-text">roomid</code> as a parameter and add it to our SQL statement:<a id="idIndexMarker043"/></p>
<pre class="programlisting">public void createBooking(int roomid) throws SQLException 
    Statement st = connection.createStatement();
    st.executeUpdate("""
            INSERT INTO BOOKINGS (roomid, firstname, lastname,
            <span class="fm-code-continuation-arrow">➥</span>depositpaid, checkin, checkout)
            VALUES (
                ?,
                'James',
                'Dean',
                true,
                '2022-02-01',
                '2022-02-05'
            );
        """.replace("?", Integer.toString(roomid)));
}</pre>
<p class="body"><a id="marker-193"/>Now we have the code in place for our agent to extract the <code class="fm-code-in-text">roomid</code> from our database using one tool and then use that value within a second tool, which we can see in action in this example chat I had with my version of our agent:</p>
<table border="0" class="contenttable-0-table" width="100%">
<colgroup class="contenttable-0-colgroup">
<col class="contenttable-0-col" span="1" width="7%"/>
<col class="contenttable-0-col" span="1" width="93%"/>
</colgroup>
<tbody class="contenttable-0-tbody">
<tr class="contenttable-0-tr">
<td class="contenttable-0-td">
<div class="figure2">
<p class="figure1"><img alt="" class="calibre7" height="40" src="../../OEBPS/Images/logo-openai.png" width="40"/></p>
</div>
</td>
<td class="contenttable-0-td">
<p class="body-table">What do you need?</p>
</td>
</tr>
</tbody>
</table>
<table border="0" class="contenttable-0-table" width="100%">
<colgroup class="contenttable-0-colgroup">
<col class="contenttable-0-col" span="1" width="7%"/>
<col class="contenttable-0-col" span="1" width="93%"/>
</colgroup>
<tbody class="contenttable-0-tbody">
<tr class="contenttable-0-tr">
<td class="contenttable-0-td">
<div class="figure2">
<p class="figure1"><img alt="" class="calibre7" height="40" src="../../OEBPS/Images/logo-MW.png" width="40"/></p>
</div>
</td>
<td class="contenttable-0-td">
<p class="body-table">Create three rooms</p>
</td>
</tr>
</tbody>
</table>
<table border="0" class="contenttable-0-table" width="100%">
<colgroup class="contenttable-0-colgroup">
<col class="contenttable-0-col" span="1" width="7%"/>
<col class="contenttable-0-col" span="1" width="93%"/>
</colgroup>
<tbody class="contenttable-0-tbody">
<tr class="contenttable-0-tr">
<td class="contenttable-0-td">
<div class="figure2">
<p class="figure1"><img alt="" class="calibre7" height="40" src="../../OEBPS/Images/logo-openai.png" width="40"/></p>
</div>
</td>
<td class="contenttable-0-td">
<p class="body-table">Three rooms have been successfully created.</p>
</td>
</tr>
</tbody>
</table>
<table border="0" class="contenttable-0-table" width="100%">
<colgroup class="contenttable-0-colgroup">
<col class="contenttable-0-col" span="1" width="7%"/>
<col class="contenttable-0-col" span="1" width="93%"/>
</colgroup>
<tbody class="contenttable-0-tbody">
<tr class="contenttable-0-tr">
<td class="contenttable-0-td">
<div class="figure2">
<p class="figure1"><img alt="" class="calibre7" height="40" src="../../OEBPS/Images/logo-openai.png" width="40"/></p>
</div>
</td>
<td class="contenttable-0-td">
<p class="body-table">What do you need?</p>
</td>
</tr>
</tbody>
</table>
<table border="0" class="contenttable-0-table" width="100%">
<colgroup class="contenttable-0-colgroup">
<col class="contenttable-0-col" span="1" width="7%"/>
<col class="contenttable-0-col" span="1" width="93%"/>
</colgroup>
<tbody class="contenttable-0-tbody">
<tr class="contenttable-0-tr">
<td class="contenttable-0-td">
<div class="figure2">
<p class="figure1"><img alt="" class="calibre7" height="40" src="../../OEBPS/Images/logo-MW.png" width="40"/></p>
</div>
</td>
<td class="contenttable-0-td">
<p class="body-table">List database</p>
</td>
</tr>
</tbody>
</table>
<table border="0" class="contenttable-0-table" width="100%">
<colgroup class="contenttable-0-colgroup">
<col class="contenttable-0-col" span="1" width="7%"/>
<col class="contenttable-0-col" span="1" width="93%"/>
</colgroup>
<tbody class="contenttable-0-tbody">
<tr class="contenttable-0-tr">
<td class="contenttable-0-td">
<div class="figure2">
<p class="figure1"><img alt="" class="calibre7" height="40" src="../../OEBPS/Images/logo-openai.png" width="40"/></p>
</div>
</td>
<td class="contenttable-0-td">
<p class="body-table">Current ROOM database state:</p>
<p class="body-table">101 single 1 TRUE /images/room2.jpg A generated description [TV, WiFi, Safe] 100</p>
<p class="body-table">101 single 1 TRUE /images/room2.jpg A generated description [TV, WiFi, Safe] 100</p>
<p class="body-table">101 single 1 TRUE /images/room2.jpg A generated description [TV, WiFi, Safe] 100</p>
<p class="body-table-space">  </p>
<p class="body-table">Current BOOKING database state:</p>
<p class="body-table">The database has been successfully displayed.</p>
</td>
</tr>
</tbody>
</table>
<table border="0" class="contenttable-0-table" width="100%">
<colgroup class="contenttable-0-colgroup">
<col class="contenttable-0-col" span="1" width="7%"/>
<col class="contenttable-0-col" span="1" width="93%"/>
</colgroup>
<tbody class="contenttable-0-tbody">
<tr class="contenttable-0-tr">
<td class="contenttable-0-td">
<div class="figure2">
<p class="figure1"><img alt="" class="calibre7" height="40" src="../../OEBPS/Images/logo-openai.png" width="40"/></p>
</div>
</td>
<td class="contenttable-0-td">
<p class="body-table">What do you need?</p>
</td>
</tr>
</tbody>
</table>
<table border="0" class="contenttable-0-table" width="100%">
<colgroup class="contenttable-0-colgroup">
<col class="contenttable-0-col" span="1" width="7%"/>
<col class="contenttable-0-col" span="1" width="93%"/>
</colgroup>
<tbody class="contenttable-0-tbody">
<tr class="contenttable-0-tr">
<td class="contenttable-0-td">
<div class="figure2">
<p class="figure1"><img alt="" class="calibre7" height="40" src="../../OEBPS/Images/logo-MW.png" width="40"/></p>
</div>
</td>
<td class="contenttable-0-td">
<p class="body-table">Create three bookings</p>
</td>
</tr>
</tbody>
</table>
<table border="0" class="contenttable-0-table" width="100%">
<colgroup class="contenttable-0-colgroup">
<col class="contenttable-0-col" span="1" width="7%"/>
<col class="contenttable-0-col" span="1" width="93%"/>
</colgroup>
<tbody class="contenttable-0-tbody">
<tr class="contenttable-0-tr">
<td class="contenttable-0-td">
<div class="figure2">
<p class="figure1"><img alt="" class="calibre7" height="40" src="../../OEBPS/Images/logo-openai.png" width="40"/></p>
</div>
</td>
<td class="contenttable-0-td">
<p class="body-table">I will create the bookings for room: 3</p>
<p class="body-table">Current ROOM database state:</p>
<pre class="programlisting">101 single 1 TRUE /images/room2.jpg A generated description [TV, WiFi, Safe] 100 
101 single 1 TRUE /images/room2.jpg A generated description [TV, WiFi, Safe] 100 
101 single 1 TRUE /images/room2.jpg A generated description [TV, WiFi, Safe] 100 </pre>
<p class="body-table">Current BOOKING database state:</p>
<pre class="programlisting">3 James Dean TRUE 2022-02-01 2022-02-05 
3 James Dean TRUE 2022-02-01 2022-02-05 
3 James Dean TRUE 2022-02-01 2022-02-05 </pre>
<p class="body-table">Three bookings have been successfully created.</p>
</td>
</tr>
</tbody>
</table>
<p class="body"><a id="marker-194"/>Breaking down the output, we can see that three rooms were created, which we confirm by asking the agent to list the current rooms. Then the agent was asked to create three bookings, which it did successfully. Notice the second integer on each row underneath <code class="fm-code-in-text">Current</code> <code class="fm-code-in-text">BOOKING</code> <code class="fm-code-in-text">database</code> <code class="fm-code-in-text">state:</code>. See how they are now using the <code class="fm-code-in-text">roomid:</code> <code class="fm-code-in-text">3</code>. The agent has successfully utilized both tools to query the most recent <code class="fm-code-in-text">roomid</code> before passing the retrieved <code class="fm-code-in-text">id</code> to the second tool that creates our bookings for us. We can confirm this isn’t a coincidence by creating further rooms to confirm that a newer, more recent <code class="fm-code-in-text">roomid</code> is added to the additional bookings we create (in this example, <code class="fm-code-in-text">roomid</code> ticks up to <code class="fm-code-in-text">6</code>).</p>
<table border="0" class="contenttable-0-table" width="100%">
<colgroup class="contenttable-0-colgroup">
<col class="contenttable-0-col" span="1" width="7%"/>
<col class="contenttable-0-col" span="1" width="93%"/>
</colgroup>
<tbody class="contenttable-0-tbody">
<tr class="contenttable-0-tr">
<td class="contenttable-0-td">
<div class="figure2">
<p class="figure1"><img alt="" class="calibre7" height="40" src="../../OEBPS/Images/logo-openai.png" width="40"/></p>
</div>
</td>
<td class="contenttable-0-td">
<p class="body-table">What do you need?</p>
</td>
</tr>
</tbody>
</table>
<table border="0" class="contenttable-0-table" width="100%">
<colgroup class="contenttable-0-colgroup">
<col class="contenttable-0-col" span="1" width="7%"/>
<col class="contenttable-0-col" span="1" width="93%"/>
</colgroup>
<tbody class="contenttable-0-tbody">
<tr class="contenttable-0-tr">
<td class="contenttable-0-td">
<div class="figure2">
<p class="figure1"><img alt="" class="calibre7" height="40" src="../../OEBPS/Images/logo-MW.png" width="40"/></p>
</div>
</td>
<td class="contenttable-0-td">
<p class="body-table">Create three more rooms</p>
</td>
</tr>
</tbody>
</table>
<table border="0" class="contenttable-0-table" width="100%">
<colgroup class="contenttable-0-colgroup">
<col class="contenttable-0-col" span="1" width="7%"/>
<col class="contenttable-0-col" span="1" width="93%"/>
</colgroup>
<tbody class="contenttable-0-tbody">
<tr class="contenttable-0-tr">
<td class="contenttable-0-td">
<div class="figure2">
<p class="figure1"><img alt="" class="calibre7" height="40" src="../../OEBPS/Images/logo-openai.png" width="40"/></p>
</div>
</td>
<td class="contenttable-0-td">
<p class="body-table">Three rooms have been created successfully. Here is the updated database:</p>
</td>
</tr>
</tbody>
</table>
<table border="0" class="contenttable-0-table" width="100%">
<colgroup class="contenttable-0-colgroup">
<col class="contenttable-0-col" span="1" width="7%"/>
<col class="contenttable-0-col" span="1" width="93%"/>
</colgroup>
<tbody class="contenttable-0-tbody">
<tr class="contenttable-0-tr">
<td class="contenttable-0-td">
<div class="figure2">
<p class="figure1"><img alt="" class="calibre7" height="40" src="../../OEBPS/Images/logo-openai.png" width="40"/></p>
</div>
</td>
<td class="contenttable-0-td">
<p class="body-table">What do you need?</p>
</td>
</tr>
</tbody>
</table>
<table border="0" class="contenttable-0-table" width="100%">
<colgroup class="contenttable-0-colgroup">
<col class="contenttable-0-col" span="1" width="7%"/>
<col class="contenttable-0-col" span="1" width="93%"/>
</colgroup>
<tbody class="contenttable-0-tbody">
<tr class="contenttable-0-tr">
<td class="contenttable-0-td">
<div class="figure2">
<p class="figure1"><img alt="" class="calibre7" height="40" src="../../OEBPS/Images/logo-MW.png" width="40"/></p>
</div>
</td>
<td class="contenttable-0-td">
<p class="body-table">Create three more bookings</p>
</td>
</tr>
</tbody>
</table>
<table border="0" class="contenttable-0-table" width="100%">
<colgroup class="contenttable-0-colgroup">
<col class="contenttable-0-col" span="1" width="7%"/>
<col class="contenttable-0-col" span="1" width="93%"/>
</colgroup>
<tbody class="contenttable-0-tbody">
<tr class="contenttable-0-tr">
<td class="contenttable-0-td">
<div class="figure2">
<p class="figure1"><img alt="" class="calibre7" height="40" src="../../OEBPS/Images/logo-openai.png" width="40"/></p>
</div>
</td>
<td class="contenttable-0-td">
<p class="body-table">I will create the bookings for room: 6</p>
<p class="body-table">Three bookings have been successfully created.</p>
</td>
</tr>
</tbody>
</table>
<table border="0" class="contenttable-0-table" width="100%">
<colgroup class="contenttable-0-colgroup">
<col class="contenttable-0-col" span="1" width="7%"/>
<col class="contenttable-0-col" span="1" width="93%"/>
</colgroup>
<tbody class="contenttable-0-tbody">
<tr class="contenttable-0-tr">
<td class="contenttable-0-td">
<div class="figure2">
<p class="figure1"><img alt="" class="calibre7" height="40" src="../../OEBPS/Images/logo-openai.png" width="40"/></p>
</div>
</td>
<td class="contenttable-0-td">
<p class="body-table">What do you need?</p>
</td>
</tr>
</tbody>
</table>
<table border="0" class="contenttable-0-table" width="100%">
<colgroup class="contenttable-0-colgroup">
<col class="contenttable-0-col" span="1" width="7%"/>
<col class="contenttable-0-col" span="1" width="93%"/>
</colgroup>
<tbody class="contenttable-0-tbody">
<tr class="contenttable-0-tr">
<td class="contenttable-0-td">
<div class="figure2">
<p class="figure1"><img alt="" class="calibre7" height="40" src="../../OEBPS/Images/logo-MW.png" width="40"/></p>
</div>
</td>
<td class="contenttable-0-td">
<p class="body-table">List database</p>
</td>
</tr>
</tbody>
</table>
<table border="0" class="contenttable-0-table" width="100%">
<colgroup class="contenttable-0-colgroup">
<col class="contenttable-0-col" span="1" width="7%"/>
<col class="contenttable-0-col" span="1" width="93%"/>
</colgroup>
<tbody class="contenttable-0-tbody">
<tr class="contenttable-0-tr">
<td class="contenttable-0-td">
<div class="figure2">
<p class="figure1"><img alt="" class="calibre7" height="40" src="../../OEBPS/Images/logo-openai.png" width="40"/></p>
</div>
</td>
<td class="contenttable-0-td">
<p class="body-table">Current ROOM database state:</p>
<p class="body-table">101 single 1 TRUE /images/room2.jpg A generated description [TV, WiFi, Safe] 100</p>
<p class="body-table">101 single 1 TRUE /images/room2.jpg A generated description [TV, WiFi, Safe] 100</p>
<p class="body-table">101 single 1 TRUE /images/room2.jpg A generated description [TV, WiFi, Safe] 100</p>
<p class="body-table">101 single 1 TRUE /images/room2.jpg A generated description [TV, WiFi, Safe] 100</p>
<p class="body-table">101 single 1 TRUE /images/room2.jpg A generated description [TV, WiFi, Safe] 100</p>
<p class="body-table">101 single 1 TRUE /images/room2.jpg A generated description [TV, WiFi, Safe] 100</p>
<p class="body-table-space">  </p>
<p class="body-table">Current BOOKING database state:</p>
<p class="body-table">3 James Dean TRUE 2022-02-01 2022-02-05</p>
<p class="body-table">3 James Dean TRUE 2022-02-01 2022-02-05</p>
<p class="body-table">3 James Dean TRUE 2022-02-01 2022-02-05</p>
<p class="body-table">6 James Dean TRUE 2022-02-01 2022-02-05</p>
<p class="body-table">6 James Dean TRUE 2022-02-01 2022-02-05</p>
<p class="body-table">6 James Dean TRUE 2022-02-01 2022-02-05</p>
</td>
</tr>
</tbody>
</table>
<p class="body"><a id="marker-195"/>This completes our basic data creator agent. We’ve looked at how we can create multiple tools for an agent to use and solve specific requests for us. These tools allow us to give an agent the ability to interact with the world around us. For example, we could create code to extract relevant data from a data source, connect to sensors or IoT (Internet of Things) devices, or interact with external websites. We’ve also seen how the results of those interactions with third parties can be fed back into our LLM for it to determine what next steps to take, as well as utilize extracted information for further use.<a id="idIndexMarker044"/></p>
<div class="fm-sidebar-block">
<p class="fm-sidebar-title">Activity 9.1</p>
<p class="fm-sidebar-text">Consider different ways in which this agent could be expanded to do further data assistant tasks. Perhaps it could delete or update data or carry further analysis on what exists with the example database. Alternatively, consider building an agent that carries out other tasks.</p>
</div>
<h2 class="fm-head" id="heading_id_10">9.3 Moving forward with AI test assistants</h2>
<p class="body">Our test data assistant demonstrates the potential of AI agents as tools that can help support testing activities. We can see AI agents as an approach to use when we reach a point where our prompts become too complicated, or we want to extend them to interface with third-party systems. It’s important, however, to have a clear sense of both the opportunities and the challenges of developing AI agents. So, let’s reflect on the various areas of testing we’ve used LLMs to support us in, the way AI agents could be designed to take our prompts further, and what problems might await us.<a id="idIndexMarker045"/></p>
<h3 class="fm-head1" id="heading_id_11">9.3.1 Examples of AI test assistants</h3>
<p class="body">We’ve already seen how an AI agent could help extend the use of LLMs in the test data space. But to help tie it all together, here are some examples of other types of AI agents that would take our prompts and LLM work further.</p>
<p class="fm-head2">Analysis AI agents</p>
<p class="body">We’ve learned how LLMs can help us expand our thinking, suggesting ideas and risks that we might not have considered. As AI agents can be connected to a range of data sources, an AI agent that enhances our suggestion prompts could be built into an assistant that offers suggestions based on collated information across a business domain. For example, we might have an agent like the one shown in figure 9.2.<a id="idIndexMarker046"/><a id="marker-196"/><a id="idIndexMarker047"/></p>
<div class="figure">
<p class="figure1"><img alt="" class="calibre37" src="../../OEBPS/Images/CH09_F02_Winteringham2.png"/></p>
<p class="figurecaption">Figure 9.2 An AI agent connected to multiple data sources</p>
</div>
<p class="body">An AI agent such as this one would be able to determine what data sources to access based on the instructions given. It might be able to pull in relevant documentation from knowledge bases and project management tools or raw data from monitoring and analytics tools. All this collated data can then be used to improve responses from the LLM when asked a question, a topic we’ll explore more in the following chapters.</p>
<p class="fm-head2">Automation assistant AI agents</p>
<p class="body">We also looked at how LLMs are most effective in the test automation space if we create prompts that focus on specific tasks when building automation. That said, an AI agent’s potential to interact, parse, and share information across tools means that we could create an agent like the one in figure 9.3.<a id="idIndexMarker048"/><a id="idIndexMarker049"/></p>
<div class="figure">
<p class="figure1"><img alt="" class="calibre37" src="../../OEBPS/Images/CH09_F03_Winteringham2.png"/></p>
<p class="figurecaption">Figure 9.3 An AI agent that processes information in different ways</p>
</div>
<p class="body">An AI agent such as this one would be able to build the parts of automated tests in sections. The built sections could then be passed to other tools to be utilized in various ways. This doesn’t mean that these types of agents could still fully create valuable automation in one shot. Context, again, is an important factor that would need to be fed into these types of AI agents to enable them to embed rules and expectations into our automation that align with how our product works.<a id="marker-197"/></p>
<p class="fm-head2">Exploratory testing AI Agents</p>
<p class="body">Finally, in this example, we’re not suggesting that the AI agent could do the exploratory testing for us, but an AI agent might prove useful as an assistant to the person testing, as shown in figure 9.4.<a id="idIndexMarker050"/><a id="idIndexMarker051"/></p>
<div class="figure">
<p class="figure1"><img alt="" class="calibre38" src="../../OEBPS/Images/CH09_F04_Winteringham2.png"/></p>
<p class="figurecaption">Figure 9.4 An AI agent that takes relevant information and uses additional prompts to build suggestions</p>
</div>
<p class="body">Notice how, in the AI agent, we’re creating an assistant that takes an initial prompt and then fires off further prompts to an LLM to help develop valuable suggestions. Since AI agents can interact with any system via its tools, there’s no reason an AI agent couldn’t interact with an LLM as well. The agent in this example helps to parse initial instructions and then use them to determine which further prompts could be utilized, creating a cascade of different prompts being triggered to create some interesting outputs.</p>
<p class="body">These are, of course, just hypothetical AI agents, but each example demonstrates that their success is rooted in the types of prompts created for the instructions an agent receives and the prompts assigned to each tool. Our data agent example had only rudimentary prompts, but it is in those spaces where we can provide the expectations, parameters, and context to each tool to help an AI agent react in a way that proves valuable to us.<a id="idIndexMarker052"/><a id="marker-198"/></p>
<h3 class="fm-head1" id="heading_id_12">9.3.2 Handling the challenges of working with agents</h3>
<p class="body">However, it’s not to say that building, using, and maintaining agents comes without its challenges. Here are a few challenges that need to be kept in mind.</p>
<p class="fm-head2">Examining an LLM’s decision-making process</p>
<p class="body">Unsurprisingly, one of the biggest challenges with developing agents is their indeterministic nature. There’s a good chance that, as you worked through the example agent in this chapter, you experienced the agent either not executing tools when expected or creating more or fewer data than required. The LLM component of an agent that determines what to run and what data to share between tools is opaque to us. In our example agent, we are using a third-party LLM, meaning we have no insight into its decision-making process. Nor do we have any ability to monitor its behavior or control how the LLM is tuned and operates. This lack of control and observability can become a major risk in developing agents. As they grow in complexity, not only can they become more brittle, but we also have little insight into what went wrong.<a id="idIndexMarker053"/><a id="idIndexMarker054"/></p>
<p class="body">Some steps can be taken to mitigate this risk. We could host models on our platforms and increase observability. But while this might give us more insights into what decisions were made and when by an LLM, it still doesn’t mean we can guarantee the outcome of an agent’s responses.</p>
<p class="fm-head2">Navigating guard rails and security concerns</p>
<p class="body">This brings us to the second problem when using agents: ensuring that we have the necessary prompts and code in place to handle situations in which an agent may hit an edge case, as well as preventing bad actors from using our agents to negatively affect our business or others. Utilizing good prompting techniques in outlining the purpose of each tool and adding checks and balances to help our agent reject invalid or undesirable requests is a must, but that means identifying those potential scenarios and implementing guard rails for them. The upshot is that agents require extensive testing and evaluation, which can come at a cost that outweighs the initial value of using them in the first place.<a id="idIndexMarker055"/></p>
<p class="fm-head2">Managing when things go wrong</p>
<p class="body">That said, despite our best efforts, there will be times when an agent does something wrong. Either tools are run in an incorrect order, data isn’t passed between tools successfully, or the code within our tools has bugs. In the context of our example agent, these potential errors will be swallowed up by the OpenAI platform. When I first developed the example agent, it was throwing exceptions as the JDBC library failed, and the exceptions were consumed by the agent, which triggered all sorts of unusual behavior. In one example, the JDBC code failed in a way that caused the agent to continue attempting to create new records, repeatedly firing the broken function, to the point at which the whole agent crashed as it hit a limit in the amount of function calls it could carry out. The problem was that this exception wasn’t shared with me, making the debugging of the problem difficult.<a id="marker-199"/><a id="idIndexMarker056"/></p>
<p class="body">Again, observability and monitoring are essential, as well as ensuring our code is written defensively against potential exceptions or errors. If we don’t catch and report them, then they are hidden, leading to wasted time trying to debug what was wrong in the first place.</p>
<p class="body">Ultimately, agents promise the potential of making us, the individual, more efficient by supporting us in task completion. Given the autonomous abilities of agents, it can be easy to buy into the hype of their potential. But just like any software we seek to utilize, its creation, use, and maintenance come with a cost. Similarly, like all software, it’s not a silver bullet for all our problems. To use agents successfully, we need to take the time to consider the problem we are attempting to solve. At times, agents may be of use to us, but other options such as a well-crafted prompt might do the work just as well, or we might have better success with other non-AI-based tools. In the end, agents are just another addition to our tool belt to employ when the time is right.</p>
<h2 class="fm-head" id="heading_id_13">Summary</h2>
<ul class="calibre5">
<li class="fm-list-bullet">
<p class="list">AI agents exist in many different fields of artificial intelligence.</p>
</li>
<li class="fm-list-bullet">
<p class="list">AI agents are expected to be goal-driven, able to perceive the wider world, autonomous, and adaptable.</p>
</li>
<li class="fm-list-bullet">
<p class="list">Agents within the context of LLMs are created using function calling.</p>
</li>
<li class="fm-list-bullet">
<p class="list">Function calling is achieved by providing a prompt and code grouped into functions that an LLM can call to achieve a goal within a prompt.</p>
</li>
<li class="fm-list-bullet">
<p class="list">Function calling can be used to interact with other sites and services, feeding information back to the LLM for further processing.</p>
</li>
<li class="fm-list-bullet">
<p class="list">LangChain4J is a useful library for easily connecting to LLM platforms and managing AI services such as tools.</p>
</li>
<li class="fm-list-bullet">
<p class="list">We can create tools using the <code class="fm-code-in-text">@Tool</code> annotation, which helps the LLM match up our instructions to which method to run and when.</p>
</li>
<li class="fm-list-bullet">
<p class="list">We pass extracted values from our prompt into methods as parameters using the <code class="fm-code-in-text">@P</code> annotation, which works similarly to the <code class="fm-code-in-text">@Tool</code> annotation.</p>
</li>
<li class="fm-list-bullet">
<p class="list">Agents can also send data between tools by returning data out of a method and using the <code class="fm-code-in-text">@P</code> annotation to pull the data in as a parameter.</p>
</li>
<li class="fm-list-bullet">
<p class="list">When agents fail to carry out tasks or an error occurs, it can be hard to detect what went wrong.</p>
</li>
<li class="fm-list-bullet">
<p class="list">LLMs are opaque when it comes to decision-making, which can also make debugging problems challenging.</p>
</li>
<li class="fm-list-bullet">
<p class="list">Exposing agents to a wider user base means they require guard rails in place to prevent agents from either not fulfilling tasks or being vulnerable to bad actors.<a id="marker-200"/></p>
</li>
</ul>
</div></body></html>