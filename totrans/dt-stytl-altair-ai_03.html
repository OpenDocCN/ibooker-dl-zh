<html><head></head><body>
<div id="sbo-rt-content"><div class="readable-text" id="p1">
<h1 class="readable-text-h1"><span class="chapter-title-numbering"><span class="num-string">3</span></span> <span class="chapter-title-text">Reviewing the basic concepts of Altair</span></h1>
</div>
<div class="introduction-summary">
<h3 class="introduction-header">This chapter covers</h3>
<ul>
<li class="readable-text" id="p2">Vega and Vega-Lite</li>
<li class="readable-text" id="p3">The basic components of an Altair chart</li>
<li class="readable-text" id="p4">A relevant case study</li>
</ul>
</div>
<div class="readable-text" id="p5">
<p>It may, at first glance, seem counterintuitive for the topic of running a data story in Altair (chapter 2) to be covered before the basics of Altair (chapter 3). The reason is that now that you have a general understanding of how Altair works, you’re ready to see all the details. If you had read this chapter right away, you probably would have gotten bored and skipped it. Instead, now, you are ready to read it calmly. In this chapter, we will review the basic concepts underlying Vega and Vega-Lite, the visualization grammars upon which Altair is built. Then, we’ll focus on the Altair main components: encodings, marks, conditions, compound charts, and interactivity. In the last part of the chapter, we’ll implement a practical example.</p>
</div>
<div class="readable-text" id="p6">
<h2 class="readable-text-h2"><span class="num-string">3.1</span> Vega and Vega-Lite</h2>
</div>
<div class="readable-text" id="p7">
<p>Vega and Vega-Lite are visualization grammars used by Altair. A <em>visualization grammar</em> is a set of rules and principles defining how to represent data visually, much like how grammar functions in a spoken language. A visualization grammar includes a vocabulary of visual elements, such as points, lines, and bars, as well as rules for combining and arranging these elements to create meaningful visualizations. Using a visualization grammar allows you to create clear and effective data visualizations that convey insights and tell stories.</p>
</div>
<div class="readable-text intended-text" id="p8">
<p>Vega and Vega-Lite provide declarative language for creating interactive visualizations. Learning Vega and Vega-Lite before Altair is important because Altair is built on top of these two visualization libraries. By first mastering these foundational tools, you can gain a deeper understanding of how Altair works and take advantage of its full potential. Additionally, learning Vega and Vega-Lite enables you to create custom visualizations that may not be possible with Altair alone, allowing for more flexibility and creativity in data exploration and communication. In the following section, we’ll explore the main components of a Vega and Vega-Lite specification.</p>
</div>
<div class="readable-text" id="p9">
<h3 class="readable-text-h3"><span class="num-string">3.1.1</span> Vega</h3>
</div>
<div class="readable-text" id="p10">
<p><em>Vega</em> is a visualization grammar used to define the visual aspects and interactive features of a chart by writing code in JSON format. Vega is built at the top of D3.js (<a href="https://d3js.org/">https://d3js.org/</a>), a very popular JavaScript library for data visualization. Using Vega, you can generate web-based views that utilize HTML5 Canvas or SVG to display the resulting chart. HTML5 Canvas is a bitmap-based drawing technology that enables you to render dynamic graphics and animations on the web. SVG is a vector-based graphics format for building scalable and resolution-independent graphics.</p>
</div>
<div class="readable-text intended-text" id="p11">
<p>A Vega JSON file contains the specifications for the visual appearance and interactive behavior of a chart. Listing 3.1 shows the basic structure of a JSON specification. For testing, you can use the Vega Editor (<a href="https://vega.github.io/editor/#/">https://vega.github.io/editor/#/</a>) to render the chart produced by Vega. We will produce a basic Vega line chart gradually, throughout this section.</p>
</div>
<div class="browsable-container listing-container" id="p12">
<h5 class="listing-container-h5 browsable-container-h5"><span class="num-string">Listing 3.1</span> The basic structure of a Vega JSON file</h5>
<div class="code-area-container">
<pre class="code-area">{
  "$schema": "https://vega.github.io/schema/vega/v5.json",
  "description": "A basic example in Vega",
  "width": 600,
  "height": 400,


  "data": [],
  "scales": [],
  "axes": [],
  "marks": [],
  "signals": []
}</pre>
</div>
</div>
<div class="readable-text print-book-callout" id="p13">
<p><span class="print-book-callout-head">Note</span>  First, define the version of the schema (<code>$schema</code>), a <code>description</code>, the <code>width</code>, and the <code>height</code> of the chart. Then, specify the main sections (<code>signals</code>, <code>data</code>, and so on). Listing 3.1 shows only the structure of a Vega JSON file and will not produce any chart if pasted in the Vega Editor.</p>
</div>
<div class="readable-text" id="p14">
<p>The main sections of a Vega JSON file include <code>data</code>, <code>scales</code>, <code>axes</code>, <code>marks</code>, and <code>signals</code>. In the remainder of this section, we’ll describe an overview of the main sections of a Vega specification. For more details, please refer to the Vega official documentation. (<a href="https://vega.github.io/vega/docs/">https://vega.github.io/vega/docs/</a>).</p>
</div>
<div class="readable-text" id="p15">
<h4 class="readable-text-h4">data</h4>
</div>
<div class="readable-text" id="p16">
<p>This section defines the data source to use. It specifies the data format, where the data is located, and how it should be loaded and transformed. The following listing shows an example of a <code>data</code> section.</p>
</div>
<div class="browsable-container listing-container" id="p17">
<h5 class="listing-container-h5 browsable-container-h5"><span class="num-string">Listing 3.2</span> An example <code>data</code> section</h5>
<div class="code-area-container">
<pre class="code-area">"data": [
    {
      "name": "myData",
      "values": [
        {"x": 10, "y": 20},
        {"x": 40, "y": 60},
        {"x": 70, "y": 40},
        {"x": 90, "y": 80},
      ]
    }
  ],</pre>
</div>
</div>
<div class="readable-text print-book-callout" id="p18">
<p><span class="print-book-callout-head">Note</span>  Specify the list of data to use in the visualization. For each element of data, specify the name and content. We will use <code>myData</code> to refer to the associated data in the specification. We can specify more than one data source. The example specifies data values directly. However, you can also retrieve the data from a CSV file, by specifying the URL and the format as follows: <code>"url":</code> <code>"/path/to/csv/myfile.csv",</code> <code>format":</code> <code>{"type":</code> <code>"csv"}.</code> Alternatively, you can retrieve data from other formats or embed them in the JSON directly. </p>
</div>
<div class="readable-text" id="p19">
<h4 class="readable-text-h4">scales</h4>
</div>
<div class="readable-text" id="p20">
<p>This section defines the scales that map the data to visual properties. Scales map a data domain (input range) to a visual range (output range). The following listing shows an example of a <code>scales</code> section.</p>
</div>
<div class="browsable-container listing-container" id="p21">
<h5 class="listing-container-h5 browsable-container-h5"><span class="num-string">Listing 3.3</span> An example <code>scales</code> section</h5>
<div class="code-area-container">
<pre class="code-area">"scales": [
    {
      "name": "xScale",
      "type": "linear",
      "domain": {"data": "myData", "field": "x"},
      "range": "width"
    },
    {
      "name": "yScale",
      "type": "linear",
      "domain": {"data": "myData", "field": "y"},
      "range": "height"
    }
  ],</pre>
</div>
</div>
<div class="readable-text print-book-callout" id="p22">
<p><span class="print-book-callout-head">Note</span>  Specify the list of <code>scales</code> to use in the visualization. For each scale, specify at least the name, range, and domain. The example defines two scales, one for the x-axis and the other for the y-axis. Specify the data to use as the value of the domain attribute. </p>
</div>
<div class="readable-text" id="p23">
<h4 class="readable-text-h4">axes</h4>
</div>
<div class="readable-text" id="p24">
<p>This section defines the axes of the chart. Use <code>axes</code> to define tick marks and labels along an axis. The following listing shows an example of an <code>axes</code> section.</p>
</div>
<div class="browsable-container listing-container" id="p25">
<h5 class="listing-container-h5 browsable-container-h5"><span class="num-string">Listing 3.4</span> An example <code>axes</code> section</h5>
<div class="code-area-container">
<pre class="code-area">"axes": [
    { "orient": "bottom", "scale": "xScale" },
    { "orient": "left", "scale": "yScale" }
]</pre>
</div>
</div>
<div class="readable-text print-book-callout" id="p26">
<p><span class="print-book-callout-head">Note</span>  Specify the list of <code>axes</code> to use in the visualization. For each axis, specify at least the scale and how to orient it. The example defines two axes, one for the x-axis and the other for the y-axis. </p>
</div>
<div class="readable-text" id="p27">
<h4 class="readable-text-h4">marks</h4>
</div>
<div class="readable-text" id="p28">
<p>This section defines the visual <code>marks</code> that represent the data. Marks include points, lines, rectangles, areas, and other shapes. Use visual properties, like size, color, opacity, and shape, to style marks. The following listing shows an example of a <code>marks</code> section.</p>
</div>
<div class="browsable-container listing-container" id="p29">
<h5 class="listing-container-h5 browsable-container-h5"><span class="num-string">Listing 3.5</span> An example <code>marks</code> section</h5>
<div class="code-area-container">
<pre class="code-area">"marks": [
    {
      "type": "line",
      "from": {"data": "myData"},
      "encode": {
        "enter": {
          "x": {"scale": "xScale", "field": "x"},
          "y": {"scale": "yScale", "field": "y"},
          "stroke": {"value": "red"}
        }
      }
    }
  ],</pre>
</div>
</div>
<div class="readable-text print-book-callout" id="p30">
<p><span class="print-book-callout-head">Note</span>  Specify the list of <code>marks</code> to use in the visualization. For each <code>mark</code>, specify at least the <code>type</code> (line, symbol, rect, and so on), the source of data (<code>from</code>), and how to encode the data (<code>encode</code>). Use the <code>enter</code> block to define the initial properties of the visualization. The example defines a line chart representing data contained in the <code>myData</code> variable defined in the <code>data</code> section. It also defines two encoding channels, <code>x</code> and <code>y</code>, and the color of the line stroke. </p>
</div>
<div class="readable-text" id="p31">
<h4 class="readable-text-h4">signals </h4>
</div>
<div class="readable-text" id="p32">
<p>This section defines the interactive signals you can use to modify the visualization, such as sliders, dropdowns, and check boxes. Every signal is composed of two parts: the <em>listener</em>, which is identified by the <code>signals</code> section, and the <em>handler</em>, which is defined by the keyword <code>signal</code> within the <code>marks</code> section. The signal listener responds to signal changes, and the signal handler determines how the visualization reacts. For example, a signal handler might change the color or size of data points based on a signal’s value. The following listing provides an example that changes the color of a selected element in a chart when the user hovers over the bar with the mouse (figure 3.1).</p>
</div>
<div class="browsable-container listing-container" id="p33">
<h5 class="listing-container-h5 browsable-container-h5"><span class="num-string">Listing 3.6</span> An example <code>signals</code> section</h5>
<div class="code-area-container">
<pre class="code-area">"signals": [{
     "name": "changeColor",
     "on": [
        {"events": "mouseover", "update": "datum"},
        {"events": "mouseout", "update": "null"}
      ]
}]</pre>
</div>
</div>
<div class="readable-text print-book-callout" id="p34">
<p><span class="print-book-callout-head">Note</span>  <code>signals</code> are used to capture events or changes in the visualization. For each signal, specify its name (<code>changeColor</code>, in the example), the property to modify (<code>value</code>, in the example), and the list of events to listen (<code>on</code>, in the example). </p>
</div>
<div class="readable-text" id="p35">
<p>To use the signal, you must specify an <code>update</code> block within your <code>mark</code> section. Rememember that you used the <code>enter</code> block to specify the initial condition of the chart. Now, you can use the <code>update</code> block to specify a change. The following listing specifies a change in the line color.</p>
</div>
<div class="browsable-container listing-container" id="p36">
<h5 class="listing-container-h5 browsable-container-h5"><span class="num-string">Listing 3.7</span> An example <code>update</code> section</h5>
<div class="code-area-container">
<pre class="code-area">"marks": [{
      "encode": {
        "enter": {
           ...
       },
        "update": {
          "stroke": {
              "signal": "changeColor === datum ? 'red' : 'blue'" 
              }
          }
        }
      }],</pre>
</div>
</div>
<div class="readable-text print-book-callout" id="p37">
<p><span class="print-book-callout-head">Note</span>  Under the <code>marks</code> section, specify a handler associated with the signal. This handler will be triggered when the specified event (like mouseover) associated with the signal occurs. Within the <code>update</code> property of the <code>marks</code> section, a handler is defined. This handler checks whether the signal corresponds to the mouseover event (e.g., <code>changeColor</code> <code>===</code> <code>datum</code>). If the condition is met (i.e., if the mouse is over the line), the handler performs an action, such as changing the color of the line accordingly. Refer to the Vega documentation (<a href="https://vega.github.io/vega/docs/signals/">https://vega.github.io/vega/docs/signals/</a>) for more details.</p>
</div>
<div class="readable-text" id="p38">
<p>Figure 3.1 shows the resulting line chart. You can find the complete example in the book’s GitHub repository under 03/vega/json/line-chart.json.<span class="aframe-location"/></p>
</div>
<div class="browsable-container figure-container" id="p39">
<img alt="figure" height="753" src="../Images/3-1.png" width="1100"/>
<h5 class="figure-container-h5"><span class="num-string">Figure 3.1</span> The line chart written in Vega</h5>
</div>
<div class="readable-text" id="p40">
<h4 class="readable-text-h4">Exercise 1</h4>
</div>
<div class="readable-text" id="p41">
<p>Draw a line chart in Vega as follows:</p>
</div>
<ol>
<li class="readable-text" id="p42"> Load data from the following URL: <a href="https://mng.bz/ZEyZ">https://mng.bz/ZEyZ</a>. </li>
<li class="readable-text" id="p43"> Add points to the line. To do this, add a new mark (in addition to the line), using <code>symbol</code> as a type. </li>
</ol>
<div class="readable-text" id="p44">
<p>You can find the solution to this exercise in the GitHub repository for the book under 03/vega/json/spec.json. </p>
</div>
<div class="readable-text" id="p45">
<h4 class="readable-text-h4">Exercise 2</h4>
</div>
<div class="readable-text" id="p46">
<p>Draw a bar chart in Vega as follows:</p>
</div>
<ol>
<li class="readable-text" id="p47"> Load data from the following URL: <a href="https://mng.bz/Ad6W">https://mng.bz/Ad6W</a>. </li>
<li class="readable-text" id="p48"> Use <code>band</code> as the type for the <code>X</code> scale. </li>
<li class="readable-text" id="p49"> Use <code>rect</code> as the <code>mark</code> type. </li>
<li class="readable-text" id="p50"> Optionally, set a signal that changes the bar color while hovering over it with the mouse. </li>
</ol>
<div class="readable-text" id="p51">
<p>You can find the solution to this exercise in the book’s GitHub repository under 03/vega/json/spec2.json. Now that you have learned the basic concepts behind Vega, let’s move to the next step: Vega-Lite.</p>
</div>
<div class="readable-text" id="p52">
<h3 class="readable-text-h3"><span class="num-string">3.1.2</span> Vega-Lite</h3>
</div>
<div class="readable-text" id="p53">
<p><em>Vega-Lite</em> is a concise JSON of a Vega visualization. Vega-Lite still maintains the specifications already defined in Vega, but it represents them through a more compact syntax. Compared to Vega, Vega-Lite offers a more streamlined and concise syntax, ideal for quickly generating simple visualizations with less code complexity, making it more accessible to users seeking rapid creation of common charts. While Vega-Lite provides a high-level abstraction for creating visualizations, it may lack the flexibility to customize every aspect of visualization. It may also perform worse than Vega. The basic sections of a Vega-Lite JSON specification are <code>data</code>, <code>encoding</code>, <code>mark</code>, and <code>layer</code>.</p>
</div>
<div class="readable-text" id="p54">
<h4 class="readable-text-h4">data</h4>
</div>
<div class="readable-text" id="p55">
<p>This section specifies the data source for the visualization. The following listing provides an example of a <code>data</code> section in Vega-Lite.</p>
</div>
<div class="browsable-container listing-container" id="p56">
<h5 class="listing-container-h5 browsable-container-h5"><span class="num-string">Listing 3.8</span> An example <code>data</code> section</h5>
<div class="code-area-container">
<pre class="code-area">"data": {
      "values": [
        {"x": 10, "y": 20},
        {"x": 40, "y": 60},
        {"x": 70, "y": 40},
        {"x": 90, "y": 80}
      ]
    },</pre>
</div>
</div>
<div class="readable-text print-book-callout" id="p57">
<p><span class="print-book-callout-head">Note</span>  This specifies the data to use in the visualization. Refer to the Vega-Lite documentation (<a href="https://vega.github.io/vega-lite/docs/data.xhtml">https://vega.github.io/vega-lite/docs/data.xhtml</a>) for more details.</p>
</div>
<div class="readable-text" id="p58">
<h4 class="readable-text-h4">encoding</h4>
</div>
<div class="readable-text" id="p59">
<p>This section maps the data fields to visual properties, such as position, color, and size. The following listing shows an example of an <code>encoding</code> section in Vega-Lite. Use the Vega Editor to test your code in Vega-Lite, ensuring you select Vega-Lite from the top-left drop-down menu.</p>
</div>
<div class="browsable-container listing-container" id="p60">
<h5 class="listing-container-h5 browsable-container-h5"><span class="num-string">Listing 3.9</span> An example <code>encoding</code> section</h5>
<div class="code-area-container">
<pre class="code-area">"encoding": {
      "x": {"field": "X", "type": "quantitative"},
      "y": {"field": "Y", "type": "quantitative"}
    },</pre>
</div>
</div>
<div class="readable-text print-book-callout" id="p61">
<p><span class="print-book-callout-head">Note</span>  Specify the encodings to use in the visualization. The example defines two channels, <code>x</code> and <code>y</code>, and specifies the data type as <code>quantitative</code>. Vega and Vega-Lite also support other data types, such as <code>ordinal</code>, for sequential data; <code>nominal</code>, for text; and <code>time</code>, for temporal data.</p>
</div>
<div class="readable-text" id="p62">
<h4 class="readable-text-h4">mark</h4>
</div>
<div class="readable-text" id="p63">
<p>This section defines the type of visual mark, such as <code>bars</code>, <code>points</code>, or <code>lines</code>. The following listing shows an example of a <code>mark</code> section in Vega-Lite.</p>
</div>
<div class="browsable-container listing-container" id="p64">
<h5 class="listing-container-h5 browsable-container-h5"><span class="num-string">Listing 3.10</span> An example <code>mark</code> section</h5>
<div class="code-area-container">
<pre class="code-area">"mark": {"type": "line"},</pre>
</div>
</div>
<div class="readable-text print-book-callout" id="p65">
<p><span class="print-book-callout-head">Note</span>  Specify the <code>mark</code> to use in the visualization. The example defines a line chart. </p>
</div>
<div class="readable-text" id="p66">
<h4 class="readable-text-h4">layer</h4>
</div>
<div class="readable-text" id="p67">
<p>This section combines multiple marks in a single chart. The next listing shows an example of a <code>layer</code> section in Vega-Lite.</p>
</div>
<div class="browsable-container listing-container" id="p68">
<h5 class="listing-container-h5 browsable-container-h5"><span class="num-string">Listing 3.11</span> An example <code>layer</code> section</h5>
<div class="code-area-container">
<pre class="code-area">"layer": [
   {"mark": {"type": "line", }},
   {"mark": {"type": "point", "shape": "circle", "size": 100}}
]</pre>
</div>
</div>
<div class="readable-text print-book-callout" id="p69">
<p><span class="print-book-callout-head">Note</span>  Specify the list of marks to combine. This combines two charts: a line chart and a point chart. </p>
</div>
<div class="readable-text" id="p70">
<h4 class="readable-text-h4">Interactivity</h4>
</div>
<div class="readable-text" id="p71">
<p>Vega-Lite simplifies the way of managing signals by using <code>params</code>. Instead of defining a signal, you define a <code>param</code>.</p>
</div>
<div class="browsable-container listing-container" id="p72">
<h5 class="listing-container-h5 browsable-container-h5"><span class="num-string">Listing 3.12</span> How to specify <code>params</code> in Vega-Lite</h5>
<div class="code-area-container">
<pre class="code-area">"params": [
      {
        "name": "changeColor",
        "select": {"type": "point", "on": "mouseover"}
      },
      {
        "name" : "default",
        "select": {"type": "point", "on": "mouseout"}

      }
    ],</pre>
</div>
</div>
<div class="readable-text print-book-callout" id="p73">
<p><span class="print-book-callout-head">Note</span>  Specify the name of each signal using the <code>params</code> keyword. For each <code>param</code>, specify the name and how to trigger it. The type can be set to <code>point</code>, to select a single point in the chart or interval. </p>
</div>
<div class="readable-text" id="p74">
<p>After defining the <code>params</code>, you can use them in the marks, as specified in the following listing. You can find the complete example in the GitHub repository for the book under 03/vega-lite/json/line-chart.json.</p>
</div>
<div class="browsable-container listing-container" id="p75">
<h5 class="listing-container-h5 browsable-container-h5"><span class="num-string">Listing 3.13</span> How to use <code>params</code> in a <code>mark</code> in Vega-Lite</h5>
<div class="code-area-container">
<pre class="code-area">"stroke": {
            "condition": [
            {
                "param": "changeColor",
                "empty": false,
                "value": "red"
            },
            {
                "param": "default",
                "empty": false,
                "value": "blue"
            }
            ],
            "value" : "blue"
        }</pre>
</div>
</div>
<div class="readable-text print-book-callout" id="p76">
<p><span class="print-book-callout-head">Note</span>  The example in listing 3.13 uses the <code>params</code> defined in listing 3.12 to set the stroke color based on a condition. If the <code>changeColor</code> <code>param</code> is triggered, then the color line is set to <code>red</code>; if the <code>default</code> <code>param</code> is triggered, then the color line is set to <code>blue</code>. The default stroke color is <code>blue</code>.</p>
</div>
<div class="readable-text" id="p77">
<h4 class="readable-text-h4">Exercise 3</h4>
</div>
<div class="readable-text" id="p78">
<p>Convert the result of exercise 1 into Vega-Lite. The solution to the exercise is provided in the book’s GitHub repository under 03/vega-lite/json/spec.json.</p>
</div>
<div class="readable-text intended-text" id="p79">
<p>Now that you have learned the basic concepts behind Vega and Vega-Lite, let’s see how to render a Vega/Vega-Lite visualization using HTML and JavaScript. If you are unfamiliar with HTML and JavaScript, you can skip the next section and move on to section 3.2.</p>
</div>
<div class="readable-text" id="p80">
<h3 class="readable-text-h3"><span class="num-string">3.1.3</span> How to render a Vega or Vega-Lite visualization</h3>
</div>
<div class="readable-text" id="p81">
<p>Both Vega and Vega-Lite are JSON objects that need a renderer to be shown, such as an external JavaScript library, to render the visualization from an HTML page. Vega-Lite provides a JavaScript API that automatically builds both Vega and Vega-Lite visualizations. </p>
</div>
<div class="readable-text intended-text" id="p82">
<p>To render a Vega or Vega-Lite JSON, import the following JavaScript libraries into your HTML file:</p>
</div>
<ul>
<li class="readable-text" id="p83"> <a href="https://cdn.jsdelivr.net/npm/vega@5.22.1">https://cdn.jsdelivr.net/npm/vega@5.22.1</a> </li>
<li class="readable-text" id="p84"> <a href="https://cdn.jsdelivr.net/npm/vega-lite@5.6.0">https://cdn.jsdelivr.net/npm/vega-lite@5.6.0</a> </li>
<li class="readable-text" id="p85"> <a href="https://cdn.jsdelivr.net/npm/vega-embed@6.21.0">https://cdn.jsdelivr.net/npm/vega-embed@6.21.0</a> </li>
</ul>
<div class="readable-text" id="p86">
<p>The library versions may vary. In our case, we import version 5.22.1 for Vega, 5.6.0 for Vega-Lite, and 6.21.0 for Vega-Embed, as we usually do to import JavaScript libraries. Then, you can wrap the code described in listing 3.11 to render your Vega/Vega-Lite JSON file.</p>
</div>
<div class="readable-text" id="p87">
<h4 class="readable-text-h4">The JavaScript code to render a Vega or Vega-Lite JSON specification </h4>
</div>
<div class="readable-text" id="p88">
<p>For example, to render the chart described in listing 3.7, use the following HTML specification.</p>
</div>
<div class="browsable-container listing-container" id="p89">
<h5 class="listing-container-h5 browsable-container-h5"><span class="num-string">Listing 3.14</span> The complete HTML file</h5>
<div class="code-area-container">
<pre class="code-area">&lt;!DOCTYPE html&gt;
&lt;html&gt;
  &lt;head&gt;         <span class="aframe-location"/> #1
    &lt;script src="https://cdn.jsdelivr.net/npm/vega@5.22.1"&gt;&lt;/script&gt;
    &lt;script src="https://cdn.jsdelivr.net/npm/vega-lite@5.6.0"&gt;&lt;/script&gt;
    &lt;script src="https://cdn.jsdelivr.net/npm/vega-embed@6.21.0"&gt;&lt;/script&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;div id="vis"&gt;&lt;/div&gt;            <span class="aframe-location"/> #2
    &lt;script type="text/javascript"&gt;           <span class="aframe-location"/> #3
      var request = new XMLHttpRequest();
      request.open(‘GET’, ‘/path/to/json/file’, false);
      request.send(null)
      var data = JSON.parse(request.responseText);
      vegaEmbed('#vis', data);
    &lt;/script&gt;
  &lt;/body&gt;
&lt;/html&gt;</pre>
<div class="code-annotations-overlay-container">
     #1 Imports Vega and Vega-Lite libraries
     <br/>#2 Creates a div to contain the chart
     <br/>#3 Builds the chart
     <br/>
</div>
</div>
</div>
<div class="readable-text print-book-callout" id="p90">
<p><span class="print-book-callout-head">Note</span>  First, import the Vega and Vega-Lite libraries in the header section. Then, create a <code>div</code> that will contain the chart. Finally, build the chart. Use an external JSON file to define the chart specifications. In the <code>script</code> body, specify the JavaScript code to import your Vega JSON file. Open a new <code>XMLHttpRequest()</code> to load the JSON file, and then use the <code>vegaEmbed()</code> function to render the JSON. Note that you must provide a valid external URL to the request object. You can’t use a local JSON file.</p>
</div>
<div class="readable-text" id="p91">
<p>You can find the complete example and other examples in the book’s GitHub repository, section 03/vega (<a href="https://mng.bz/x2NB">https://mng.bz/x2NB</a>) and 03/vega-lite (<a href="https://mng.bz/Vxj5">https://mng.bz/Vxj5</a>). Now that you have learned the basic concepts underlying Vega and Vega-Lite, let’s move to the next topic: the basic components of an Altair chart.</p>
</div>
<div class="readable-text" id="p92">
<h2 class="readable-text-h2"><span class="num-string">3.2</span> The basic components of an Altair chart</h2>
</div>
<div class="readable-text" id="p93">
<p>In this book, we mostly use the <em>just-in-time teaching</em> methodology, which combines theory and practice to teach concepts at the exact moment you need them. However, in this chapter, we will not use this methodology. This is because we want to establish a strong foundation of fundamental concepts about Altair before diving into the more advanced topics covered later in the book. By deviating from the just-in-time teaching methodology for this chapter, we can provide a comprehensive overview and in-depth understanding of the underlying principles that will serve as building blocks for the subsequent material. Altair is built on top of Vega-Lite and offers a user-friendly API to build charts. You learned how to build a basic chart in Altair in chapter 2, and in this chapter, we’ll dive deep into the basic components of an Altair chart.</p>
</div>
<div class="readable-text intended-text" id="p94">
<p>The basic Altair components include the following:</p>
</div>
<ul>
<li class="readable-text" id="p95"> <em>Encodings</em> —These define how data is mapped to visual properties, such as color, shape, and size. </li>
<li class="readable-text" id="p96"> <em>Marks</em> —These refer to the visual elements representing the data, such as bars, points, and lines. </li>
<li class="readable-text" id="p97"> <em>Conditions</em> —These enable us to create more complex visualizations by specifying rules for when we should use certain encodings or marks. </li>
<li class="readable-text" id="p98"> <em>Compound charts</em> —These combine multiple visual elements to create more complex and informative visualizations. </li>
<li class="readable-text" id="p99"> <em>Interactivity</em> —This enables us to interact with the visualization and explore the data. </li>
<li class="readable-text" id="p100"> <em>Configurations</em> —These define general properties for compound charts. </li>
</ul>
<div class="readable-text" id="p101">
<p>Let’s analyze each component separately, starting with the first one: encodings. You can find some sample code in the 03/altair directory (<a href="https://mng.bz/rVXX">https://mng.bz/rVXX</a>) of the book’s GitHub repository. </p>
</div>
<div class="readable-text" id="p102">
<h3 class="readable-text-h3"><span class="num-string">3.2.1</span> Encodings</h3>
</div>
<div class="readable-text" id="p103">
<p>Altair utilizes <em>encodings</em> to indicate where to show data. An encoding defines a mapping between a column in the dataset and an encoding channel. Each encoding channel corresponds to a specific column of the DataFrame that can be mapped to a visual feature of the plot. The encoding process determines where to display the data in the chart, according to the chosen channel type. Altair identifies several key types of channels, including the following:</p>
</div>
<ul>
<li class="readable-text" id="p104"> <em>Position</em> —This specifies the location of data in the chart. </li>
<li class="readable-text" id="p105"> <em>Mark property</em> —This determines the chart’s appearance such as color, size, and shape. </li>
<li class="readable-text" id="p106"> <em>Text and tooltip</em> —These offer supplementary annotations for the graph. </li>
</ul>
<div class="readable-text" id="p107">
<p>Table 3.1 provides a brief description of the main encodings. For more details, please refer to the Altair documentation (<a href="https://mng.bz/d6RQ">https://mng.bz/d6RQ</a>). </p>
</div>
<div class="readable-text intended-text" id="p108">
<p>Refer to chapter 2 to build a chart using encodings.</p>
</div>
<div class="browsable-container browsable-table-container framemaker-table-container" id="p109">
<h5 class="browsable-container-h5"><span class="num-string">Table 3.1</span> The main encodings in Altair</h5>
<table>
<thead>
<tr>
<th>
<div>
         Type 
       </div></th>
<th>
<div>
         Channel 
       </div></th>
<th>
<div>
         Description 
       </div></th>
</tr>
</thead>
<tbody>
<tr>
<td>  Position <br/></td>
<td> <code>x, y</code> <br/></td>
<td>  Horizontal and vertical positions <br/></td>
</tr>
<tr>
<td/>
<td> <code>longitude, latitude </code> <br/></td>
<td>  Geographical coordinates <br/></td>
</tr>
<tr>
<td/>
<td> <code>xError, xError</code> <br/></td>
<td>  Error values for <code>x</code> and <code>y</code> <br/></td>
</tr>
<tr>
<td/>
<td> <code>x2,y2, longitude2, latitude2</code> <br/></td>
<td>  Second positions for ranges <br/></td>
</tr>
<tr>
<td/>
<td> <code>theta, theta2</code> <br/></td>
<td>  Start and end arc angles <br/></td>
</tr>
<tr>
<td>  Mark property <br/></td>
<td> <code>angle, radius</code> <br/></td>
<td>  The angle and the radius of the mark <br/></td>
</tr>
<tr>
<td/>
<td> <code>color, fill</code> <br/></td>
<td>  The color and the fill of the mark <br/></td>
</tr>
<tr>
<td/>
<td> <code>opacity, fillOpacity</code> <br/></td>
<td>  The opacity and the fill opacity of the mark <br/></td>
</tr>
<tr>
<td/>
<td> <code>shape, size</code> <br/></td>
<td>  The shape and the size of the mark <br/></td>
</tr>
<tr>
<td/>
<td> <code>stroke, strokeDash, strokeOpacity, strokeWidth</code> <br/></td>
<td>  Stroke properties of the mark <br/></td>
</tr>
<tr>
<td>  Text and tooltip <br/></td>
<td> <code>text</code> <br/></td>
<td>  The text of the mark <br/></td>
</tr>
<tr>
<td/>
<td> <code>tooltip</code> <br/></td>
<td>  The tooltip of the mark <br/></td>
</tr>
</tbody>
</table>
</div>
<div class="readable-text" id="p110">
<p>Each column in the dataset is associated with a data type, which defines the kind of values a variable can store. A data type includes primitive types, like integers and characters, and complex types, like arrays and objects. Altair supports the following data types:</p>
</div>
<ul>
<li class="readable-text" id="p111"> <em>Nominal</em> —Data that can be divided into distinct categories, without any specific order, such as the names of different fruits in a dataset </li>
<li class="readable-text" id="p112"> <em>Ordinal</em> —Data that can be divided into distinct categories with an inherent order, such as the days of the week, where the order of the days is essential </li>
<li class="readable-text" id="p113"> <em>Quantitative</em> —Numerical and continuous data, such as the number of product sales </li>
<li class="readable-text" id="p114"> <em>Temporal</em> —Data with a temporal (i.e., date or time) component, such as the date on which a sale occurred </li>
<li class="readable-text" id="p115"> <em>Geojson</em> —Data with a geographic component, such as latitude and longitude coordinates </li>
</ul>
<div class="readable-text" id="p116">
<p>When we build a chart in Altair, we must associate each column involved in the chart with a data type. Altair defines two ways to specify a data type:</p>
</div>
<ul>
<li class="readable-text" id="p117"> The type property of the channel, such as <code>x=alt.X('category',</code> <code>type= 'quantitative')</code>, where <code>category</code> is the column name </li>
<li class="readable-text" id="p118"> A shorthand code following the <code>:</code> symbol, after the column name, <code>x=alt.X ('category:Q')</code> </li>
</ul>
<div class="readable-text" id="p119">
<p>Now that you have learned the concept of encodings, let’s move on to the next concept, marks.</p>
</div>
<div class="readable-text" id="p120">
<h3 class="readable-text-h3"><span class="num-string">3.2.2</span> Marks</h3>
</div>
<div class="readable-text" id="p121">
<p><em>Marks</em> enable you to represent data in visualizations. Examples of marks include bar charts, line charts, heat maps, and box plots, among others. To specify the type of mark, use the <code>mark_&lt;type&gt;()</code> function, where <code>&lt;type&gt;</code> represents the specific type of mark. For instance, to create a bar chart, use <code>mark_bar()</code>. Additionally, you can provide a list of attributes as input parameters for each mark property defined in table 3.1. When using a mark property within the <code>mark_&lt;type&gt;()</code> function, the value of that property is fixed to a constant value. For example, <code>mark_circle(size=5)</code> will draw circles with a constant size of 5. However, if you want to vary the size of the circles depending on a specific column of your DataFrame, use the <code>size</code> channel within the encoding function. Table 3.2 shows the main mark types provided by Altair.</p>
</div>
<div class="browsable-container browsable-table-container framemaker-table-container" id="p122">
<h5 class="browsable-container-h5"><span class="num-string">Table 3.2</span> The main mark types provided by Altair</h5>
<table>
<thead>
<tr>
<th>
<div>
         Method 
       </div></th>
<th>
<div>
         Description 
       </div></th>
</tr>
</thead>
<tbody>
<tr>
<td> <code>mark_arc()</code> <br/></td>
<td>  A pie chart <br/></td>
</tr>
<tr>
<td> <code>mark_area()</code> <br/></td>
<td>  A filled-area chart <br/></td>
</tr>
<tr>
<td> <code>mark_bar()</code> <br/></td>
<td>  A bar chart <br/></td>
</tr>
<tr>
<td> <code>mark_circle()</code> <br/></td>
<td>  A scatter plot with filled points <br/></td>
</tr>
<tr>
<td> <code>mark_geoshape()</code> <br/></td>
<td>  A geographic shape <br/></td>
</tr>
<tr>
<td> <code>mark_line()</code> <br/></td>
<td>  A line chart <br/></td>
</tr>
<tr>
<td> <code>mark_point()</code> <br/></td>
<td>  A scatter plot with configurable points <br/></td>
</tr>
<tr>
<td> <code>mark_rect()</code> <br/></td>
<td>  A filled rectangle for heatmaps <br/></td>
</tr>
<tr>
<td> <code>mark_rule()</code> <br/></td>
<td>  A vertical or horizontal line spanning the axis <br/></td>
</tr>
<tr>
<td> <code>mark_text()</code> <br/></td>
<td>  A text <br/></td>
</tr>
</tbody>
</table>
</div>
<div class="readable-text" id="p123">
<p>Refer to chapter 2 to build a chart using marks.</p>
</div>
<div class="readable-text" id="p124">
<h3 class="readable-text-h3"><span class="num-string">3.2.3</span> Conditions</h3>
</div>
<div class="readable-text" id="p125">
<p>Altair provides several ways to create <em>conditions</em> in visualizations, which enable you to customize and control the appearance of your charts based on specific criteria. One common way to create conditions in Altair is <span class="aframe-location"/>to use the <em>if-else</em> <em>statements</em> in the encoding channels of a chart. To define a condition in Altair, use the <code>alt.condition()</code> method, which takes three arguments: </p>
</div>
<ul>
<li class="readable-text" id="p126"> A condition </li>
<li class="readable-text" id="p127"> A value to use when the condition is true </li>
<li class="readable-text" id="p128"> A value to use when the condition is false </li>
</ul>
<div class="readable-text" id="p129">
<p>For instance, if we want to change the color of the bars in a bar chart based on a specific condition, write the code shown in the following listing and the GitHub repository for the book under 03/altair/condition.py. The final chart is rendered in 03/altair/condition.xhtml.</p>
</div>
<div class="browsable-container listing-container" id="p130">
<h5 class="listing-container-h5 browsable-container-h5"><span class="num-string">Listing 3.15</span> Using the <code>alt.condition()</code> method</h5>
<div class="code-area-container">
<pre class="code-area">import altair as alt
import pandas as pd

df = pd.DataFrame(
    {"Country": ["Japan", "USA", "Germany", "Spain", "France", "Italy"], 
     "Medals": [4, 6, 10, 3, 7, 8], 
     "Region":["Asia","Americas","Europe","Europe","Europe","Europe"]}) 

chart = alt.Chart(df).mark_bar().encode(
    x='Medals',
    y='Country',
    color=alt.condition(
        alt.datum.Region == 'Europe',
        alt.value('red'),     <span class="aframe-location"/> #1
        alt.value('blue')     <span class="aframe-location"/> #2
    )
)

chart.save('chart.xhtml')</pre>
<div class="code-annotations-overlay-container">
     #1 Color to use when condition is true
     <br/>#2 Color to use when condition is false
     <br/>
</div>
</div>
</div>
<div class="readable-text print-book-callout" id="p131">
<p><span class="print-book-callout-head">Note</span>  The condition in the example checks if the Region is Europe. If the condition is true, the bars will be colored red, and if the condition is false, the bars will be colored blue. Use the datum variable to directly access the DataFrame column name within a condition.</p>
</div>
<div class="readable-text" id="p132">
<p>In addition to using if-else statements with the <code>alt.condition()</code> method and the type-checking functions, Altair provides two other ways to create conditions in visualizations: <em>transformations </em>and <em>selections</em>. You will see transformations in chapter 5 and selections in chapter 6. You can use transformations and selections to build interconnected charts that update synchronously.</p>
</div>
<div class="readable-text" id="p133">
<h3 class="readable-text-h3"><span class="num-string">3.2.4</span> Compound charts</h3>
</div>
<div class="readable-text" id="p134">
<p><em>Compound charts</em> enable you to combine visualizations in a single chart. Altair supports the following types of compound charts: layering,<span class="aframe-location"/> horizontal concatenation, vertical concatenation, and repeated charts. To explain how each type of compound chart works, consider the two charts described in the following listing and 03/altair/ layering.py. </p>
</div>
<div class="browsable-container listing-container" id="p135">
<h5 class="listing-container-h5 browsable-container-h5"><span class="num-string">Listing 3.16</span> Building two charts in Altair</h5>
<div class="code-area-container">
<pre class="code-area">base = alt.Chart(df
).encode(
    x='Country',
    y='Medals'
).properties(
    width=300
)

chart1 = base.mark_bar(
    color='#636466'
).properties(
    title='A bar chart'
) 

chart2 = base.mark_line(
    color='#80C11E'
).properties(
    title='A line chart'
)</pre>
</div>
</div>
<div class="readable-text print-book-callout" id="p136">
<p><span class="print-book-callout-head">Note</span>  Build a base chart, with the encodings and properties shared among all the charts, and then use it to build the other charts, a bar chart (<code>chart1</code>), and a line chart (<code>chart2</code>). Use <code>properties()</code> to set the chart properties, such as the width and the title.</p>
</div>
<div class="readable-text" id="p137">
<h4 class="readable-text-h4">Layering</h4>
</div>
<div class="readable-text" id="p138">
<p><em>Layering</em> lets you combine charts on top of each other, as shown in figure 3.2. In Altair, use the <code>alt.layer(chart1,chart2)</code> function to layer two charts, or the <code>+</code> operator (<code>chart1</code> <code>+</code> <code>chart2</code>). If each chart has a title and you don’t specify any general title for the compound chart, layering will set the title of the layered chart as that of the first chart.<span class="aframe-location"/></p>
</div>
<div class="browsable-container figure-container" id="p139">
<img alt="figure" height="841" src="../Images/3-2.png" width="675"/>
<h5 class="figure-container-h5"><span class="num-string">Figure 3.2</span> A bar chart layered with a line chart</h5>
</div>
<div class="readable-text" id="p140">
<h4 class="readable-text-h4">Horizontal concatenation</h4>
</div>
<div class="readable-text" id="p141">
<p><em>Horizontal concatenation</em> enables you to concatenate charts horizontally, as shown in figure 3.3. In Altair, use the <code>alt.hconcat(chart1,chart2)</code> function to layer two charts or, alternatively, the <code>|</code> operator. Refer to 03/altair/hconcat.py for the complete example.<span class="aframe-location"/></p>
</div>
<div class="browsable-container figure-container" id="p142">
<img alt="figure" height="674" src="../Images/3-3.png" width="1100"/>
<h5 class="figure-container-h5"><span class="num-string">Figure 3.3</span> A bar chart concatenated horizontally with a line chart</h5>
</div>
<div class="readable-text" id="p143">
<h4 class="readable-text-h4">Vertical concatenation</h4>
</div>
<div class="readable-text" id="p144">
<p><em>Vertical concatenation</em> enables you to concatenate charts vertically, as shown in figure 3.4. In Altair, use the <code>alt.vconcat(chart1,chart2)</code> function to layer two charts or the <code>&amp;</code> operator. Refer to 03/altair/vconcat.py for the complete example.<span class="aframe-location"/></p>
</div>
<div class="browsable-container figure-container" id="p145">
<img alt="figure" height="1742" src="../Images/3-4.png" width="671"/>
<h5 class="figure-container-h5"><span class="num-string">Figure 3.4</span> A bar chart concatenated vertically with a line chart</h5>
</div>
<div class="readable-text" id="p146">
<h4 class="readable-text-h4">Repeated charts</h4>
</div>
<div class="readable-text" id="p147">
<p>A <em>repeated chart</em> displays similar data views in a single visualization. With a repeated chart, you can create a set of charts, each displaying a subset of the data, by repeating a base chart using different data subsets or by changing a visual encoding. </p>
</div>
<div class="readable-text intended-text" id="p148">
<p>Use the <code>repeat()</code> function to create a repeated chart in Altair. This function takes the list of fields for the repeat, as shown in the following listing and under 03/altair/ repeat.py.</p>
</div>
<div class="browsable-container listing-container" id="p149">
<h5 class="listing-container-h5 browsable-container-h5"><span class="num-string">Listing 3.17</span> Building a repeated chart in Altair</h5>
<div class="code-area-container">
<pre class="code-area">import pandas as pd
import altair as alt

df = pd.DataFrame({
'X' : [1,2,3,4],
'Y' : [2,4,5,6],
'Z' : [3,4,5,6],
'H' : [5,6,8,9],
'M' : [3,4,5,3],
'Country' : ['USA', 'EU', 'EU', 'USA']
})


fields = df.columns.tolist()
fields.remove('Country')

chart = alt.Chart(df).mark_circle(color='#80C11E').encode(
    alt.X(alt.repeat("column"), type='quantitative'),
    alt.Y(alt.repeat("row"), type='quantitative')
).properties(
    width=100,
    height=100
).repeat(
    row=fields,
    column=fields
)

chart.save('repeat.xhtml')</pre>
</div>
</div>
<div class="readable-text print-book-callout" id="p150">
<p><span class="print-book-callout-head">Note</span>  First, create the pandas DataFrame. Then, extract the list of fields to repeat and store them in the <code>fields</code> variable. Next, define the <code>repeat()</code> method with the rows and columns to repeat. Finally, use the <code>row</code> and <code>column</code> variables just defined as a variable of the chart encodings.</p>
</div>
<div class="readable-text" id="p151">
<p>Figure 3.5 shows the output of listing 3.17. Altair has built 25 charts, one for each combination of the columns of the DataFrame specified in the <code>fields</code> variable.<span class="aframe-location"/></p>
</div>
<div class="browsable-container figure-container" id="p152">
<img alt="figure" height="1143" src="../Images/3-5.png" width="1100"/>
<h5 class="figure-container-h5"><span class="num-string">Figure 3.5</span> A repeated chart varying the encodings</h5>
</div>
<div class="readable-text" id="p153">
<h3 class="readable-text-h3"><span class="num-string">3.2.5</span> Interactivity</h3>
</div>
<div class="readable-text" id="p154">
<p><em>Interactivity</em> refers to the ability to manipulate visualizations through user input, such as hovering over data points, clicking legends, or dragging sliders. In Altair, use the <code>interactive()</code> method to enable features like zooming, panning, and hovering over data points to display tooltips. Listing 3.18 shows an example of how to make a chart interactive, and figure 3.6 shows the resulting chart. You can also find the complete example under 03/altair/interactive.py.</p>
</div>
<div class="browsable-container listing-container" id="p155">
<h5 class="listing-container-h5 browsable-container-h5"><span class="num-string">Listing 3.18</span> Building an interactive chart in Altair</h5>
<div class="code-area-container">
<pre class="code-area">import altair as alt
import pandas as pd

df = pd.DataFrame(
    {"Country": ["Japan", "USA", "Germany", "Spain", "France", "Italy"], 
     "Medals": [4, 6, 10, 3, 7, 8], 
     "Region":["Asia","Americas","Europe","Europe","Europe","Europe"]}) 

chart = alt.Chart(df).mark_bar(color='#636466').encode(
    x='Country',
    y='Medals',
    tooltip=['Country', 'Medals', 'Region']
).properties(
    width=300, 
    title='A bar chart'
).interactive()

chart.save('interactive.xhtml')</pre>
</div>
</div>
<div class="readable-text print-book-callout" id="p156">
<p><span class="print-book-callout-head">Note</span>  First, create the pandas DataFrame. Then, build the Altair chart, appending the <code>interactive()</code> method at the end. Also, add a tooltip, which receives the list of DataFrame columns to show.<span class="aframe-location"/></p>
</div>
<div class="browsable-container figure-container" id="p157">
<img alt="figure" height="858" src="../Images/3-6.png" width="695"/>
<h5 class="figure-container-h5"><span class="num-string">Figure 3.6</span> A bar chart with interactivity enabled</h5>
</div>
<div class="readable-text" id="p158">
<h3 class="readable-text-h3"><span class="num-string">3.2.6</span> Configurations</h3>
</div>
<div class="readable-text" id="p159">
<p>To configure the basic properties of a single chart, use the <code>properties()</code> method. For more complex properties and to configure a compound chart, instead, you must use <em>global configurations</em>. Altair supports many global configurations. In this section, we will describe axes, title, and view. We will wait to describe the other configurations until later in the book, when we will require them.</p>
</div>
<div class="readable-text intended-text" id="p160">
<p>To show how configurations work, we will start with the chart described in figure 3.7 and generated through the code in the following listing.</p>
</div>
<div class="browsable-container listing-container" id="p161">
<h5 class="listing-container-h5 browsable-container-h5"><span class="num-string">Listing 3.19</span> Defining the basic chart</h5>
<div class="code-area-container">
<pre class="code-area">import pandas as pd
import altair as alt

df = pd.DataFrame(
    {"Country": ["Japan", "USA", "Germany", "Spain", "France", "Italy"], 
     "Medals": [4, 6, 10, 3, 7, 8], 
     "Region":["Asia","Americas","Europe","Europe","Europe","Europe"]}) 


chart = alt.Chart(df).mark_bar(color='#636466').encode(
    x='Country',
    y='Medals'
).properties(width=300, title='A bar chart')

chart.save('chart.xhtml')<span class="aframe-location"/></pre>
</div>
</div>
<div class="browsable-container figure-container" id="p162">
<img alt="figure" height="1116" src="../Images/3-7.png" width="970"/>
<h5 class="figure-container-h5"><span class="num-string">Figure 3.7</span> The basic bar chart built by the default configuration</h5>
</div>
<div class="readable-text" id="p163">
<p>Now, let’s start modifying the basic chart by configuring axes.</p>
</div>
<div class="readable-text" id="p164">
<h4 class="readable-text-h4">Configuring axes</h4>
</div>
<div class="readable-text" id="p165">
<p>To configure axes at a global level, Altair supports three methods: </p>
</div>
<ul>
<li class="readable-text" id="p166"> <code>configure_axis()</code>—Configures both axes. </li>
<li class="readable-text" id="p167"> <code>configure_axisX()</code>—Configures the x-axis. </li>
<li class="readable-text" id="p168"> <code>configure_axisY()</code>—Configures the y-axis. </li>
</ul>
<div class="readable-text" id="p169">
<p>Configuring axes enables you to customize several properties, such as labels, tick marks, and scales. The following listing shows an example, which you can also find under 03/altair/configure-axis.py.</p>
</div>
<div class="browsable-container listing-container" id="p170">
<h5 class="listing-container-h5 browsable-container-h5"><span class="num-string">Listing 3.20</span> Configuring axes</h5>
<div class="code-area-container">
<pre class="code-area">chart = chart.configure_axis(
    labelAngle=0,        <span class="aframe-location"/> #1
    titleFontSize=14,     <span class="aframe-location"/> #2
    labelFontSize=12   <span class="aframe-location"/> #3
)

chart.save('configure-axis.xhtml')</pre>
<div class="code-annotations-overlay-container">
     #1 Sets the label angle
     <br/>#2 Sets the font size of the axis title
     <br/>#3 Sets the font size of the axis labels
     <br/>
</div>
</div>
</div>
<div class="readable-text print-book-callout" id="p171">
<p><span class="print-book-callout-head">Note</span>  Use <code>configure_axis()</code> to configure labels and titles in axes. As an alternative, use <code>configure_axisX()</code> to configure the x-axis and <code>configure_</code> <code>axisY()</code> configure the y-axis.</p>
</div>
<div class="readable-text" id="p172">
<p>Figure 3.8 shows the difference between the layouts when using <code>configure_axis()</code> (on the left) and not using <code>configure_axis()</code> (on the right).<span class="aframe-location"/></p>
</div>
<div class="browsable-container figure-container" id="p173">
<img alt="figure" height="676" src="../Images/3-8.png" width="1100"/>
<h5 class="figure-container-h5"><span class="num-string">Figure 3.8</span> The difference between the layouts with <code>configure_axis()</code> and without <code>configure_axis()</code></h5>
</div>
<div class="readable-text" id="p174">
<h4 class="readable-text-h4">Configuring title</h4>
</div>
<div class="readable-text" id="p175">
<p>Use the <code>configure_title()</code> method to customize the title properties of your chart, such as color, font size, and font family. The following listing shows an example of how to use the <code>configure_title()</code> method, which you can also find under 03/altair/ configure-title.py.</p>
</div>
<div class="browsable-container listing-container" id="p176">
<h5 class="listing-container-h5 browsable-container-h5"><span class="num-string">Listing 3.21</span> Configuring <code>title</code></h5>
<div class="code-area-container">
<pre class="code-area">chart = chart.configure_title(
    fontSize=20,            <span class="aframe-location"/> #1
    color='#80C11E',    <span class="aframe-location"/> #2
    offset=30,        <span class="aframe-location"/> #3
    anchor='start'    <span class="aframe-location"/> #4
)

chart.save('configure-title.xhtml')</pre>
<div class="code-annotations-overlay-container">
     #1 Sets the title font size
     <br/>#2 Sets the title color
     <br/>#3 Sets the distance between the title and the chart
     <br/>#4 Sets where to anchor the title
     <br/>
</div>
</div>
</div>
<div class="readable-text print-book-callout" id="p177">
<p><span class="print-book-callout-head">Note</span>  Use <code>configure_title()</code> to configure the title properties. The anchor must be either <code>None</code>, <code>start</code>, <code>middle</code>, or <code>end</code>.</p>
</div>
<div class="readable-text" id="p178">
<p>Figure 3.9 shows the difference between the layouts when using <code>configure_title()</code> (on the left) and not using <code>configure_title()</code> (on the right).<span class="aframe-location"/></p>
</div>
<div class="browsable-container figure-container" id="p179">
<img alt="figure" height="624" src="../Images/3-9.png" width="1100"/>
<h5 class="figure-container-h5"><span class="num-string">Figure 3.9</span> The difference between the layouts with <code>configure_title()</code> and without <code>configure_title()</code></h5>
</div>
<div class="readable-text" id="p180">
<h4 class="readable-text-h4">Configuring view</h4>
</div>
<div class="readable-text" id="p181">
<p>Use the <code>configure_view()</code> method to customize the general view of the chart. The following listing shows an example of usage of the <code>configure_view()</code> method, which you can also find under 03/altair/configure-view.py.</p>
</div>
<div class="browsable-container listing-container" id="p182">
<h5 class="listing-container-h5 browsable-container-h5"><span class="num-string">Listing 3.22</span> Configuring <code>view</code></h5>
<div class="code-area-container">
<pre class="code-area">chart = chart.configure_view(
    strokeWidth=0,          <span class="aframe-location"/> #1
    stroke='#80C11E',   <span class="aframe-location"/> #2
    fill='#E0E0E0'   <span class="aframe-location"/> #3
)

chart.save('configure-view.xhtml')</pre>
<div class="code-annotations-overlay-container">
     #1 Sets the border stroke width 
     <br/>#2 Sets the border stroke color
     <br/>#3 Sets the background color
     <br/>
</div>
</div>
</div>
<div class="readable-text print-book-callout" id="p183">
<p><span class="print-book-callout-head">Note</span>  Use <code>configure_view()</code> to configure the general view of the chart.</p>
</div>
<div class="readable-text" id="p184">
<p>Figure 3.10 shows the difference between the layouts when using <code>configure_view()</code> (on the left) and not using <code>configure_view()</code> (on the right).<span class="aframe-location"/></p>
</div>
<div class="browsable-container figure-container" id="p185">
<img alt="figure" height="619" src="../Images/3-10.png" width="1100"/>
<h5 class="figure-container-h5"><span class="num-string">Figure 3.10</span> The difference between the layouts with <code>configure_view()</code> and without <code>configure_view()</code></h5>
</div>
<div class="readable-text" id="p186">
<p>Now that you have learned the basic components of an Altair chart, let’s move to the next step: implementing a case study.</p>
</div>
<div class="readable-text" id="p187">
<h2 class="readable-text-h2"><span class="num-string">3.3</span> Case study</h2>
</div>
<div class="readable-text" id="p188">
<p>Let us imagine you work as a researcher at the Global Demographic Analysis Center (GDAC), who wants to study population growth in North America. For this study, you will be using the World Bank’s population dataset (released under the CC BY-4.0 license, <a href="https://data.worldbank.org/indicator/SP.POP.TOTL">https://data.worldbank.org/indicator/SP.POP.TOTL</a>); you can find a cleaned version of the dataset in the GitHub repository for the book under CaseStudies/population/source/population.csv. The dataset contains the population from 1960 to 2021 for all the countries of the world, as shown in table 3.3. The Country Name column also contains continents. You can find this case study’s complete code provided as a Jupyter Notebook in the book’s GitHub repository under CaseStudies/population/ population.ipynb. In this case, simply execute a cell with the chart variable to visualize an Altair chart.</p>
</div>
<div class="browsable-container browsable-table-container framemaker-table-container" id="p189">
<h5 class="browsable-container-h5"><span class="num-string">Table 3.3</span> The population dataset</h5>
<table>
<thead>
<tr>
<th>
<div>
         Country Name 
       </div></th>
<th>
<div>
         1960 
       </div></th>
<th>
<div>
         … 
       </div></th>
<th>
<div>
         2021 
       </div></th>
</tr>
</thead>
<tbody>
<tr>
<td>  Aruba <br/></td>
<td>  54,608 <br/></td>
<td/>
<td>  106,537 <br/></td>
</tr>
<tr>
<td>  … <br/></td>
<td/>
<td/>
<td/>
</tr>
<tr>
<td>  Zimbabwe <br/></td>
<td>  3,806,310 <br/></td>
<td/>
<td>  15,993,524 <br/></td>
</tr>
</tbody>
</table>
</div>
<div class="readable-text" id="p190">
<p>You start by drawing a raw chart in the following listing, showing all the trend lines from 1960 to 2021 for all the countries and continents. The Country Name column is dirty, so the resulting chart is very confusing, as shown in figure 3.11.</p>
</div>
<div class="browsable-container listing-container" id="p191">
<h5 class="listing-container-h5 browsable-container-h5"><span class="num-string">Listing 3.23</span> Drawing the raw chart</h5>
<div class="code-area-container">
<pre class="code-area">import pandas as pd
import altair as alt
alt.data_transformers.disable_max_rows()   <span class="aframe-location"/> #1

df = pd.read_csv('data/population.csv')
df = df.melt(id_vars='Country Name',      <span class="aframe-location"/> #2
             var_name='Year', 
             value_name='Population')
df['Year'] = df['Year'].astype('int')     

chart = alt.Chart(df).mark_line().encode(
    x = 'Year:Q',
    y = 'Population:Q',
    color = 'Country Name:N'
)              <span class="aframe-location"/> #3

chart</pre>
<div class="code-annotations-overlay-container">
     #1 Uses this Altair function for datasets with more than 5,000 rows
     <br/>#2 Unpivots the dataset
     <br/>#3 Draws the chart
     <br/>
</div>
</div>
</div>
<div class="readable-text print-book-callout" id="p192">
<p><span class="print-book-callout-head">Note</span>  Use <code>mark_line()</code> to draw the chart. To plot the different countries, use the <code>color</code> channel.<span class="aframe-location"/></p>
</div>
<div class="browsable-container figure-container" id="p193">
<img alt="figure" height="704" src="../Images/3-11.png" width="1100"/>
<h5 class="figure-container-h5"><span class="num-string">Figure 3.11</span> The chart with raw data</h5>
</div>
<div class="readable-text" id="p194">
<p>The chart is very confusing because it presents the following problems: there are too many countries, there are too many colors, and it does not focus on North America. To solve these issues, let us use the DIKW pyramid, starting from the first step: turning data into information.</p>
</div>
<div class="readable-text" id="p195">
<h3 class="readable-text-h3"><span class="num-string">3.3.1</span> From data to information</h3>
</div>
<div class="readable-text" id="p196">
<p>Turning data into information involves extracting insights from data. From the point of view of a chart, it means making the chart readable and understandable. Start by grouping countries by continent. The dataset already contains values for continents. List the countries using the <code>unique()</code> method provided by the pandas DataFrame applied to the Country Name column. For more details on the <code>unique()</code> method, please refer to appendix B. Note that the list of countries also contains the continents, so we can build a list of the continents and filter the DataFrame based on that list. Then, plot the resulting chart.</p>
</div>
<div class="browsable-container listing-container" id="p197">
<h5 class="listing-container-h5 browsable-container-h5"><span class="num-string">Listing 3.24</span> Decluttering the chart</h5>
<div class="code-area-container">
<pre class="code-area">continents = ['Africa Eastern and Southern',
             'Africa Western and Central',
             'Middle East &amp; North Africa',
             'Sub-Saharan Africa',
             'Europe &amp; Central Asia',
             'Latin America &amp; Caribbean',
             'North America',
             'Pacific island small states',
             'East Asia &amp; Pacific']      <span class="aframe-location"/> #1

df = df[df['Country Name'].isin(continents)]  <span class="aframe-location"/> #2

chart = alt.Chart(df).mark_line().encode(
    x = 'Year:Q',
    y = 'Population:Q',
    color = 'Country Name:N'
)        <span class="aframe-location"/> #3

chart</pre>
<div class="code-annotations-overlay-container">
     #1 Defines the list of continents
     <br/>#2 Filters the DataFrame on the basis of the list
     <br/>#3 Draws the chart
     <br/>
</div>
</div>
</div>
<div class="readable-text print-book-callout" id="p198">
<p><span class="print-book-callout-head">Note</span>  Group data by continents to reduce the number of lines.</p>
</div>
<div class="readable-text" id="p199">
<p>Figure 3.12 shows the resulting chart, which is more readable. However, it still presents some problems: there too many colors and it does not focus on North America. In practice, it is difficult to compare North America with the other continents.<span class="aframe-location"/></p>
</div>
<div class="browsable-container figure-container" id="p200">
<img alt="figure" height="562" src="../Images/3-12.png" width="1100"/>
<h5 class="figure-container-h5"><span class="num-string">Figure 3.12</span> The chart with a focus on continents</h5>
</div>
<div class="readable-text" id="p201">
<p>Change the chart by focusing on North America and grouping the other continents by calculating their average value, as shown in the following listing.</p>
</div>
<div class="browsable-container listing-container" id="p202">
<h5 class="listing-container-h5 browsable-container-h5"><span class="num-string">Listing 3.25</span> Focusing on North America</h5>
<div class="code-area-container">
<pre class="code-area">mask = df['Country Name'].isin(['North America'])                <span class="aframe-location"/> #1
df_mean = df[~mask].groupby(by='Year').mean().reset_index()   <span class="aframe-location"/> #2

df_grouped = pd.DataFrame({ 
    'Year' : df[mask]['Year'].values,
    'North America' : df[mask]['Population'].values, 
    'World': df_mean['Population'].values
})   <span class="aframe-location"/> #3

df_melt = df_grouped.melt(id_vars='Year', var_name='Continent', value_name='Population')</pre>
<div class="code-annotations-overlay-container">
     #1 Defines a mask that selects only North America
     <br/>#2 Calculates the average value for the continents not in the mask
     <br/>#3 Builds a new DataFrame with North America and the average value of the other continents
     <br/>
</div>
</div>
</div>
<div class="readable-text print-book-callout" id="p203">
<p><span class="print-book-callout-head">Note</span>  Focus on North America, and calculate the average value of the other continents.</p>
</div>
<div class="readable-text" id="p204">
<p>Then, draw the chart.</p>
</div>
<div class="browsable-container listing-container" id="p205">
<h5 class="listing-container-h5 browsable-container-h5"><span class="num-string">Listing 3.26</span> Drawing the chart</h5>
<div class="code-area-container">
<pre class="code-area">colors=['#80C11E', 'grey']

chart = alt.Chart(df_melt).mark_line().encode(
    x = alt.X('Year:Q',
              title=None, 
              axis=alt.Axis(format='.0f',tickMinStep=10)),  <span class="aframe-location"/> #1
    y = alt.Y('Population:Q', 
              title='Difference of population from 1960',
              axis=alt.Axis(format='.2s')),   <span class="aframe-location"/> #2
    color = alt.Color('Continent:N', 
                      scale=alt.Scale(range=colors),      <span class="aframe-location"/> #3
                      legend=None),   <span class="aframe-location"/> #4
    opacity = alt.condition(alt.datum['Continent'] == 'North America', alt.value(1), alt.value(0.3))
).properties(
    title='Population in the North America over the last 50 years',
    width=400,
    height=250
).configure_axis(
    grid=False,          <span class="aframe-location"/> #5
    titleFontSize=14,
    labelFontSize=12
).configure_title(
    fontSize=16,
    color='#80C11E'
).configure_view(
    strokeWidth=0
)

chart</pre>
<div class="code-annotations-overlay-container">
     #1 Formats x labels
     <br/>#2 Formats y labels
     <br/>#3 Sets the range of colors
     <br/>#4 Does not show the legend
     <br/>#5 Disables grid
     <br/>
</div>
</div>
</div>
<div class="readable-text print-book-callout" id="p206">
<p><span class="print-book-callout-head">Note</span>  To format the x-axis labels, use the <code>format</code> parameter. Use <code>.0f</code> to show only the integer part. Also, use the <code>tickMinStep</code> parameter to set the distance between two labels. The example sets the value to <code>10</code>, thus labeling the decades. To format the y-axis labels, set the format parameter to <code>.2s</code>, using scientific notation with two significant figures.</p>
</div>
<div class="readable-text" id="p207">
<p>Figure 3.13 shows the resulting chart. We have omitted the legend for now and will add it later. The chart is clearer; however, the audience needs to do some calculations to understand the difference between the two lines.<span class="aframe-location"/></p>
</div>
<div class="browsable-container figure-container" id="p208">
<img alt="figure" height="704" src="../Images/3-13.png" width="1100"/>
<h5 class="figure-container-h5"><span class="num-string">Figure 3.13</span> The chart focuses on North America.</h5>
</div>
<div class="readable-text" id="p209">
<p>When drawing a chart, do the calculations for the audience to serve them the ready-made dish. Let us calculate the difference from the starting year (1960) for both lines, thus making them comparable. The following listing shows how to calculate the difference.</p>
</div>
<div class="browsable-container listing-container" id="p210">
<h5 class="listing-container-h5 browsable-container-h5"><span class="num-string">Listing 3.27</span> Calculating the difference</h5>
<div class="code-area-container">
<pre class="code-area">baseline = df_melt[df_melt['Year'] == 1960]

continents = ['North America', 'World']
for continent in continents:
    baseline_value = baseline[baseline['Continent'] == continent]['Population'].values[0]
    m = df_melt['Continent'] == continent
    df_melt.loc[m, 'Diff'] = df_melt.loc[m,'Population'] - baseline_value</pre>
</div>
</div>
<div class="readable-text print-book-callout" id="p211">
<p><span class="print-book-callout-head">Note</span>  Calculate the baseline value for 1960, and then for each continent, calculate the difference between each year and the baseline.</p>
</div>
<div class="readable-text" id="p212">
<p>Having calculated the difference, draw the chart. The code is similar to that in listing 3.23. Change only the y-axis column to <code>Diff</code>. Figure 3.14 shows the resulting chart.<span class="aframe-location"/></p>
</div>
<div class="browsable-container figure-container" id="p213">
<img alt="figure" height="688" src="../Images/3-14.png" width="1100"/>
<h5 class="figure-container-h5"><span class="num-string">Figure 3.14</span> The chart with a focus on the difference in population from 1960</h5>
</div>
<div class="readable-text" id="p214">
<p>The chart clearly shows the difference between the two lines, although it is not explicit. To complete the chart, add a label for each line as an additional textual mark.</p>
</div>
<div class="browsable-container listing-container" id="p215">
<h5 class="listing-container-h5 browsable-container-h5"><span class="num-string">Listing 3.28</span> Adding labels</h5>
<div class="code-area-container">
<pre class="code-area">mask = df_melt['Year'] == 2021
na = df_melt[mask]['Diff'].values[0]
oth = df_melt[mask]['Diff'].values[1]

df_text = pd.DataFrame({'text' : ['Rest of the world','North America'],
       'x' : [2023,2023],  <span class="aframe-location"/> #1
       'y' : [oth,na]})    <span class="aframe-location"/> #2

text = alt.Chart(df_text).mark_text(fontSize=14, align='left').encode(
    x = 'x',
    y = 'y',
    text = 'text',
    color = alt.condition(alt.datum.text == 'North America', alt.value('#80C11E'), alt.value('grey'))
)</pre>
<div class="code-annotations-overlay-container">
     #1 Sets the x position
     <br/>#2 Sets the y position
     <br/>
</div>
</div>
</div>
<div class="readable-text print-book-callout" id="p216">
<p><span class="print-book-callout-head">Note</span>  Use <code>mark_text()</code> to set the line labels. We label the lines by placing a text annotation next to each line. We could have used the legend to label the lines, but as Cole Nussbaumer Knaflic says in her book, <em>Storytelling with Data: A Data Visualization Guide for Business Professionals</em> (John Wiley &amp; Sons, 2015), it’s clearer to use text annotations for better clarity. To set the y text position, use the coordinates of the last point in each line. For the x, instead, slightly increase the coordinates of the last point in each line (e.g., 2023 in the example, while the last point is 2021).</p>
</div>
<div class="readable-text" id="p217">
<p>Now, combine the textual mark and the original chart.</p>
</div>
<div class="browsable-container listing-container" id="p218">
<h5 class="listing-container-h5 browsable-container-h5"><span class="num-string">Listing 3.29</span> Combining the chart and the text labels</h5>
<div class="code-area-container">
<pre class="code-area">total = (chart + text).configure_axis(
    grid=False,
    titleFontSize=14,
    labelFontSize=12
).configure_title(
    fontSize=16,
    color='#80C11E'
).configure_view(
    strokeWidth=0
)

total</pre>
</div>
</div>
<div class="readable-text print-book-callout" id="p219">
<p><span class="print-book-callout-head">Note</span>  Use <code>+</code> to combine the two layers. Then, use <code>configure_axis()</code>, <code>configure_title()</code>, and <code>configure_view()</code> to set the global chart configurations.</p>
</div>
<div class="readable-text" id="p220">
<p>Figure 3.15 illustrates the resulting chart at the end of the information step.<span class="aframe-location"/></p>
</div>
<div class="browsable-container figure-container" id="p221">
<img alt="figure" height="594" src="../Images/3-15.png" width="1100"/>
<h5 class="figure-container-h5"><span class="num-string">Figure 3.15</span> The chart at the end of the information step</h5>
</div>
<div class="readable-text" id="p222">
<p>The next step of the DIKW pyramid is turning information into knowledge. So let us proceed.</p>
</div>
<div class="readable-text" id="p223">
<h3 class="readable-text-h3"><span class="num-string">3.3.2</span> From information to knowledge</h3>
</div>
<div class="readable-text" id="p224">
<p>Turning information into knowledge involves adding context to the chart. We add three types of context: an annotation showing the gap between the two lines, an annotation containing the data source, and a text explaining the causes of this gap.</p>
</div>
<div class="readable-text" id="p225">
<h4 class="readable-text-h4">Chart annotation</h4>
</div>
<div class="readable-text" id="p226">
<p><em>Chart annotation</em> aims to ease the audience’s life by making explicit the gap between the two lines. Figure 3.16 shows the annotation we are going to add to the chart. The annotation comprises two elements: a vertical line showing the gap between the two lines and a “big number” (BAN), a large number containing the gap value.<span class="aframe-location"/></p>
</div>
<div class="browsable-container figure-container" id="p227">
<img alt="figure" height="594" src="../Images/3-16.png" width="1100"/>
<h5 class="figure-container-h5"><span class="num-string">Figure 3.16</span> The chart with an explicit annotation on the gap between North America and the rest of the world</h5>
</div>
<div class="readable-text" id="p228">
<p>To draw the chart annotation, use <code>mark_line()</code> to draw the vertical line and <code>mark_ text()</code> to draw the text. The following listing describes how to render the previous annotations.</p>
</div>
<div class="browsable-container listing-container" id="p229">
<h5 class="listing-container-h5 browsable-container-h5"><span class="num-string">Listing 3.30</span> Adding the annotation</h5>
<div class="code-area-container">
<pre class="code-area">offset = 10000000                           <span class="aframe-location"/> #1
mask = df_melt['Year'] == 2021
na = df_melt[mask]['Diff'].values[0]    <span class="aframe-location"/> #2
oth = df_melt[mask]['Diff'].values[1]    <span class="aframe-location"/> #3

df_vline = pd.DataFrame({'y' : [oth - offset,na + offset], 
                         'x' : [2021,2021]})

line = alt.Chart(df_vline).mark_line(color='black').encode(
    y = 'y',
    x = 'x'
)    <span class="aframe-location"/> #4

df_ann = pd.DataFrame({'text' : ['367M'],
       'x' : [2022],
       'y' : [na + (oth-na)/2]})    <span class="aframe-location"/> #5

ann = alt.Chart(df_ann).mark_text(fontSize=30, align='left').encode(
    x = 'x',
    y = 'y',
    text = 'text'
)                 <span class="aframe-location"/> #6

total = chart + text + line + ann    <span class="aframe-location"/> #7
total = total.configure_axis(
    grid=False,
    titleFontSize=14,
    labelFontSize=12
).configure_title(
    fontSize=16,
    color='#80C11E'
).configure_view(
    strokeWidth=0
)

total</pre>
<div class="code-annotations-overlay-container">
     #1 Defines the distance between the vertical line and the last point in the country line
     <br/>#2 Calculates the last value for North America line
     <br/>#3 Calculates the last value for the other line
     <br/>#4 Draws the vertical line
     <br/>#5 Places the BAN at the middle of the vertical line
     <br/>#6 Draws the BAN
     <br/>#7 Combines the charts
     <br/>
</div>
</div>
</div>
<div class="readable-text print-book-callout" id="p230">
<p><span class="print-book-callout-head">Note</span>  Use the last data points of the lines of the continents as y-coordinates for the vertical line and the BAN. We have hardcoded the BAN value for simplicity. However, you can dynamically calculate it in a complex scenario. </p>
</div>
<div class="readable-text" id="p231">
<h4 class="readable-text-h4">Data source</h4>
</div>
<div class="readable-text" id="p232">
<p>Place the data source as a textual annotation immediately under the title.</p>
</div>
<div class="browsable-container listing-container" id="p233">
<h5 class="listing-container-h5 browsable-container-h5"><span class="num-string">Listing 3.31</span> Adding the data source</h5>
<div class="code-area-container">
<pre class="code-area">df_subtitle= pd.DataFrame({'text' : ['source: World Bank'], 
                            'href' : ' https://data.worldbank.org/indicator/SP.POP.TOTL' })

subtitle = alt.Chart(df_subtitle
                    ).mark_text(
                        y=0
                    ).encode(
                        text='text',
                        href='href'
                    )</pre>
</div>
</div>
<div class="readable-text print-book-callout" id="p234">
<p><span class="print-book-callout-head">Note</span>  Use the <code>mark_text()</code> mark to add a text to the chart. Also, set the <code>href</code> channel to the link to the data source.</p>
</div>
<div class="readable-text" id="p235">
<h4 class="readable-text-h4">Text annotation</h4>
</div>
<div class="readable-text" id="p236">
<p>Place the text annotation to the left of the graph to prepare your audience for the chart. The text explains the possible causes of the gap between North America and the other continents. The following listing describes how to add a text annotation to the chart.</p>
</div>
<div class="browsable-container listing-container" id="p237">
<h5 class="listing-container-h5 browsable-container-h5"><span class="num-string">Listing 3.32</span> Adding a text annotation</h5>
<div class="code-area-container">
<pre class="code-area">df_context = pd.DataFrame({'text' : ['Why this gap?',
                            '1. Lower Fertility Rate', 
                            '2. Lower Immigration Rate', 
                            '3. Higher Average Age'],
                           'y': [0,1,2,3]})

context = alt.Chart(df_context).mark_text(fontSize=14, align='left', dy=50).encode(
    y = alt.Y('y:O', axis=None),
    text = 'text',
    stroke = alt.condition(alt.datum.y == 0, alt.value('#80C11E'), alt.value('black')),
    strokeWidth = alt.condition(alt.datum.y == 0, alt.value(1), alt.value(0))
)

total = (context | (chart + text + line + ann + subtitle)).configure_axis(
    grid=False,
    titleFontSize=14,
    labelFontSize=12
).configure_title(
    fontSize=16,
    color='#80C11E'
).configure_view(
    strokeWidth=0
)

total.show()</pre>
</div>
</div>
<div class="readable-text print-book-callout" id="p238">
<p><span class="print-book-callout-head">Note</span>  Use <code>mark_text()</code> to draw the text. Then, combine the text annotation with the chart.</p>
</div>
<div class="readable-text" id="p239">
<p>Figure 3.17 shows the resulting chart at the end of the knowledge step.<span class="aframe-location"/></p>
</div>
<div class="browsable-container figure-container" id="p240">
<img alt="figure" height="462" src="../Images/3-17.png" width="1100"/>
<h5 class="figure-container-h5"><span class="num-string">Figure 3.17</span> The chart at the end of the knowledge step</h5>
</div>
<div class="readable-text intended-text" id="p241">
<p>The chart is almost ready. Let us proceed to the last step: turning knowledge into wisdom.</p>
</div>
<div class="readable-text" id="p242">
<h3 class="readable-text-h3"><span class="num-string">3.3.3</span> From knowledge to wisdom</h3>
</div>
<div class="readable-text" id="p243">
<p>Turning knowledge into wisdom involves adding a call to action. In the previous chapters, we added a simple call to action in the title, inviting the audience to do something. However, in a real scenario, the call to action must include a proposal of possible next steps, justified with appropriate resources. The next step invites the audience to do something concrete; thus, the situation depicted in the chart changes. For example, you can add the call to action as an additional chart, which describes the percentage of success of each possible alternative. In our example, we can add a bar chart with possible strategies to improve population growth in North America. The percentages in the example are imaginary and do not reflect reality—we’ve added them just to show how a call to action works. The following listing shows how to build the call to action as a bar chart and add it to the main chart.</p>
</div>
<div class="browsable-container listing-container" id="p244">
<h5 class="listing-container-h5 browsable-container-h5"><span class="num-string">Listing 3.33</span> Adding a call to action</h5>
<div class="code-area-container">
<pre class="code-area">df_cta = pd.DataFrame({
    'Strategy': ['Immigration Development', 'Enhance Family-Friendly Policies', 'Revitalize Rural Areas'],
    'Population Increase': [20, 30, 15]  # Sample population increase percentages
})

cta = alt.Chart(df_cta).mark_bar(color='#80C11E').encode(
    x='Population Increase:Q',
    y=alt.Y('Strategy:N', sort='-x', title=None),
    tooltip=['Strategy', 'Population Increase']
).properties(
    title='Strategies for population growth in North America',
)

total = alt.vconcat((context | (chart + text + line + ann)), cta,center=True).configure_axis(
    grid=False,
    titleFontSize=14,
    labelFontSize=12
).configure_title(
    fontSize=20,
    color='#80C11E',
    offset=10
).configure_view(
    strokeWidth=0
).configure_concat(
    spacing=50
)

total.show()</pre>
</div>
</div>
<div class="readable-text print-book-callout" id="p245">
<p><span class="print-book-callout-head">Note</span>  Draw a chart specifying the possible alternatives and their percentage of success.</p>
</div>
<div class="readable-text" id="p246">
<p>Figure 3.18 shows the final chart. Following the steps specified by the DIKW, we have transformed the raw chart of figure 3.11 into a data story.<span class="aframe-location"/></p>
</div>
<div class="browsable-container figure-container" id="p247">
<img alt="figure" height="735" src="../Images/3-18.png" width="1100"/>
<h5 class="figure-container-h5"><span class="num-string">Figure 3.18</span> The final chart at the end of the wisdom step</h5>
</div>
<div class="readable-text" id="p248">
<p>In this chapter, you have learned the basic concepts of Altair. In the next chapter, you’ll review the basic concepts of generative AI.</p>
</div>
<div class="readable-text" id="p249">
<h2 class="readable-text-h2">Summary</h2>
</div>
<ul>
<li class="readable-text" id="p250"> Vega and Vega-Lite are visualization grammars to define the visual aspects and interactive features of a chart by writing code in JSON format. </li>
<li class="readable-text" id="p251"> Altair is built at the top of Vega-Lite and offers a user-friendly API to build charts. The basic components of an Altair chart are encodings, marks, conditions, compound charts, interactivity, and configurations. </li>
<li class="readable-text" id="p252"> Encodings define how data attributes (like x-coordinates, y-coordinates, color, and size) are visually represented in the chart. </li>
<li class="readable-text" id="p253"> Marks are the visual elements in the chart, such as bars, points, lines, or areas. </li>
<li class="readable-text" id="p254"> Conditions specify how data attributes are mapped to visual properties based on different criteria. </li>
<li class="readable-text" id="p255"> Compound charts involve combining multiple charts into a single view. </li>
<li class="readable-text" id="p256"> Interactivity refers to the ability of the chart to respond or change based on user input or interactions. </li>
<li class="readable-text" id="p257"> Configurations encompass various settings to alter the appearance of the chart, such as adjusting axes, scales, or layout, to better convey the intended information or aesthetics. </li>
</ul>
<div class="readable-text" id="p258">
<h2 class="readable-text-h2">References</h2>
</div>
<div class="readable-text" id="p259">
<h3 class="readable-text-h3">Data visualization</h3>
</div>
<ul>
<li class="readable-text" id="p260"> Belorkar, A., Guntuku, S. C., Hora, S., and Kumar, A. (2020). <em>Interactive Data Visualization with Python</em>. Packt Publishing. </li>
<li class="readable-text" id="p261"> Abbott, D. (2024). <em>Everyday Data Visualization</em>. Manning Publications. </li>
</ul>
<div class="readable-text" id="p262">
<h3 class="readable-text-h3">Vega, Vega-Lite, and D3.js</h3>
</div>
<ul>
<li class="readable-text" id="p263"> Kats, P. and Katz, D. (2019). <em>Learn Python by Building Data Science Applications</em>. Packt Publications. </li>
<li class="readable-text" id="p264"> Meeks, E. and Dufour, A.M. (2024). <em>D3.js in Action</em>. Manning Publications. </li>
<li class="readable-text" id="p265"> <em>Vega: A Visualization Grammar</em>. (n.d.). <a href="https://vega.github.io/vega/">https://vega.github.io/vega/</a>.<span class="link-like"/> </li>
<li class="readable-text" id="p266"> <em>Vega-Lite: A Grammar of Interactive Graphics</em>. (n.d.). <a href="https://vega.github.io/vega-lite/">https://vega.github.io/vega-lite/</a>. </li>
</ul>
<div class="readable-text" id="p267">
<h3 class="readable-text-h3">Other</h3>
</div>
<ul>
<li class="readable-text" id="p268"> Knaflic, C. N. (2015). Storytelling with Data: A Data Visualization Guide for Business Professionals. John Wiley &amp; Sons. </li>
</ul>
</div></body></html>