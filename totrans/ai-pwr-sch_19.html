<html><head></head><body>
<div id="sbo-rt-content"><div class="readable-text" id="p1">
<h1 class="readable-text-h1"><span class="chapter-title-numbering"><span class="num-string">appendix A</span></span> <span class="chapter-title-text">Running the code examples</span></h1>
</div>
<div class="readable-text" id="p2">
<p>During your journey through <em>AI-Powered Search</em>, we walk through a lot of code and run software examples demonstrating the techniques within this book. This appendix shows you how to easily set up and run the accompanying source code so that you can experiment with live, running examples as you work through the material. We’ll cover how the book’s source code is packaged, pulling and building the source code, and working with Jupyter notebooks and Docker to run the examples.</p>
</div>
<div class="readable-text" id="p3">
<h2 class="readable-text-h2" id="sigil_toc_id_251"><span class="num-string">A.1</span> Overall structure of code examples</h2>
</div>
<div class="readable-text" id="p4">
<p>Building an AI-powered search system requires integrating many components and libraries. For our default search engine, we will use Apache Solr, which internally relies on Apache ZooKeeper. You can also swap out Solr with many other popular search engines and vector databases—see appendix B for instructions. </p>
</div>
<div class="readable-text intended-text" id="p5">
<p>For significant data processing and machine learning tasks, we use Apache Spark. We use Python as our programming language for all the code examples and rely on many Python library dependencies, in addition to other system dependencies (like Java), which several of our systems require. Of course, we also need to execute our code examples and see the results in a user-friendly way, which we accomplish with the use of Jupyter notebooks.</p>
</div>
<div class="readable-text intended-text" id="p6">
<p>Instead of installing dozens of software libraries and hundreds of dependencies to make this all work, we’ve made this process as easy as possible by packaging all of the book’s examples into Docker containers, which are already fully configured and and ready to use. This means there is only a single prerequisite you must install before running the code examples in this book: Docker.</p>
</div>
<div class="readable-text intended-text" id="p7">
<p>Docker enables the creation and running of tiny containers—fully functioning virtual machines that run only a lightweight operating system with all of the needed software and dependencies already installed and configured. This allows you to run the code on most operating systems (macOS, Windows, Linux) without having to configure any system-specific dependencies.</p>
</div>
<div class="readable-text intended-text" id="p8">
<p>Once all of the services are running, all of the code listings in the book will be available through Jupyter notebooks, which will serve as the interface for running through and experimenting with the code examples to see the resulting outputs. </p>
</div>
<div class="readable-text" id="p9">
<h2 class="readable-text-h2" id="sigil_toc_id_252"><span class="num-string">A.2</span> Pulling the source code</h2>
</div>
<div class="readable-text" id="p10">
<p>The source code accompanying this book is available on GitHub here: <a href="https://github.com/treygrainger/ai-powered-search">https://github.com/treygrainger/ai-powered-search</a>. To pull the code, either use an installed Git client or open up a command-line interface in your preferred development folder and run the following command:</p>
</div>
<div class="browsable-container listing-container" id="p11">
<div class="code-area-container">
<pre class="code-area">git clone https://github.com/treygrainger/ai-powered-search.git</pre>
</div>
</div>
<div class="readable-text" id="p12">
<p>You should now have a new folder in your current directory called ai-powered-search/ that contains all the source code for the book.</p>
</div>
<div class="readable-text intended-text" id="p13">
<p>If you don’t have Git installed or can’t pull the code through the preceding command, there is also an option on the website to download the source code as a zip file through your web browser, which you would then just need to unzip into your development folder.</p>
</div>
<div class="readable-text intended-text" id="p14">
<p>Feel free to rename or move the ai-powered-search/ folder if you wish; throughout the rest of this book, we’ll simply refer to this directory using the variable <code>$AIPS_HOME</code>. </p>
</div>
<div class="readable-text" id="p15">
<h2 class="readable-text-h2" id="sigil_toc_id_253"><span class="num-string">A.3</span> Building and running the code</h2>
</div>
<div class="readable-text" id="p16">
<p>As previously mentioned, Docker is the one key dependency you must install on your system to build and run the <em>AI-Powered Search</em> code examples. We will not cover this installation process here as it is system-dependent and changes from time to time. Please visit <a href="https://docker.com">https://docker.com</a> for download and installation instructions. We should also note that other container-management tools, like Podman, can be used instead of Docker, though we will not cover those here. </p>
</div>
<div class="readable-text intended-text" id="p17">
<p>Once you have Docker installed, make sure to change the directory in your command-line interface to the <code>$AIPS_HOME</code> directory (<code>cd</code> <code>$AIPS_HOME</code>). To build and run the codebase, you then just need to run the following command:</p>
</div>
<div class="browsable-container listing-container" id="p18">
<div class="code-area-container">
<pre class="code-area">docker compose up</pre>
</div>
</div>
<div class="readable-text" id="p19">
<p>Note that this command is equivalent to running <code>docker compose up solr</code>. The book’s codebase works with multiple search engines and vector databases, and that (optional) last argument allows you to specify which engine(s) you want to use (with Apache Solr being the default). If you wanted to use OpenSearch with the book, for example, you would run <code>docker compose up opensearch</code> instead. For more information on other supported search engines, see appendix B.</p>
</div>
<div class="readable-text print-book-callout" id="p20">
<p><span class="print-book-callout-head">TIP</span> <strong> </strong>The <code>docker compose up</code> command runs in the foreground of your console, which allows you to see all the logs streaming in real time, but this also means your containers will all die if you close the console. If you would like to instead run the containers in the background and close or continue using your console, you can pass in the <code>-d</code> or <code>--detach</code> parameter (<code>docker compose up -d</code>). If you launch it like this, be sure to explicitly run <code>docker compose --profile all down</code> when you are finished to stop the containers from running indefinitely in the background, consuming resources. </p>
</div>
<div class="readable-text" id="p21">
<p>This command will take a while to run the first time, as it pulls in all of the code, operating systems, and dependencies needed to build and run the software accompanying this book. Once the command finishes, however, you will have all of the necessary services (Jupyter, Spark, ZooKeeper, Solr, etc.) running in separate Docker containers.</p>
</div>
<div class="readable-text intended-text" id="p22">
<p>Now, to get started, simply open up your web browser and go to http://localhost:8888. This will redirect to the welcome screen listing all the book’s chapters and their corresponding Jupyter notebooks (figure A.1). You can now click on any of the chapters to start running their code examples.<span class="aframe-location"/></p>
</div>
<div class="browsable-container figure-container" id="p23">
<img alt="figure" height="379" src="../Images/APPA_F01_Grainger.png" width="1100"/>
<h5 class="figure-container-h5 sigil_not_in_toc"><span class="num-string">Figure A.1</span> Welcome screen. Once you see this, the <em>AI-Powered Search</em> containers are built and the Jupyter notebooks are running.</h5>
</div>
<div class="readable-text" id="p24">
<p>By default, the Jupyter Notebooks are loaded into a Jupyter Labs environment, which is a development environment for working with, debugging, and navigating notebooks. It allows you to open up and edit multiple notebooks at once (in separate tabs) and to navigate and modify the directory structure on the left side of the screen as you explore.</p>
</div>
<div class="readable-text intended-text" id="p25">
<p>If you just want to follow along with the book in a simpler environment, you can alternatively go to http://localhost:8888/notebooks and navigate the table of contents to follow along, one notebook at a time, as you progress through the book. We’ll use this simpler interface in the next section, though the same functionality (and more) is present in the default Jupyter Labs environment at http://localhost:8888. </p>
</div>
<div class="readable-text" id="p26">
<h2 class="readable-text-h2" id="sigil_toc_id_254"><span class="num-string">A.4</span> Working with Jupyter</h2>
</div>
<div class="readable-text" id="p27">
<p>Once you view the <code>welcome.ipynb</code> notebook, you’ll see a few data cells on the screen, including an introduction message, a “health check” script, and a table of contents to various notebooks containing executable examples from the book. </p>
</div>
<div class="readable-text intended-text" id="p28">
<p>If you’ve never used Jupyter before, it is a tool that lets you mix markup (usually instructions and explanation) and code in your browser, and to edit, run, and interact with the output from the code examples. This makes learning much easier, as you don’t have to use command-line tools and can instead interact entirely with ready-to-execute examples with the click of a button.</p>
</div>
<div class="readable-text intended-text" id="p29">
<p>You’ll notice a toolbar near the top of the screen (below the menu bar) that allows you to interact with the sections of content (called <em>cells</em>) within the notebook. You can use these tools to navigate up and down, to stop and restart the notebook, or to execute each cell sequentially using the Run button. </p>
</div>
<div class="readable-text intended-text" id="p30">
<p>In figure A.2, clicking Run while the healthcheck code cell is highlighted will result in the healthcheck executing to confirm that all Docker containers are running and that the services running within them are healthy and responding.<span class="aframe-location"/></p>
</div>
<div class="browsable-container figure-container" id="p31">
<img alt="figure" height="265" src="../Images/APPA_F02_Grainger.png" width="1100"/>
<h5 class="figure-container-h5 sigil_not_in_toc"><span class="num-string">Figure A.2</span> Running code examples. Clicking Run in the toolbar will execute any examples in the current cell (if any) and proceed to the next cell.</h5>
</div>
<div class="readable-text" id="p32">
<p>Figure A.3 shows the response you will see when everything is running as expected.<span class="aframe-location"/></p>
</div>
<div class="browsable-container figure-container" id="p33">
<img alt="figure" height="544" src="../Images/APPA_F03_Grainger.png" width="1100"/>
<h5 class="figure-container-h5 sigil_not_in_toc"><span class="num-string">Figure A.3</span> Healthcheck success. You should see this message if everything is running correctly.</h5>
</div>
<div class="readable-text" id="p34">
<p>At this point, you can scroll down to the table of contents and proceed through the notebooks for each chapter. Of course, since the explanation behind the examples is contained within the book, you’ll probably prefer to work through the examples as you’re reading the book so that you have the appropriate background when running them. The Jupyter notebooks are not intended to be standalone examples, so you’ll probably want to keep the book close by to provide context.</p>
</div>
<div class="readable-text intended-text" id="p35">
<p>All Jupyter notebooks are designed to be independently idempotent. This means that, while all steps in a notebook need to be executed in order to guarantee a successful result, you can always start over at the beginning of any notebook, and it will “reset” to the expected results necessary to make the subsequent steps succeed. If ever you experience errors in a notebook, just go back to the first cell on the page and run through the whole notebook again. </p>
</div>
<div class="readable-text" id="p36">
<h2 class="readable-text-h2" id="sigil_toc_id_255"><span class="num-string">A.5</span> Working with Docker</h2>
</div>
<div class="readable-text" id="p37">
<p>While everything in the previous sections should work as expected, it’s of course possible that you could run into problems along the way. The most likely challenge you’ll face is having one of your Docker containers, or the service running inside of it, fail. It’s also possible, if you’re making changes to underlying data or config in one of the services, for example, that you could put it in a bad state. </p>
</div>
<div class="readable-text intended-text" id="p38">
<p>When this happens, you can always tear down your containers and start over. To do this, just run this command from the <code>$AIPS_HOME</code> directory:</p>
</div>
<div class="browsable-container listing-container" id="p39">
<div class="code-area-container">
<pre class="code-area">docker compose --profile all down &amp;&amp; docker compose up</pre>
</div>
</div>
<div class="readable-text" id="p40">
<p>Keep in mind that if you’ve made any changes to your notebooks or code, any work you’ve done will be lost when you run <code>docker</code> <code>compose</code> <code>--profile</code> <code>all</code> <code>down</code>. In general, the examples are designed to be transient. If you want to preserve your work across container rebuilds, you can modify the docker-compose.yaml file to mount folders to your local drive or use Docker data volumes marked as <code>external</code> that will be persistent. Please refer to the Docker documentation if you plan to make changes there, as the mechanisms and APIs can change from time to time. </p>
</div>
<div class="readable-text intended-text" id="p41">
<p>If you ever modify the code examples or your configuration, it’s also possible you may need to rebuild your Docker images. When you run <code>docker compose up</code> the first time, it will pull or build your images and start them, but it doesn’t rebuild with changes made after the first build. To rebuild everything prior to restarting your Docker containers, you can instead run this command:</p>
</div>
<div class="browsable-container listing-container" id="p42">
<div class="code-area-container">
<pre class="code-area">docker compose up --build</pre>
</div>
</div>
<div class="readable-text" id="p43">
<p>If you just want to temporarily stop your running Docker containers and resume them later, you can also run <code>docker</code> <code>compose</code> <code>--profile</code> <code>all</code> <code>stop</code> to stop, and then <code>docker compose start</code> later to resume. This is helpful if you want to preserve any changes you’ve made without resetting to a clean version of the notebooks on the next start. </p>
</div>
<div class="readable-text intended-text" id="p44">
<p>This should give you everything you need to run through all of the notebooks and code in <em>AI-Powered Search</em>. </p>
</div>
</div></body></html>