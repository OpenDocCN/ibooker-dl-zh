["```py\nimport torch\nfrom transformers import AutoTokenizer, AutoModelForCausalLM\n\ndevice = \"cuda\" if torch.cuda.is_available() else \"cpu\"\nmodel_name = \"gpt2-xl\"\ntokenizer = AutoTokenizer.from_pretrained(model_name)\nmodel = AutoModelForCausalLM.from_pretrained(model_name).to(device)\n```", "```py\nimport pandas as pd\n\ninput_txt = \"Transformers are the\"\ninput_ids = tokenizer(input_txt, return_tensors=\"pt\")[\"input_ids\"].to(device)\niterations = []\nn_steps = 8\nchoices_per_step = 5\n\nwith torch.no_grad():\n    for _ in range(n_steps):\n        iteration = dict()\n        iteration[\"Input\"] = tokenizer.decode(input_ids[0])\n        output = model(input_ids=input_ids)\n        # Select logits of the first batch and the last token and apply softmax\n        next_token_logits = output.logits[0, -1, :]\n        next_token_probs = torch.softmax(next_token_logits, dim=-1)\n        sorted_ids = torch.argsort(next_token_probs, dim=-1, descending=True)\n        # Store tokens with highest probabilities\n        for choice_idx in range(choices_per_step):\n            token_id = sorted_ids[choice_idx]\n            token_prob = next_token_probs[token_id].cpu().numpy()\n            token_choice = (\n                f\"{tokenizer.decode(token_id)} ({100 * token_prob:.2f}%)\"\n            )\n            iteration[f\"Choice {choice_idx+1}\"] = token_choice\n        # Append predicted next token to input\n        input_ids = torch.cat([input_ids, sorted_ids[None, 0, None]], dim=-1)\n        iterations.append(iteration)\n\npd.DataFrame(iterations)\n```", "```py\ninput_ids = tokenizer(input_txt, return_tensors=\"pt\")[\"input_ids\"].to(device)\noutput = model.generate(input_ids, max_new_tokens=n_steps, do_sample=False)\nprint(tokenizer.decode(output[0]))\n```", "```py\nTransformers are the most popular toy line in the world,\n```", "```py\nmax_length = 128\ninput_txt = \"\"\"In a shocking finding, scientist discovered \\\na herd of unicorns living in a remote, previously unexplored \\\nvalley, in the Andes Mountains. Even more surprising to the \\\nresearchers was the fact that the unicorns spoke perfect English.\\n\\n `\"\"\"`\n`input_ids` `=` `tokenizer``(``input_txt``,` `return_tensors``=``\"pt\"``)[``\"input_ids\"``]``.``to``(``device``)`\n`output_greedy` `=` `model``.``generate``(``input_ids``,` `max_length``=``max_length``,`\n                               `do_sample``=``False``)`\n`print``(``tokenizer``.``decode``(``output_greedy``[``0``]))`\n```", "```py`\nIn a shocking finding, scientist discovered a herd of unicorns living in a\nremote, previously unexplored valley, in the Andes Mountains. Even more\nsurprising to the researchers was the fact that the unicorns spoke perfect\nEnglish.\n\nThe researchers, from the University of California, Davis, and the University of\nColorado, Boulder, were conducting a study on the Andean cloud forest, which is\nhome to the rare species of cloud forest trees.\n\nThe researchers were surprised to find that the unicorns were able to\ncommunicate with each other, and even with humans.\n\nThe researchers were surprised to find that the unicorns were able\n```", "```py\n0.5 ** 1024\n```", "```py\n5.562684646268003e-309\n```", "```py\nimport numpy as np\n\nsum([np.log(0.5)] * 1024)\n```", "```py\n-709.7827128933695\n```", "```py\nimport torch.nn.functional as F\n\ndef log_probs_from_logits(logits, labels):\n    logp = F.log_softmax(logits, dim=-1)\n    logp_label = torch.gather(logp, 2, labels.unsqueeze(2)).squeeze(-1)\n    return logp_label\n```", "```py\ndef sequence_logprob(model, labels, input_len=0):\n    with torch.no_grad():\n        output = model(labels)\n        log_probs = log_probs_from_logits(\n            output.logits[:, :-1, :], labels[:, 1:])\n        seq_log_prob = torch.sum(log_probs[:, input_len:])\n    return seq_log_prob.cpu().numpy()\n```", "```py\nlogp = sequence_logprob(model, output_greedy, input_len=len(input_ids[0]))\nprint(tokenizer.decode(output_greedy[0]))\nprint(f\"\\nlog-prob: {logp:.2f}\")\n```", "```py\nIn a shocking finding, scientist discovered a herd of unicorns living in a\nremote, previously unexplored valley, in the Andes Mountains. Even more\nsurprising to the researchers was the fact that the unicorns spoke perfect\nEnglish.\n\nThe researchers, from the University of California, Davis, and the University of\nColorado, Boulder, were conducting a study on the Andean cloud forest, which is\nhome to the rare species of cloud forest trees.\n\nThe researchers were surprised to find that the unicorns were able to\ncommunicate with each other, and even with humans.\n\nThe researchers were surprised to find that the unicorns were able\n\nlog-prob: -87.43\n```", "```py\noutput_beam = model.generate(input_ids, max_length=max_length, num_beams=5,\n                             do_sample=False)\nlogp = sequence_logprob(model, output_beam, input_len=len(input_ids[0]))\nprint(tokenizer.decode(output_beam[0]))\nprint(f\"\\nlog-prob: {logp:.2f}\")\n```", "```py\nIn a shocking finding, scientist discovered a herd of unicorns living in a\nremote, previously unexplored valley, in the Andes Mountains. Even more\nsurprising to the researchers was the fact that the unicorns spoke perfect\nEnglish.\n\nThe discovery of the unicorns was made by a team of scientists from the\nUniversity of California, Santa Cruz, and the National Geographic Society.\n\nThe scientists were conducting a study of the Andes Mountains when they\ndiscovered a herd of unicorns living in a remote, previously unexplored valley,\nin the Andes Mountains. Even more surprising to the researchers was the fact\nthat the unicorns spoke perfect English\n\nlog-prob: -55.23\n```", "```py\noutput_beam = model.generate(input_ids, max_length=max_length, num_beams=5,\n                             do_sample=False, no_repeat_ngram_size=2)\nlogp = sequence_logprob(model, output_beam, input_len=len(input_ids[0]))\nprint(tokenizer.decode(output_beam[0]))\nprint(f\"\\nlog-prob: {logp:.2f}\")\n```", "```py\nIn a shocking finding, scientist discovered a herd of unicorns living in a\nremote, previously unexplored valley, in the Andes Mountains. Even more\nsurprising to the researchers was the fact that the unicorns spoke perfect\nEnglish.\n\nThe discovery was made by a team of scientists from the University of\nCalifornia, Santa Cruz, and the National Geographic Society.\n\nAccording to a press release, the scientists were conducting a survey of the\narea when they came across the herd. They were surprised to find that they were\nable to converse with the animals in English, even though they had never seen a\nunicorn in person before. The researchers were\n\nlog-prob: -93.12\n```", "```py\noutput_temp = model.generate(input_ids, max_length=max_length, do_sample=True,\n                             temperature=2.0, top_k=0)\nprint(tokenizer.decode(output_temp[0]))\n```", "```py\nIn a shocking finding, scientist discovered a herd of unicorns living in a\nremote, previously unexplored valley, in the Andes Mountains. Even more\nsurprising to the researchers was the fact that the unicorns spoke perfect\nEnglish.\n\nWhile the station aren protagonist receive Pengala nostalgiates tidbitRegarding\nJenny loclonju AgreementCON irrational \ufffdrite Continent seaf A jer Turner\nDorbecue WILL Pumpkin mere Thatvernuildagain YoAniamond disse *\nRunewitingkusstemprop});b zo coachinginventorymodules deflation press\nVaticanpres Wrestling chargesThingsctureddong Ty physician PET KimBi66 graz Oz\nat aff da temporou MD6 radi iter\n```", "```py\noutput_temp = model.generate(input_ids, max_length=max_length, do_sample=True,\n                             temperature=0.5, top_k=0)\nprint(tokenizer.decode(output_temp[0]))\n```", "```py\nIn a shocking finding, scientist discovered a herd of unicorns living in a\nremote, previously unexplored valley, in the Andes Mountains. Even more\nsurprising to the researchers was the fact that the unicorns spoke perfect\nEnglish.\n\nThe scientists were searching for the source of the mysterious sound, which was\nmaking the animals laugh and cry.\n\nThe unicorns were living in a remote valley in the Andes mountains\n\n'When we first heard the noise of the animals, we thought it was a lion or a\ntiger,' said Luis Guzman, a researcher from the University of Buenos Aires,\nArgentina.\n\n'But when\n```", "```py\noutput_topk = model.generate(input_ids, max_length=max_length, do_sample=True,\n                             top_k=50)\nprint(tokenizer.decode(output_topk[0]))\n```", "```py\nIn a shocking finding, scientist discovered a herd of unicorns living in a\nremote, previously unexplored valley, in the Andes Mountains. Even more\nsurprising to the researchers was the fact that the unicorns spoke perfect\nEnglish.\n\nThe wild unicorns roam the Andes Mountains in the region of Cajamarca, on the\nborder with Argentina (Picture: Alamy/Ecole Nationale Sup\u00e9rieure d'Histoire\nNaturelle)\n\nThe researchers came across about 50 of the animals in the valley. They had\nlived in such a remote and isolated area at that location for nearly a thousand\nyears that\n```", "```py\noutput_topp = model.generate(input_ids, max_length=max_length, do_sample=True,\n                             top_p=0.90)\nprint(tokenizer.decode(output_topp[0]))\n```", "```py\nIn a shocking finding, scientist discovered a herd of unicorns living in a\nremote, previously unexplored valley, in the Andes Mountains. Even more\nsurprising to the researchers was the fact that the unicorns spoke perfect\nEnglish.\n\nThe scientists studied the DNA of the animals and came to the conclusion that\nthe herd are descendants of a prehistoric herd that lived in Argentina about\n50,000 years ago.\n\nAccording to the scientific analysis, the first humans who migrated to South\nAmerica migrated into the Andes Mountains from South Africa and Australia, after\nthe last ice age had ended.\n\nSince their migration, the animals have been adapting to\n```"]