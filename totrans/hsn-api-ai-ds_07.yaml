- en: Chapter 6\. Deploying Your API to the Cloud
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: It sounds a little extreme, but in this day and age, if your work isn’t online,
    it doesn’t exist.
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: ''
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Austin Kleon, *Show Your Work! 10 Ways to Share Your Creativity and Get Discovered*
    (Workman, 2014)
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: You have made great progress with your first API. You have selected the most
    important qualities for your users, developed multiple API endpoints, and created
    user-friendly documentation. In this chapter, you will publish your API to the
    cloud, where consumers can access it. This is another chance to share what you
    have been working on.
  prefs: []
  type: TYPE_NORMAL
- en: Benefits and Responsibilities of Cloud Deployment
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: The *cloud* is an informal term to refer to the collection of computer servers
    and connecting infrastructure that make the public internet. For a developer or
    data scientist, a great way to deploy prototypes and personal projects is through
    public cloud hosts. Before these became available, the process of running side
    projects was laborious and the capabilities were pretty limited. As a simple example,
    before cloud hosts became available to developers, hosting your software on a
    server required purchasing the physical server. When you finished with your project,
    you still had that server sitting around. With the cloud you can spin up a virtual
    server with a few commands, and when you are finished you can delete it. Now you
    have a great opportunity to deploy your work to a public cloud host with all of
    the networking and application hosting power that you can imagine (or at least
    afford).
  prefs: []
  type: TYPE_NORMAL
- en: Benefits
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Cloud platforms allow you several great opportunities for the project in this
    book:'
  prefs: []
  type: TYPE_NORMAL
- en: You can learn the end-to-end process of cloud development, deployment, and operations
    with the project that you developed.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: You can share it with others as part of your portfolio project. This fast feedback
    loop allows you to learn and improve much more quickly.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: With the published API, you can use internet-facing tools and products to explore
    from the user’s perspective. This is the focus of [Part II](part02.html#part_2)
    of this book.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: You can use generative AI services to consume the API. This is the focus of
    [Part III](part03.html#part_3) of this book.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: I have found that deploying an application to the web makes the project real
    in a way that isn’t possible when it is only running in a development environment.
  prefs: []
  type: TYPE_NORMAL
- en: Responsibilities
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: You should be aware that deploying to the internet comes with a few responsibilities
    as well, the first of which is cost. Cloud providers offer paid services, and
    they generally charge a variable amount based on the amount of usage of the applications
    that are hosted. Although some of the cloud providers used in this chapter have
    a free tier of services or starter credits, they will require a debit or credit
    card to be added to the account. When you are developing projects on a cloud host,
    it’s not uncommon to have a surprise bill at the end of the month for several
    dollars. There are also horror stories of people who ended up with unexpected
    bills costing hundreds or thousands of dollars. I will share some tips about cost
    management, but you should take care not to sign up for any services that you
    can’t afford. (When deploying the example applications in this chapter, I spent
    less than $1 USD to host them for several weeks on all the services combined.
    But your costs could be greater.)
  prefs: []
  type: TYPE_NORMAL
- en: Warning
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
- en: Another responsibility is security. Using the phrase *expose your API endpoint*
    gives you a hint of this responsibility—when you make your work available to the
    world, bad actors can access it. If your portfolio project contains fantasy sports
    data, you won’t be putting any personal data at risk. However, if you are careless
    with the credentials you use to connect to the cloud services, you could expose
    usernames, passwords, and API keys publicly. This could allow a fraudster to use
    your accounts to run up large bills mining crypto or creating bot armies to attack
    websites.
  prefs: []
  type: TYPE_NORMAL
- en: 'There are several ways to control costs when using cloud hosts:'
  prefs: []
  type: TYPE_NORMAL
- en: Review the costs of services before using them. There are usually several services
    involved in a coding project. Use cost calculators if available.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Use services with free tiers and free trial periods.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Create monthly budgets and set up email notifications to notify you when you
    are approaching budgeted amounts.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Shut down or delete resources after use.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: When you have finished working with a cloud host, clean up resources and remove
    your payment method.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Keep tight control of your login credentials.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Use short-lived access keys.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Only activate the permissions for specific services you are using, and disable
    them after you are done.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Do not commit any credentials into source control repositories.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: If any credentials do become exposed, deactivate or delete them. Contact support
    of the cloud host if necessary.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Choosing a Cloud Host for Your Project
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: I have used a variety of cloud hosts to deploy prototypes and portfolio projects,
    and their capabilities and pricing models change over time. When I am deciding
    what host to use, I first decide what my primary focus is at the time. If I am
    just focused on getting my app out into the world, I choose the host that is simplest
    to deploy. If I want to learn about a specific cloud host or some of its underlying
    technical services, I am more willing to put in the time (and often pay a bit
    in hosting fees) to learn the deployment process for that host. When I am trying
    to practice some deployment or operational technique such as continuous integration
    (CI) or containerization, I select a host that supports that particular method
    and use it to deploy my app.
  prefs: []
  type: TYPE_NORMAL
- en: This chapter includes instructions for deploying to two cloud hosts, and I would
    encourage you to try out both of them to see the advantages and disadvantages
    of each. You will begin by using Render, which is fairly simple to deploy. Then,
    you will install and configure the Docker containerization tool, which you will
    use to deploy to Amazon Web Services (AWS).
  prefs: []
  type: TYPE_NORMAL
- en: '[Table 6-1](#tools_table_chapter_6) displays the new tools or services you
    will use in this chapter.'
  prefs: []
  type: TYPE_NORMAL
- en: Table 6-1\. New tools or services used in this chapter
  prefs: []
  type: TYPE_NORMAL
- en: '| Software or service name | Version | Purpose |'
  prefs: []
  type: TYPE_TB
- en: '| --- | --- | --- |'
  prefs: []
  type: TYPE_TB
- en: '| Amazon Lightsail | NA | AWS virtual cloud server |'
  prefs: []
  type: TYPE_TB
- en: '| AWS CLI | 2.15 | Command-line interface for AWS services |'
  prefs: []
  type: TYPE_TB
- en: '| Docker | 24.0 | Pack and run your application in a container |'
  prefs: []
  type: TYPE_TB
- en: '| Render | NA | Cloud hosting provider |'
  prefs: []
  type: TYPE_TB
- en: Setting Up Your Project Directory
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'To continue your portfolio project where you left it in the previous chapter,
    change the directory to *chapter6* and then copy the previous chapter’s files
    into it. The following shows the commands and expected output:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE0]'
  prefs: []
  type: TYPE_PRE
- en: Using GitHub Codespaces as a Cloud Host
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: For intermittent cloud hosting, GitHub Codespaces may be sufficient. It will
    only be available while your Codespace is running, but this can be useful for
    testing with an external tool or sharing it with someone else to review.
  prefs: []
  type: TYPE_NORMAL
- en: When you first run the API in your Codespace, you will see a dialog stating
    “Your application running on port 8000 is available,” as shown in [Figure 6-1](#make_api_public_ch6).
    Click Make Public.
  prefs: []
  type: TYPE_NORMAL
- en: '![Make API Public](assets/haad_0601.png)'
  prefs: []
  type: TYPE_IMG
- en: Figure 6-1\. Making the API public
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
- en: The API is now running in Codespaces with a public port. To view the API in
    the browser, click Ports in the terminal and hover over Port 8000 as shown in
    [Figure 6-2](#api_running_public_port_6).
  prefs: []
  type: TYPE_NORMAL
- en: '![Open API on public address](assets/haad_0602.png)'
  prefs: []
  type: TYPE_IMG
- en: Figure 6-2\. Open API on a public address
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
- en: 'Click the globe icon, and the web browser should be opened to the health check
    endpoint of your API. If you look at the address in your browser, you should see
    a base URL that ends in *app.github.dev*. The browser page should show the response
    from your API running on Codespaces. You should see the following health check
    message in your web browser:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE1]'
  prefs: []
  type: TYPE_PRE
- en: Your API is running publicly in the cloud.
  prefs: []
  type: TYPE_NORMAL
- en: Deploying to Render
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Render calls itself “a unified cloud to build and run all your apps and websites.”
    At the time of this writing, Render has a pricing plan that includes Python hosting
    for free, except for a small cost for monthly storage. You will be generally following
    the instructions from [Deploy a FastAPI App](https://oreil.ly/nmdaK).
  prefs: []
  type: TYPE_NORMAL
- en: The process of deploying to Render only involves a few steps, as shown in [Figure 6-3](#deploying_render_diagram_ch4).
  prefs: []
  type: TYPE_NORMAL
- en: '![Deploying your API to Render](assets/haad_0603.png)'
  prefs: []
  type: TYPE_IMG
- en: Figure 6-3\. Deploying your API to Render
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
- en: Signing Up for Render
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: The first step is to [sign up for a Render account](https://oreil.ly/rend).
    You can create a new account or use one of the existing services, such as GitHub
    or Google. It should work the same either way. When you have created your account
    and provided the information requested, you should see the Render dashboard with
    no services.
  prefs: []
  type: TYPE_NORMAL
- en: Creating a New Web Service
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: From the New menu, select Web Service.
  prefs: []
  type: TYPE_NORMAL
- en: On the New Web Service page, select Public Git Repository, enter the URL of
    your GitHub repo, as shown in [Figure 6-4](#render_choose_git_ch6), and click
    Connect.
  prefs: []
  type: TYPE_NORMAL
- en: '![Choosing how to deploy your web service](assets/haad_0604.png)'
  prefs: []
  type: TYPE_IMG
- en: Figure 6-4\. Choosing how to deploy a web service
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
- en: The next page should say “You are deploying a Web Service,” as shown in [Figure 6-5](#render_service_page_ch6).
  prefs: []
  type: TYPE_NORMAL
- en: '![Render web service settings](assets/haad_0605.png)'
  prefs: []
  type: TYPE_IMG
- en: Figure 6-5\. Render web service settings
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
- en: 'Enter the settings on this page as follows:'
  prefs: []
  type: TYPE_NORMAL
- en: '*Name*: Enter an available unique name.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '*Project*: Do not create a project.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '*Language*: **`Python 3`**'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '*Branch*: **`main`**'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '*Region*: Select the region nearest you.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '*Root directory*: **`chapter6`**'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '*Build command*: **`pip install -r requirements.txt`**'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '*Start command*: **`uvicorn main:app --host 0.0.0.0 --port $PORT`**'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '*Instance type*: **`Free`**'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Notice that the start command did not use `fastapi run` as you used on the command
    line. For the web deployments, you are directly using the Uvicorn web server to
    run the API without using the fastapi-cli library.
  prefs: []
  type: TYPE_NORMAL
- en: Scroll to the bottom of the page, and select Deploy Web Service. A page should
    be displayed with a deployment log. As you watch, you should see the cloud host
    installing the software from your *requirements.txt* file and starting an instance
    of your application. When the process completes successfully, you should see the
    statement “Your service is live,” as shown in [Figure 6-6](#successful_render_deploy).
  prefs: []
  type: TYPE_NORMAL
- en: '![Render successfully deployed](assets/haad_0606.png)'
  prefs: []
  type: TYPE_IMG
- en: Figure 6-6\. Successful deployment on Render
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
- en: Copy the URL of your web service that is displayed near the top of the window.
    (In this example, the address is *[*https://football-api-service.onrender.com*](https://football-api-service.onrender.com)*).
    Paste this URL into another browser window. You should see the health check message
    of your API. If you access the */docs* endpoint, you can use Swagger UI to check
    that the rest of the endpoints are returning data. Congratulations! You have deployed
    your API to the first cloud host!
  prefs: []
  type: TYPE_NORMAL
- en: Tip
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
- en: If you receive an error in the deployment, verify that you committed the [Chapter 6](#chapter_6)
    code to your repository prior to deploying.
  prefs: []
  type: TYPE_NORMAL
- en: Auto-Deploying a Change to Your API
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'By default, Render is set to auto-deploy any changes you make to files in your
    repository’s *chapter6* folder. Test this by modifying the health-check endpoint
    in *main.py* with the following message:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE2]'
  prefs: []
  type: TYPE_PRE
- en: Commit these changes to your GitHub repository.
  prefs: []
  type: TYPE_NORMAL
- en: Open your web service from the [Render dashboard](https://dashboard.render.com)
    and select Events. The most recent event should be a new deployment. After a few
    minutes, you should see the updated health check text when you access the web
    service in your browser.
  prefs: []
  type: TYPE_NORMAL
- en: In the next section, you will configure your application to run on Docker, which
    will be used by AWS Lightsail.
  prefs: []
  type: TYPE_NORMAL
- en: Shipping Your Application in a Docker Container
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Whereas Render deployed your application from a source code repository (GitHub),
    AWS will use an application named Docker. Docker is a very useful tool for shipping
    applications in *containers*. Just as cargo is shipped in a shipping container,
    applications are shipped in a software container.
  prefs: []
  type: TYPE_NORMAL
- en: The [Docker glossary](https://oreil.ly/TyStu) explains a few key terms that
    you will use. A *Dockerfile* is “a text document that contains all the commands
    you would normally execute manually to build a Docker image.” The *container image*,
    or Docker image, is “an ordered collection of root filesystem changes and the
    corresponding execution parameters for use within a container runtime.” A *repository*
    is a set of Docker images. A *container runtime* is software that uses the image
    to create a container, which is a runtime instance of a container image. You will
    use Docker as your container runtime.
  prefs: []
  type: TYPE_NORMAL
- en: You will first learn the process of using Docker to run your application locally,
    and then build on that knowledge to deploy to AWS Lightsail.
  prefs: []
  type: TYPE_NORMAL
- en: Don’t worry if all of this information does not make sense yet. As you go through
    the process of deploying the application in the three different environments,
    you will begin to see the purpose of the tasks.
  prefs: []
  type: TYPE_NORMAL
- en: '[Table 6-2](#docker_commands_ch6) has a summary of Docker commands you will
    use in this chapter. A full list of commands is available on the [Docker cheat
    sheet](https://oreil.ly/Prc1P).'
  prefs: []
  type: TYPE_NORMAL
- en: Table 6-2\. Docker commands
  prefs: []
  type: TYPE_NORMAL
- en: '| Command | Purpose |'
  prefs: []
  type: TYPE_TB
- en: '| --- | --- |'
  prefs: []
  type: TYPE_TB
- en: '| `docker --version` | Verify what version of the library is installed. |'
  prefs: []
  type: TYPE_TB
- en: '| `docker build -t` | Build an image from a Dockerfile. |'
  prefs: []
  type: TYPE_TB
- en: '| `docker images` | List local images in your environment. |'
  prefs: []
  type: TYPE_TB
- en: '| `docker run` | Run a container from a local image. |'
  prefs: []
  type: TYPE_TB
- en: Verifying Docker Installation
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: If you are using GitHub Codespaces, Docker should come preloaded for you. Otherwise,
    follow the instructions on the [Get Docker page](https://oreil.ly/jUGKm) to install
    the appropriate version for your development environment.
  prefs: []
  type: TYPE_NORMAL
- en: 'Verify that Docker is installed by executing the command **`docker --version`**,
    which should return the version and build number, such as the following:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE3]'
  prefs: []
  type: TYPE_PRE
- en: 'You will perform a couple of fairly simple steps:'
  prefs: []
  type: TYPE_NORMAL
- en: Create a Dockerfile.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Build a container image from this Dockerfile.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Run a container based on this image.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Let’s get started.
  prefs: []
  type: TYPE_NORMAL
- en: Creating a Dockerfile
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'A *Dockerfile* contains the instructions that Docker will use to create a container
    image. Keep in mind that the statements will be executed in the `docker build`
    step that you will initiate. Create a file named *chapter6/Dockerfile*:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE4]'
  prefs: []
  type: TYPE_PRE
- en: 'Update *chapter6/Dockerfile* with the following contents:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE5]'
  prefs: []
  type: TYPE_PRE
- en: '[![1](assets/1.png)](#co_deploying_your_api_to_the_cloud_CO1-1)'
  prefs: []
  type: TYPE_NORMAL
- en: This chooses the *parent image*, which is the official Python 3.10 slim Docker
    image in this case. This image already contains most of the items you will need
    to run your application. That allows you to focus on adding your code and any
    custom libraries.
  prefs: []
  type: TYPE_NORMAL
- en: '[![2](assets/2.png)](#co_deploying_your_api_to_the_cloud_CO1-2)'
  prefs: []
  type: TYPE_NORMAL
- en: This statement sets a working directory inside the container image. This working
    directory is where the remaining commands will be executed unless otherwise specified.
  prefs: []
  type: TYPE_NORMAL
- en: '[![3](assets/3.png)](#co_deploying_your_api_to_the_cloud_CO1-3)'
  prefs: []
  type: TYPE_NORMAL
- en: 'This copies the *requirements.txt* file from *context*, which is a set of files
    in a location that you will specify when you execute the build statement. (Spoiler
    alert: in this chapter, you will be using the *chapter6* directory as the context,
    so the context includes all the files in this folder.)'
  prefs: []
  type: TYPE_NORMAL
- en: '[![4](assets/4.png)](#co_deploying_your_api_to_the_cloud_CO1-4)'
  prefs: []
  type: TYPE_NORMAL
- en: 'This uses `pip` to install the specified libraries in your *requirements.txt*
    file into a new layer in the Docker image. A Docker container image is like a
    brand-new virtual server: you have complete control of the libraries and versions
    that are contained in it so that your application works correctly.'
  prefs: []
  type: TYPE_NORMAL
- en: '[![5](assets/5.png)](#co_deploying_your_api_to_the_cloud_CO1-5)'
  prefs: []
  type: TYPE_NORMAL
- en: These two statements copy your Python program files and SQLite database from
    the context directory to your Docker working directory.
  prefs: []
  type: TYPE_NORMAL
- en: '[![6](assets/6.png)](#co_deploying_your_api_to_the_cloud_CO1-6)'
  prefs: []
  type: TYPE_NORMAL
- en: After steps 1 through 5 have built the container image, this step sets the default
    command that will be executed each time a container is launched from that image
    using the `docker run` command. As you did with the Render deployment, you are
    directly calling Uvicorn to run the API.
  prefs: []
  type: TYPE_NORMAL
- en: These are all the instructions you need to define your container image. The
    next step will be to build the container image in your local repository.
  prefs: []
  type: TYPE_NORMAL
- en: Creating a .dockerignore File
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Just like *.gitignore* excludes files from version control, you want to exclude
    some files in your directory from the Docker image. Create a file named *.dockerignore*
    with the following contents:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE6]'
  prefs: []
  type: TYPE_PRE
- en: Building a Container Image
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'To put this Dockerfile to use, enter the following command at the command line:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE7]'
  prefs: []
  type: TYPE_PRE
- en: This tells Docker to build an image (`apicontainerimage`) using the Dockerfile
    in the current directory. The container image will be stored in your local Docker
    repository.
  prefs: []
  type: TYPE_NORMAL
- en: 'You should see multiple steps being executed. The first time you run this command,
    this may take several minutes. Future builds will take less time because Docker
    can cache items that do not change. You should see something similar to the following
    when it is completed:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE8]'
  prefs: []
  type: TYPE_PRE
- en: 'To verify that the image was created successfully, enter the command **`docker
    images`** to view the images in your repository. You should see something like
    the following:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE9]'
  prefs: []
  type: TYPE_PRE
- en: Running Your Container Image Locally
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: You use the `docker run` command to run a container based on this image. There
    are just a couple of options to notice here. The statement `--publish 80:80` maps
    port 80 inside the Docker container (the second `80`) to port 80 on your local
    environment (the first `80`). The statement `--name apicontainer1` sets the name
    of the container that you will be using. This is a convenient way to reference
    the running container (Docker will also assign an image ID). Finally, `apicontainerimage`
    passes the image name that you built in the previous step. Remember, the image
    is used to run a container.
  prefs: []
  type: TYPE_NORMAL
- en: 'Execute the following command:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE10]'
  prefs: []
  type: TYPE_PRE
- en: 'You should see the following:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE11]'
  prefs: []
  type: TYPE_PRE
- en: You will see the message “Your application running on port 80 is available.”
    Select “Open in Browser” to run the API in the web browser. You should see the
    health check message in the window, exactly like when you ran the API from the
    command line.
  prefs: []
  type: TYPE_NORMAL
- en: 'Now if you go back to the terminal window, you will see a log message for the
    first request to the API:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE12]'
  prefs: []
  type: TYPE_PRE
- en: Congratulations! Your application is being run by Docker in a container that
    you defined. To stop the application, press Ctrl-C.
  prefs: []
  type: TYPE_NORMAL
- en: Deploying to AWS
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: The AWS deployment will take advantage of the Docker container that you created.
    You will run your application using the Amazon Lightsail service, which is one
    of the simpler AWS services to get started with.
  prefs: []
  type: TYPE_NORMAL
- en: To begin, [create a new AWS account](https://oreil.ly/09mZ7) and store your
    login credentials securely. For this project, it will be acceptable to use the
    *root user* account, which is the full owner of the account identified by the
    email address. However, you should enable multifactor authentication (MFA), following
    the directions [in the AWS Identity and Access Management User Guide](https://oreil.ly/N5Q7e).
  prefs: []
  type: TYPE_NORMAL
- en: If you continue using AWS, a best practice is to create a separate administration
    account and use it for normal work instead of the root user.
  prefs: []
  type: TYPE_NORMAL
- en: Creating a Lightsail Container Service
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: When you have logged in to the AWS console, select Lightsail from the search
    bar and then select Containers from the lefthand menu. You should see a page that
    looks like [Figure 6-7](#lightsail_home_ch4). Click “Create container service.”
  prefs: []
  type: TYPE_NORMAL
- en: '![Lightsail home page](assets/haad_0607.png)'
  prefs: []
  type: TYPE_IMG
- en: Figure 6-7\. Starter page for Lightsail
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
- en: 'You will be asked to complete the information for your first Lightsail service:'
  prefs: []
  type: TYPE_NORMAL
- en: '*Region*: Select a region that is nearest to you for best performance.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '*Power*: Choose Nano or Micro.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '*Scale*: Choose 1.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '*Identify your service*: Choose a name for your container. This example uses
    `aws-api-container`.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Click “Create container service”. It will take several minutes for the container
    to be created. When it finishes, you should see a status page like the one in
    [Figure 6-8](#completed_lightsail_status).
  prefs: []
  type: TYPE_NORMAL
- en: '![Lightsail instance complete](assets/haad_0608.png)'
  prefs: []
  type: TYPE_IMG
- en: Figure 6-8\. Lightsail container service creation completed
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
- en: Installing the AWS CLI
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: To interact with AWS, you will use the AWS CLI. Follow the instructions from
    AWS to [install or update the latest version of the AWS CLI](https://oreil.ly/r8tTp).
  prefs: []
  type: TYPE_NORMAL
- en: 'Run the following command to verify the installation:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE13]'
  prefs: []
  type: TYPE_PRE
- en: Installing the Amazon Lightsail Container Services Plug-in
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: For Lightsail, an additional installation is required. Follow the instructions
    on [installing the Amazon Lightsail container services plug-in](https://oreil.ly/xMzkI).
  prefs: []
  type: TYPE_NORMAL
- en: Configuring Your Login Credentials
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: To connect the AWS CLI to your AWS account, you will need to configure your
    authentication and access credentials. There are multiple ways to do this, and
    it can take a bit of time to set up correctly. As mentioned multiple times in
    this chapter, you should be extremely careful in the handling of your credentials
    by cloud services. This includes taking care that they are never committed to
    a source code repository. Follow the instructions from [“Authentication and access
    credentials for the AWS CLI”](https://oreil.ly/HAXYD) to configure your AWS CLI.
  prefs: []
  type: TYPE_NORMAL
- en: 'Once you have followed the instructions for configuring your credentials, verify
    them by entering this command:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE14]'
  prefs: []
  type: TYPE_PRE
- en: 'You should receive a response in the following format:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE15]'
  prefs: []
  type: TYPE_PRE
- en: Pushing Your Container Image to Lightsail
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Next, you will use the AWS CLI to push a container image to Lightsail. If you
    run into any issues during these instructions, additional information is available
    on the [“Push, view, and delete container images for a Lightsail container service”
    page](https://oreil.ly/lJ0wX).
  prefs: []
  type: TYPE_NORMAL
- en: 'To verify that your Docker images are still in your local repository where
    you built them in the previous sections of this chapter, enter the following:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE16]'
  prefs: []
  type: TYPE_PRE
- en: 'You will push an image from this local Docker repository to Lightsail. Take
    a moment to understand some of the values you will populate:'
  prefs: []
  type: TYPE_NORMAL
- en: '`Region`'
  prefs: []
  type: TYPE_NORMAL
- en: This is the AWS region where you set up the Lightsail service.
  prefs: []
  type: TYPE_NORMAL
- en: '`ContainerServiceName`'
  prefs: []
  type: TYPE_NORMAL
- en: This should be `aws-api-container` if you set up the Lightsail service correctly
    in the previous steps.
  prefs: []
  type: TYPE_NORMAL
- en: '`LocalContainerImageName:ImageTag`'
  prefs: []
  type: TYPE_NORMAL
- en: This is the name and tag from your local repository. In the preceding example,
    the value would be `apicontainerimage:latest`.
  prefs: []
  type: TYPE_NORMAL
- en: 'Enter the following command in the terminal, replacing the values in brackets
    with your information:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE17]'
  prefs: []
  type: TYPE_PRE
- en: Note
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
- en: These commands may wrap in this book, but you will enter them on a single line
    in the terminal.
  prefs: []
  type: TYPE_NORMAL
- en: 'Here is an example of the command filled out completely:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE18]'
  prefs: []
  type: TYPE_PRE
- en: 'After a couple of minutes, you should see the following:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE19]'
  prefs: []
  type: TYPE_PRE
- en: Go back to the Lightsail console login and view the Images tab on your `aws-api-container`.
    You should see something like [Figure 6-9](#lightsail_stored_images_ch4).
  prefs: []
  type: TYPE_NORMAL
- en: '![Lightsail stored images](assets/haad_0609.png)'
  prefs: []
  type: TYPE_IMG
- en: Figure 6-9\. Lightsail stored images page
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
- en: Creating a Lightsail Deployment
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'On the Deployments tab of the `aws-api-container` service, select “Create your
    first deployment.” Enter the following values, as shown in [Figure 6-10](#first_deployment_top):'
  prefs: []
  type: TYPE_NORMAL
- en: '*Container name*: Choose a unique container name. This example uses `aws-api-container-1`.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '*Image*: Choose the stored image that was pushed in the previous steps.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '![Lightsail top options](assets/haad_0610.png)'
  prefs: []
  type: TYPE_IMG
- en: Figure 6-10\. Deployment options (top of page)
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
- en: Click “+ Add open ports” and enter a value of 80 in the port. In the Public
    Endpoint section, click the drop-down box and select the container you created.
  prefs: []
  type: TYPE_NORMAL
- en: After these steps, the completed options should appear as shown in [Figure 6-11](#first_deployment_bottom).
  prefs: []
  type: TYPE_NORMAL
- en: '![Lightsail top options](assets/haad_0611.png)'
  prefs: []
  type: TYPE_IMG
- en: Figure 6-11\. Deployment options (bottom of page)
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
- en: Click “Save and deploy.” Lightsail will begin deploying. After a few minutes,
    you should see a status of Active, as shown in [Figure 6-12](#lightsail_deploy_success).
  prefs: []
  type: TYPE_NORMAL
- en: '![Lightsail deployment success](assets/haad_0612.png)'
  prefs: []
  type: TYPE_IMG
- en: Figure 6-12\. Lightsail deployment success
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
- en: Your container will have a Status of Running, and a “Public domain” will be
    generated (not shown in [Figure 6-12](#lightsail_deploy_success)). This is the
    base URL for the API. To verify that your API is running, copy the value from
    the “Public domain” and paste it into a browser bar. You should see your API’s
    health check page. Congratulations, you’ve deployed your API using AWS Lightsail!
  prefs: []
  type: TYPE_NORMAL
- en: Updating Your API Documentation
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'In [Chapter 5](ch05.html#chapter_5), you created the *README.md* file as API’s
    documentation, but you didn’t have an API address yet. Update the Public API Address
    section of the *README.md* file as follows, replacing `[*API URL*]` with your
    deployed application’s address, wherever you find it:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE20]'
  prefs: []
  type: TYPE_PRE
- en: Additional Resources
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: The [Docker website](https://oreil.ly/6AyzJ) provides a deep dive into the concepts
    around Docker containers.
  prefs: []
  type: TYPE_NORMAL
- en: For best practices on containerizing Python, take a look at [“Best practices
    for containerizing Python applications with Docker” from Snyk.io](https://oreil.ly/1SYWr).
  prefs: []
  type: TYPE_NORMAL
- en: Summary
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'In this chapter, you learned the benefits and responsibilities of using cloud
    hosting platforms to deploy your API. You now have experience in deploying your
    application in several different ways:'
  prefs: []
  type: TYPE_NORMAL
- en: In a local development environment or GitHub Codespaces environment
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: In a Docker container in a local development environment or GitHub Codespaces
    environment
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: On the Render cloud host
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: On AWS using Amazon Lightsail and Docker
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: In [Chapter 7](ch07.html#chapter_7), you will create an SDK to make your API
    easier to use for Python developers.
  prefs: []
  type: TYPE_NORMAL
