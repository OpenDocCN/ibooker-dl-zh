<html><head></head><body>
<div id="book-content">
<div id="sbo-rt-content"><section data-type="chapter" epub:type="chapter" data-pdf-bookmark="Chapter 9. Using APIs for Data Analytics"><div class="chapter" id="chapter_9">
<h1><span class="label">Chapter 9. </span>Using APIs for Data Analytics</h1>

<blockquote data-type="epigraph" epub:type="epigraph">
  <p>Your eyes see the game much better than the numbers. But the numbers see <em>all</em> the games.</p>
  <p data-type="attribution">Dean Oliver, sports statistician</p>
</blockquote>

<p>The sports world loves all forms of <em>data analytics</em>—charts, graphs, and statistics that describe the results of events or predict what will happen next. When a sports fan views those data analytics, they probably never consider what data source was used to create them. In many cases, the data source is an API. In this chapter, you will learn best practices for consuming APIs and creating data analytics products using Jupyter Notebooks, a popular tool used by data scientists.</p>






<section data-type="sect1" data-pdf-bookmark="Custom Metrics for Sports Analytics"><div class="sect1" id="id96">
<h1>Custom Metrics for Sports Analytics</h1>

<p>One of the most celebrated forms<a data-type="indexterm" data-primary="data analytics" data-secondary="custom metrics" id="id1823"/><a data-type="indexterm" data-primary="custom metrics" id="id1824"/> of analytics is the <em>custom metric</em>, a calculation that summarizes complicated behavior, ability, and outcomes as a number. Every sport has metrics that players, coaches, managers, and fans pay attention to. Baseball has the longest history with metrics, from the historical <em>earned run average</em> (ERA) to the modern <em>weighted runs created plus</em> (wRC+) and <em>wins against replacement</em> (WAR). Soccer fans and professionals alike focus on the <em>expected goals</em> (xG), a method of defining quality shots that has motivated a variety of <a href="https://oreil.ly/HHSL0">secret-sauce models</a>. The NBA uses the <em>player efficiency rating</em> (PER) to measure a basketball player’s all-around value.</p>

<p>Some of the most interesting work in custom metrics is happening in football,<a data-type="indexterm" data-primary="Big Data Bowl (NFL)" id="id1825"/> where the NFL has sponsored an annual analytics contest called the <a href="https://oreil.ly/5h1RE">Big Data Bowl</a>, where data students and professionals research and propose new metrics for prizes, job prospects, and the excitement of seeing their work included in TV broadcasts. It has a special track devoted to creating new custom metrics, such as  <em>converted tackle opportunity</em> and <em>path analysis via swarm-tackle accuracy</em> (PASTA). Some have made their way into the broadcast booth, and more are on the way.</p>

<p>Every custom metric requires a few components to succeed:</p>
<dl>
<dt>Question</dt>
<dd>
<p>What question is it trying to solve? It should be general enough to have broad application but specific enough to add new knowledge to the sport. <a data-type="indexterm" data-primary="KenPom ranking" id="id1826"/>For example, the <a href="https://oreil.ly/2MIk3">KenPom ranking</a> answers the question: which college basketball teams deserve to make the NCAA tournament field?</p>
</dd>
<dt>Theory</dt>
<dd>
<p>By choosing specific numbers to measure and weighing them against each other, you make a value judgment. You are proposing subcomponents that matter to answer a question.</p>
</dd>
<dt>Valid approach</dt>
<dd>
<p>Do the underlying calculations support the purpose of the metric?</p>
</dd>
<dt>Data source</dt>
<dd>
<p>Can you get data to calculate the metric at a reasonable frequency? If data isn’t available, your approach and the supporting theory may have to be adjusted out of practicality.</p>
</dd>
<dt>Name</dt>
<dd>
<p>This is the fun part. The more interesting the name, the more impact it can have.</p>
</dd>
</dl>
</div></section>






<section data-type="sect1" data-pdf-bookmark="Using APIs as Data Sources for Fantasy Custom Metrics"><div class="sect1" id="id97">
<h1>Using APIs as Data Sources for Fantasy Custom Metrics</h1>

<p>Fantasy sports enthusiasts <a data-type="indexterm" data-primary="custom metrics" data-secondary="APIs as data sources" id="id1827"/><a data-type="indexterm" data-primary="data analytics" data-secondary="custom metrics" data-tertiary="APIs as data sources" id="id1828"/><a data-type="indexterm" data-primary="data acquisition" data-secondary="APIs as data sources" data-tertiary="custom metrics" id="id1829"/>love analytics and metrics too. Fantasy league websites provide a lot of stats and charts, but commissioners and managers sometimes want to create their own. Since the fantasy league data is updated frequently, an automated process is key to making the calculations repeatable and consistent. <a data-type="indexterm" data-primary="web scrapers" id="id1830"/><a data-type="indexterm" data-primary="data acquisition" data-secondary="web scrapers" id="id1831"/>To gather this data in software code, two primary choices are available: APIs or <em>web scraping</em>. Web scraping involves using program code to read the HTML from a website page and extract the data. The technique is powerful but brittle: every time the website structure changes, the web scraper code stops working and has to be modified and tested again. But if the league website maintains an API, the data is available even when changes to the layout or structure of the web page occur.</p>

<p>A web search turns up various examples of fantasy managers who share their custom metrics for others to use. <a data-type="indexterm" data-primary="custom metrics" data-secondary="Leeger Python library" id="id1832"/><a data-type="indexterm" data-primary="data analytics" data-secondary="custom metrics" data-tertiary="Leeger Python library" id="id1833"/><a data-type="indexterm" data-primary="Leeger app (Greco)" data-secondary="Leeger Python library for custom metrics" id="id1834"/><a data-type="indexterm" data-primary="Greco, Joey" data-secondary="Leeger Python library" id="id1835"/><a data-type="indexterm" data-primary="resources online" data-secondary="Leeger Python library for custom metrics" id="id1836"/>The most feature-rich metric I have found is the <a href="https://oreil.ly/leegpy">Leeger Python library</a>, which is maintained by software engineer Joey Greco. It is an open source project that generates custom metrics from six fantasy football websites. Appropriate for this chapter, Leeger uses APIs heavily.</p>

<p>You read some of Joey’s advice about SDKs in <a data-type="xref" href="ch07.html#chapter_7">Chapter 7</a>. I talked to him about how he uses APIs to create metrics with Leeger.</p>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="id1837">
<h1>API Perspectives: Joey Greco on APIs and Custom Metrics</h1>
<p><em>When did you first start using APIs from the fantasy websites?</em></p>

<p>Early in 2022, I realized<a data-type="indexterm" data-primary="custom metrics" data-secondary="APIs as data sources" data-tertiary="Joey Greco on" id="id1838"/><a data-type="indexterm" data-primary="data analytics" data-secondary="custom metrics" data-tertiary="Joey Greco on APIs and" id="id1839"/><a data-type="indexterm" data-primary="Greco, Joey" data-secondary="APIs and custom metrics" id="id1840"/><a data-type="indexterm" data-primary="Leeger app (Greco)" id="id1841"/> that copying the fantasy scores for my leagues each week into my own database was tedious and prone to error. One particularly frustrating evening (the Tuesday after I went 0-4 in my fantasy leagues), I had reached my limit, and I looked into what APIs were available for the fantasy sites I was using at that time (ESPN and MyFantasyLeague).</p>

<p><em>What motivated you to create the Leeger app and the fantasy SDKs for the league host websites?</em></p>

<p>I really like keeping stats for all of my fantasy leagues. Over the years, I slowly evolved from calculating stats in a paper notebook, to using Excel, to manually entering them in a database, to writing code that can retrieve data from my fantasy sites and calculate them for me. <a data-type="indexterm" data-primary="SDK (software development kit)" data-secondary="Leeger app Python SDK" id="id1842"/>This led me to create a Python SDK that anyone could use to do the same thing (pull data automatically from their fantasy site and have stats calculated for them each week). While developing Leeger, I realized that some fantasy sites either didn’t have a Python SDK or had one that was old/not maintained. I figured while I’m at it I might as well make them myself, so that’s what I did!</p>

<p><em>What are some of your favorite custom metrics that you have developed for your 
<span class="keep-together">leagues</span>?</em></p>

<p>I think my favorite to date is AWAL, which stands for “Adjusted Wins Against the League.” It’s a simple metric that shows how many wins a team should have had if schedule was not a factor. It looks at any given week and assigns each team a score based on how they ranked in that week’s scoring. You can look at this AWAL over the course of the season and see clear trends of over- and underperformance. Other metrics I’ve created, like Team Score, Team Success, and Team Luck, are a lot of fun. I’m always thinking about new ways to look at fantasy statistics and extract more meaning from them. It’s part of what makes it so much fun for me!</p>
</div></aside>

<p>The Leeger app that Joey created contains dozens of custom metrics that are calculated from data extracted from league website APIs. They have entertaining names, such as Adjusted Team Luck and Smart Wins. Here is the calculation behind the AWAL stat that Greco mentioned:</p>
<pre>AWAL = (teams_outscored_in_week * (1/possible_opponents_in_week)) +
(teams_tied_in_week * (0.5/L))</pre>
</div></section>






<section data-type="sect1" class="less_space pagebreak-before" data-pdf-bookmark="Creating a Custom Metric: The Shark League Score"><div class="sect1" id="id98">
<h1>Creating a Custom Metric: The Shark League Score</h1>

<p>Now it’s your turn to create<a data-type="indexterm" data-primary="data analytics" data-secondary="custom metrics" data-tertiary="creating the Shark League Score" id="ch9cr8sls"/><a data-type="indexterm" data-primary="custom metrics" data-secondary="creating the Shark League Score" id="ch9cr8sls2"/><a data-type="indexterm" data-primary="data analytics" data-secondary="creating the Shark League Score" id="ch9cr8sls3"/><a data-type="indexterm" data-primary="Shark League Score custom metric" id="ch9cr8sls4"/><a data-type="indexterm" data-primary="data analytics" data-secondary="creating the Shark League Score" data-tertiary="about" id="id1843"/><a data-type="indexterm" data-primary="custom metrics" data-secondary="creating the Shark League Score" data-tertiary="about" id="id1844"/><a data-type="indexterm" data-primary="Shark League Score custom metric" data-secondary="about" id="id1845"/> a custom metric: the Shark League Score. <a data-type="xref" href="#ch9_architecture_jupyter">Figure 9-1</a> shows the high-level architecture of the project you will create in this chapter.</p>

<figure><div id="ch9_architecture_jupyter" class="figure">
<img src="assets/haad_0901.png" alt="High-level architecture" width="733" height="438"/>
<h6><span class="label">Figure 9-1. </span>High-level architecture</h6>
</div></figure>

<p>The question it seeks to answer is: “How tough is our fantasy league?” A real fantasy shark is a manager who knows their stuff: they are prepared for the draft, they scour the waiver wire for the best players, and they always seem to start the right lineup. A league filled with owners like this is a Shark League, and making the playoffs in this type of league is a badge of honor. Winning a title in a Shark League—​that is a victory to savor for a lifetime.</p>

<p>The theory of the Shark League Score is based on a few attributes of efficient managers. First, Shark Leagues should be balanced from top to bottom—​there should be no easy weeks on the schedule. Second, the league as a whole should be picking up the best players and getting them in rosters to score points. One supporting theory is that fantasy regular season stats (usually weeks 1 through 14) are more appropriate than fantasy playoffs (week 15 and beyond) because all teams are playing.</p>

<p>There are a few additional items that could arguably be included but are not supported by the SportsWorldCentral API. For instance, a Shark League should rarely or never have an empty roster spot in the weekly starters. Another sign of efficient owners is picking up the “hot free agents” before they have their big weeks—​that would be especially tricky to measure.</p>

<p>As you go through the examples in this chapter, you will develop the Shark League Score, as well as two supporting metrics: the League Balance Score and League Juice Score. It’s time to get started!</p>
</div></section>






<section data-type="sect1" class="less_space pagebreak-before" data-pdf-bookmark="Software Used in This Chapter"><div class="sect1" id="id99">
<h1>Software Used in This Chapter</h1>

<p><a data-type="xref" href="#tools_table_chapter_9">Table 9-1</a> lists a few of the software components you will begin using in this chapter.<a data-type="indexterm" data-primary="backoff Python library" data-secondary="about" id="id1846"/><a data-type="indexterm" data-primary="httpx Python library" data-secondary="about" id="id1847"/><a data-type="indexterm" data-primary="Jupyter Notebooks" data-secondary="about" id="id1848"/><a data-type="indexterm" data-primary="pandas library" id="id1849"/><a data-type="indexterm" data-primary="data analytics" data-secondary="creating the Shark League Score" data-tertiary="software used" id="id1850"/><a data-type="indexterm" data-primary="custom metrics" data-secondary="creating the Shark League Score" data-tertiary="software used" id="id1851"/><a data-type="indexterm" data-primary="Shark League Score custom metric" data-secondary="software used" id="id1852"/></p>
<table id="tools_table_chapter_9">
<caption><span class="label">Table 9-1. </span>Key tools or services used in this chapter</caption>
<thead>
<tr>
<th>Software name</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td><p>backoff</p></td>
<td><p>Python library for adding backoff and retry to web calls</p></td>
</tr>
<tr>
<td><p>httpx</p></td>
<td><p>Python library for making web calls</p></td>
</tr>
<tr>
<td><p>Jupyter Notebooks</p></td>
<td><p>Interactive data science environment</p></td>
</tr>
<tr>
<td><p>pandas</p></td>
<td><p>Data analysis and formatting library</p></td>
</tr>
</tbody>
</table>








<section data-type="sect2" data-pdf-bookmark="httpx"><div class="sect2" id="id100">
<h2>httpx</h2>

<p>The Python library you will use<a data-type="indexterm" data-primary="httpx Python library" data-secondary="asynchronous calls" id="id1853"/><a data-type="indexterm" data-primary="requests library with only synchronous calls" id="id1854"/> for calling APIs is httpx. This library is very similar to the popular requests library but also supports asynchronous API calls. For more information about httpx, read <a data-type="xref" href="ch04.html#chapter_4">Chapter 4</a>.</p>

<p>You will use version 27.x of httpx to stay consistent with the version used in <a data-type="xref" href="part01.html#part_1">Part I</a>.</p>
</div></section>








<section data-type="sect2" data-pdf-bookmark="Jupyter Notebooks"><div class="sect2" id="id101">
<h2>Jupyter Notebooks</h2>

<p>Jupyter Notebooks support<a data-type="indexterm" data-primary="Jupyter Notebooks" id="id1855"/><a data-type="indexterm" data-primary="interactive computing" id="id1856"/> a unique way to perform data science. This mode is called <em>interactive computing</em>, and it allows you to mix code cells, Markdown comment cells, and results. Cells flow from the top of a notebook to the bottom, and variables and libraries that have been run previously are available to cells that run later. (If you run cells only sequentially, that would mean the cells below, but you can run cells out of order.) In addition to this interactive mode, Jupyter Notebooks also provide Markdown cells that run between code cells, which allows you to create richly formatted documents that interweave code, results, and documentation. The notebook style of programming is heavily used by data scientists, who value its ability to store the results of prior work along with the code that went into creating it.</p>

<p>Jupyter Notebooks are supported<a data-type="indexterm" data-primary="Codespaces (GitHub)" data-secondary="Jupyter Notebooks" id="id1857"/><a data-type="indexterm" data-primary="GitHub" data-secondary="Codespaces" data-tertiary="Jupyter Notebooks" id="id1858"/> out of the box with the default VS Code installation in your GitHub Codespace. You will run notebooks directly in VS Code <a data-type="indexterm" data-primary=".ipynb file extension" data-primary-sortas="ipynb" id="id1859"/>by creating a file with the <em>.ipynb</em> extension. Project Jupyter has many more options and features beyond what you will learn in this chapter; <a data-type="indexterm" data-primary="Jupyter Notebooks" data-secondary="about" data-tertiary="website for more information" id="id1860"/><a data-type="indexterm" data-primary="resources online" data-secondary="Jupyter Notebooks website" id="id1861"/>you can learn more about them at the <a href="https://jupyter.org">Jupyter project home page</a>.</p>

<p>You will use the default version of Jupyter that comes installed in Codespaces.</p>
</div></section>








<section data-type="sect2" class="less_space pagebreak-before" data-pdf-bookmark="pandas"><div class="sect2" id="id388">
<h2>pandas</h2>

<p>For data scientists using Python, one of the most trusted libraries is pandas. For data scientists, it is one of the first imports you include in almost any Python program. The pandas library provides Python a data type called a <code>DataFrame</code>, which is a two-dimensional structure with rows and columns. This spreadsheet-like format is a natural way of viewing data in rows and columns.</p>

<p>The library also provides many methods for data manipulation, filtering, and formatting. As mentioned in <a data-type="xref" href="ch01.html#chapter_1">Chapter 1</a> of this book, data scientists spend more than one-third of their time preparing and cleansing data. The pandas library is a powerful tool for this type of work. The <a href="https://oreil.ly/X4vXa">official pandas user guide</a> is a great reference for this library.</p>

<p>You will use the default version of pandas that comes installed in GitHub Codespaces.</p>
</div></section>
</div></section>






<section data-type="sect1" data-pdf-bookmark="Installing the New Libraries in Your Codespace"><div class="sect1" id="id196">
<h1>Installing the New Libraries in Your Codespace</h1>

<p>To install the libraries you need<a data-type="indexterm" data-primary="data analytics" data-secondary="creating the Shark League Score" data-tertiary="installing new libraries" id="id1862"/><a data-type="indexterm" data-primary="custom metrics" data-secondary="creating the Shark League Score" data-tertiary="installing new libraries" id="id1863"/><a data-type="indexterm" data-primary="Shark League Score custom metric" data-secondary="installing new libraries" id="id1864"/><a data-type="indexterm" data-primary="requirements.txt file for pip" data-secondary="Shark League Score new libraries" id="id1865"/> for this chapter, create a file named <em>chapter9/requirements.txt</em>:</p>

<pre data-type="programlisting" data-code-language="shell">.../analytics-project (main) $ cd chapter9
.../chapter9 (main) $ touch requirements.txt</pre>

<p>Update <em>chapter9/requirements.txt</em> with the following contents:</p>

<pre data-type="programlisting" data-code-language="shell">logging <a class="co" id="co_using_apis_for_data_analytics_CO1-1" href="#callout_using_apis_for_data_analytics_CO1-1"><img src="assets/1.png" alt="1" width="12" height="12"/></a>
httpx&gt;=0.27.0
backoff&gt;=2.2.1 <a class="co" id="co_using_apis_for_data_analytics_CO1-2" href="#callout_using_apis_for_data_analytics_CO1-2"><img src="assets/2.png" alt="2" width="12" height="12"/></a></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_using_apis_for_data_analytics_CO1-1" href="#co_using_apis_for_data_analytics_CO1-1"><img src="assets/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>This is the standard Python logging module.</p></dd>
<dt><a class="co" id="callout_using_apis_for_data_analytics_CO1-2" href="#co_using_apis_for_data_analytics_CO1-2"><img src="assets/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>This library provides backoff and retry functionality for API calls. See <a data-type="xref" href="ch07.html#chapter_7">Chapter 7</a> for more details.</p></dd>
</dl>

<p>Execute the following command to install the new libraries in your Codespace:</p>

<pre data-type="programlisting" data-code-language="shell">.../chapter9 (main) $ pip3 install -r requirements.txt</pre>

<p>You should see a message that states that these libraries were successfully installed.</p>
</div></section>






<section data-type="sect1" data-pdf-bookmark="Launching Your API in Codespaces"><div class="sect1" id="id197">
<h1>Launching Your API in Codespaces</h1>

<p>To access your API data, you will need to launch v0.2 of your API in the terminal. <a data-type="indexterm" data-primary="data analytics" data-secondary="creating the Shark League Score" data-tertiary="running API in Codespace" id="id1866"/><a data-type="indexterm" data-primary="custom metrics" data-secondary="creating the Shark League Score" data-tertiary="running API in Codespace" id="id1867"/><a data-type="indexterm" data-primary="Shark League Score custom metric" data-secondary="running API in Codespace" id="id1868"/><a data-type="indexterm" data-primary="Codespaces (GitHub)" data-secondary="launching your API" data-tertiary="running in Codespace" id="id1869"/><a data-type="indexterm" data-primary="GitHub" data-secondary="Codespaces" data-tertiary="launching your API to run in Codespace" id="id1870"/><a data-type="indexterm" data-primary="launching your API" data-secondary="running in Codespace" id="id1871"/><a data-type="indexterm" data-primary="Python" data-secondary="API files" data-tertiary="launching your API to run in Codespace" id="id1872"/><a data-type="indexterm" data-primary="SportsWorldCentral (SWC)" data-secondary="website API" data-tertiary="API running in Codespace" id="id1873"/><a data-type="indexterm" data-primary="Codespaces (GitHub)" data-secondary="SWC API run locally" id="id1874"/><a data-type="indexterm" data-primary="Codespaces (GitHub)" data-secondary="terminal window" data-tertiary="SWC API run locally" id="id1875"/><a data-type="indexterm" data-primary="terminal window of GitHub Codespace" data-secondary="SWC API run locally" id="id1876"/><a data-type="indexterm" data-primary="using APIs" data-secondary="SWC API running in Codespace" id="id1877"/><a data-type="indexterm" data-primary="GitHub" data-secondary="Codespaces" data-tertiary="SWC API run locally" id="id1878"/><a data-type="indexterm" data-primary="GitHub" data-secondary="Codespaces" data-tertiary="terminal window SWC API run locally" id="id1879"/>For instructions, read <a data-type="xref" href="ch08.html#sportsworldcentral">“Running the SportsWorldCentral (SWC) API Locally”</a>. Copy the URL of your API from the browser address bar to use as the base URL in this chapter.</p>
</div></section>






<section data-type="sect1" data-pdf-bookmark="Creating an API Client File"><div class="sect1" id="id102">
<h1>Creating an API Client File</h1>

<p>You will create a standalone <a data-type="indexterm" data-primary="data analytics" data-secondary="creating the Shark League Score" data-tertiary="API client file created" id="ch9client"/><a data-type="indexterm" data-primary="custom metrics" data-secondary="creating the Shark League Score" data-tertiary="API client file created" id="ch9client2"/><a data-type="indexterm" data-primary="Shark League Score custom metric" data-secondary="API client file created" id="ch9client3"/>Python file to make all calls to your API. By maintaining this file separate from the Jupyter Notebook, you keep special API-related logic in one place and make it available to multiple notebooks.</p>

<p>You will use the backoff library<a data-type="indexterm" data-primary="backoff and retry process" data-secondary="exponential backoff instead of simple retries" data-tertiary="with jitters" id="ch9clisft"/><a data-type="indexterm" data-primary="backoff Python library" data-secondary="custom metric creation" id="ch9clisft2"/><a data-type="indexterm" data-primary="httpx Python library" data-secondary="httpx.Client" data-tertiary="context manager" id="ch9clisft3"/> to implement exponential backoff and retry with jitter, which makes your API calls more reliable without overwhelming the source API. You use the HTTPX client in a context manager style. <a data-type="xref" href="ch07.html#chapter_7">Chapter 7</a> uses these techniques and a few more to create a full-featured Python SDK. Using SDKs when available is also helpful for Jupyter Notebooks, but for this chapter, you will add most of the features yourself.</p>
<div data-type="tip"><h6>Tip</h6>
<p>Version 0.2 of the API has <a data-type="indexterm" data-primary="endpoints of APIs" data-secondary="Part II version of API" id="id1880"/><a data-type="indexterm" data-primary="API endpoints" data-secondary="Part II version of API" id="id1881"/><a data-type="indexterm" data-primary="Swagger UI" data-secondary="Part II API endpoints" id="id1882"/>several new endpoints that you didn’t create in <a data-type="xref" href="part01.html#part_1">Part I</a>. To explore the format of the new endpoints, access the interactive API docs using Swagger UI at the <em>/docs</em> endpoint on your API.</p>
</div>

<p>Create a new Python file in the terminal as shown:<a data-type="indexterm" data-primary="swc_simple_client.py file" id="id1883"/><a data-type="indexterm" data-primary="Python" data-secondary="API files" data-tertiary="swc_simple_client.py" id="id1884"/><a data-type="indexterm" data-primary="data analytics" data-secondary="creating the Shark League Score" data-tertiary="swc_simple_client.py file" id="id1885"/><a data-type="indexterm" data-primary="custom metrics" data-secondary="creating the Shark League Score" data-tertiary="swc_simple_client.py file" id="id1886"/><a data-type="indexterm" data-primary="Shark League Score custom metric" data-secondary="swc_simple_client.py file" id="id1887"/></p>

<pre data-type="programlisting" data-code-language="shell">.../analytics-project (main) $ cd chapter9
.../chapter9 (main) $ mkdir notebooks
.../chapter9 (main) $ touch notebooks/swc_simple_client.py</pre>

<p>Update <em>swc_simple_client.py</em> with the following code:</p>

<pre data-type="programlisting" data-code-language="python">import backoff
import logging
import httpx

HEALTH_CHECK_ENDPOINT = "/" <a class="co" id="co_using_apis_for_data_analytics_CO2-1" href="#callout_using_apis_for_data_analytics_CO2-1"><img src="assets/1.png" alt="1" width="12" height="12"/></a>
LIST_LEAGUES_ENDPOINT = "/v0/leagues/"
LIST_PLAYERS_ENDPOINT = "/v0/players/"
LIST_PERFORMANCES_ENDPOINT = "/v0/performances/"
LIST_TEAMS_ENDPOINT = "/v0/teams/"
LIST_WEEKS_ENDPOINT = "/v0/weeks/"
GET_COUNTS_ENDPOINT = "/v0/counts/"

logger = logging.getLogger(__name__) <a class="co" id="co_using_apis_for_data_analytics_CO2-2" href="#callout_using_apis_for_data_analytics_CO2-2"><img src="assets/2.png" alt="2" width="12" height="12"/></a>

@backoff.on_exception( <a class="co" id="co_using_apis_for_data_analytics_CO2-3" href="#callout_using_apis_for_data_analytics_CO2-3"><img src="assets/3.png" alt="3" width="12" height="12"/></a>
    wait_gen=backoff.expo, 
    exception=(httpx.RequestError, httpx.HTTPStatusError),  
    max_time=5,  
    jitter=backoff.random_jitter  
)
def call_api_endpoint(
    base_url: str,
    api_endpoint: str, 
    api_params: dict = None <a class="co" id="co_using_apis_for_data_analytics_CO2-4" href="#callout_using_apis_for_data_analytics_CO2-4"><img src="assets/4.png" alt="4" width="12" height="12"/></a>
) -&gt; httpx.Response:

    try:
        with httpx.Client(base_url=base_url) as client: <a class="co" id="co_using_apis_for_data_analytics_CO2-5" href="#callout_using_apis_for_data_analytics_CO2-5"><img src="assets/5.png" alt="5" width="12" height="12"/></a>
            logger.debug(f"base_url: {base_url}, api_endpoint: {api_endpoint}")
            response = client.get(api_endpoint, params=api_params)
            response.raise_for_status()
            logger.debug(f"Response JSON: {response.json()}") <a class="co" id="co_using_apis_for_data_analytics_CO2-6" href="#callout_using_apis_for_data_analytics_CO2-6"><img src="assets/6.png" alt="6" width="12" height="12"/></a>
            return response
    except httpx.HTTPStatusError as e: 
        logger.error(f"HTTP status error occurred: {e.response.text}") <a class="co" id="co_using_apis_for_data_analytics_CO2-7" href="#callout_using_apis_for_data_analytics_CO2-7"><img src="assets/7.png" alt="7" width="12" height="12"/></a>
return httpx.Response(status_code=e.response.status_code,
                             content=b"API error") <a class="co" id="co_using_apis_for_data_analytics_CO2-8" href="#callout_using_apis_for_data_analytics_CO2-8"><img src="assets/8.png" alt="8" width="12" height="12"/></a>
    except httpx.RequestError as e:
        logger.error(f"Request error occurred: {str(e)}")
        return httpx.Response(status_code=500, content=b"Network error")
    except Exception as e:
        logger.error(f"Unexpected error occurred: {str(e)}")
        return httpx.Response(status_code=500, content=b"Unexpected error")</pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_using_apis_for_data_analytics_CO2-1" href="#co_using_apis_for_data_analytics_CO2-1"><img src="assets/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>The URL endpoints are set as variables that can be used when calling the client.</p></dd>
<dt><a class="co" id="callout_using_apis_for_data_analytics_CO2-2" href="#co_using_apis_for_data_analytics_CO2-2"><img src="assets/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>This statement gets a reference to the log file.</p></dd>
<dt><a class="co" id="callout_using_apis_for_data_analytics_CO2-3" href="#co_using_apis_for_data_analytics_CO2-3"><img src="assets/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p>This decorator adds backoff and retry functionality to the <code>call_api_endpoint</code> function. For more information about the settings, see the <a href="https://oreil.ly/c_4yV">backoff documentation</a>.</p></dd>
<dt><a class="co" id="callout_using_apis_for_data_analytics_CO2-4" href="#co_using_apis_for_data_analytics_CO2-4"><img src="assets/4.png" alt="4" width="12" height="12"/></a></dt>
<dd><p>This allows you to pass in parameters to the API.</p></dd>
<dt><a class="co" id="callout_using_apis_for_data_analytics_CO2-5" href="#co_using_apis_for_data_analytics_CO2-5"><img src="assets/5.png" alt="5" width="12" height="12"/></a></dt>
<dd><p>This statement uses the HTTPX client in a resource manager style, which makes the API call and then cleans up resources when it finishes.</p></dd>
<dt><a class="co" id="callout_using_apis_for_data_analytics_CO2-6" href="#co_using_apis_for_data_analytics_CO2-6"><img src="assets/6.png" alt="6" width="12" height="12"/></a></dt>
<dd><p>This statement logs the data in the API response for debugging.</p></dd>
<dt><a class="co" id="callout_using_apis_for_data_analytics_CO2-7" href="#co_using_apis_for_data_analytics_CO2-7"><img src="assets/7.png" alt="7" width="12" height="12"/></a></dt>
<dd><p>If errors occur, they are logged with an <code>ERROR</code> type.</p></dd>
<dt><a class="co" id="callout_using_apis_for_data_analytics_CO2-8" href="#co_using_apis_for_data_analytics_CO2-8"><img src="assets/8.png" alt="8" width="12" height="12"/></a></dt>
<dd><p>In case of error, the client returns an <code>httpx.response</code> object with the error code and message.<a data-type="indexterm" data-primary="httpx Python library" data-secondary="httpx.Response" data-tertiary="error code and message" id="id1888"/><a data-type="indexterm" data-startref="ch9client" id="id1889"/><a data-type="indexterm" data-startref="ch9client2" id="id1890"/><a data-type="indexterm" data-startref="ch9client3" id="id1891"/><a data-type="indexterm" data-startref="ch9clisft" id="id1892"/><a data-type="indexterm" data-startref="ch9clisft2" id="id1893"/><a data-type="indexterm" data-startref="ch9clisft3" id="id1894"/></p></dd>
</dl>
</div></section>






<section data-type="sect1" data-pdf-bookmark="Creating Your Jupyter Notebook"><div class="sect1" id="id198">
<h1>Creating Your Jupyter Notebook</h1>

<p>To get started, run the following<a data-type="indexterm" data-primary="data analytics" data-secondary="creating the Shark League Score" data-tertiary="Jupyter Notebook created" id="id1895"/><a data-type="indexterm" data-primary="custom metrics" data-secondary="creating the Shark League Score" data-tertiary="Jupyter Notebook created" id="id1896"/><a data-type="indexterm" data-primary="Shark League Score custom metric" data-secondary="Jupyter Notebook created" id="id1897"/><a data-type="indexterm" data-primary="terminal window of GitHub Codespace" data-secondary="Jupyter Notebook created" id="id1898"/><a data-type="indexterm" data-primary="Codespaces (GitHub)" data-secondary="terminal window" data-tertiary="Jupyter Notebook created" id="id1899"/><a data-type="indexterm" data-primary="GitHub" data-secondary="Codespaces" data-tertiary="terminal window for creating Jupyter Notebook" id="id1900"/><a data-type="indexterm" data-primary="Jupyter Notebooks" data-secondary="creating a Jupyter Notebook" data-tertiary="Shark League Score custom metric" id="id1901"/> commands in the Terminal window at the bottom of the screen to create the new directory and the Jupyter Notebook you will be using in this chapter:<a data-type="indexterm" data-primary=".ipynb file extension" data-secondary="shark_league_notebook.ipynb" data-primary-sortas="ipynb" id="id1902"/></p>

<pre data-type="programlisting" data-code-language="shell">.../analytics-project (main) $ cd chapter9
.../chapter9 (main) $ mkdir notebooks
.../notebooks (main) $ touch notebooks/shark_league_notebook.ipynb</pre>

<p>If you open the <em>chapter9/notebooks</em> folder in the Explorer on the left, you should see <em>shark_league_notebook.ipynb</em>. Click to open it. As shown in <a data-type="xref" href="#shark_notebook_chapter_9">Figure 9-2</a>, you will see a blank cell. A Jupyter Notebook is made up of cells like these that you can fill with software code to run commands or Markdown-formatted text to provide context and explanation for the code.</p>

<p>In the top-right of the file you will see Select Kernel, as shown in <a data-type="xref" href="#shark_notebook_chapter_9">Figure 9-2</a>.</p>

<figure><div id="shark_notebook_chapter_9" class="figure">
<img src="assets/haad_0902.png" alt="New notebook file" width="1064" height="239"/>
<h6><span class="label">Figure 9-2. </span>New notebook file</h6>
</div></figure>

<p>Click Select Kernel. Codespaces should prompt you to “Install/Enable suggested extensions Python + Jupyter” as shown in <a data-type="xref" href="#install_extensions_ch9">Figure 9-3</a>. Select “Install/Enable suggested extensions Python + Jupyter.” Click Install in the additional pop-up window, if prompted.</p>

<figure><div id="install_extensions_ch9" class="figure">
<img src="assets/haad_0903.png" alt="Install/enable extensions" width="727" height="139"/>
<h6><span class="label">Figure 9-3. </span>Install/enable extensions</h6>
</div></figure>

<p>After the installation completes, the title of the window will change to Select <span class="keep-together">Another Kernel and</span> you will see the choice Python Environments. Select Python Environments.</p>

<p>The title of the window will change to “Select a Python Environment.” One Python version should be listed with a star next to it and the label Recommended—select this Python version.</p>
</div></section>






<section data-type="sect1" data-pdf-bookmark="Adding General Configuration to Your Notebook"><div class="sect1" id="id103">
<h1>Adding General Configuration to Your Notebook</h1>

<p>The beginning of your notebook<a data-type="indexterm" data-primary="Jupyter Notebooks" data-secondary="adding code" data-tertiary="Shark League Score custom metric" id="ch9code"/><a data-type="indexterm" data-primary="data analytics" data-secondary="creating the Shark League Score" data-tertiary="Jupyter Notebook code" id="ch9code2"/><a data-type="indexterm" data-primary="custom metrics" data-secondary="creating the Shark League Score" data-tertiary="Jupyter Notebook code" id="ch9code3"/><a data-type="indexterm" data-primary="Shark League Score custom metric" data-secondary="Jupyter Notebook created" data-tertiary="adding code" id="ch9code4"/> will contain general configuration and setup. Hover your cursor above the empty Python cell and click +Markdown to create a new Markdown cell. Enter the following title in the Markdown cell:</p>

<pre data-type="programlisting" data-code-language="markdown"># Shark League Score
## Import Python libraries</pre>

<p>Run this cell by clicking the play icon on the left of the cell or by pressing Shift-Enter. You should see your message formatted as a title.</p>

<p>Hover your cursor below this cell and click “+Code” to create a new Python cell. Enter the following code in the Python cell:</p>

<pre data-type="programlisting" data-code-language="python">import pandas as pd
import logging
import swc_simple_client as swc <a class="co" id="co_using_apis_for_data_analytics_CO3-1" href="#callout_using_apis_for_data_analytics_CO3-1"><img src="assets/1.png" alt="1" width="12" height="12"/></a></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_using_apis_for_data_analytics_CO3-1" href="#co_using_apis_for_data_analytics_CO3-1"><img src="assets/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>This references the Python file you created named <em>swc_simple_client.py</em>.<a data-type="indexterm" data-primary="Python" data-secondary="API files" data-tertiary="swc_simple_client.py" id="id1903"/><a data-type="indexterm" data-primary="swc_simple_client.py file" id="id1904"/><a data-type="indexterm" data-primary="data analytics" data-secondary="creating the Shark League Score" data-tertiary="swc_simple_client.py file" id="id1905"/><a data-type="indexterm" data-primary="custom metrics" data-secondary="creating the Shark League Score" data-tertiary="swc_simple_client.py file" id="id1906"/><a data-type="indexterm" data-primary="Shark League Score custom metric" data-secondary="swc_simple_client.py file" id="id1907"/></p></dd>
</dl>

<p>Placing all the imports <a data-type="indexterm" data-primary="Python" data-secondary="import statement" data-tertiary="placing at top of files" id="id1908"/><a data-type="indexterm" data-primary="import statement (Python)" data-secondary="placing at top of files" id="id1909"/><a data-type="indexterm" data-primary="Jupyter Notebooks" data-secondary="import statements placed at top" id="id1910"/>at the top of your notebook helps keep track of the libraries you are using. These imports will work for all the cells in this Jupyter Notebook.</p>
<div data-type="tip"><h6>Tip</h6>
<p>Jupyter Notebooks are executed<a data-type="indexterm" data-primary="Jupyter Notebooks" data-secondary="execution from top to bottom" id="id1911"/> top to bottom. Although the output of Jupyter Notebooks is saved between sessions, the variables and imported libraries are not. When you start a coding session, select Execute Above Cells to rerun all the cells above the one you are using.</p>
</div>

<p>As mentioned in <a data-type="xref" href="ch08.html#chapter_8">Chapter 8</a>, logging<a data-type="indexterm" data-primary="Jupyter Notebooks" data-secondary="logging" id="id1912"/><a data-type="indexterm" data-primary="logging" data-secondary="Jupyter Notebook" data-tertiary="shark_notebook.log" id="id1913"/><a data-type="indexterm" data-primary="Jupyter Notebooks" data-secondary="logging" data-tertiary="shark_notebook.log" id="id1914"/><a data-type="indexterm" data-primary="logging" data-secondary="Jupyter Notebook" id="id1915"/><a data-type="indexterm" data-primary="data analytics" data-secondary="creating the Shark League Score" data-tertiary="logging" id="id1916"/><a data-type="indexterm" data-primary="custom metrics" data-secondary="creating the Shark League Score" data-tertiary="logging" id="id1917"/><a data-type="indexterm" data-primary="Shark League Score custom metric" data-secondary="logging" id="id1918"/><a data-type="indexterm" data-primary="shark_notebook.log file" id="id1919"/> is an important component of working with APIs. You will configure a log file named <em>shark_notebook.log</em> to store the logging messages that are generated in your notebook. <a data-type="indexterm" data-primary=".gitignore file" data-secondary="shark_notebook.log file" data-primary-sortas="gitignore file" id="id1920"/>These log files are excluded by your repository’s <em>.gitignore</em> file, so they will not be committed to your repository, which is a good practice.</p>

<p>Add another Markdown cell with the following text:</p>

<pre data-type="programlisting" data-code-language="markdown">## Configure logging</pre>

<p>Add and run a Python code cell with the following:</p>

<pre data-type="programlisting" data-code-language="python">for handler in logging.root.handlers[:]: <a class="co" id="co_using_apis_for_data_analytics_CO4-1" href="#callout_using_apis_for_data_analytics_CO4-1"><img src="assets/1.png" alt="1" width="12" height="12"/></a>
    logging.root.removeHandler(handler)

logging.basicConfig(
    filename='shark_notebook.log',
    level=logging.INFO,  <a class="co" id="co_using_apis_for_data_analytics_CO4-2" href="#callout_using_apis_for_data_analytics_CO4-2"><img src="assets/2.png" alt="2" width="12" height="12"/></a>
)</pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_using_apis_for_data_analytics_CO4-1" href="#co_using_apis_for_data_analytics_CO4-1"><img src="assets/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>This statement removes any existing logging handlers configured by Codespaces.</p></dd>
<dt><a class="co" id="callout_using_apis_for_data_analytics_CO4-2" href="#co_using_apis_for_data_analytics_CO4-2"><img src="assets/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>This sets the logging level to record in the log. Review <a data-type="xref" href="ch07.html#python_logging_levels_ch7">Table 7-1</a> for more details about Python logging.</p></dd>
</dl>

<p>The next code cell will contain shared variables, which are good to add after the import statements. In this notebook, you set a reusable variable for the base URL <span class="keep-together">of the API</span> and created string constants with the API endpoints. These two steps make the purpose of API calls clearer and help avoid manual typing errors. These will be available to all the cells in the notebook. Add another Markdown cell with the following text:</p>

<pre data-type="programlisting" data-code-language="markdown">## Setup notebook variables</pre>

<p>Add and run a Python code cell with the following:<a data-type="indexterm" data-primary="URL of API" data-secondary="Jupyter Notebook base_url" id="id1921"/></p>

<pre data-type="programlisting" data-code-language="python">base_url = "[insert your API base URL]" <a class="co" id="co_using_apis_for_data_analytics_CO5-1" href="#callout_using_apis_for_data_analytics_CO5-1"><img src="assets/1.png" alt="1" width="12" height="12"/></a></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_using_apis_for_data_analytics_CO5-1" href="#co_using_apis_for_data_analytics_CO5-1"><img src="assets/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Inside the quotations, you should put the base URL of the API running locally on Codespaces, without the backslash, for example, <em>https://fluffy-⁠lemur-12345-​8000.app.github.dev</em>.<a data-type="indexterm" data-startref="ch9code" id="id1922"/><a data-type="indexterm" data-startref="ch9code2" id="id1923"/><a data-type="indexterm" data-startref="ch9code3" id="id1924"/><a data-type="indexterm" data-startref="ch9code4" id="id1925"/></p></dd>
</dl>
</div></section>






<section data-type="sect1" data-pdf-bookmark="Working with Your API Data"><div class="sect1" id="id104">
<h1>Working with Your API Data</h1>

<p>The next several cells <a data-type="indexterm" data-primary="data analytics" data-secondary="creating the Shark League Score" data-tertiary="working with your API data" id="ch9work"/><a data-type="indexterm" data-primary="custom metrics" data-secondary="creating the Shark League Score" data-tertiary="working with your API data" id="ch9work2"/><a data-type="indexterm" data-primary="Shark League Score custom metric" data-secondary="working with your API data" id="ch9work3"/><a data-type="indexterm" data-primary="httpx Python library" data-secondary="httpx.Response" data-tertiary="object returned from call_api_endpoint()" id="id1926"/><a data-type="indexterm" data-primary="httpx Python library" data-secondary="httpx.Response" data-tertiary="httpx.Response.json() to extract data" id="id1927"/><a data-type="indexterm" data-primary="pandas library" data-secondary="DataFrame storage of data" id="ch9pandas"/>use the imported <code>call_api_endpoint()</code> function to call the API and get an <code>httpx.Response</code> object. Then, they extract the API data using <code>Response.json()</code> and store it in a pandas DataFrame.</p>

<p>Add a Markdown cell with the following text:</p>

<pre data-type="programlisting" data-code-language="markdown">## Get Max Scores
### Use endpoint: LIST_WEEKS_ENDPOINT</pre>

<p>This code retrieves the maximum scores for SportsWorldCentral leagues based on custom scoring types, which will be used for the League Juice Score. Highly custom values like these are examples of data that is best retrieved from the website’s API. Although you could potentially estimate the total possible points using public NFL scoring data, it would take a lot of effort and would likely be slightly different from the final totals the website calculates. Since the website makes this available, you can easily get an exact match to the league totals.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>From this point, the contents of the code cell and the output will be displayed together. The code will be on top and the output will follow the <code>OUTPUT</code> statement.</p>
</div>

<p>Add and run a Python code cell with the following:</p>

<pre data-type="programlisting" data-code-language="python">week_api_response = swc.call_api_endpoint(base_url,swc.LIST_WEEKS_ENDPOINT)
weeks_df = pd.DataFrame(week_api_response.json()) <a class="co" id="co_using_apis_for_data_analytics_CO6-1" href="#callout_using_apis_for_data_analytics_CO6-1"><img src="assets/1.png" alt="1" width="12" height="12"/></a>
weeks_df['year'] = weeks_df['week_number'].str.slice(0, 4).astype(int) <a class="co" id="co_using_apis_for_data_analytics_CO6-2" href="#callout_using_apis_for_data_analytics_CO6-2"><img src="assets/2.png" alt="2" width="12" height="12"/></a>

max_totals_grouped_df = weeks_df.groupby('year').agg( <a class="co" id="co_using_apis_for_data_analytics_CO6-3" href="#callout_using_apis_for_data_analytics_CO6-3"><img src="assets/3.png" alt="3" width="12" height="12"/></a>
    ppr_12_max_points=('ppr_12_max_points', 'sum'),
    half_ppr_8_max_points=('half_ppr_8_max_points', 'sum'))

display(max_totals_grouped_df)

OUTPUT:
year ppr_12_max_points  half_ppr_8_max_points
2023            21048.0                14800.0</pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_using_apis_for_data_analytics_CO6-1" href="#co_using_apis_for_data_analytics_CO6-1"><img src="assets/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>This extracts the data in a dictionary format and creates a <code>DataFrame</code>.</p></dd>
<dt><a class="co" id="callout_using_apis_for_data_analytics_CO6-2" href="#co_using_apis_for_data_analytics_CO6-2"><img src="assets/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>This uses the pandas <code>str.slice</code> method to get the year substring from the <code>week_number</code>.</p></dd>
<dt><a class="co" id="callout_using_apis_for_data_analytics_CO6-3" href="#co_using_apis_for_data_analytics_CO6-3"><img src="assets/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p>This uses the pandas <code>groupby().agg()</code> method to group the data by year and calculate the maximum points for two of the league types.</p></dd>
</dl>

<p>Next, you’ll retrieve the league information. Add a Markdown cell with this text:</p>

<pre data-type="programlisting" data-code-language="markdown">## Get League Scoring Type
### Use Endpoint: LIST_LEAGUES_ENDPOINT</pre>

<p>Add and run a Python code cell with the following:</p>

<pre data-type="programlisting" data-code-language="python">league_api_response = swc.call_api_endpoint(base_url,swc.LIST_LEAGUES_ENDPOINT)
leagues_df = pd.DataFrame(league_api_response.json())
leagues_df = leagues_df.drop(columns=['teams','last_changed_date']) <a class="co" id="co_using_apis_for_data_analytics_CO7-1" href="#callout_using_apis_for_data_analytics_CO7-1"><img src="assets/1.png" alt="1" width="12" height="12"/></a>
display(leagues_df)

OUTPUT:
    league_id                      league_name scoring_type  league_size
0       5001  Pigskin Prodigal Fantasy League          PPR           12
1       5002       Recurring Champions League     Half-PPR            8
2       5003                      AHAHFZZFFFL     Half-PPR            8
3       5004    Gridiron Gurus Fantasy League          PPR           12
4       5005                 Best League Ever          PPR           12
...</pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_using_apis_for_data_analytics_CO7-1" href="#co_using_apis_for_data_analytics_CO7-1"><img src="assets/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>This statement uses the pandas <code>drop</code> method to exclude columns from the DataFrame.</p></dd>
</dl>

<p class="less_space pagebreak-before">Next, you will retrieve the total scoring for each league to compare to the max potential. Add a Markdown cell with the following text:</p>

<pre data-type="programlisting" data-code-language="markdown">## Get Regular Season Scoring Totals - By Team
### Use Endpoint: LIST_TEAMS_ENDPOINT</pre>

<p>This section of code includes two techniques that are useful when using pandas to process API data. The SportsWorldCentral API returns JSON data with several nested dictionaries in the <code>weekly_scores</code> element, but you want to have one row per week. You also want to get multiple columns out of the nested column. You will use the pandas <code>json_normalize()</code> function to accomplish these tasks.</p>

<p>This section also introduces the pandas <code>groupby().sum()</code> method, which is similar to the SQL <code>GROUP BY</code> statement. You will use this to total up all of the weekly scoring values and give a total for the entire fantasy regular season. (The NFL plays 18 weeks, but SportsWorldCentral considers weeks 1 through 14 the fantasy regular season, and the rest are the playoffs.)</p>

<p>Add and run a Python code cell with the following:</p>

<pre data-type="programlisting" data-code-language="python">team_api_response = swc.call_api_endpoint(base_url,swc.LIST_TEAMS_ENDPOINT)

teams_parsed_df = pd.json_normalize(team_api_response.json(), 'weekly_scores',
                                   ['league_id', 'team_id', 'team_name'])  <a class="co" id="co_using_apis_for_data_analytics_CO8-1" href="#callout_using_apis_for_data_analytics_CO8-1"><img src="assets/1.png" alt="1" width="12" height="12"/></a>

teams_parsed_df['year'] = (teams_parsed_df['week_number']
                          .str.slice(0, 4).astype(int)) <a class="co" id="co_using_apis_for_data_analytics_CO8-2" href="#callout_using_apis_for_data_analytics_CO8-2"><img src="assets/2.png" alt="2" width="12" height="12"/></a>
teams_parsed_df['week'] = (teams_parsed_df['week_number']
                          .str.slice(4, 6).astype(int))

#get only regular season teams
teams_regular_season_df = teams_parsed_df.query('week &lt;= 14')

#get team season totals
team_totals_df = teams_regular_season_df.groupby(
   ['league_id', 'team_id', 'year'], as_index = False
   )['fantasy_points'].sum() <a class="co" id="co_using_apis_for_data_analytics_CO8-3" href="#callout_using_apis_for_data_analytics_CO8-3"><img src="assets/3.png" alt="3" width="12" height="12"/></a>

team_totals_df.head()</pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_using_apis_for_data_analytics_CO8-1" href="#co_using_apis_for_data_analytics_CO8-1"><img src="assets/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>The pandas <code>json_normalize()</code> function breaks the nested JSON data into multiple rows and extracts new columns.</p></dd>
<dt><a class="co" id="callout_using_apis_for_data_analytics_CO8-2" href="#co_using_apis_for_data_analytics_CO8-2"><img src="assets/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>The pandas <code>str.slice()</code> method is used to extract the <code>year</code> and <code>week</code> values from the <code>week_number</code> field.</p></dd>
<dt><a class="co" id="callout_using_apis_for_data_analytics_CO8-3" href="#co_using_apis_for_data_analytics_CO8-3"><img src="assets/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p>This <code>groupby</code> statement sums the fantasy points by league, team, and year.<a data-type="indexterm" data-startref="ch9work" id="id1928"/><a data-type="indexterm" data-startref="ch9work2" id="id1929"/><a data-type="indexterm" data-startref="ch9work3" id="id1930"/><a data-type="indexterm" data-startref="ch9pandas" id="id1931"/></p></dd>
</dl>
</div></section>






<section data-type="sect1" class="less_space pagebreak-before" data-pdf-bookmark="Calculating the League Balance Score"><div class="sect1" id="id105">
<h1>Calculating the League Balance Score</h1>

<p>With the data loading and formatting<a data-type="indexterm" data-primary="data analytics" data-secondary="creating the Shark League Score" data-tertiary="calculating League Balance Score" id="id1932"/><a data-type="indexterm" data-primary="custom metrics" data-secondary="creating the Shark League Score" data-tertiary="calculating League Balance Score" id="id1933"/><a data-type="indexterm" data-primary="Shark League Score custom metric" data-secondary="calculating League Balance Score" id="id1934"/><a data-type="indexterm" data-primary="League Balance Score calculation" id="id1935"/> out of the way, you can calculate your first metric: the League Balance Score. The intuition behind this metric is that a high-quality league is a balanced league. Instead of being dominated by one or two top teams, the league has a balance of teams that are all competitive.</p>

<p>A balanced league has less variability among the team’s regular season totals. One way to measure for variability is to calculate the <em>standard deviation</em> of the values. However, leagues with high scoring systems tend to have a higher variability, making it difficult to compare leagues with different scoring systems. To adjust for this, you’ll use the <em>coefficient of variation</em> (CV) of each league’s regular season total scores. This takes the <em>standard deviation</em> of the league’s totals and divides it by the <em>mean</em> of the totals.</p>

<p>This gives you a measure of relative variability between the values that adjusts for the overall scoring system. The reason CV works for this situation is that it is <em>dimensionless</em>, which means it can be compared across values of difference sizes—​scoring systems in this case. Here is the exact formula you will use:</p>
<div data-type="equation">
<math alttext="upper L e a g u e upper B a l a n c e upper S c o r e equals 100 minus s t d e v left-parenthesis upper L e a g u e upper R e g u l a r upper S e a s o n upper T o t a l right-parenthesis slash m e a n left-parenthesis upper L e a g u e upper R e g u l a r upper S e a s o n upper T o t a l right-parenthesis asterisk 100" display="block">
  <mrow>
    <mi>L</mi>
    <mi>e</mi>
    <mi>a</mi>
    <mi>g</mi>
    <mi>u</mi>
    <mi>e</mi>
    <mi>B</mi>
    <mi>a</mi>
    <mi>l</mi>
    <mi>a</mi>
    <mi>n</mi>
    <mi>c</mi>
    <mi>e</mi>
    <mi>S</mi>
    <mi>c</mi>
    <mi>o</mi>
    <mi>r</mi>
    <mi>e</mi>
    <mo>=</mo>
    <mn>100</mn>
    <mo>-</mo>
    <mi>s</mi>
    <mi>t</mi>
    <mi>d</mi>
    <mi>e</mi>
    <mi>v</mi>
    <mo>(</mo>
    <mi>L</mi>
    <mi>e</mi>
    <mi>a</mi>
    <mi>g</mi>
    <mi>u</mi>
    <mi>e</mi>
    <mi>R</mi>
    <mi>e</mi>
    <mi>g</mi>
    <mi>u</mi>
    <mi>l</mi>
    <mi>a</mi>
    <mi>r</mi>
    <mi>S</mi>
    <mi>e</mi>
    <mi>a</mi>
    <mi>s</mi>
    <mi>o</mi>
    <mi>n</mi>
    <mi>T</mi>
    <mi>o</mi>
    <mi>t</mi>
    <mi>a</mi>
    <mi>l</mi>
    <mo>)</mo>
    <mo>/</mo>
    <mi>m</mi>
    <mi>e</mi>
    <mi>a</mi>
    <mi>n</mi>
    <mo>(</mo>
    <mi>L</mi>
    <mi>e</mi>
    <mi>a</mi>
    <mi>g</mi>
    <mi>u</mi>
    <mi>e</mi>
    <mi>R</mi>
    <mi>e</mi>
    <mi>g</mi>
    <mi>u</mi>
    <mi>l</mi>
    <mi>a</mi>
    <mi>r</mi>
    <mi>S</mi>
    <mi>e</mi>
    <mi>a</mi>
    <mi>s</mi>
    <mi>o</mi>
    <mi>n</mi>
    <mi>T</mi>
    <mi>o</mi>
    <mi>t</mi>
    <mi>a</mi>
    <mi>l</mi>
    <mo>)</mo>
    <mo>*</mo>
    <mn>100</mn>
  </mrow>
</math>
</div>

<p>A CV is lower if it varies less, but you want a metric where a higher number is better. You also want it to be comparable to the League Juice Score, which has a max value of 100. To accomplish this, you multiply it by 100 and subtract it from 100 to give a number similar in scale to the League Juice Score, and so that a larger number is better, also matching the League Juice Score.</p>

<p>Add another Markdown cell, with the following text:</p>

<pre data-type="programlisting" data-code-language="markdown">## League Balance Score
### Using the Coefficient of Variation (CV) of league regular season totals</pre>

<p>This section also uses<a data-type="indexterm" data-primary="lambda command (Python)" id="id1936"/><a data-type="indexterm" data-primary="Python" data-secondary="lambda command" id="id1937"/> a <code>lambda</code> command to execute Python code during the aggregation. You will use this in several other locations.</p>

<p>Add and run a Python code cell with the following:</p>

<pre data-type="programlisting" data-code-language="python">league_stats_df = team_totals_df.groupby(['league_id','year']).agg(
    league_points_sum=('fantasy_points', 'sum'), <a class="co" id="co_using_apis_for_data_analytics_CO9-1" href="#callout_using_apis_for_data_analytics_CO9-1"><img src="assets/1.png" alt="1" width="12" height="12"/></a>
    league_points_mean=('fantasy_points', 'mean'),
    league_points_stdev=('fantasy_points', 'std'), <a class="co" id="co_using_apis_for_data_analytics_CO9-2" href="#callout_using_apis_for_data_analytics_CO9-2"><img src="assets/2.png" alt="2" width="12" height="12"/></a>
 league_balance_score=('fantasy_points',
                         lambda x: (100 -(x.std() / x.mean()) * 100)) <a class="co" id="co_using_apis_for_data_analytics_CO9-3" href="#callout_using_apis_for_data_analytics_CO9-3"><img src="assets/3.png" alt="3" width="12" height="12"/></a>
).reset_index()

display(league_stats_df.sort_values(by='league_balance_score',
                                         ascending=False)) <a class="co" id="co_using_apis_for_data_analytics_CO9-4" href="#callout_using_apis_for_data_analytics_CO9-4"><img src="assets/4.png" alt="4" width="12" height="12"/></a></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_using_apis_for_data_analytics_CO9-1" href="#co_using_apis_for_data_analytics_CO9-1"><img src="assets/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>This sum value will be used in the next metric, but this is a convenient place to calculate it.</p></dd>
<dt><a class="co" id="callout_using_apis_for_data_analytics_CO9-2" href="#co_using_apis_for_data_analytics_CO9-2"><img src="assets/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>This uses the pandas built-in <code>GroupBy.std</code> calculation for the standard deviation of the league totals.</p></dd>
<dt><a class="co" id="callout_using_apis_for_data_analytics_CO9-3" href="#co_using_apis_for_data_analytics_CO9-3"><img src="assets/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p>This uses <code>lambda</code> to execute a calculation on the aggregated values to calculate the league score and scale it to match the League Juice Score.</p></dd>
<dt><a class="co" id="callout_using_apis_for_data_analytics_CO9-4" href="#co_using_apis_for_data_analytics_CO9-4"><img src="assets/4.png" alt="4" width="12" height="12"/></a></dt>
<dd><p>The pandas <code>sort_values</code> method does not change the underlying structure; it only sorts during the display.</p></dd>
</dl>

<p>The output of this cell is shown in <a data-type="xref" href="#league_balance_ch9">Figure 9-4</a>.</p>

<figure><div id="league_balance_ch9" class="figure">
<img src="assets/haad_0904.png" alt="League Balance Score" width="1006" height="189"/>
<h6><span class="label">Figure 9-4. </span>League Balance Score</h6>
</div></figure>
</div></section>






<section data-type="sect1" data-pdf-bookmark="Calculating the League Juice Score"><div class="sect1" id="id199">
<h1>Calculating the League Juice Score</h1>

<p>The second metric you will <a data-type="indexterm" data-primary="data analytics" data-secondary="creating the Shark League Score" data-tertiary="calculating League Juice Score" id="id1938"/><a data-type="indexterm" data-primary="custom metrics" data-secondary="creating the Shark League Score" data-tertiary="calculating League Juice Score" id="id1939"/><a data-type="indexterm" data-primary="Shark League Score custom metric" data-secondary="calculating League Juice Score" id="id1940"/>calculate is the League Juice Score, which is the percentage of potential points that the league scored for the season. This represents how much juice the league owners squeezed out of the orange, that is, how many potential points were in the starting lineups. In fantasy football, it doesn’t do much good for the week’s top scorers to be sitting on someone’s bench. In a high-quality league, managers are setting starting lineups that get the most from their teams.</p>

<p>One wrinkle to the calculation is that max points differ by the size of the league and the scoring type. <a data-type="indexterm" data-primary="pandas library" data-secondary="DataFrame storage of data" data-tertiary="merging DataFrames into single" id="id1941"/><a data-type="indexterm" data-primary="pandas library" data-secondary="pandas.merge() function to join DataFrames" id="id1942"/>Before you can calculate the score, you need to merge three DataFrames that you already prepared into a single DataFrame:</p>
<dl>
<dt><code>league_stats_df</code></dt>
<dd>
<p>Contains the total points scored by each team and year</p>
</dd>
<dt><code>max_totals_grouped_df</code></dt>
<dd>
<p>Contains the custom max point totals for the regular season</p>
</dd>
<dt><code>leagues_df</code></dt>
<dd>
<p>Contains the scoring type and league size of each league, to match against custom max points</p>
</dd>
</dl>

<p>The exact formula you will use is the following:</p>
<div data-type="equation">
<math alttext="upper L e a g u e upper J u i c e upper S c o r e equals 100 asterisk left-parenthesis upper L e a g u e upper T o t a l upper P o i n t s right-parenthesis slash upper M a x upper P o t e n t i a l upper P o i n t s right-parenthesis" display="block">
  <mrow>
    <mi>L</mi>
    <mi>e</mi>
    <mi>a</mi>
    <mi>g</mi>
    <mi>u</mi>
    <mi>e</mi>
    <mi>J</mi>
    <mi>u</mi>
    <mi>i</mi>
    <mi>c</mi>
    <mi>e</mi>
    <mi>S</mi>
    <mi>c</mi>
    <mi>o</mi>
    <mi>r</mi>
    <mi>e</mi>
    <mo>=</mo>
    <mn>100</mn>
    <mo>*</mo>
    <mo>(</mo>
    <mi>L</mi>
    <mi>e</mi>
    <mi>a</mi>
    <mi>g</mi>
    <mi>u</mi>
    <mi>e</mi>
    <mi>T</mi>
    <mi>o</mi>
    <mi>t</mi>
    <mi>a</mi>
    <mi>l</mi>
    <mi>P</mi>
    <mi>o</mi>
    <mi>i</mi>
    <mi>n</mi>
    <mi>t</mi>
    <mi>s</mi>
    <mo>)</mo>
    <mo>/</mo>
    <mi>M</mi>
    <mi>a</mi>
    <mi>x</mi>
    <mi>P</mi>
    <mi>o</mi>
    <mi>t</mi>
    <mi>e</mi>
    <mi>n</mi>
    <mi>t</mi>
    <mi>i</mi>
    <mi>a</mi>
    <mi>l</mi>
    <mi>P</mi>
    <mi>o</mi>
    <mi>i</mi>
    <mi>n</mi>
    <mi>t</mi>
    <mi>s</mi>
    <mo>)</mo>
  </mrow>
</math>
</div>

<p>Add another Markdown cell with the following text:</p>

<pre data-type="programlisting" data-code-language="markdown">## League Juice Score
### Compare league scoring to max potential scoring</pre>

<p>Add and run a Python code cell with the following:</p>

<pre data-type="programlisting" data-code-language="python">league_stats_with_league_max_df = (league_stats_df[
   ['league_id','year', 'league_points_sum','league_balance_score']]
              .merge(max_totals_grouped_df,left_on = 'year', right_on='year'))<a class="co" id="co_using_apis_for_data_analytics_CO10-1" href="#callout_using_apis_for_data_analytics_CO10-1"><img src="assets/1.png" alt="1" width="12" height="12"/></a>

combined_metrics_df = (leagues_df[
   ['league_id','league_name','scoring_type', 'league_size']]<a class="co" id="co_using_apis_for_data_analytics_CO10-2" href="#callout_using_apis_for_data_analytics_CO10-2"><img src="assets/2.png" alt="2" width="12" height="12"/></a>
   .merge(league_stats_with_league_max_df,
          left_on = 'league_id', right_on = 'league_id'))

combined_metrics_df['league_juice_score'] = combined_metrics_df.apply(<a class="co" id="co_using_apis_for_data_analytics_CO10-3" href="#callout_using_apis_for_data_analytics_CO10-3"><img src="assets/3.png" alt="3" width="12" height="12"/></a>
   lambda row: (
       100 * (row['league_points_sum'] / row['ppr_12_max_points'])<a class="co" id="co_using_apis_for_data_analytics_CO10-4" href="#callout_using_apis_for_data_analytics_CO10-4"><img src="assets/4.png" alt="4" width="12" height="12"/></a>
       if (row['scoring_type'] == 'PPR' and row['league_size'] == 12)
       else (
           100 * (row['league_points_sum'] / row['half_ppr_8_max_points'])
           if (row['scoring_type'] == 'Half-PPR' and row['league_size'] == 8)
           else None
       )
   ),
   axis=1
)

combined_metrics_df = (combined_metrics_df.drop(
   columns=['scoring_type','league_size','league_points_sum'
            ,'ppr_12_max_points','half_ppr_8_max_points',] )
)
display(combined_metrics_df)</pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_using_apis_for_data_analytics_CO10-1" href="#co_using_apis_for_data_analytics_CO10-1"><img src="assets/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>The first step is to combine <code>league_stats_df</code> with <code>max_totals_grouped_df</code>.</p></dd>
<dt><a class="co" id="callout_using_apis_for_data_analytics_CO10-2" href="#co_using_apis_for_data_analytics_CO10-2"><img src="assets/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>Next, you combine <code>leagues_df</code> with the output of the previous step.</p></dd>
<dt><a class="co" id="callout_using_apis_for_data_analytics_CO10-3" href="#co_using_apis_for_data_analytics_CO10-3"><img src="assets/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p>This section uses the <code>apply()</code> method to execute a <code>lambda</code> function against each row to calculate the custom <code>league_juice+score</code> value.</p></dd>
<dt><a class="co" id="callout_using_apis_for_data_analytics_CO10-4" href="#co_using_apis_for_data_analytics_CO10-4"><img src="assets/4.png" alt="4" width="12" height="12"/></a></dt>
<dd><p>You multiply the ratio by 100 to make it a percentage, and scale it to match the League Balance Score.</p></dd>
</dl>

<p>The output of this cell is shown in <a data-type="xref" href="#two_metrics_chapter_9">Figure 9-5</a>.</p>

<figure><div id="two_metrics_chapter_9" class="figure">
<img src="assets/haad_0905.png" alt="League Juice Score" width="879" height="192"/>
<h6><span class="label">Figure 9-5. </span>League Juice Score</h6>
</div></figure>
</div></section>






<section data-type="sect1" data-pdf-bookmark="Creating the Shark League Score"><div class="sect1" id="id106">
<h1>Creating the Shark League Score</h1>

<p>After your API data has been<a data-type="indexterm" data-primary="data analytics" data-secondary="creating the Shark League Score" data-tertiary="building the Shark League Score" id="id1943"/><a data-type="indexterm" data-primary="custom metrics" data-secondary="creating the Shark League Score" data-tertiary="building the Shark League Score" id="id1944"/><a data-type="indexterm" data-primary="Shark League Score custom metric" data-secondary="building the Shark League Score" id="id1945"/> manipulated, munged, and merged, you are ready for the payoff: building your Shark League Score. Based on your decision to weight the League Juice Score double, the final formula you will use is:</p>
<div data-type="equation">
<math alttext="upper S h a r k upper L e a g u e upper S c o r e equals 2 asterisk left-parenthesis upper L e a g u e upper J u i c e upper S c o r e right-parenthesis plus upper L e a g u e upper B a l a n c e upper S c o r e" display="block">
  <mrow>
    <mi>S</mi>
    <mi>h</mi>
    <mi>a</mi>
    <mi>r</mi>
    <mi>k</mi>
    <mi>L</mi>
    <mi>e</mi>
    <mi>a</mi>
    <mi>g</mi>
    <mi>u</mi>
    <mi>e</mi>
    <mi>S</mi>
    <mi>c</mi>
    <mi>o</mi>
    <mi>r</mi>
    <mi>e</mi>
    <mo>=</mo>
    <mn>2</mn>
    <mo>*</mo>
    <mo>(</mo>
    <mi>L</mi>
    <mi>e</mi>
    <mi>a</mi>
    <mi>g</mi>
    <mi>u</mi>
    <mi>e</mi>
    <mi>J</mi>
    <mi>u</mi>
    <mi>i</mi>
    <mi>c</mi>
    <mi>e</mi>
    <mi>S</mi>
    <mi>c</mi>
    <mi>o</mi>
    <mi>r</mi>
    <mi>e</mi>
    <mo>)</mo>
    <mo>+</mo>
    <mi>L</mi>
    <mi>e</mi>
    <mi>a</mi>
    <mi>g</mi>
    <mi>u</mi>
    <mi>e</mi>
    <mi>B</mi>
    <mi>a</mi>
    <mi>l</mi>
    <mi>a</mi>
    <mi>n</mi>
    <mi>c</mi>
    <mi>e</mi>
    <mi>S</mi>
    <mi>c</mi>
    <mi>o</mi>
    <mi>r</mi>
    <mi>e</mi>
  </mrow>
</math>
</div>

<p>Add another Markdown cell, with the following text:</p>

<pre data-type="programlisting" data-code-language="markdown"># Create Shark League Score
## Shark League Score = (2 * League Juice Score) + League Balance Score</pre>

<p>Add and run a Python code cell with the following:</p>

<pre data-type="programlisting" data-code-language="python">combined_metrics_df['shark_league_score'] = combined_metrics_df.apply(
    lambda league: (2 * league['league_juice_score']) +
    league['league_balance_score'],
    axis=1
)
display(combined_metrics_df.sort_values(by='shark_league_score',
ascending=False))</pre>

<p>The output of this cell is shown in <a data-type="xref" href="#shark_league_ch9">Figure 9-6</a>.</p>

<figure><div id="shark_league_ch9" class="figure">
<img src="assets/haad_0906.png" alt="Shark League Score" width="904" height="161"/>
<h6><span class="label">Figure 9-6. </span>Shark League Score</h6>
</div></figure>

<p>Congratulations, you have calculated the Shark League Score based on customized data from the SportsWorldCentral API.<a data-type="indexterm" data-startref="ch9cr8sls" id="id1946"/><a data-type="indexterm" data-startref="ch9cr8sls2" id="id1947"/><a data-type="indexterm" data-startref="ch9cr8sls3" id="id1948"/><a data-type="indexterm" data-startref="ch9cr8sls4" id="id1949"/></p>
</div></section>






<section data-type="sect1" data-pdf-bookmark="Additional Resources"><div class="sect1" id="id107">
<h1>Additional Resources</h1>

<p>For a discussion of the value of statistics in basketball, read <a href="https://oreil.ly/DqSG-">“NBA Insider: Is It Numbers or Talent? Sorting Fact, Fiction in NBA Stats Wave”</a>.<a data-type="indexterm" data-primary="“Is It Numbers or Talent? Sorting Fact, Fiction in NBA Stats Wave” (Beck)" data-primary-sortas="Is It Numbers" id="id1950"/><a data-type="indexterm" data-primary="Beck, Howard" id="id1951"/></p>

<p>To continue building your knowledge of pandas, I recommend <em>Python for Data Analysis: Data Wrangling with pandas, NumPy, and Jupyter</em> (O’Reilly, 2022). It was written by Wes McKinney, the creator of pandas.<a data-type="indexterm" data-primary="pandas library" data-secondary="book on data wrangling by creator" id="id1952"/><a data-type="indexterm" data-primary="Python for Data Analysis (McKinney)" id="id1953"/><a data-type="indexterm" data-primary="McKinney, Wes" id="id1954"/></p>

<p>To learn more detailed charts that can be created with football data from nfl_data_py, I recommend the book <em>Football Analytics with Python &amp; R: Learning Data Science Through the Lens of Sports</em> Eager and Erickson (O’Reilly, 2023).<a data-type="indexterm" data-primary="Football Analytics with Python &amp; R by Erik A. Eager and Richard A. Erickson)" id="id1955"/><a data-type="indexterm" data-primary="Eager, Eric A." id="id1956"/><a data-type="indexterm" data-primary="Erickson, Richard A." id="id1957"/></p>

<p>For more tips on formatting Markdown for your notebook, read the <a href="https://oreil.ly/_7OgB">Markdown Guide</a>.<a data-type="indexterm" data-primary="Markdown formatting guide online" id="id1958"/><a data-type="indexterm" data-primary="resources online" data-secondary="Markdown formatting guide" id="id1959"/></p>

<p>To learn more about the coefficient of variation in other domains, read <a href="https://oreil.ly/yO4zn">“Coefficient of Variation: Meaning and How to Use It”</a>.<a data-type="indexterm" data-primary="“Coefficient of Variation: Meaning and How to Use It” (Hayes)" data-primary-sortas="Coefficient of Variation" id="id1960"/><a data-type="indexterm" data-primary="Hayes, Adam" id="id1961"/></p>

<p>If you’d like to explore more uses of data analytics in fantasy football using Python, Nathan Braun has courses and books available at <a href="https://fantasycoding.com" class="bare"><em class="hyperlink">https://fantasycoding.com</em></a>.<a data-type="indexterm" data-primary="Braun, Nathan" id="id1962"/><a data-type="indexterm" data-primary="fantasycoding.com for data analytics" id="id1963"/><a data-type="indexterm" data-primary="websites for fantasy leagues" data-secondary="fantasycoding.com for data analytics" id="id1964"/><a data-type="indexterm" data-primary="resources online" data-secondary="fantasycoding.com for data analytics" id="id1965"/></p>
</div></section>






<section data-type="sect1" data-pdf-bookmark="Summary"><div class="sect1" id="id389">
<h1>Summary</h1>

<p>In this chapter, you learned about creating custom metrics using API data. You calculated the Shark League Score and learned how to use pandas and Jupyter Notebooks along the way.</p>

<p>In <a data-type="xref" href="ch10.html#chapter_10">Chapter 10</a>, you will build your API and data science skills by calling APIs in a data pipeline built with Apache Airflow.</p>
</div></section>
</div></section></div>
</div>
</body></html>