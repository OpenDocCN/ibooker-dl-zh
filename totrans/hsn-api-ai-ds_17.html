<html><head></head><body>
<div id="book-content">
<div id="sbo-rt-content"><section data-type="chapter" epub:type="chapter" data-pdf-bookmark="Chapter 14. Using APIs with LangChain"><div class="chapter" id="chapter_14">
<h1><span class="label">Chapter 14. </span>Using APIs with LangChain</h1>

<blockquote data-type="epigraph" epub:type="epigraph">
  <p>A system is more “agentic” the more an LLM decides how the system can behave.</p>
  <p data-type="attribution">Harrison Chase, LangChain creator</p>
</blockquote>

<p>AI applications use LLMs as<a data-type="indexterm" data-primary="Chase, Harrison" id="id2478"/><a data-type="indexterm" data-primary="AI (artificial intelligence)" data-secondary="LLMs for natural language interface" data-seealso="LLMs (large language models)" id="id2479"/><a data-type="indexterm" data-primary="LLMs (large language models)" data-secondary="about" data-tertiary="natural language interface for AI apps" id="id2480"/> a natural language interface with users, and researchers are exploring ways to use the LLMs to perform multistep tasks. This chapter examines two important ways that APIs and LLMs are used together to create AI applications. First, you will look at calling LLMs using APIs, and then you will reverse the roles and call APIs with LLMs. You will use LangChain for both of these tasks.</p>

<p>LangChain and its related project, <a data-type="indexterm" data-primary="LangChain" data-secondary="about" id="id2481"/><a data-type="indexterm" data-primary="LangGraph" data-secondary="about" id="id2482"/><a data-type="indexterm" data-primary="agents in AI" data-secondary="agentic AI apps" data-tertiary="AI agent frameworks" id="id2483"/> LangGraph, are open source frameworks for creating <em>agentic</em> applications—applications that use LLMs to control the system behavior. Although many developers build these applications by calling the LLM APIs directly and performing custom coding to interact with them, LangChain and LangGraph standardize many of the tasks required. You can think of them as frameworks that sit on top of the APIs or models.</p>

<p>Here are a few new terms:<a data-type="indexterm" data-primary="agents in AI" data-secondary="agentic AI apps" data-tertiary="terminology" id="id2484"/><a data-type="indexterm" data-primary="LangChain" data-secondary="agentic applications terminology" id="id2485"/></p>
<dl>
<dt>Agent</dt>
<dd>
<p>Harrison Chase defines an agent<a data-type="indexterm" data-primary="agents in AI" data-secondary="about" id="id2486"/><a data-type="indexterm" data-primary="AI (artificial intelligence)" data-secondary="agents" id="id2487"/> as “a system that uses an LLM to decide the control flow of an application.” Agents are not preprogrammed, like traditional software—they use a model to reason and decide the flow of a conversation. They can execute tool calls that are suggested by function-calling models.</p>
</dd>
<dt>Function-calling model</dt>
<dd>
<p>This is a specialized type of model <a data-type="indexterm" data-primary="function-calling models" id="id2488"/><a data-type="indexterm" data-primary="agents in AI" data-secondary="function-calling models" id="id2489"/>that considers available <em>functions</em> or <em>tools</em> and suggests when they should be used. Despite the name, the models don’t call the tool directly; they give that suggestion to <em>agents</em>, who do the calling.</p>
</dd>
<dt>Models</dt>
<dd>
<p>These are the AI models<a data-type="indexterm" data-primary="model as term" data-secondary="models in LangChain" id="id2490"/> that LangChain users call. LangChain can use models that are downloaded locally or called via web APIs provided by model providers.</p>
</dd>
<dt>Model families</dt>
<dd>
<p>These are multiple models that share a name and architecture.<a data-type="indexterm" data-primary="model as term" data-secondary="models in LangChain" data-tertiary="model families" id="id2491"/></p>
</dd>
<dt>Toolkit</dt>
<dd>
<p>This is a collection of multiple tools that an agent will use to perform tasks.<a data-type="indexterm" data-primary="toolkits used by agents" data-secondary="about" id="id2492"/></p>
</dd>
<dt>Tools or functions</dt>
<dd>
<p>This is code that provides extra skills<a data-type="indexterm" data-primary="toolkits used by agents" data-secondary="tools used by AI agents" id="id2493"/> to an agent. A simple Python function might perform mathematical operations. You will create a tool that calls the SWC API.</p>
</dd>
</dl>

<p>The software introduced in this chapter will focus on using the LangChain ecosystem with APIs. <a data-type="xref" href="#tools_table_chapter_14">Table 14-1</a> displays the new tools you will use.<a data-type="indexterm" data-primary="agents in AI" data-secondary="agentic AI apps" data-tertiary="software used" id="id2494"/><a data-type="indexterm" data-primary="LangChain" data-secondary="about" id="id2495"/><a data-type="indexterm" data-primary="LangGraph" data-secondary="about" id="id2496"/><a data-type="indexterm" data-primary="Anthropic" data-secondary="Claude" id="id2497"/><a data-type="indexterm" data-primary="Pydantic" data-secondary="about" id="id2498"/><a data-type="indexterm" data-primary="swcpy SDK" data-secondary="about" data-seealso="SDK (software development kit)" id="id2499"/><a data-type="indexterm" data-primary="LangChain" data-secondary="software in ecosystem" id="id2500"/></p>
<table id="tools_table_chapter_14">
<caption><span class="label">Table 14-1. </span>Tools used in this chapter</caption>
<thead>
<tr>
<th>Software name</th>
<th>Version</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td><p>LangChain</p></td>
<td><p>0.3</p></td>
<td><p>Python library used to create tools and toolkits that allow agents to use your API</p></td>
</tr>
<tr>
<td><p>LangGraph</p></td>
<td><p>0.2</p></td>
<td><p>Python library used to create an agent</p></td>
</tr>
<tr>
<td><p>Anthropic Claude</p></td>
<td><p>3.5 Sonnet</p></td>
<td><p>Model used to provide reasoning to the LangGraph agent</p></td>
</tr>
<tr>
<td><p>Pydantic</p></td>
<td><p>2</p></td>
<td><p>Python library used to perform validation in your toolkit</p></td>
</tr>
<tr>
<td><p>swcpy</p></td>
<td><p>NA</p></td>
<td><p>SDK created in <a data-type="xref" href="ch07.html#chapter_7">Chapter 7</a> for your API</p></td>
</tr>
</tbody>
</table>






<section data-type="sect1" data-pdf-bookmark="Calling AI Using APIs (via LangChain)"><div class="sect1" id="id215">
<h1>Calling AI Using APIs (via LangChain)</h1>

<p><a data-type="xref" href="#langgraph_architecture_ch14">Figure 14-1</a> shows the high-level architecture of the project you will create in this chapter.</p>

<p>To understand the capabilities<a data-type="indexterm" data-primary="LangChain" data-secondary="APIs calling AI via" id="id2501"/><a data-type="indexterm" data-primary="LangChain" data-secondary="chat models list online" id="id2502"/><a data-type="indexterm" data-primary="resources online" data-secondary="LangChain" data-tertiary="chat models list" id="id2503"/><a data-type="indexterm" data-primary="function-calling models" data-secondary="LangChain chat models list online" id="id2504"/><a data-type="indexterm" data-primary="agents in AI" data-secondary="function-calling models" data-tertiary="LangChain chat models list online" id="id2505"/> that LangChain is harnessing, it is helpful to look at the APIs that LangChain interacts with. The <a href="https://oreil.ly/2elFn">LangChain “Chat Models” page</a> lists more than 60 providers of chat models. The list also displays which models are function-calling, which will be important in this chapter because they are capable of using tools to call APIs.</p>

<figure><div id="langgraph_architecture_ch14" class="figure">
<img src="assets/haad_1401.png" alt="High-level architecture" width="1303" height="596"/>
<h6><span class="label">Figure 14-1. </span>High-level architecture</h6>
</div></figure>

<p>If you look at the documentation for these model providers, they typically provide documentation for their APIs and allow you to register for an API key (for a fee). These companies follow many of the best practices from <a data-type="xref" href="ch06.html#chapter_6">Chapter 6</a>: interactive API documentation, SDKs in Python and other languages, methods of contacting support, and many other features. For these providers, APIs are not a side business—they <em>are</em> the business.</p>
<div data-type="warning" epub:type="warning"><h6>Warning</h6>
<p>While it’s tempting to focus only on the potential of LLMs, the model providers also publish some sobering warnings. <a data-type="indexterm" data-primary="model cards for documentation" data-secondary="model providers supplying" id="id2506"/><a data-type="indexterm" data-primary="system cards for documentation" data-secondary="model providers supplying" id="id2507"/><a data-type="indexterm" data-primary="documentation" data-secondary="machine learning models" data-tertiary="model and system cards from model providers" id="id2508"/><a data-type="indexterm" data-primary="LLMs (large language models)" data-secondary="model providers supplying model or system cards" id="id2509"/>The providers often provide a <em>model card</em> or <em>system card</em> that describes the intended use and limitations of their models. At the time of this writing, these cards of major LLMs list risks such as bias, hallucinations, mistakes, and harmful content. <a data-type="indexterm" data-primary="Anthropic" data-secondary="Claude" data-tertiary="warning about model risks" id="id2510"/> For example, Anthropic states in their article, <a href="https://oreil.ly/vq7FK">“The Claude 3 Model Family: Opus, Sonnet, Haiku”: “The models should not be used on their own in high-stakes situations”</a>.</p>

<p>In this chapter, you will be using a read-only fantasy football API, which is low risk.</p>
</div>
</div></section>






<section data-type="sect1" data-pdf-bookmark="Creating a LangGraph Agent"><div class="sect1" id="create_lang_agent">
<h1>Creating a LangGraph Agent</h1>
<blockquote data-type="epigraph" epub:type="epigraph">
  <p>Letting an LLM decide the control flow of an application (i.e. what we call agents) is attractive, as they can unlock a variety of tasks that couldn’t previously be automated. In practice, however, it is incredibly difficult to build systems that reliably execute on these tasks.</p>
  <p data-type="attribution">LangChain blog post, <a href="https://oreil.ly/KoxAw">“Announcing LangGraph v0.1 &amp; LangGraph Cloud: Running agents at scale, reliably”</a>, June 2024</p>
</blockquote>

<p class="less_space pagebreak-before">LangGraph is a LangChain-related <a data-type="indexterm" data-primary="agents in AI" data-secondary="creating a LangGraph agent" id="ch14cr8agnt"/><a data-type="indexterm" data-primary="LangGraph" data-secondary="creating an agent" id="ch14cr8agnt2"/><a data-type="indexterm" data-primary="Anthropic" data-secondary="creating a LangGraph agent" id="ch14cr8agnt3"/><a data-type="indexterm" data-primary="LangGraph" data-secondary="about" id="id2511"/>project focused on creating applications that have one or more agents working together. <a data-type="indexterm" data-primary="LangChain" data-secondary="agent legacy methods" data-seealso="LangGraph" id="id2512"/>LangChain has methods for using agents, which have recently been labeled as <em>legacy methods</em>, at the time of this writing. LangGraph is intended to be an improvement on these methods by allowing more developer control and supporting multiagent applications.</p>

<p>LangGraph uses some terminology<a data-type="indexterm" data-primary="agents in AI" data-secondary="creating a LangGraph agent" data-tertiary="terminology" id="id2513"/><a data-type="indexterm" data-primary="LangGraph" data-secondary="creating an agent" data-tertiary="terminology" id="id2514"/><a data-type="indexterm" data-primary="Anthropic" data-secondary="creating a LangGraph agent" data-tertiary="terminology" id="id2515"/> from mathematical graph theory (see <a data-type="xref" href="ch10.html#data_pipeline_apache_airflow">“Orchestrating the Data Pipeline with Apache Airflow”</a>). <a data-type="indexterm" data-primary="nodes (LangGraph)" id="id2516"/><a data-type="indexterm" data-primary="state of the application (LangGraph)" id="id2517"/><a data-type="indexterm" data-primary="edges (LangGraph)" id="id2518"/>The logical flow of LangGraph agents is represented by <em>nodes</em>, which are processes that update the <em>state</em> of the application. The nodes are connected by <em>edges</em>, which are one-way flows between one node and another. <a data-type="indexterm" data-primary="cyclical graphs of LangGraph" id="id2519"/>Where Airflow had <em>acyclic</em> graphs that begin at a start node and go in one direction to an end node, LangGraph allows <em>cyclical</em> graphs, where nodes and edges can loop multiple times. For example, a loop may allow a user to ask multiple questions to a model before getting the final answer.</p>

<p><a data-type="xref" href="#directed_cyclic_graph_ch14">Figure 14-2</a> shows<a data-type="indexterm" data-primary="directed cyclic graphs of LangGraph" id="id2520"/><a data-type="indexterm" data-primary="edges (LangGraph)" data-secondary="directed cyclic graph" id="id2521"/><a data-type="indexterm" data-primary="nodes (LangGraph)" data-secondary="directed cyclic graph" id="id2522"/> how nodes and edges relate to each other in a <em>directed cyclic graph</em> that contains loops.</p>

<figure><div id="directed_cyclic_graph_ch14" class="figure">
<img src="assets/haad_1402.png" alt="Directed cyclic graph" width="626" height="431"/>
<h6><span class="label">Figure 14-2. </span>Directed cyclic graph</h6>
</div></figure>

<p>You will be creating an agent in this chapter that can be represented by a directed cyclic graph.</p>








<section data-type="sect2" data-pdf-bookmark="Signing Up for Anthropic"><div class="sect2" id="id143">
<h2>Signing Up for Anthropic</h2>

<p>You will be using a model from Anthropic,<a data-type="indexterm" data-primary="Anthropic" data-secondary="account created" id="id2523"/><a data-type="indexterm" data-primary="LangGraph" data-secondary="creating an agent" data-tertiary="Anthropic account" id="id2524"/><a data-type="indexterm" data-primary="agents in AI" data-secondary="creating a LangGraph agent" data-tertiary="Anthropic account" id="id2525"/><a data-type="indexterm" data-primary="Anthropic" data-secondary="creating a LangGraph agent" data-tertiary="Anthropic account" id="id2526"/> so you need to sign up for an Anthropic account at the <a href="https://console.anthropic.com/login">“Build with Claude” web page</a>.</p>

<p>To use the Anthropic API, <a data-type="indexterm" data-primary="Anthropic" data-secondary="account created" data-tertiary="API requiring Build Plan" id="id2527"/>you will need to upgrade your initial account to a Build Plan and add funds to your account. <a data-type="indexterm" data-primary="costs for Anthropic Build Plan" id="id2528"/>To limit potential overspending, I suggest initially adding $5 and disabling auto-reload. This means the maximum amount you can spend is $5, even if your API key is misused.</p>

<p class="less_space pagebreak-before">Next, navigate to the <a href="https://oreil.ly/fcaYA">Anthropic API keys page</a> and<a data-type="indexterm" data-primary="resources online" data-secondary="Anthropic" data-tertiary="API keys page" id="id2529"/><a data-type="indexterm" data-primary="Anthropic" data-secondary="API keys page" id="id2530"/><a data-type="indexterm" data-primary="Anthropic" data-secondary="API keys page" data-tertiary="create key" id="id2531"/><a data-type="indexterm" data-primary="agents in AI" data-secondary="creating a LangGraph agent" data-tertiary="Anthropic API key created" id="id2532"/><a data-type="indexterm" data-primary="LangGraph" data-secondary="creating an agent" data-tertiary="Anthropic API key created" id="id2533"/><a data-type="indexterm" data-primary="Anthropic" data-secondary="creating a LangGraph agent" data-tertiary="Anthropic API key created" id="id2534"/> select Create Key. Give the key a name such as <strong><code>secret-api-key</code></strong> and select the Default workspace. Your display should look like <a data-type="xref" href="#anthropic_api_key_ch14">Figure 14-3</a>.</p>

<figure><div id="anthropic_api_key_ch14" class="figure">
<img src="assets/haad_1403.png" alt="Creating Anthropic API key" width="418" height="305"/>
<h6><span class="label">Figure 14-3. </span>Creating an Anthropic API key</h6>
</div></figure>

<p>Click Add. You will be prompted to “Save Your API key.” This is the only time the key will be displayed. <a data-type="indexterm" data-primary="security" data-secondary="Anthropic API key" id="id2535"/>Store this key in a secure location.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>If you lose your Anthropic API key<a data-type="indexterm" data-primary="credentials handled safely" data-secondary="Anthropic API key" id="id2536"/><a data-type="indexterm" data-primary="rotating a credential" id="id2537"/><a data-type="indexterm" data-primary="security" data-secondary="rotating a credential" id="id2538"/> or think it may have been exposed, delete it from the keys page and create a new one. This is called <em>rotating</em> a credential, and it is a convenient way to lower the risk of your API key being abused.</p>
</div>
</div></section>








<section data-type="sect2" data-pdf-bookmark="Launching Your GitHub Codespace"><div class="sect2" id="id144">
<h2>Launching Your GitHub Codespace</h2>

<p>Before you launch the GitHub Codespace for this chapter,<a data-type="indexterm" data-primary="Codespaces (GitHub)" data-secondary="secret added" id="id2539"/><a data-type="indexterm" data-primary="GitHub" data-secondary="Codespaces" data-tertiary="secret added" id="id2540"/><a data-type="indexterm" data-primary="secret added to Codespace" id="id2541"/><a data-type="indexterm" data-primary="Anthropic" data-secondary="API keys page" data-tertiary="adding secret to Codespace" id="id2542"/><a data-type="indexterm" data-primary="LangGraph" data-secondary="creating an agent" data-tertiary="Codespace secret for Anthropic API key" id="id2543"/> you want to add the Anthropic API key as a secret in your Codespace. This will allow you to use the Anthropic models with LangGraph.</p>

<p>Follow the instructions<a data-type="indexterm" data-primary="resources online" data-secondary="GitHub Codespaces" data-tertiary="secret added" id="id2544"/> for <a href="https://oreil.ly/VGSJ3">“Adding a secret”</a> and create a new secret with the following information:</p>

<ul>
<li>
<p><em>Name</em>: <code>ANTHROPIC_API_KEY</code></p>
</li>
<li>
<p><em>Value</em>: Use the value of the Anthropic API key you created in the previous section.</p>
</li>
<li>
<p><em>Repository access:</em> Select the <code>ai-project</code> repository.</p>
</li>
</ul>

<p>When completed, you should see the key saved as shown in <a data-type="xref" href="#codespaces_secret_ch14">Figure 14-4</a>.</p>

<figure><div id="codespaces_secret_ch14" class="figure">
<img src="assets/haad_1404.png" alt="Codespaces secrets" width="958" height="276"/>
<h6><span class="label">Figure 14-4. </span>Codespaces secrets</h6>
</div></figure>
</div></section>
</div></section>






<section data-type="sect1" data-pdf-bookmark="Installing the New Libraries in Your Codespace"><div class="sect1" id="id216">
<h1>Installing the New Libraries in Your Codespace</h1>

<p>Now launch your Codespace. <a data-type="indexterm" data-primary="LangGraph" data-secondary="creating an agent" data-tertiary="installing new libraries" id="id2545"/><a data-type="indexterm" data-primary="agents in AI" data-secondary="creating a LangGraph agent" data-tertiary="installing new libraries" id="id2546"/><a data-type="indexterm" data-primary="Anthropic" data-secondary="creating a LangGraph agent" data-tertiary="installing new libraries" id="id2547"/>You will be working with the Part III GitHub Codespace that you created in <a data-type="xref" href="ch12.html#cloning_part_3_sect">“Cloning the Part III Repository”</a>. If you haven’t created your Part III Codespace yet, you can complete that section now. To install the libraries you need for this chapter, create a file named <em>chapter14/requirements.txt</em>:<a data-type="indexterm" data-primary="requirements.txt file for pip" data-secondary="installing LangChain, LangGraph" id="id2548"/></p>

<pre data-type="programlisting" data-code-language="shell">.../analytics-project (main) $ cd chapter14
.../chapter14 (main) $ touch requirements.txt</pre>

<p>Update <em>chapter14/requirements.txt</em> with the following contents:</p>

<pre data-type="programlisting" data-code-language="shell">langchain_core&gt;=0.3.0,&lt;0.4.0 <a class="co" id="co_using_apis_with_langchain_CO1-1" href="#callout_using_apis_with_langchain_CO1-1"><img src="assets/1.png" alt="1" width="12" height="12"/></a>
langchain_anthropic&gt;=0.2.0,&lt;0.3.0 <a class="co" id="co_using_apis_with_langchain_CO1-2" href="#callout_using_apis_with_langchain_CO1-2"><img src="assets/2.png" alt="2" width="12" height="12"/></a>
langgraph&gt;=0.2.0,&lt;0.3.0  <a class="co" id="co_using_apis_with_langchain_CO1-3" href="#callout_using_apis_with_langchain_CO1-3"><img src="assets/3.png" alt="3" width="12" height="12"/></a></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_using_apis_with_langchain_CO1-1" href="#co_using_apis_with_langchain_CO1-1"><img src="assets/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>This installs the base LangChain library and its dependencies.</p></dd>
<dt><a class="co" id="callout_using_apis_with_langchain_CO1-2" href="#co_using_apis_with_langchain_CO1-2"><img src="assets/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>This library is used for the specific model you use in this chapter.</p></dd>
<dt><a class="co" id="callout_using_apis_with_langchain_CO1-3" href="#co_using_apis_with_langchain_CO1-3"><img src="assets/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p>This is the LangGraph library used to define your agent.</p></dd>
</dl>

<p>Execute the following command to install the new libraries in your Codespace, and make sure to upgrade to the latest version available:</p>

<pre data-type="programlisting" data-code-language="shell">.../chapter14 (main) $ pip3 install --upgrade -r requirements.txt</pre>

<p>You should see a message that states that these libraries were successfully installed.</p>
</div></section>






<section data-type="sect1" data-pdf-bookmark="Creating Your Jupyter Notebook"><div class="sect1" id="id145">
<h1>Creating Your Jupyter Notebook</h1>

<p>You will be using a Jupyter Notebook<a data-type="indexterm" data-primary="agents in AI" data-secondary="creating a LangGraph agent" data-tertiary="Jupyter Notebook created" id="id2549"/><a data-type="indexterm" data-primary="LangGraph" data-secondary="creating an agent" data-tertiary="Jupyter Notebook created" id="id2550"/><a data-type="indexterm" data-primary="Jupyter Notebooks" data-secondary="creating a Jupyter Notebook" data-tertiary="LangGraph agent" id="id2551"/><a data-type="indexterm" data-primary="Anthropic" data-secondary="creating a LangGraph agent" data-tertiary="Jupyter Notebook created" id="id2552"/><a data-type="indexterm" data-primary="Codespaces (GitHub)" data-secondary="terminal window" data-tertiary="Jupyter Notebook created" id="id2553"/><a data-type="indexterm" data-primary="GitHub" data-secondary="Codespaces" data-tertiary="terminal window for creating Jupyter Notebook" id="id2554"/> to implement a conversational chat agent, based on an example from the <a href="https://oreil.ly/U-TJF">LangChain GitHub repository</a>.</p>

<p class="less_space pagebreak-before">To get started, run the following commands in the Terminal window to create the new directory and the Jupyter Notebook you will be using in this chapter:</p>

<pre data-type="programlisting" data-code-language="shell">.../chapter14 (main) $ touch langgraph_notebook.ipynb</pre>

<p>Click the <em>langgraph_notebook.ipynb</em> file to open it.<a data-type="indexterm" data-primary=".ipynb file extension" data-secondary="langgraph_notebook.ipynb" data-primary-sortas="ipynb" id="id2555"/><a data-type="indexterm" data-primary="langgraph_notebook.ipynb" id="id2556"/> In the top-right of the file, click Select Kernel. Codespaces should prompt you to “Install/Enable suggested extensions Python + Jupyter”—select this. Click Install in the additional pop-up window, if prompted. This will install some extensions to VS Code.</p>

<p>After the installation completes, the title of the window will change to Select Another Kernel. Select Python Environments. The title of the window will change to Select a Python Environment. One Python version should be listed with a star next to it—select this Python version.</p>

<p>Click “+ Markdown” to create a new Markdown cell. Enter the following title in the Markdown cell:<a data-type="indexterm" data-primary="Jupyter Notebooks" data-secondary="adding code" data-tertiary="LangGraph agent" id="ch14agntcod"/><a data-type="indexterm" data-primary="LangGraph" data-secondary="creating an agent" data-tertiary="Jupyter Notebook code" id="ch14agntcod2"/><a data-type="indexterm" data-primary="agents in AI" data-secondary="creating a LangGraph agent" data-tertiary="Jupyter Notebook code" id="ch14agntcod3"/><a data-type="indexterm" data-primary="Anthropic" data-secondary="creating a LangGraph agent" data-tertiary="Jupyter Notebook code" id="ch14agntcod4"/></p>

<pre data-type="programlisting" data-code-language="markdown"># LangGraph Agent
## Without tools</pre>

<p>Run this cell by clicking the play icon on the left of the cell or by pressing Shift-Enter. You should see your message formatted as a title.</p>

<p>Create another Markdown cell and run it with the following:</p>

<pre data-type="programlisting" data-code-language="markdown">## Library Imports</pre>

<p>Hover your cursor below this cell and click “+ Code” to create a new Python cell. Enter the following code in the Python cell:</p>

<pre data-type="programlisting" data-code-language="python">from langchain_core.messages import HumanMessage <a class="co" id="co_using_apis_with_langchain_CO2-1" href="#callout_using_apis_with_langchain_CO2-1"><img src="assets/1.png" alt="1" width="12" height="12"/></a>
from langchain_anthropic import ChatAnthropic <a class="co" id="co_using_apis_with_langchain_CO2-2" href="#callout_using_apis_with_langchain_CO2-2"><img src="assets/2.png" alt="2" width="12" height="12"/></a>
from langgraph.checkpoint.memory import MemorySaver <a class="co" id="co_using_apis_with_langchain_CO2-3" href="#callout_using_apis_with_langchain_CO2-3"><img src="assets/3.png" alt="3" width="12" height="12"/></a>
from langgraph.graph import END, START, StateGraph, MessagesState
import logging
from IPython.display import Image, Markdown, display <a class="co" id="co_using_apis_with_langchain_CO2-4" href="#callout_using_apis_with_langchain_CO2-4"><img src="assets/4.png" alt="4" width="12" height="12"/></a>
from langchain_core.runnables.graph import CurveStyle,
MermaidDrawMethod, NodeStyles <a class="co" id="co_using_apis_with_langchain_CO2-5" href="#callout_using_apis_with_langchain_CO2-5"><img src="assets/5.png" alt="5" width="12" height="12"/></a></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_using_apis_with_langchain_CO2-1" href="#co_using_apis_with_langchain_CO2-1"><img src="assets/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>This import defines the messages you’ll use to communicate with the agent.</p></dd>
<dt><a class="co" id="callout_using_apis_with_langchain_CO2-2" href="#co_using_apis_with_langchain_CO2-2"><img src="assets/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>This is the library for using the Anthropic model.<a data-type="indexterm" data-primary="Anthropic" data-secondary="library import on Jupyter Notebook" id="id2557"/></p></dd>
<dt><a class="co" id="callout_using_apis_with_langchain_CO2-3" href="#co_using_apis_with_langchain_CO2-3"><img src="assets/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p>The following libraries enable different parts of the LangGraph framework.</p></dd>
<dt><a class="co" id="callout_using_apis_with_langchain_CO2-4" href="#co_using_apis_with_langchain_CO2-4"><img src="assets/4.png" alt="4" width="12" height="12"/></a></dt>
<dd><p>This will be used for the formatting of the messages returned by the agent.</p></dd>
<dt><a class="co" id="callout_using_apis_with_langchain_CO2-5" href="#co_using_apis_with_langchain_CO2-5"><img src="assets/5.png" alt="5" width="12" height="12"/></a></dt>
<dd><p>This will be used to display a visual view of the graph.</p></dd>
</dl>

<p>Placing all the imports at the<a data-type="indexterm" data-primary="import statement (Python)" data-secondary="placing at top of files" id="id2558"/><a data-type="indexterm" data-primary="Jupyter Notebooks" data-secondary="import statements placed at top" id="id2559"/><a data-type="indexterm" data-primary="Python" data-secondary="import statement" data-tertiary="placing at top of files" id="id2560"/> top of your notebook helps keep track of the libraries you are using. These imports will work for all the cells in this Jupyter Notebook.</p>

<p>Add another Markdown cell with the following text:<a data-type="indexterm" data-primary="logging" data-secondary="Jupyter Notebook" data-tertiary="LangGraph agent" id="id2561"/><a data-type="indexterm" data-primary="Jupyter Notebooks" data-secondary="logging" data-tertiary="LangGraph agent" id="id2562"/></p>

<pre data-type="programlisting" data-code-language="markdown">## Configure logging</pre>

<p>Add and run a Python code cell with the following:</p>

<pre data-type="programlisting" data-code-language="python">for handler in logging.root.handlers[:]: <a class="co" id="co_using_apis_with_langchain_CO3-1" href="#callout_using_apis_with_langchain_CO3-1"><img src="assets/1.png" alt="1" width="12" height="12"/></a>
    logging.root.removeHandler(handler)

logging.basicConfig(
    filename='langgraph_notebook.log',
    level=logging.INFO,  <a class="co" id="co_using_apis_with_langchain_CO3-2" href="#callout_using_apis_with_langchain_CO3-2"><img src="assets/2.png" alt="2" width="12" height="12"/></a>
)</pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_using_apis_with_langchain_CO3-1" href="#co_using_apis_with_langchain_CO3-1"><img src="assets/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>This statement removes any existing logging handlers configured by Codespaces.</p></dd>
<dt><a class="co" id="callout_using_apis_with_langchain_CO3-2" href="#co_using_apis_with_langchain_CO3-2"><img src="assets/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>This sets the logging level to record in the log. Review <a data-type="xref" href="ch07.html#python_logging_levels_ch7">Table 7-1</a> for more details about Python logging.</p></dd>
</dl>

<p>Add another Markdown cell with the following text:</p>

<pre data-type="programlisting" data-code-language="markdown">## Configure Agent and Model</pre>

<p>Add and run a Python code cell with the following:<a data-type="indexterm" data-primary="agents in AI" data-secondary="creating a LangGraph agent" data-tertiary="configuring agent and model" id="id2563"/><a data-type="indexterm" data-primary="LangGraph" data-secondary="creating an agent" data-tertiary="configuring agent and model" id="id2564"/><a data-type="indexterm" data-primary="Anthropic" data-secondary="creating a LangGraph agent" data-tertiary="configuring agent and model" id="id2565"/></p>

<pre data-type="programlisting" data-code-language="python">model = ChatAnthropic(model="claude-3-5-sonnet-20240620", temperature=0) <a class="co" id="co_using_apis_with_langchain_CO4-1" href="#callout_using_apis_with_langchain_CO4-1"><img src="assets/1.png" alt="1" width="12" height="12"/></a>

def call_model(state: MessagesState): <a class="co" id="co_using_apis_with_langchain_CO4-2" href="#callout_using_apis_with_langchain_CO4-2"><img src="assets/2.png" alt="2" width="12" height="12"/></a>
    messages = state['messages']
    response = model.invoke(messages)
    return {"messages": [response]}

workflow = StateGraph(MessagesState) <a class="co" id="co_using_apis_with_langchain_CO4-3" href="#callout_using_apis_with_langchain_CO4-3"><img src="assets/3.png" alt="3" width="12" height="12"/></a>

workflow.add_node("agent", call_model) <a class="co" id="co_using_apis_with_langchain_CO4-4" href="#callout_using_apis_with_langchain_CO4-4"><img src="assets/4.png" alt="4" width="12" height="12"/></a>

workflow.add_edge(START, "agent") <a class="co" id="co_using_apis_with_langchain_CO4-5" href="#callout_using_apis_with_langchain_CO4-5"><img src="assets/5.png" alt="5" width="12" height="12"/></a>

checkpointer = MemorySaver()

app = workflow.compile(checkpointer=checkpointer) <a class="co" id="co_using_apis_with_langchain_CO4-6" href="#callout_using_apis_with_langchain_CO4-6"><img src="assets/6.png" alt="6" width="12" height="12"/></a></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_using_apis_with_langchain_CO4-1" href="#co_using_apis_with_langchain_CO4-1"><img src="assets/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>This initializes the Anthropic model. <a data-type="indexterm" data-primary="temperature" data-secondary="Anthropic model" id="id2566"/>The <code>temperature</code> sets how creative the responses are. Lower is less creative and more predictable.</p></dd>
<dt><a class="co" id="callout_using_apis_with_langchain_CO4-2" href="#co_using_apis_with_langchain_CO4-2"><img src="assets/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>This function is used to send messages to the model using the <code>state</code> object.</p></dd>
<dt><a class="co" id="callout_using_apis_with_langchain_CO4-3" href="#co_using_apis_with_langchain_CO4-3"><img src="assets/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p>The <code>workflow</code> is used to define the tasks available to the agent.</p></dd>
<dt><a class="co" id="callout_using_apis_with_langchain_CO4-4" href="#co_using_apis_with_langchain_CO4-4"><img src="assets/4.png" alt="4" width="12" height="12"/></a></dt>
<dd><p>The <code>agent</code> node will use the <code>call_model</code> function defined above.<a data-type="indexterm" data-primary="nodes (LangGraph)" data-secondary="agent node" id="id2567"/></p></dd>
<dt><a class="co" id="callout_using_apis_with_langchain_CO4-5" href="#co_using_apis_with_langchain_CO4-5"><img src="assets/5.png" alt="5" width="12" height="12"/></a></dt>
<dd><p>This defines the start of the graph, which will directly call the <code>agent</code> node.</p></dd>
<dt><a class="co" id="callout_using_apis_with_langchain_CO4-6" href="#co_using_apis_with_langchain_CO4-6"><img src="assets/6.png" alt="6" width="12" height="12"/></a></dt>
<dd><p>This statement compiles the graph<a data-type="indexterm" data-primary="agents in AI" data-secondary="creating a LangGraph agent" data-tertiary="LangChain runnable object" id="id2568"/><a data-type="indexterm" data-primary="LangGraph" data-secondary="creating an agent" data-tertiary="LangChain runnable object" id="id2569"/><a data-type="indexterm" data-primary="Anthropic" data-secondary="creating a LangGraph agent" data-tertiary="LangChain runnable object" id="id2570"/><a data-type="indexterm" data-primary="LangChain" data-secondary="runnable object from LangGraph" id="id2571"/> into a LangChain <code>Runnable</code> object named <code>app</code>. (For more information, see the  <a href="https://oreil.ly/UJJzq">documentation for the Runnable interface</a>.) The <code>app</code> object will act as the agent.</p></dd>
</dl>

<p>Viewing a visual representation<a data-type="indexterm" data-primary="nodes (LangGraph)" data-secondary="displaying an image of" id="id2572"/><a data-type="indexterm" data-primary="edges (LangGraph)" data-secondary="displaying an image of" id="id2573"/><a data-type="indexterm" data-primary="agents in AI" data-secondary="creating a LangGraph agent" data-tertiary="visualizing the graph" id="id2574"/><a data-type="indexterm" data-primary="LangGraph" data-secondary="creating an agent" data-tertiary="visualizing the graph" id="id2575"/><a data-type="indexterm" data-primary="Anthropic" data-secondary="creating a LangGraph agent" data-tertiary="visualizing the graph" id="id2576"/> of the graph will help you see the nodes and edges that were created in this code, and the flow of the agent you created. Add another Markdown cell with the following text:</p>

<pre data-type="programlisting" data-code-language="markdown">## Visualize the Graph</pre>

<p>Add and run a Python code cell with the following:</p>

<pre data-type="programlisting" data-code-language="python">display(
    Image(
        app.get_graph().draw_mermaid_png(
            draw_method=MermaidDrawMethod.API,
        )
    )
)</pre>

<p>Displaying an image of the graph demonstrates the flow of your agent. You should see an image that matches <a data-type="xref" href="#graph_visual_1_ch14">Figure 14-5</a>. This shows that the graph will start and a message will be sent to the agent without referencing any other nodes.<a data-type="indexterm" data-startref="ch14cr8agnt" id="id2577"/><a data-type="indexterm" data-startref="ch14cr8agnt2" id="id2578"/><a data-type="indexterm" data-startref="ch14cr8agnt3" id="id2579"/><a data-type="indexterm" data-startref="ch14agntcod" id="id2580"/><a data-type="indexterm" data-startref="ch14agntcod2" id="id2581"/><a data-type="indexterm" data-startref="ch14agntcod3" id="id2582"/><a data-type="indexterm" data-startref="ch14agntcod4" id="id2583"/></p>

<figure><div id="graph_visual_1_ch14" class="figure">
<img src="assets/haad_1405.png" alt="Graph of the basic agent" width="141" height="181"/>
<h6><span class="label">Figure 14-5. </span>Graph of the basic agent</h6>
</div></figure>
</div></section>






<section data-type="sect1" data-pdf-bookmark="Chatting with the LangGraph Agent"><div class="sect1" id="id146">
<h1>Chatting with the LangGraph Agent</h1>

<p>You are ready to have a conversation<a data-type="indexterm" data-primary="agents in AI" data-secondary="chatting with LangGraph agent" id="ch14chat"/><a data-type="indexterm" data-primary="LangGraph" data-secondary="chatting with LangGraph agent" id="ch14chat2"/><a data-type="indexterm" data-primary="Anthropic" data-secondary="chatting with LangGraph agent" id="ch14chat3"/><a data-type="indexterm" data-primary="chatting with LangGraph agent" id="ch14chat4"/> with the agent you have created. You will accomplish this by using the <code>app.invoke()</code> method along with a <code>messages</code> object. The call to the <code>invoke()</code> method also includes a <code>config</code> object with a <code>thread_id</code> value. The <code>thread_id</code> allows the agent to remember previous messages in the <span class="keep-together">conversation.</span></p>

<p>Add another Markdown cell with the following text:</p>

<pre data-type="programlisting" data-code-language="markdown">## Chat with the Agent</pre>

<p>Add and run a Python code cell with the following:</p>

<pre data-type="programlisting" data-code-language="python">final_state = app.invoke(
    {"messages": [HumanMessage(content="What teams did Joe Montana play for?")]},
    config={"configurable": {"thread_id": 99}}
)
display(Markdown(final_state["messages"][-1].content))</pre>

<p>This is how you will chat with your agent. The <code>app.invoke</code> command sends the <span class="keep-together"><code>messages</code></span> object and adds a question as a <code>HumanMessage</code>. The <code>config</code> object passes a <code>thread_id</code> so that the agent knows you are in the same conversation. While you are using this <code>thread_id</code>, the agent will remember the previous messages in the same conversation. After each <code>invoke()</code> statement, the <code>final_state</code> object contains a list of messages between the model and the human.</p>

<p>To get the most recent message in the conversation, you will display <code>final_state["messages"][-1].content</code>. The messages will have Markdown formatting, so you can use the <code>display(Markdown())</code> statement to format them <span class="keep-together">correctly.</span></p>

<p>Remember that models are <em>nondeterministic</em>, even<a data-type="indexterm" data-primary="temperature" data-secondary="models non-deterministic" id="id2584"/><a data-type="indexterm" data-primary="AI (artificial intelligence)" data-secondary="models non-deterministic" id="id2585"/> with a temperature setting of zero. This means that each interaction may be slightly different. But if your call to the graph is successful, you should see a message similar to this:</p>

<pre data-type="programlisting" data-code-language="text">Joe Montana played for two NFL teams during his professional career:

1. San Francisco 49ers (1979-1992)
2. Kansas City Chiefs (1993-1994)
He spent the majority of his career with the 49ers, where he achieved his
greatest success, before finishing his career with two seasons in Kansas City.</pre>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>If you receive an error at this step<a data-type="indexterm" data-primary="agents in AI" data-secondary="chatting with LangGraph agent" data-tertiary="error with API key" id="id2586"/><a data-type="indexterm" data-primary="Anthropic" data-secondary="chatting with LangGraph agent" data-tertiary="error with API key" id="id2587"/><a data-type="indexterm" data-primary="chatting with LangGraph agent" data-secondary="error with API key" id="id2588"/><a data-type="indexterm" data-primary="LangGraph" data-secondary="chatting with LangGraph agent" data-tertiary="error with API key" id="id2589"/><a data-type="indexterm" data-primary="Anthropic" data-secondary="API keys page" data-tertiary="error with API key during chat" id="id2590"/> related to the API key, check to make sure that you have added funds to your Anthropic account, created an API key, and set it in your Codespaces secrets. If any of these steps were skipped, you won’t be able to use the Anthropic model in this example.</p>
</div>

<p>It appears that the Anthropic model has been trained with historical information about the NFL. Let’s see how it does when we ask questions about the SportsWorldCentral app. Add and run a Python code cell with the following:</p>

<pre data-type="programlisting" data-code-language="python">final_state = app.invoke(
    {"messages": [HumanMessage(content="What are the leagues in the
    SportsWorldCentral fantasy football platform?")]},
    config={"configurable": {"thread_id": 99}}
)
display(Markdown(final_state["messages"][-1].content))</pre>

<p class="less_space pagebreak-before">You will receive a message similar to the following:</p>

<pre data-type="programlisting" data-code-language="text">I apologize, but I don't have any specific information about leagues in a
platform called "SportsWorldCentral" for fantasy football. Fantasy football
platforms can vary widely in their league structures and offerings, and I'm not
familiar with this particular one. If this is a real platform, you might
need to check their website or contact their customer support
for accurate information about their league types and structures.
If you have more general questions about fantasy football leagues,
I'd be happy to help with those.</pre>

<p>The model apparently suspects that SportsWorldCentral may not be “a real platform,” but even for real-world platforms like Sleeper or MyFantasyLeague.com, the model doesn’t contain information about specific leagues and teams.</p>

<p>To solve this knowledge gap, you will create a toolkit that provides access to the SportsWorldCentral API.<a data-type="indexterm" data-primary="agents in AI" data-secondary="toolkit for SWC API" id="ch14tlkt"/><a data-type="indexterm" data-primary="LangChain" data-secondary="toolkit for SWC API" id="ch14tlkt2"/><a data-type="indexterm" data-primary="toolkits used by agents" data-secondary="SWC API toolkit" id="ch14tlkt3"/><a data-type="indexterm" data-startref="ch14chat" id="id2591"/><a data-type="indexterm" data-startref="ch14chat2" id="id2592"/><a data-type="indexterm" data-startref="ch14chat3" id="id2593"/><a data-type="indexterm" data-startref="ch14chat4" id="id2594"/></p>
</div></section>






<section data-type="sect1" data-pdf-bookmark="Running the SportsWorldCentral (SWC) API Locally"><div class="sect1" id="id147">
<h1>Running the SportsWorldCentral (SWC) API Locally</h1>

<p>The code and database files<a data-type="indexterm" data-primary="SportsWorldCentral (SWC)" data-secondary="introduction to Part III" id="id2595"/><a data-type="indexterm" data-primary="agents in AI" data-secondary="toolkit for SWC API" data-tertiary="running SWC API locally" id="id2596"/><a data-type="indexterm" data-primary="LangChain" data-secondary="toolkit for SWC API" data-tertiary="running SWC API locally" id="id2597"/><a data-type="indexterm" data-primary="toolkits used by agents" data-secondary="SWC API toolkit" data-tertiary="running SWC API locally" id="id2598"/><a data-type="indexterm" data-primary="SportsWorldCentral (SWC)" data-secondary="website API" data-tertiary="API running in Codespace" id="id2599"/><a data-type="indexterm" data-primary="Codespaces (GitHub)" data-secondary="launching your API" data-tertiary="running in Codespace" id="id2600"/><a data-type="indexterm" data-primary="launching your API" data-secondary="running in Codespace" id="id2601"/><a data-type="indexterm" data-primary="GitHub" data-secondary="Codespaces" data-tertiary="launching your API to run in Codespace" id="id2602"/><a data-type="indexterm" data-primary="Codespaces (GitHub)" data-secondary="terminal window" data-tertiary="SWC API run locally" id="id2603"/><a data-type="indexterm" data-primary="GitHub" data-secondary="Codespaces" data-tertiary="terminal window SWC API run locally" id="id2604"/><a data-type="indexterm" data-primary="terminal window of GitHub Codespace" data-secondary="SWC API run locally" id="id2605"/><a data-type="indexterm" data-primary="using APIs" data-secondary="SWC API running in Codespace" id="id2606"/><a data-type="indexterm" data-primary="Python" data-secondary="API files" data-tertiary="launching your API to run in Codespace" id="id2607"/><a data-type="indexterm" data-primary="requirements.txt file for pip" data-secondary="SWC API toolkit libraries" id="id2608"/> for the SWC API are in the <em>/api</em> folder of your Codespace. Start a second session in the Terminal and install the required libraries for the API in your Codespace as shown, using the <em>requirements.txt</em> file that is provided:</p>

<pre data-type="programlisting" data-code-language="shell">.../ai-project (main) $ cd api
.../api (main) $ pip3 install -r requirements.txt</pre>

<p>Now launch the API from the command line as shown:<a data-type="indexterm" data-primary="FastAPI" data-secondary="CLI" data-tertiary="fastapi run" id="id2609"/></p>

<pre data-type="programlisting" data-code-language="shell">.../api (main) $ fastapi run main.py</pre>

<p>You will see several messages from the FastAPI CLI, ending with the following:</p>

<pre data-type="programlisting" data-code-language="shell">INFO:     Started server process [19192]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
INFO:     Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)</pre>

<p>The API is now running in Codespaces. <a data-type="indexterm" data-primary="URL of API" data-secondary="Part III locally running API" id="id2610"/>Copy the URL shown in the Terminal (in this example it is <code><a href="http://0.0.0.0:8000" class="bare"><em class="hyperlink">http://0.0.0.0:8000</em></a></code>, and it may be in yours too).</p>

<p>In the primary Terminal session, create a file named <em>.env</em> in the base project directory as shown:<a data-type="indexterm" data-primary=".env file for SWC API toolkit" data-primary-sortas="env file" id="id2611"/><a data-type="indexterm" data-primary="agents in AI" data-secondary="toolkit for SWC API" data-tertiary=".env file" data-tertiary-sortas="env file" id="id2612"/><a data-type="indexterm" data-primary="LangChain" data-secondary="toolkit for SWC API" data-tertiary=".env file" data-tertiary-sortas="env file" id="id2613"/><a data-type="indexterm" data-primary="toolkits used by agents" data-secondary="SWC API toolkit" data-tertiary=".env file" data-tertiary-sortas="env file" id="id2614"/></p>

<pre data-type="programlisting" data-code-language="shell">chapter14 (main) $ touch ../.env</pre>

<p>Update this file with the following contents:</p>

<pre data-type="programlisting" data-code-language="shell">SWC_API_BASE_URL=[URL from previous step]</pre>

<p>This will be used in the Jupyter Notebook you create later.</p>
</div></section>






<section data-type="sect1" class="less_space pagebreak-before" data-pdf-bookmark="Installing the swcpy Software Development Kit (SDK)"><div class="sect1" id="id217">
<h1>Installing the swcpy Software Development Kit (SDK)</h1>

<p>To build the toolkit for using<a data-type="indexterm" data-primary="agents in AI" data-secondary="toolkit for SWC API" data-tertiary="installing swcpy SDK" id="id2615"/><a data-type="indexterm" data-primary="LangChain" data-secondary="toolkit for SWC API" data-tertiary="installing swcpy SDK" id="id2616"/><a data-type="indexterm" data-primary="toolkits used by agents" data-secondary="SWC API toolkit" data-tertiary="installing swcpy SDK" id="id2617"/><a data-type="indexterm" data-primary="SDK (software development kit)" data-secondary="toolkit for SWC API" data-tertiary="installing swcpy SDK" id="id2618"/><a data-type="indexterm" data-primary="swcpy SDK" data-secondary="toolkit for SWC API" data-tertiary="installing swcpy SDK" id="id2619"/> your API, you will first install the swcpy SDK that you created in <a data-type="xref" href="ch07.html#chapter_7">Chapter 7</a>. If you completed that project already, you can copy that code to this repository and install it locally using <code>pip3 install -e</code> in the <em>/sdk</em> directory. If you have not completed that yet, execute the following command to install the SDK from the Part I GitHub repository:</p>

<pre data-type="programlisting" data-code-language="shell">.../api (main) $ pip install swcpy@git+https://github.com/handsonapibook/
api-book-part-one#subdirectory=chapter7/complete/sdk</pre>

<p>If the installation is successful, you should see the following:</p>

<pre data-type="programlisting" data-code-language="shell">Successfully built swcpy
Installing collected packages: pyarrow, backoff, swcpy
Successfully installed backoff-2.2.1 pyarrow-16.1.0 swcpy-0.0.2</pre>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>You will be creating a tool that<a data-type="indexterm" data-primary="toolkits used by agents" data-secondary="about" id="id2620"/> uses the swcpy SDK, which gives the most robust way to interact with your API. There are other methods you could use to interact with your API. For example, you could also build a tool that is based on the simple API client that you created in <a data-type="xref" href="ch09.html#chapter_9">Chapter 9</a>. Or you could create a tool that directly calls individual API endpoints using httpx or requests. You may want to experiment with different methods to see which you prefer.</p>
</div>
</div></section>






<section data-type="sect1" data-pdf-bookmark="Creating a LangChain Toolkit"><div class="sect1" id="id148">
<h1>Creating a LangChain Toolkit</h1>

<p>A LangChain toolkit contains multiple tools.<a data-type="indexterm" data-primary="agents in AI" data-secondary="toolkit for SWC API" data-tertiary="creating a LangChain toolkit" id="ch14cr8tlkt"/><a data-type="indexterm" data-primary="LangChain" data-secondary="toolkit for SWC API" data-tertiary="creating a LangChain toolkit" id="ch14cr8tlkt2"/><a data-type="indexterm" data-primary="toolkits used by agents" data-secondary="SWC API toolkit" data-tertiary="creating a LangChain toolkit" id="ch14cr8tlkt3"/><a data-type="indexterm" data-primary="SDK (software development kit)" data-secondary="toolkit for SWC API" data-tertiary="creating a LangChain toolkit" id="ch14cr8tlkt4"/><a data-type="indexterm" data-primary="swcpy SDK" data-secondary="toolkit for SWC API" data-tertiary="creating a LangChain toolkit" id="ch14cr8tlkt5"/><a data-type="indexterm" data-primary="toolkits used by agents" data-secondary="LangChain toolkits" id="id2621"/><a data-type="indexterm" data-primary="LangChain" data-secondary="toolkits" id="id2622"/><a data-type="indexterm" data-primary="LangChain" data-secondary="toolkits" data-tertiary="creating tools document online" id="id2623"/><a data-type="indexterm" data-primary="toolkits used by agents" data-secondary="LangChain toolkits" data-tertiary="creating tools document online" id="id2624"/><a data-type="indexterm" data-primary="resources online" data-secondary="LangChain" data-tertiary="creating tools document" id="id2625"/> LangChain provides multiple ways to create tools, as shown in <a href="https://oreil.ly/V8tBi">“How to Create Tools”</a>. You will create tools by subclassing the <code>BaseTool</code> class. According to the documentation, this method “provides maximal control over the tool definition.”</p>

<p>Create a Python file named <em>swc_toolkit.py</em> as shown:<a data-type="indexterm" data-primary="swc_toolkit.py file" id="id2626"/><a data-type="indexterm" data-primary="Python" data-secondary="toolkit file swc_toolkit.py" id="id2627"/></p>

<pre data-type="programlisting" data-code-language="shell">chapter14 (main) $ touch swc_toolkit.py</pre>

<p>At the top of your toolkit file, you will add your imports and load the Codespace secret. Add the following contents to <em>swc_toolkit.py</em>:</p>

<pre data-type="programlisting" data-code-language="python">import os
from typing import Optional, Type, List

from pydantic import BaseModel, Field

from langchain_core.callbacks import CallbackManagerForToolRun <a class="co" id="co_using_apis_with_langchain_CO5-1" href="#callout_using_apis_with_langchain_CO5-1"><img src="assets/1.png" alt="1" width="12" height="12"/></a>
from langchain_core.tools import BaseTool, BaseToolkit

try: <a class="co" id="co_using_apis_with_langchain_CO5-2" href="#callout_using_apis_with_langchain_CO5-2"><img src="assets/2.png" alt="2" width="12" height="12"/></a>
            from swcpy import SWCClient
            from swcpy import SWCConfig
            from swcpy.swc_client import League, Team
except ImportError:
    raise ImportError(
        "swcpy is not installed. Please install it."
    )

config = SWCConfig(backoff=False) <a class="co" id="co_using_apis_with_langchain_CO5-3" href="#callout_using_apis_with_langchain_CO5-3"><img src="assets/3.png" alt="3" width="12" height="12"/></a>
local_swc_client = SWCClient(config)</pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_using_apis_with_langchain_CO5-1" href="#co_using_apis_with_langchain_CO5-1"><img src="assets/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>These imports use the LangChain libraries for defining tools and toolkits.</p></dd>
<dt><a class="co" id="callout_using_apis_with_langchain_CO5-2" href="#co_using_apis_with_langchain_CO5-2"><img src="assets/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>This statement checks to see if the swcpy SDK has been installed in the environment. If not, an error is generated.</p></dd>
<dt><a class="co" id="callout_using_apis_with_langchain_CO5-3" href="#co_using_apis_with_langchain_CO5-3"><img src="assets/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p>This instantiates the SDK. For more information about how this works, see <a data-type="xref" href="ch07.html#chapter_7">Chapter 7</a>.</p></dd>
</dl>

<p>The swcpy SDK has multiple functions,<a data-type="indexterm" data-primary="SDK (software development kit)" data-secondary="toolkit for SWC API" data-tertiary="multiple functions and endpoints in swcpy SDK" id="id2628"/><a data-type="indexterm" data-primary="swcpy SDK" data-secondary="toolkit for SWC API" data-tertiary="multiple functions and endpoints in swcpy SDK" id="id2629"/> which call API endpoints in different ways. For each of the SDK functions you make available to the agent, create an instance of the Pydantic <code>BasesModel</code> class for input values and an instance of the LangChain <code>BaseTool</code> class to call the SDK. You will create the following tools:<a data-type="indexterm" data-primary="health check" data-secondary="HealthCheckTool for SWC toolkit" id="id2630"/></p>

<ul>
<li>
<p><code>HealthCheckTool</code>: Allows the agent to check if the API is up and running</p>
</li>
<li>
<p><code>ListLeaguesTool</code>:  Allows the agent to get a list of leagues</p>
</li>
<li>
<p><code>ListTeamsTool</code>: Allows the agent to get a list of teams</p>
</li>
</ul>

<p>Add the following contents to the bottom of <em>swc_toolkit.py</em>, which add the <code>HealthCheckTool</code> and <code>ListLeaguesTool</code>:<a data-type="indexterm" data-primary="Python" data-secondary="toolkit file swc_toolkit.py" id="id2631"/><a data-type="indexterm" data-primary="swc_toolkit.py file" id="id2632"/></p>

<pre data-type="programlisting" data-code-language="python">class HealthCheckInput(BaseModel): <a class="co" id="co_using_apis_with_langchain_CO6-1" href="#callout_using_apis_with_langchain_CO6-1"><img src="assets/1.png" alt="1" width="12" height="12"/></a>
    pass

class HealthCheckTool(BaseTool): <a class="co" id="co_using_apis_with_langchain_CO6-2" href="#callout_using_apis_with_langchain_CO6-2"><img src="assets/2.png" alt="2" width="12" height="12"/></a>
    name: str = "HealthCheck"
   description: str = (
         "useful to check if the API is running before you make other calls"
    args_schema: Type[HealthCheckInput] = HealthCheckInput <a class="co" id="co_using_apis_with_langchain_CO6-3" href="#callout_using_apis_with_langchain_CO6-3"><img src="assets/3.png" alt="3" width="12" height="12"/></a>
    return_direct: bool = False

    def _run(
        self, run_manager: Optional[CallbackManagerForToolRun] = None
    ) -&gt; str:
        """Use the tool to check if the API is running."""
        health_check_response = local_swc_client.get_health_check() <a class="co" id="co_using_apis_with_langchain_CO6-4" href="#callout_using_apis_with_langchain_CO6-4"><img src="assets/4.png" alt="4" width="12" height="12"/></a>
        return health_check_response.text
    

class LeaguesInput(BaseModel): <a class="co" id="co_using_apis_with_langchain_CO6-5" href="#callout_using_apis_with_langchain_CO6-5"><img src="assets/5.png" alt="5" width="12" height="12"/></a>
   league_name: Optional[str] = Field(
        default=None,
        description="league name. Leave blank or None to get all leagues.")

class ListLeaguesTool(BaseTool): <a class="co" id="co_using_apis_with_langchain_CO6-6" href="#callout_using_apis_with_langchain_CO6-6"><img src="assets/6.png" alt="6" width="12" height="12"/></a>
   name: str = "ListLeagues"
   description: str = (
       "get a list of leagues from SportsWorldCentral. "
       "Leagues contain teams if they are present."
    args_schema: Type[LeaguesInput] = LeaguesInput
    return_direct: bool = False

   def _run(
       self, league_name: Optional[str] = None,
       run_manager: Optional[CallbackManagerForToolRun] = None
   ) -&gt; List[League]:
        """Use the tool to get a list of leagues from SportsWorldCentral."""
        # Call the API with league_name, which could be None
        list_leagues_response = local_swc_client.list_leagues(
                                league_name=league_name)
        return list_leagues_response</pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_using_apis_with_langchain_CO6-1" href="#co_using_apis_with_langchain_CO6-1"><img src="assets/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>For each tool, you will define an input object, which is a subclass of the Pydantic <code>BaseModel</code>. This tool does not accept parameters, so you are creating an empty object.</p></dd>
<dt><a class="co" id="callout_using_apis_with_langchain_CO6-2" href="#co_using_apis_with_langchain_CO6-2"><img src="assets/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>This is the definition of the tool for the health check, and it is a subclass of the LangChain <code>BaseTool</code>. The information you provide in this section will be used by the model to decide how and when to use this tool.</p></dd>
<dt><a class="co" id="callout_using_apis_with_langchain_CO6-3" href="#co_using_apis_with_langchain_CO6-3"><img src="assets/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p>The <code>args_schema</code> defines what inputs are expected, and the model will use this to send input to the tool.</p></dd>
<dt><a class="co" id="callout_using_apis_with_langchain_CO6-4" href="#co_using_apis_with_langchain_CO6-4"><img src="assets/4.png" alt="4" width="12" height="12"/></a></dt>
<dd><p>This is where the action occurs. It is calling the <code>get_health_check()</code> method from the SDK.</p></dd>
<dt><a class="co" id="callout_using_apis_with_langchain_CO6-5" href="#co_using_apis_with_langchain_CO6-5"><img src="assets/5.png" alt="5" width="12" height="12"/></a></dt>
<dd><p>This is the input defined for the <code>ListLeaguesTool</code>. It contains parameters used by that tool.</p></dd>
<dt><a class="co" id="callout_using_apis_with_langchain_CO6-6" href="#co_using_apis_with_langchain_CO6-6"><img src="assets/6.png" alt="6" width="12" height="12"/></a></dt>
<dd><p>This is the tool that will call the SDK’s <code>list_leagues()</code> function.</p></dd>
</dl>

<p>Now you will add the <code>ListTeamsTool</code> and create a <code>BaseToolkit</code> object that represents all of the tools that you will be providing to an agent. Add the following contents to the bottom of <em>swc_toolkit.py</em>:<a data-type="indexterm" data-primary="swc_toolkit.py file" id="id2633"/><a data-type="indexterm" data-primary="Python" data-secondary="toolkit file swc_toolkit.py" id="id2634"/></p>

<pre data-type="programlisting" data-code-language="python">class TeamsInput(BaseModel): <a class="co" id="co_using_apis_with_langchain_CO7-1" href="#callout_using_apis_with_langchain_CO7-1"><img src="assets/1.png" alt="1" width="12" height="12"/></a>
   team_name: Optional[str] = Field(
        default=None,
        description="Name of the team to search for. 
        Leave blank or None to get all teams.")
   league_id: Optional[int] = Field(
        default=None,
        description=(
             "League ID from a league. You must provide a numerical League ID. "
             "Leave blank or None to get teams from all leagues."
             ))


class ListTeamsTool(BaseTool): <a class="co" id="co_using_apis_with_langchain_CO7-2" href="#callout_using_apis_with_langchain_CO7-2"><img src="assets/2.png" alt="2" width="12" height="12"/></a>
   name: str = "ListTeams"
   description: str = (
        "Get a list of teams from SportsWorldCentral. Teams contain players "
        "if they are present. Optionally provide a numerical League ID to "
        "filter teams from a specific league.")
   args_schema: Type[TeamsInput] = TeamsInput
   return_direct: bool = False


   def _run(
       self, team_name: Optional[str] = None,
       league_id: Optional[int] = None,
       run_manager: Optional[CallbackManagerForToolRun] = None
   ) -&gt; List[Team]:
       """Use the tool to get a list of teams from SportsWorldCentral."""
       list_teams_response = local_swc_client.list_teams(
            team_name=team_name, league_id= league_id)
       return list_teams_response

class SportsWorldCentralToolkit(BaseToolkit): <a class="co" id="co_using_apis_with_langchain_CO7-3" href="#callout_using_apis_with_langchain_CO7-3"><img src="assets/3.png" alt="3" width="12" height="12"/></a>
    def get_tools(self) -&gt; List[BaseTool]: <a class="co" id="co_using_apis_with_langchain_CO7-4" href="#callout_using_apis_with_langchain_CO7-4"><img src="assets/4.png" alt="4" width="12" height="12"/></a>
        """Return the list of tools in the toolkit."""
        return [HealthCheckTool(), ListLeaguesTool(), ListTeamsTool()] <a class="co" id="co_using_apis_with_langchain_CO7-5" href="#callout_using_apis_with_langchain_CO7-5"><img src="assets/5.png" alt="5" width="12" height="12"/></a></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_using_apis_with_langchain_CO7-1" href="#co_using_apis_with_langchain_CO7-1"><img src="assets/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>This is the input defined for the <code>ListTeamsTool</code>. It contains parameters used by that tool.</p></dd>
<dt><a class="co" id="callout_using_apis_with_langchain_CO7-2" href="#co_using_apis_with_langchain_CO7-2"><img src="assets/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>This is the tool that will call the SDK’s <code>list_teams()</code> function.</p></dd>
<dt><a class="co" id="callout_using_apis_with_langchain_CO7-3" href="#co_using_apis_with_langchain_CO7-3"><img src="assets/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p>The toolkit is subclassed from the LangChain <code>BaseToolkit</code> class.</p></dd>
<dt><a class="co" id="callout_using_apis_with_langchain_CO7-4" href="#co_using_apis_with_langchain_CO7-4"><img src="assets/4.png" alt="4" width="12" height="12"/></a></dt>
<dd><p>The <code>get_tools()</code> method returns a list of the tools in the toolkit.</p></dd>
<dt><a class="co" id="callout_using_apis_with_langchain_CO7-5" href="#co_using_apis_with_langchain_CO7-5"><img src="assets/5.png" alt="5" width="12" height="12"/></a></dt>
<dd><p>This statement instantiates the tools and returns them in a list.<a data-type="indexterm" data-startref="ch14tlkt" id="id2635"/><a data-type="indexterm" data-startref="ch14tlkt2" id="id2636"/><a data-type="indexterm" data-startref="ch14tlkt3" id="id2637"/><a data-type="indexterm" data-startref="ch14cr8tlkt" id="id2638"/><a data-type="indexterm" data-startref="ch14cr8tlkt2" id="id2639"/><a data-type="indexterm" data-startref="ch14cr8tlkt3" id="id2640"/><a data-type="indexterm" data-startref="ch14cr8tlkt4" id="id2641"/><a data-type="indexterm" data-startref="ch14cr8tlkt5" id="id2642"/></p></dd>
</dl>
</div></section>






<section data-type="sect1" data-pdf-bookmark="Calling APIs Using AI (with LangGraph)"><div class="sect1" id="id149">
<h1>Calling APIs Using AI (with LangGraph)</h1>

<p>In the <em>langgraph_notebook.ipynb</em> notebook,<a data-type="indexterm" data-primary="langgraph_notebook.ipynb" id="id2643"/><a data-type="indexterm" data-primary=".ipynb file extension" data-secondary="langgraph_notebook.ipynb" data-primary-sortas="ipynb" id="id2644"/><a data-type="indexterm" data-primary="LangGraph" data-secondary="AI calling APIs via" id="ch14ai2api"/><a data-type="indexterm" data-primary="AI (artificial intelligence)" data-secondary="APIs and" data-tertiary="AI calling APIs via LangGraph" id="ch14ai2api2"/><a data-type="indexterm" data-primary="APIs" data-secondary="AI and" data-tertiary="AI calling APIs via LangGraph" id="ch14ai2api3"/><a data-type="indexterm" data-primary="SportsWorldCentral (SWC)" data-secondary="website API" data-tertiary="AI calling SWC API" id="ch14ai2api4"/><a data-type="indexterm" data-primary="Jupyter Notebooks" data-secondary="adding code" data-tertiary="LangGraph agent calling SWC API" id="ch14ai2api5"/><a data-type="indexterm" data-primary="agents in AI" data-secondary="creating a LangGraph agent" data-tertiary="agent calling SWC API" id="ch14ai2api6"/><a data-type="indexterm" data-primary="LangGraph" data-secondary="creating an agent" data-tertiary="agent calling SWC API" id="ch14ai2api7"/><a data-type="indexterm" data-primary="agents in AI" data-secondary="toolkit for SWC API" data-tertiary="agent calling SWC API" id="ch14ai2api8"/><a data-type="indexterm" data-primary="LangChain" data-secondary="toolkit for SWC API" data-tertiary="agent calling SWC API" id="ch14ai2api9"/><a data-type="indexterm" data-primary="toolkits used by agents" data-secondary="SWC API toolkit" data-tertiary="agent calling SWC API" id="ch14ai2apiA"/> you created an agent that could chat, but the agent was unable to answer questions from the SWC API. Now you will make an improved version that can use tools to call the SWC API. First, make a copy of the Jupyter Notebook with the following commands:<a data-type="indexterm" data-primary="langgraph_notebook_with_toolkit.ipynb file" id="id2645"/><a data-type="indexterm" data-primary=".ipynb file extension" data-secondary="langgraph_notebook_with_toolkit.ipynb file" data-primary-sortas="ipynb" id="id2646"/></p>

<pre data-type="programlisting" data-code-language="shell">.../chapter14 (main) $ cp langgraph_notebook.ipynb \
langgraph_notebook_with_toolkit.ipynb</pre>

<p>Open <em>langgraph_notebook_with_toolkit.ipynb</em> and select the Python kernel as you did previously. Update the first Markdown cell with the following text for clarity:</p>

<pre data-type="programlisting" data-code-language="markdown"># LangGraph Agent
## _With_ tools</pre>

<p>Add the following to the first Python cell that contains the <code>import</code> statements and re-run it:</p>

<pre data-type="programlisting" data-code-language="python">from swc_toolkit import SportsWorldCentralToolkit <a class="co" id="co_using_apis_with_langchain_CO8-1" href="#callout_using_apis_with_langchain_CO8-1"><img src="assets/1.png" alt="1" width="12" height="12"/></a>
from langchain_core.tools import tool <a class="co" id="co_using_apis_with_langchain_CO8-2" href="#callout_using_apis_with_langchain_CO8-2"><img src="assets/2.png" alt="2" width="12" height="12"/></a>
from langgraph.prebuilt import ToolNode <a class="co" id="co_using_apis_with_langchain_CO8-3" href="#callout_using_apis_with_langchain_CO8-3"><img src="assets/3.png" alt="3" width="12" height="12"/></a>
from typing import Literal</pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_using_apis_with_langchain_CO8-1" href="#co_using_apis_with_langchain_CO8-1"><img src="assets/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>This is the <code>import</code> statement for the toolkit that you created.</p></dd>
<dt><a class="co" id="callout_using_apis_with_langchain_CO8-2" href="#co_using_apis_with_langchain_CO8-2"><img src="assets/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>This <code>import</code> provides the LangChain tool functionality.</p></dd>
<dt><a class="co" id="callout_using_apis_with_langchain_CO8-3" href="#co_using_apis_with_langchain_CO8-3"><img src="assets/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p>This <code>import</code> adds LangGraph support for toolkits.</p></dd>
</dl>

<p>Find the Python cell that is used to configure logging. Beneath that cell, add the following Markdown cell:</p>

<pre data-type="programlisting" data-code-language="markdown">## Create toolkit</pre>

<p>Now you will reference the toolkit you created and imported earlier. To instantiate your toolkit, add the following Python cell and run it:</p>

<pre data-type="programlisting" data-code-language="python">swc_toolkit = SportsWorldCentralToolkit()
tools = swc_toolkit.get_tools()</pre>

<p>These statements create an instance of your toolkit class, then retrieve all of the tools from it and put those into the <code>tools</code> object.</p>

<p>For the main body of your agent, there will be many changes. You will be <em>binding</em> the tools to your model, which means making the model aware of the tools it has access to. Then, you will create a node for the tools and update the flow of the agent to use tools when needed to answer questions.</p>

<p class="less_space pagebreak-before">Locate the Python cell following the title “Configure Agent and Model.” Replace the entire contents with the following, and run it:</p>

<pre data-type="programlisting" data-code-language="python">tool_node = ToolNode(tools)

model = ChatAnthropic(model="claude-3-5-sonnet-20240620",
                     temperature=0).bind_tools(tools) <a class="co" id="co_using_apis_with_langchain_CO9-1" href="#callout_using_apis_with_langchain_CO9-1"><img src="assets/1.png" alt="1" width="12" height="12"/></a>

def should_continue(state: MessagesState) -&gt; Literal["tools", END]: <a class="co" id="co_using_apis_with_langchain_CO9-2" href="#callout_using_apis_with_langchain_CO9-2"><img src="assets/2.png" alt="2" width="12" height="12"/></a>
    messages = state['messages']
    last_message = messages[-1]
    if last_message.tool_calls:
        return "tools"
    return END

def call_model(state: MessagesState):
    messages = state['messages']
    response = model.invoke(messages)
    return {"messages": [response]}

workflow = StateGraph(MessagesState)

workflow.add_node("agent", call_model)
workflow.add_node("tools", tool_node) <a class="co" id="co_using_apis_with_langchain_CO9-3" href="#callout_using_apis_with_langchain_CO9-3"><img src="assets/3.png" alt="3" width="12" height="12"/></a>

workflow.add_edge(START, "agent")

workflow.add_conditional_edges( <a class="co" id="co_using_apis_with_langchain_CO9-4" href="#callout_using_apis_with_langchain_CO9-4"><img src="assets/4.png" alt="4" width="12" height="12"/></a>
    "agent",
    should_continue,
)

workflow.add_edge("tools", 'agent')

checkpointer = MemorySaver()

app = workflow.compile(checkpointer=checkpointer)</pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_using_apis_with_langchain_CO9-1" href="#co_using_apis_with_langchain_CO9-1"><img src="assets/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>This adds the <code>bind_tools()</code> function to the model initialization so that the model can use the toolkit you created.</p></dd>
<dt><a class="co" id="callout_using_apis_with_langchain_CO9-2" href="#co_using_apis_with_langchain_CO9-2"><img src="assets/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>This will be used as a <em>conditional edge</em>, which is a workflow that decides how to proceed based on the results. If the model suggests a tool call, this returns the literal “tools.”</p></dd>
<dt><a class="co" id="callout_using_apis_with_langchain_CO9-3" href="#co_using_apis_with_langchain_CO9-3"><img src="assets/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p>This adds a new node in the graph to perform tool calls using the new toolkit.</p></dd>
<dt><a class="co" id="callout_using_apis_with_langchain_CO9-4" href="#co_using_apis_with_langchain_CO9-4"><img src="assets/4.png" alt="4" width="12" height="12"/></a></dt>
<dd><p>This adds the conditional edge that uses the <code>should_continue</code> function defined earlier.</p></dd>
</dl>

<p>To see how the flow has been updated to add a tool node, rerun the Python cell under the “Visualize the Graph” heading.<a data-type="indexterm" data-primary="LangGraph" data-secondary="creating an agent" data-tertiary="visualizing the graph" id="id2647"/><a data-type="indexterm" data-primary="agents in AI" data-secondary="creating a LangGraph agent" data-tertiary="visualizing the graph" id="id2648"/><a data-type="indexterm" data-primary="Anthropic" data-secondary="creating a LangGraph agent" data-tertiary="visualizing the graph" id="id2649"/></p>

<p>You should see an image that matches <a data-type="xref" href="#graph_visual_2_ch14">Figure 14-6</a>. This shows a loop between the agent and the available tools.</p>

<figure><div id="graph_visual_2_ch14" class="figure">
<img src="assets/haad_1406.png" alt="Graph of the agent with tools" width="301" height="354"/>
<h6><span class="label">Figure 14-6. </span>Graph of the agent with tools</h6>
</div></figure>

<p>The agent will decide how many times it needs to use the tools to answer the question. Depending on the question asked and the reasoning of the agent, this may involve one API call, multiple API calls, or no API calls.<a data-type="indexterm" data-startref="ch14ai2api" id="id2650"/><a data-type="indexterm" data-startref="ch14ai2api2" id="id2651"/><a data-type="indexterm" data-startref="ch14ai2api3" id="id2652"/><a data-type="indexterm" data-startref="ch14ai2api4" id="id2653"/><a data-type="indexterm" data-startref="ch14ai2api5" id="id2654"/><a data-type="indexterm" data-startref="ch14ai2api6" id="id2655"/><a data-type="indexterm" data-startref="ch14ai2api7" id="id2656"/><a data-type="indexterm" data-startref="ch14ai2api8" id="id2657"/><a data-type="indexterm" data-startref="ch14ai2api9" id="id2658"/><a data-type="indexterm" data-startref="ch14ai2apiA" id="id2659"/></p>
</div></section>






<section data-type="sect1" data-pdf-bookmark="Chatting with Your Agent (with Tools)"><div class="sect1" id="id218">
<h1>Chatting with Your Agent (with Tools)</h1>

<p>Now it’s time to see if your effort<a data-type="indexterm" data-primary="agents in AI" data-secondary="chatting with LangGraph agent" data-tertiary="SWC API incorporated" id="id2660"/><a data-type="indexterm" data-primary="Anthropic" data-secondary="chatting with LangGraph agent" data-tertiary="SWC API incorporated" id="id2661"/><a data-type="indexterm" data-primary="chatting with LangGraph agent" data-secondary="SWC API incorporated" id="id2662"/><a data-type="indexterm" data-primary="LangGraph" data-secondary="chatting with LangGraph agent" data-tertiary="SWC API incorporated" id="id2663"/> to provide tools to the agent has improved its ability to answer questions about SportsWorldCentral. Let’s start with the question that stumped it before. Enter the following in a new Python cell and run it:</p>

<pre data-type="programlisting" data-code-language="python">final_state = app.invoke(
    {"messages": [HumanMessage(content="What are the leagues in the
    SportsWorldCentral fantasy football platform? Keep the response simple.")]},
    config={"configurable": {"thread_id": 99}}
)
display(Markdown(final_state["messages"][-1].content))</pre>

<p>You will receive a message similar to the following:</p>

<pre data-type="programlisting" data-code-language="text">Here's a simple list of the leagues in the SportsWorldCentral fantasy
football platform:

1. Pigskin Prodigal Fantasy League
2. Recurring Champions League
3. AHAHFZZFFFL
4. Gridiron Gurus Fantasy League
5. Best League Ever

These are the five leagues currently available in the platform.</pre>

<p>If you look at the Terminal window, you should see the following, which indicates that the agent used the <code>ListLeaguesTool</code> from the toolkit:</p>

<pre data-type="programlisting" data-code-language="shell">INFO: 0.0.0.0:8000 - "GET /v0/leagues/?skip=0&amp;limit=100 HTTP/1.1" 200 OK</pre>

<p>Congratulations! You have created a LangGraph agent and provided it a toolkit to call your custom API.</p>

<p>Take time and experiment with questions that will encourage the agent to use the <code>HealthCheckTool</code> and the <code>ListTeamsTool</code>. Look at the Terminal output or log file to see the API calls that are generated. How can you influence its tool use? How can you guide it to answer more difficult questions using the tools? How can you stump it?</p>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="id2664">
<h1>Extending Your Portfolio Project</h1>
<p>You have learned to create AI agents using LangGraph and LangChain. Here are a few ideas to continue your learning:</p>

<ul>
<li>
<p>If you deployed your API in <a data-type="xref" href="ch06.html#chapter_6">Chapter 6</a>, modify the code in this chapter to use the cloud-hosted API instead of running the API in your Codespace.</p>
</li>
<li>
<p>Continue adding more tools from your API to the toolkit. Explore how the definition of the tools and the prompts you provide influence the behavior of the agent.</p>
</li>
<li>
<p>You used models from Anthropic in this chapter. Experiment using other function-calling models that<a data-type="indexterm" data-primary="LangChain" data-secondary="chat models list online" id="id2665"/><a data-type="indexterm" data-primary="resources online" data-secondary="LangChain" data-tertiary="chat models list" id="id2666"/> LangChain supports, as shown in the <a href="https://oreil.ly/w8YWi">LangChain “Chat Models” page</a>.</p>
</li>
<li>
<p>Provide your agent with additional tools and ask it to use these tools in combination. A first suggestion: create a toolkit for the nfl_data_py library you used in <a data-type="xref" href="ch11.html#streamlit_nfl_data_py">“Installing Streamlit and nfl_data_py”</a>.</p>
</li>
</ul>
</div></aside>
</div></section>






<section data-type="sect1" data-pdf-bookmark="Additional Resources"><div class="sect1" id="id150">
<h1>Additional Resources</h1>

<p>LangChain is a recent framework, so published resources are having a hard time keeping up. As you look at online resources and demos, check the versions of libraries that are being discussed, because at the time of this writing, some of the resources contained deprecated code.</p>

<p>With that caveat, the most up-to-date resource is the <a href="https://oreil.ly/jyC-I">official LangChain docs page</a>.<a data-type="indexterm" data-primary="LangChain" data-secondary="documentation online" id="id2667"/><a data-type="indexterm" data-primary="resources online" data-secondary="LangChain" data-tertiary="documentation" id="id2668"/></p>

<p>LangGraph is even newer than LangChain; the <a href="https://oreil.ly/WBOXF">LangGraph documentation</a> has the most detailed information.<a data-type="indexterm" data-primary="LangGraph" data-secondary="documentation online" id="id2669"/><a data-type="indexterm" data-primary="resources online" data-secondary="LangGraph documentation" id="id2670"/></p>

<p>To see Anthropic’s advice on agents, including several recommended workflows, read <a href="https://oreil.ly/QvAKC">“Building Effective Agents”</a>.<a data-type="indexterm" data-primary="agents in AI" data-secondary="information online" id="id2671"/><a data-type="indexterm" data-primary="Anthropic" data-secondary="Building Effective Agents online" id="id2672"/><a data-type="indexterm" data-primary="resources online" data-secondary="Anthropic" data-tertiary="Building Effective Agents" id="id2673"/></p>

<p>Google produced an <a href="https://oreil.ly/M5hV_">Agents Whitepaper</a> that explains<a data-type="indexterm" data-primary="Agents Whitepaper (Google)" id="id2674"/><a data-type="indexterm" data-primary="Google" data-secondary="Agents Whitepaper" id="id2675"/> the key components in a fully functional agent. It has a strong emphasis on how agents can use tools, which includes APIs.</p>
</div></section>






<section data-type="sect1" data-pdf-bookmark="Summary"><div class="sect1" id="id397">
<h1>Summary</h1>

<p>In this chapter, you used the LangChain and LangGraph frameworks to create an intelligent agent that interacted with an AI model and your SWC API. This allowed you to ask questions about SWC data with natural language in a Jupyter Notebook. These are the beginning steps to using APIs with AI applications.</p>

<p>In <a data-type="xref" href="ch15.html#chapter_15">Chapter 15</a>, you will use ChatGPT, which is a full-featured application that uses LLMs and can call APIs like you did in this chapter. You will create a custom action and custom GPT that can interact with the SWC API.</p>
</div></section>
</div></section></div>
</div>
</body></html>