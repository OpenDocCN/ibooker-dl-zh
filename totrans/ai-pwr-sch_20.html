<html><head></head><body>
<div id="sbo-rt-content"><div class="readable-text" id="p1">
<h1 class="readable-text-h1"><span class="chapter-title-numbering"><span class="num-string">appendix B</span></span> <span class="chapter-title-text">Supported search engines and vector databases</span></h1>
</div>
<div class="readable-text" id="p2">
<p>We use the open source Apache Solr search engine as our default search engine throughout the book for consistency, but all of the algorithms in the codebase are designed to work with a wide variety of search engines and vector databases. To that end, other than cases where engine-specific syntax is required to demonstrate a point, we have implemented search functionality using a generic <code>engine</code> interface that allows you to easily swap in your preferred search engine or vector database. In this appendix, we’ll cover the list of supported engines, how to swap out the default engine, and how the major abstractions (<code>engine</code> and <code>collection</code>) are used throughout the book. </p>
</div>
<div class="readable-text" id="p3">
<h2 class="readable-text-h2" id="sigil_toc_id_256"><span class="num-string">B.1</span> Supported engines</h2>
</div>
<div class="readable-text" id="p4">
<p>The list of supported engines will continue to grow over time, but at the time of publication, the following engines are initially supported:</p>
</div>
<ul>
<li class="readable-text" id="p5"> <code>solr</code>—Apache Solr </li>
<li class="readable-text" id="p6"> <code>opensearch</code>—OpenSearch </li>
<li class="readable-text" id="p7"> <code>bonsai</code>—Bonsai </li>
<li class="readable-text" id="p8"> <code>weaviate</code>—Weaviate </li>
</ul>
<div class="readable-text" id="p9">
<p>To see the full, most up-to-date list of all supported engines, please visit <a href="https://aipoweredsearch.com/supported-engines">https://aipoweredsearch.com/supported-engines</a>. </p>
</div>
<div class="readable-text" id="p10">
<h2 class="readable-text-h2" id="sigil_toc_id_257"><span class="num-string">B.2</span> Swapping out the engine</h2>
</div>
<div class="readable-text" id="p11">
<p>Normally, you’ll only be working with one search engine or vector database at a time when running the book’s code examples. To use any particular engine, you just need to specify the engine’s name (as enumerated above) when starting up Docker.</p>
</div>
<div class="readable-text intended-text" id="p12">
<p>You would launch OpenSearch, for example, like this:</p>
</div>
<div class="browsable-container listing-container" id="p13">
<div class="code-area-container">
<pre class="code-area">docker compose up opensearch</pre>
</div>
</div>
<div class="readable-text" id="p14">
<p>This will both start any necessary Docker containers needed to run <code>opensearch</code> (or the engine you specify) as well as set this engine as active in the book’s Jupyter notebooks for use in all the code examples.</p>
</div>
<div class="readable-text intended-text" id="p15">
<p>Note that some engines, such as managed search and API-based services, do not require any additional local Docker containers, since their services are hosted elsewhere. Also, some engines may require additional configuration parameters, such as API keys, remote addresses/URLs, ports, and so on. These parameters can be set in the .env file at the root of the project.</p>
</div>
<div class="readable-text intended-text" id="p16">
<p>If you want to use a different engine at any time, you can restart the Docker containers and specify the new engine you want to use:</p>
</div>
<div class="browsable-container listing-container" id="p17">
<div class="code-area-container">
<pre class="code-area">docker compose up bonsai</pre>
</div>
</div>
<div class="readable-text" id="p18">
<p>If you want to launch more than one engine at a time to experiment, you can provide a list of the engines you wish to start at the end of the <code>docker compose up</code> command:</p>
</div>
<div class="browsable-container listing-container" id="p19">
<div class="code-area-container">
<pre class="code-area">docker compose up solr opensearch weaviate</pre>
</div>
</div>
<div class="readable-text" id="p20">
<p>The first engine you reference in your <code>docker compose up</code> command will be set as your active engine in the Jupyter notebooks, with the others available on standby. </p>
</div>
<div class="readable-text intended-text" id="p21">
<p>If you’d like to switch to one of the standby engines within your live Jupyter notebooks (for example, to <code>opensearch</code>), you can do this at any time by simply running the following command in any notebook:</p>
</div>
<div class="browsable-container listing-container" id="p22">
<div class="code-area-container">
<pre class="code-area">import aips
aips.set_engine("opensearch")</pre>
</div>
</div>
<div class="readable-text" id="p23">
<p>Keep in mind that if you call <code>set_engine</code> for an engine that is not currently running, this will later result in errors if that engine is still unavailable when you try to use it. </p>
</div>
<div class="readable-text intended-text" id="p24">
<p>You can also check the currently set engine at any time by running this command:</p>
</div>
<div class="browsable-container listing-container" id="p25">
<div class="code-area-container">
<pre class="code-area">aips.get_engine().name</pre>
</div>
</div>
<div class="readable-text" id="p26">
<h2 class="readable-text-h2" id="sigil_toc_id_258"><span class="num-string">B.3</span> The engine and collection abstractions</h2>
</div>
<div class="readable-text" id="p27">
<p>The search engine industry is full of different terminology and concepts, and we have tried to abstract away as much of that as possible in the codebase. Most search engines started with lexical keyword search and have since added support for vector search, and many vector databases started with vector search and have since added lexical search. For our purposes, we just think of all these systems as <em>matching and ranking engines</em>, and we use the term <em>engine</em> to refer to all of them. </p>
</div>
<div class="readable-text intended-text" id="p28">
<p>Likewise, each engine has a concept of one or more logical partitions or containers for adding data. In Solr and Weaviate, these containers are called <em>collections</em>; in OpenSearch, Elasticsearch, and Redis these are called <em>indexes</em>; and in Vespa they are called <em>applications</em>. In MongoDB, the original data is stored in a <em>collection</em>, but it can then be copied into an <em>index</em> for search purposes. Naming also varies further among other engines. </p>
</div>
<div class="readable-text intended-text" id="p29">
<p>For proper abstraction, we always use the term <em>collection</em> in the codebase, so every engine that gets implemented has a <code>collection</code> interface through which you can query or add documents. </p>
</div>
<div class="readable-text intended-text" id="p30">
<p>Common public methods on the <code>engine</code> interface include </p>
</div>
<ul>
<li class="readable-text" id="p31"> <code>engine.create_collection(collection_name)</code>—Creates a new collection </li>
<li class="readable-text" id="p32"> <code>engine.get_collection(collection_name)</code>—Returns an existing collection </li>
</ul>
<div class="readable-text" id="p33">
<p>Common public methods on the <code>collection</code> interface include </p>
</div>
<ul>
<li class="readable-text" id="p34"> <code>collection.search(**request)</code>—Runs a search and returns results. Individual request parameters should be passed in as Python keyword arguments, like <code>collection.search(query="keyword), limit=10"</code>. </li>
<li class="readable-text" id="p35"> <code>collection.add_documents(docs)</code>—Adds a list of documents to the collection </li>
<li class="readable-text" id="p36"> <code>collection.write(dataframe)</code>—Writes each row from a Spark dataframe to the collection as a document </li>
<li class="readable-text" id="p37"> <code>collection.commit()</code>—Ensures that recently added documents are persisted and available for searching </li>
</ul>
<div class="readable-text" id="p38">
<p>The <code>engine</code> and <code>collection</code> interfaces also internally implement schema definitions and management for all the datasets used in the book. </p>
</div>
<div class="readable-text intended-text" id="p39">
<p>Because the <code>collection.write</code> method takes a dataframe, we utilize helpers as needed when loading data from additional data sources, such as CSV or SQL:</p>
</div>
<ul>
<li class="readable-text" id="p40"> <code>collection.write(from_csv(csv_file))</code>—Writes each row in the CSV file to the collection as a document </li>
<li class="readable-text" id="p41"> <code>collection.write(from_sql(sql_query))</code>—Runs the SQL query and writes each returned row to the collection as a document </li>
</ul>
<div class="readable-text" id="p42">
<p>No additional engine-specific implementation is needed for loading from these additional data sources, as any data source that can be mapped to a Spark dataframe is implicitly supported.</p>
</div>
<div class="readable-text" id="p43">
<h2 class="readable-text-h2" id="sigil_toc_id_259"><span class="num-string">B.4</span> Adding support for additional engines</h2>
</div>
<div class="readable-text" id="p44">
<p>While we hope to eventually support most major search engines and vector databases, you may find that your favorite engine is not currently supported. If that is the case, we encourage you to add support for it and submit a pull request to the codebase. The <code>engine</code> and <code>collection</code> interfaces are designed to be easy to implement, and you can use the default <code>solr</code> implementation or any other already-implemented engines as a reference. </p>
</div>
<div class="readable-text intended-text" id="p45">
<p>Not all data stores have full support for all the capabilities implemented in <em>AI-Powered Search</em>. For example, a pure vector database may not support lexical keyword matching and ranking, and some search engines may not support vector search. Likewise, some specialized capabilities may only be available in certain engines.</p>
</div>
<div class="readable-text intended-text" id="p46">
<p>While the default <code>solr</code> engine supports all of the <em>AI-Powered Search</em> capabilities implemented in the book, other engines may require workarounds, integration of additional libraries, or delegation of some capabilities to another engine for certain algorithms. Most engines don’t have native support for semantic knowledge graphs and text tagging, for example, so many of the engine implementations will delegate these one-off capabilities to other libraries. </p>
</div>
<div class="readable-text intended-text" id="p47">
<p>We hope that the <code>engine</code> and <code>collection</code> abstractions will make it easy for you to add support for your favorite engine and also to potentially contribute it to the book’s codebase to benefit the larger community of <em>AI-Powered Search</em> readers and practitioners. Happy searching!</p>
</div>
</div></body></html>