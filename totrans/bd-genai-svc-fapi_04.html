<html><head></head><body><div id="book-content"><div id="sbo-rt-content"><section data-pdf-bookmark="Chapter 2. Getting Started with FastAPI" data-type="chapter" epub:type="chapter"><div class="chapter" id="ch02">
<h1><span class="label">Capitolo 2. </span>Come iniziare con FastAPI</h1><div data-type="note"><p>Questo lavoro è stato tradotto utilizzando l'AI. Siamo lieti di ricevere il tuo feedback e i tuoi commenti: <a href="mailto:translation-feedback@oreilly.com">translation-feedback@oreilly.com</a></p></div>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="id505">
<h1>Obiettivi del capitolo</h1>
<p><a data-primary="FastAPI (basics)" data-type="indexterm" id="ix_ch02-asciidoc0"/>In questo capitolo imparerai a conoscere:</p>
<ul>
<li>
<p>Cos'è FastAPI</p>
</li>
<li>
<p>Come iniziare a creare il proprio progetto FastAPI</p>
</li>
<li>
<p>Caratteristiche e vantaggi di FastAPI</p>
</li>
<li>
<p>Come strutturare i progetti FastAPI</p>
</li>
<li>
<p>Il modello di progettazione del software a cipolla/strato</p>
</li>
<li>
<p>Confronto tra FastAPI e altri framework</p>
</li>
<li>
<p>Limitazioni di FastAPI</p>
</li>
<li>
<p>Impostazione di un ambiente Python gestito e di strumenti per il tuo progetto</p>
</li>
</ul>
</div></aside>
<p>Alla fine di questo capitolo, dovresti sentirti a tuo agio nell'utilizzo del framework web FastAPI, nell'impostazione di progetti FastAPI e nell'articolare le tue decisioni sullo stack tecnologico per la creazione di servizi GenAI.</p>
<section data-pdf-bookmark="Introduction to FastAPI" data-type="sect1"><div class="sect1" id="id236">
<h1>Introduzione a FastAPI</h1>
<p><a href="https://oreil.ly/2xcoR">FastAPI</a> è <a data-primary="Asynchronous Server Gateway Interface (ASGI)" data-secondary="FastAPI as" data-type="indexterm" id="id506"/>un framework web ASGI (asynchronous gateway interface) che ti permette di costruire API e server web backend snelli. Essendo<span class="keep-together">un</span> framework<span class="keep-together">ASGI</span>, è in grado di sfruttare la concorrenza per elaborare le richieste web. È <a href="https://oreil.ly/tgwEJ">veloce, paragonabile ai framework moderni</a>, ma è anche<span class="keep-together">dotato di solide</span> <a href="https://oreil.ly/WlwOC">integrazioni Swagger/OpenAPI per la documentazione automatica</a>, oltre a funzioni integrate di validazione e serializzazione dei dati tramite <a href="https://oreil.ly/5-EmU">Pydantic</a>.<sup><a data-type="noteref" href="ch02.html#id507" id="id507-marker" translate="no">1</a></sup> In effetti, FastAPI è un wrapper del <a href="https://oreil.ly/tyKtQ">framework Starlette</a>, costruito da Encode, le stesse persone che hanno realizzato il framework REST Django. È leggero e ha un'esperienza di sviluppo simile.</p>
<p>Prima di parlare di FastAPI in modo più dettagliato, configuriamo il tuo ambiente di sviluppo con un'applicazione FastAPI in esecuzione.</p>
</div></section>
<section data-pdf-bookmark="Setting Up Your Development Environment" data-type="sect1"><div class="sect1" id="id14">
<h1>Impostazione dell'ambiente di sviluppo</h1>
<p><a data-primary="development environment setup, FastAPI" data-type="indexterm" id="ix_ch02-asciidoc1"/><a data-primary="FastAPI (basics)" data-secondary="development environment setup" data-type="indexterm" id="ix_ch02-asciidoc2"/>Nel resto del capitolo, ti guiderò attraverso il processo di installazione di FastAPI e delle sue dipendenze essenziali, consentendoti di configurare un server web di base. Installeremo anche una selezione di formattatori, logger e linter che potrai impostare per migliorare il tuo flusso di lavoro di sviluppo.</p>
<div data-type="warning" epub:type="warning"><h6>Avvertenze</h6>
<p>Gli esempi di codice presenti in questo libro sono stati testati con Python 3.11. L'esecuzione di esempi di codice con altre versioni di Python potrebbe causare problemi. Inoltre, alcuni ambienti di distribuzione e le dipendenze dei pacchetti potrebbero non supportare le ultime versioni di Python.</p>
</div>
<p>Ora puoi iniziare a configurare il tuo progetto FastAPI.</p>
<section data-pdf-bookmark="Installing Python, FastAPI, and Required Packages" data-type="sect2"><div class="sect2" id="id237">
<h2>Installazione di Python, FastAPI e dei pacchetti necessari</h2>
<p><a data-primary="development environment setup, FastAPI" data-secondary="installing Python/Fast API/required packages" data-type="indexterm" id="id508"/><a data-primary="FastAPI (basics)" data-secondary="development environment setup" data-tertiary="installing Python/Fast API/required packages" data-type="indexterm" id="id509"/><a data-primary="Python" data-secondary="installing" data-type="indexterm" id="id510"/>Se utilizzi Windows, puoi usare <code translate="no">conda</code> per creare un ambiente virtuale Python:</p>
<pre data-type="programlisting" translate="no">conda create -n genaiservice python=3.11
conda activate genaiservice</pre>
<p>Se utilizzi un sistema macOS o Linux, puoi creare un ambiente Python virtuale utilizzando <code translate="no">venv</code>:</p>
<pre data-code-language="bash" data-type="programlisting" translate="no">$<code class="w" translate="no"> </code>python3<code class="w" translate="no"> </code>-m<code class="w" translate="no"> </code>venv<code class="w" translate="no"> </code>.venv<code class="w" translate="no"/></pre>
<p><code translate="no">venv</code> crea il tuo ambiente virtuale nella cartella <code translate="no">.venv</code> che puoi attivare con questo comando:</p>
<pre data-code-language="bash" data-type="programlisting" translate="no">$<code class="w" translate="no"> </code><code class="nb" translate="no">source</code><code class="w" translate="no"> </code>.venv/bin/activate<code class="w" translate="no"/></pre>
<p>Una volta attivato l'ambiente, puoi installare i pacchetti fondamentali necessari per eseguire il server FastAPI e servire le richieste dell'API OpenAI:</p>
<pre data-code-language="bash" data-type="programlisting" translate="no">$<code class="w" translate="no"> </code>pip<code class="w" translate="no"> </code>install<code class="w" translate="no"> </code><code class="s2" translate="no">"fastapi[standard]"</code><code class="w" translate="no"> </code>uvicorn<code class="w" translate="no"> </code>openai<code class="w" translate="no"/></pre>
<p>Il pacchetto <code translate="no">uvicorn</code> è il server web di base su cui gira FastAPI.<code translate="no">fastapi</code> installerà anche i suoi pacchetti di dipendenza come <code translate="no">starlette</code> e <code translate="no">pydantic</code>.</p>
</div></section>
<section data-pdf-bookmark="Creating a Simple FastAPI Web Server" data-type="sect2"><div class="sect2" id="id15">
<h2>Creare un semplice server web FastAPI</h2>
<p><a data-primary="development environment setup, FastAPI" data-secondary="creating a simple FastAPI web server" data-type="indexterm" id="ix_ch02-asciidoc3"/><a data-primary="FastAPI (basics)" data-secondary="development environment setup" data-tertiary="creating a simple FastAPI web server" data-type="indexterm" id="ix_ch02-asciidoc4"/><a data-primary="web server, creating simple" data-type="indexterm" id="ix_ch02-asciidoc5"/>Una volta installate FastAPI e le sue dipendenze, sei pronto per avviare il tuo server web. Per creare un semplice server web con un endpoint in FastAPI, devi scrivere solo 15 righe di codice. Crea un file <em>main.py</em> nella radice della tua directory, come mostrato nell'<a data-type="xref" href="#simple_fastapi_web_server">Esempio 2-1</a>.</p>
<div data-type="note" epub:type="note"><h6>Nota</h6>
<p>Per semplicità, l'<a data-type="xref" href="#simple_fastapi_web_server">esempio 2-1</a> utilizza l'API OpenAI. Per eseguire il codice, puoi ottenere una chiave API da <a href="https://oreil.ly/SZsuD">OpenAI</a>, che richiede una carta di credito. Tuttavia, ti assicuriamo che gli altri esempi di codice in questo libro utilizzeranno il più possibile modelli open source<span class="keep-together">.</span></p>
</div>
<div data-type="example" id="simple_fastapi_web_server">
<h5><span class="label">Esempio 2-1. </span>Codice di partenza per un semplice server web FastAPI che serve richieste GPT-4o</h5>
<pre data-code-language="python" data-type="programlisting" translate="no"><code class="c1" translate="no"># main.py</code><code translate="no">
</code><code class="kn" translate="no">from</code><code translate="no"> </code><code class="nn" translate="no">fastapi</code><code translate="no"> </code><code class="kn" translate="no">import</code><code translate="no"> </code><code class="n" translate="no">FastAPI</code><code translate="no">
</code><code class="kn" translate="no">from</code><code translate="no"> </code><code class="nn" translate="no">openai</code><code translate="no"> </code><code class="kn" translate="no">import</code><code translate="no"> </code><code class="n" translate="no">OpenAI</code><code translate="no">
</code><code translate="no">
</code><code class="n" translate="no">app</code><code translate="no"> </code><code class="o" translate="no">=</code><code translate="no"> </code><code class="n" translate="no">FastAPI</code><code class="p" translate="no">(</code><code class="p" translate="no">)</code><code translate="no"> </code><a class="co" href="#callout_getting_started_with_fastapi_CO1-1" id="co_getting_started_with_fastapi_CO1-1"><img alt="1" src="assets/1.png" width="12" height="12"/></a><code translate="no">
</code><code class="n" translate="no">openai_client</code><code translate="no"> </code><code class="o" translate="no">=</code><code translate="no"> </code><code class="n" translate="no">OpenAI</code><code class="p" translate="no">(</code><code class="n" translate="no">api_key</code><code class="o" translate="no">=</code><code class="s2" translate="no">"</code><em><code class="s2" translate="no">your_api_key</code></em><code class="s2" translate="no">"</code><code class="p" translate="no">)</code><code translate="no"> </code><a class="co" href="#callout_getting_started_with_fastapi_CO1-2" id="co_getting_started_with_fastapi_CO1-2"><img alt="2" src="assets/2.png" width="12" height="12"/></a><code translate="no">
</code><code translate="no">
</code><code class="nd" translate="no">@app</code><code class="o" translate="no">.</code><code class="n" translate="no">get</code><code class="p" translate="no">(</code><code class="s2" translate="no">"</code><code class="s2" translate="no">/</code><code class="s2" translate="no">"</code><code class="p" translate="no">)</code><code translate="no">
</code><code class="k" translate="no">def</code><code translate="no"> </code><code class="nf" translate="no">root_controller</code><code class="p" translate="no">(</code><code class="p" translate="no">)</code><code class="p" translate="no">:</code><code translate="no">
</code><code translate="no">    </code><code class="k" translate="no">return</code><code translate="no"> </code><code class="p" translate="no">{</code><code class="s2" translate="no">"</code><code class="s2" translate="no">status</code><code class="s2" translate="no">"</code><code class="p" translate="no">:</code><code translate="no"> </code><code class="s2" translate="no">"</code><code class="s2" translate="no">healthy</code><code class="s2" translate="no">"</code><code class="p" translate="no">}</code><code translate="no">
</code><code translate="no">
</code><code class="nd" translate="no">@app</code><code class="o" translate="no">.</code><code class="n" translate="no">get</code><code class="p" translate="no">(</code><code class="s2" translate="no">"</code><code class="s2" translate="no">/chat</code><code class="s2" translate="no">"</code><code class="p" translate="no">)</code><code translate="no"> </code><a class="co" href="#callout_getting_started_with_fastapi_CO1-3" id="co_getting_started_with_fastapi_CO1-3"><img alt="3" src="assets/3.png" width="12" height="12"/></a><code translate="no">
</code><code class="k" translate="no">def</code><code translate="no"> </code><code class="nf" translate="no">chat_controller</code><code class="p" translate="no">(</code><code class="n" translate="no">prompt</code><code class="p" translate="no">:</code><code translate="no"> </code><code class="nb" translate="no">str</code><code translate="no"> </code><code class="o" translate="no">=</code><code translate="no"> </code><code class="s2" translate="no">"</code><code class="s2" translate="no">Inspire me</code><code class="s2" translate="no">"</code><code class="p" translate="no">)</code><code class="p" translate="no">:</code><code translate="no"> </code><a class="co" href="#callout_getting_started_with_fastapi_CO1-3" id="co_getting_started_with_fastapi_CO1-4"><img alt="3" src="assets/3.png" width="12" height="12"/></a><code translate="no">
</code><code translate="no">    </code><code class="n" translate="no">response</code><code translate="no"> </code><code class="o" translate="no">=</code><code translate="no"> </code><code class="n" translate="no">openai_client</code><code class="o" translate="no">.</code><code class="n" translate="no">chat</code><code class="o" translate="no">.</code><code class="n" translate="no">completions</code><code class="o" translate="no">.</code><code class="n" translate="no">create</code><code class="p" translate="no">(</code><code translate="no"> </code><a class="co" href="#callout_getting_started_with_fastapi_CO1-4" id="co_getting_started_with_fastapi_CO1-5"><img alt="4" src="assets/4.png" width="12" height="12"/></a><code translate="no">
</code><code translate="no">        </code><code class="n" translate="no">model</code><code class="o" translate="no">=</code><code class="s2" translate="no">"</code><code class="s2" translate="no">gpt-4o</code><code class="s2" translate="no">"</code><code class="p" translate="no">,</code><code translate="no">
</code><code translate="no">        </code><code class="n" translate="no">messages</code><code class="o" translate="no">=</code><code class="p" translate="no">[</code><code translate="no">
</code><code translate="no">            </code><code class="p" translate="no">{</code><code class="s2" translate="no">"</code><code class="s2" translate="no">role</code><code class="s2" translate="no">"</code><code class="p" translate="no">:</code><code translate="no"> </code><code class="s2" translate="no">"</code><code class="s2" translate="no">system</code><code class="s2" translate="no">"</code><code class="p" translate="no">,</code><code translate="no"> </code><code class="s2" translate="no">"</code><code class="s2" translate="no">content</code><code class="s2" translate="no">"</code><code class="p" translate="no">:</code><code translate="no"> </code><code class="s2" translate="no">"</code><code class="s2" translate="no">You are a helpful assistant.</code><code class="s2" translate="no">"</code><code class="p" translate="no">}</code><code class="p" translate="no">,</code><code translate="no">
</code><code translate="no">            </code><code class="p" translate="no">{</code><code class="s2" translate="no">"</code><code class="s2" translate="no">role</code><code class="s2" translate="no">"</code><code class="p" translate="no">:</code><code translate="no"> </code><code class="s2" translate="no">"</code><code class="s2" translate="no">user</code><code class="s2" translate="no">"</code><code class="p" translate="no">,</code><code translate="no"> </code><code class="s2" translate="no">"</code><code class="s2" translate="no">content</code><code class="s2" translate="no">"</code><code class="p" translate="no">:</code><code translate="no"> </code><code class="n" translate="no">prompt</code><code class="p" translate="no">}</code><code class="p" translate="no">,</code><code translate="no">
</code><code translate="no">        </code><code class="p" translate="no">]</code><code class="p" translate="no">,</code><code translate="no">
</code><code translate="no">    </code><code class="p" translate="no">)</code><code translate="no">
</code><code translate="no">    </code><code class="n" translate="no">statement</code><code translate="no"> </code><code class="o" translate="no">=</code><code translate="no"> </code><code class="n" translate="no">response</code><code class="o" translate="no">.</code><code class="n" translate="no">choices</code><code class="p" translate="no">[</code><code class="mi" translate="no">0</code><code class="p" translate="no">]</code><code class="o" translate="no">.</code><code class="n" translate="no">message</code><code class="o" translate="no">.</code><code class="n" translate="no">content</code><code translate="no">
</code><code translate="no">    </code><code class="k" translate="no">return</code><code translate="no"> </code><code class="p" translate="no">{</code><code class="s2" translate="no">"</code><code class="s2" translate="no">statement</code><code class="s2" translate="no">"</code><code class="p" translate="no">:</code><code translate="no"> </code><code class="n" translate="no">statement</code><code class="p" translate="no">}</code><code translate="no"> </code><a class="co" href="#callout_getting_started_with_fastapi_CO1-5" id="co_getting_started_with_fastapi_CO1-6"><img alt="5" src="assets/5.png" width="12" height="12"/></a></pre>
<dl class="calloutlist">
<dt><a class="co" href="#co_getting_started_with_fastapi_CO1-1" id="callout_getting_started_with_fastapi_CO1-1"><img alt="1" src="assets/1.png" width="12" height="12"/></a></dt>
<dd><p>Crea un oggetto applicazione FastAPI.</p></dd>
<dt><a class="co" href="#co_getting_started_with_fastapi_CO1-2" id="callout_getting_started_with_fastapi_CO1-2"><img alt="2" src="assets/2.png" width="12" height="12"/></a></dt>
<dd><p>Per utilizzare l'API OpenAI è necessaria una <a href="https://oreil.ly/PP0nN">chiave API</a>.</p></dd>
<dt><a class="co" href="#co_getting_started_with_fastapi_CO1-3" id="callout_getting_started_with_fastapi_CO1-3"><img alt="3" src="assets/3.png" width="12" height="12"/></a></dt>
<dd><p>Utilizza il decoratore <code translate="no">@app.get</code> per creare un endpoint <code translate="no">GET</code> sul percorso <code translate="no">/chat</code>.</p></dd>
<dt><a class="co" href="#co_getting_started_with_fastapi_CO1-5" id="callout_getting_started_with_fastapi_CO1-4"><img alt="4" src="assets/4.png" width="12" height="12"/></a></dt>
<dd><p>Effettua una chiamata API alla OpenAI Completions API per generare una risposta dal modello <code translate="no">gpt-4o</code>.</p></dd>
<dt><a class="co" href="#co_getting_started_with_fastapi_CO1-6" id="callout_getting_started_with_fastapi_CO1-5"><img alt="5" src="assets/5.png" width="12" height="12"/></a></dt>
<dd><p>Tutti i dati restituiti dalla funzione decorata saranno restituiti quando si raggiunge l'endpoint della radice.</p></dd>
</dl></div>
<p>Ora puoi avviare il server utilizzando il comando <code translate="no">fastapi dev</code>, come mostrato qui:<sup><a data-type="noteref" href="ch02.html#id511" id="id511-marker" translate="no">2</a></sup></p>
<pre data-code-language="bash" data-type="programlisting" translate="no">$<code class="w" translate="no"> </code>fastapi<code class="w" translate="no"> </code>dev<code class="w" translate="no"/>

&gt;&gt;<code class="w" translate="no"> </code>server<code class="w" translate="no">   </code>Server<code class="w" translate="no"> </code>started<code class="w" translate="no"> </code>at<code class="w" translate="no"> </code>http://127.0.0.1:8000<code class="w" translate="no"/>
&gt;&gt;<code class="w" translate="no"> </code>server<code class="w" translate="no">   </code>Documentation<code class="w" translate="no"> </code>at<code class="w" translate="no"> </code>http://127.0.0.1:8000/docs<code class="w" translate="no"/>

&gt;&gt;<code class="w" translate="no"> </code>INFO<code class="w" translate="no">   </code>Uvicorn<code class="w" translate="no"> </code>running<code class="w" translate="no"> </code>on<code class="w" translate="no"> </code>http://127.0.0.1:8000<code class="w" translate="no"> </code><code class="o" translate="no">(</code>Press<code class="w" translate="no"> </code>CTRL+C<code class="w" translate="no"> </code>to<code class="w" translate="no"> </code>quit<code class="o" translate="no">)</code><code class="w" translate="no"/>
&gt;&gt;<code class="w" translate="no"> </code>INFO<code class="w" translate="no">   </code>Started<code class="w" translate="no"> </code>reloader<code class="w" translate="no"> </code>process<code class="w" translate="no"> </code><code class="o" translate="no">[</code><code class="m" translate="no">4172</code><code class="o" translate="no">]</code><code class="w" translate="no"> </code>using<code class="w" translate="no"> </code>WatchFiles<code class="w" translate="no"/>
&gt;&gt;<code class="w" translate="no"> </code>INFO<code class="w" translate="no">   </code>Started<code class="w" translate="no"> </code>server<code class="w" translate="no"> </code>process<code class="w" translate="no"> </code><code class="o" translate="no">[</code><code class="m" translate="no">11316</code><code class="o" translate="no">]</code><code class="w" translate="no"/>
&gt;&gt;<code class="w" translate="no"> </code>INFO<code class="w" translate="no">   </code>Waiting<code class="w" translate="no"> </code><code class="k" translate="no">for</code><code class="w" translate="no"> </code>application<code class="w" translate="no"> </code>startup.<code class="w" translate="no"/>
&gt;&gt;<code class="w" translate="no"> </code>INFO<code class="w" translate="no">   </code>Application<code class="w" translate="no"> </code>startup<code class="w" translate="no"> </code>complete.<code class="w" translate="no"/></pre>
<p>Il tuo server web è ora accessibile da <code translate="no">http://127.0.0.1:8000</code> con due endpoint esposti alle rotte radice <code translate="no">/</code> e <code translate="no">/chat</code>.</p>
<p>Se visiti <code translate="no">http://127.0.0.1:8000</code> nel tuo browser, dovresti vedere il messaggio <code translate="no">{"status": "healthy"}</code>. Inoltre, quando visiti <code translate="no">http://127.0.0.1:8000/chat</code>, dovresti vedere un messaggio di ispirazione dal modello <code translate="no">gpt-4o</code> di OpenAI.</p>
<p>Congratulazioni, ora hai un servizio di IA generativa completamente funzionante.</p>
<div data-type="tip"><h6>Suggerimento</h6>
<p>Poiché hai avviato il server in un modello dev utilizzando il comando <code translate="no">fastapi dev</code>, un processo di file watcher è in ascolto per le modifiche al tuo progetto e aggiorna automaticamente il servizio quando aggiorni il codice.</p>
</div>
<p>Non esitare a cambiare il prompt predefinito e ad aggiornare il browser per vedere le tue modifiche in tempo reale.</p>
<p>L'oggetto <code translate="no">app</code>, creato dalla classe <code translate="no">FastAPI</code>, converte la tua funzione Python con un decoratore in un endpoint HTTP (Hypertext Transfer Protocol). Puoi attivare entrambi gli endpoint inviando una richiesta HTTP.</p>
<p>Il pacchetto <code translate="no">uvicorn</code> prende l'oggetto <code translate="no">app</code> e avvia un server web che esegue il tuo servizio FastAPI.</p>
<p><a data-primary="auto-documentation" data-type="indexterm" id="id512"/><a data-primary="documentation, automatic generation of" data-type="indexterm" id="id513"/><a data-primary="FastAPI (basics)" data-secondary="automatic documentation" data-type="indexterm" id="id514"/><a data-primary="Swagger documentation" data-type="indexterm" id="id515"/>Oltre a ottenere un semplice server web, avrai anche una documentazione API generata automaticamente per te. La documentazione segue lo standard OpenAPI e include una specifica <code translate="no">openapi.json</code> del tuo servizio web e una pagina di documentazione Swagger costruita a partire dallo stesso file di specifica.</p>
<p>Puoi accedere alla pagina dei documenti autogenerati collegandoti al percorso <code translate="no">/docs</code> del tuo server tramite <code translate="no">http://localhost:8000/docs</code>; vedrai una pagina simile a quella della <a data-type="xref" href="#swagger_docs">Figura 2-1</a>.</p>
<figure><div class="figure" id="swagger_docs">
<img alt="bgai 0201" src="assets/bgai_0201.png" width="1249" height="809"/>
<h6><span class="label">Figura 2-1. </span>Documentazione Swagger generata automaticamente dell'API</h6>
</div></figure>
<p>Dalla pagina dei documenti Swagger, puoi inviare richieste alla tua API per testare rapidamente un endpoint. La pagina dei documenti si occuperà anche di inviare le intestazioni, i metodi e i parametri di richiesta corretti.</p>
<p>Ciò che mi piace della pagina dei documenti di Swagger è che puoi iterare rapidamente su varie implementazioni utilizzando l'interfaccia utente, il che può essere più veloce della scrittura di test durante l'iterazione del design delle tue API. Tuttavia, questo non sostituisce i test tradizionali che possono controllare ogni endpoint quando si apportano modifiche. Man mano che la tua applicazione cresce, vale ancora la pena di scrivere dei test. Una volta che le firme dei tuoi endpoint sono ulteriormente stabilite, puoi scrivere i test di <code translate="no">pytest</code> per testare sistematicamente il tuo servizio web da un capo all'altro.</p>
<p><a data-primary="data serialization" data-type="indexterm" id="id516"/><a data-primary="data validation" data-type="indexterm" id="id517"/>Oltre alla documentazione automatica, FastAPI offre anche la serializzazione automatica e la convalida dei dati. Nell'<a data-type="xref" href="#simple_fastapi_web_server">Esempio 2-1</a>, abbiamo restituito un dizionario nel controller principale quando hai visitato <code translate="no">http://localhost:8000</code>. C'è un po' di magia che deve accadere affinché i dati vengano visualizzati nel browser.
I dati devono prima essere serializzati da un oggetto Python come un dizionario o un elenco in una stringa JavaScript Object Notation (JSON). Successivamente, vengono trasferiti sul web e deserializzati in un oggetto JavaScript dal client del browser una volta completata la trasmissione. Questo è il modo in cui le applicazioni sul web "parlano" tra loro.</p>
<div data-type="note" epub:type="note"><h6>Nota</h6>
<p>La serializzazione è necessaria quando si utilizza HTTP per la trasmissione dei dati, poiché solo i dati testuali o binari possono essere trasferiti tramite HTTP.<a data-startref="ix_ch02-asciidoc5" data-type="indexterm" id="id518"/><a data-startref="ix_ch02-asciidoc4" data-type="indexterm" id="id519"/><a data-startref="ix_ch02-asciidoc3" data-type="indexterm" id="id520"/></p>
</div>
<p>Ora che hai un server FastAPI funzionante, vediamo le caratteristiche e i vantaggi di FastAPI che puoi utilizzare nel tuo progetto.<a data-startref="ix_ch02-asciidoc2" data-type="indexterm" id="id521"/><a data-startref="ix_ch02-asciidoc1" data-type="indexterm" id="id522"/></p>
</div></section>
</div></section>
<section data-pdf-bookmark="FastAPI Features and Advantages" data-type="sect1"><div class="sect1" id="id238">
<h1>Caratteristiche e vantaggi di FastAPI</h1>
<p><a data-primary="FastAPI (basics)" data-secondary="features and advantages" data-type="indexterm" id="ix_ch02-asciidoc6"/>Vuoi un framework web adatto che ti permetta di creare senza fatica i tuoi servizi di intelligenza artificiale generativa, senza inutili difficoltà. Questo framework dovrebbe includere tutti gli elementi essenziali per la sicurezza, l'autenticazione e le prestazioni, pur garantendoti la flessibilità necessaria per incorporare tutte le funzionalità e le integrazioni aggiuntive richieste man mano che la tua applicazione cresce in complessità.</p>
<p>FastAPI è in grado di soddisfare la maggior parte di questi criteri, in quanto offre diverse funzionalità e vantaggi. Tuttavia, come scoprirai più avanti in questo capitolo sui <a href="#fastapi_limitations">limiti di FastAPI</a>, i casi d'uso avanzati, come i carichi di lavoro AI ad alta intensità di risorse, possono richiedere framework o soluzioni web specializzate, come verrà illustrato nel <a data-type="xref" href="ch03.html#ch03">Capitolo 3</a>.</p>
<p>Per ora, esaminiamo le caratteristiche e i vantaggi di FastAPI prima di discutere i suoi limiti nel contesto della creazione di servizi di intelligenza artificiale generativa.</p>
<section data-pdf-bookmark="Inspired by Flask Routing Pattern" data-type="sect2"><div class="sect2" id="id439">
<h2>Ispirato al modello di instradamento di Flask</h2>
<p>Sia in Flask che in FastAPI, puoi creare qualsiasi rotta decorando una funzione con un decoratore specializzato. Puoi quindi configurare le rotte per accettare e convalidare intestazioni, cookie, corpo, percorso e parametri di query per supportare la tua implementazione.</p>
</div></section>
<section data-pdf-bookmark="Handling Asynchronous and Synchronous Operations" data-type="sect2"><div class="sect2" id="id16">
<h2>Gestione delle operazioni asincrone e sincrone</h2>
<p><a data-primary="asynchronous functions" data-type="indexterm" id="id523"/><a data-primary="concurrency" data-secondary="FastAPI and" data-type="indexterm" id="id524"/><a data-primary="FastAPI (basics)" data-secondary="handling asynchronous/synchronous operations" data-type="indexterm" id="id525"/>Quando costruisci un servizio, questo deve essere in grado di gestire richieste multiple da parte di<span class="keep-together">più</span> utenti per aumentare l'efficienza d'uso man mano che la domanda aumenta. FastAPI è in grado di <a href="https://oreil.ly/gNYMg">gestire</a> senza problemi <a href="https://oreil.ly/gNYMg">sia le funzioni sincrone che quelle asincrone nella tua applicazione</a> per abilitare la concorrenza fin dall'inizio.</p>
<p>Come vedremo in dettaglio nel <a data-type="xref" href="ch05.html#ch05">Capitolo 5</a>, se definisci una rotta asincrona usando <code translate="no">async def</code>, FastAPI la eseguirà sul thread principale nel ciclo dell'evento principale.<a data-primary="thread worker" data-type="indexterm" id="id526"/>D'altra parte, se definisci una rotta sincrona (non dichiarata con la parola chiave <code translate="no">async</code> ), FastAPI la eseguirà su un <em>thread worker</em> per gestire carichi di lavoro concorrenti.</p>
<div data-type="warning" epub:type="warning"><h6>Avvertenze</h6>
<p>L'esecuzione di operazioni filettate comporta un overhead aggiuntivo<span class="keep-together">rispetto</span> all'esecuzione asincrona. Pertanto, avere molti percorsi sincroni può limitare la scalabilità della tua<span class="keep-together">applicazione.</span></p>
</div>
<p>Di conseguenza, le richieste simultanee non bloccheranno il thread principale del server. Questo è particolarmente utile quando si tratta di operazioni di input/output, come le query sui database, lo scambio di dati con le unità di elaborazione grafica (GPU),<sup><a data-type="noteref" href="ch02.html#id527" id="id527-marker" translate="no">3</a></sup> o le richieste HTTP.</p>
</div></section>
<section data-pdf-bookmark="Built-In Support for Background Tasks" data-type="sect2"><div class="sect2" id="id17">
<h2>Supporto integrato per le attività in background</h2>
<p><a data-primary="background tasks (FastAPI mechanism)" data-type="indexterm" id="id528"/><a data-primary="FastAPI (basics)" data-secondary="background tasks" data-type="indexterm" id="id529"/>Puoi costruire percorsi in grado di gestire attività di lunga durata (ad esempio, l'invio di e-mail) senza dover ricorrere a librerie esterne (ad esempio, <code translate="no">celery</code>). FastAPI include una <a href="https://oreil.ly/aO6ml">funzione per le attività in background</a><sup><a data-type="noteref" href="ch02.html#id530" id="id530-marker" translate="no">4</a></sup> per lavorare con sistemi che hanno bisogno di tempo per elaborare i dati ma che non vogliono ritardare la restituzione delle risposte alle richieste.</p>
<p>Non tutti i compiti possono essere eseguiti entro i limiti di pazienza dei tuoi utenti. Non vuoi farli aspettare mentre il processo continua a terminare. Puoi affidare l'operazione in corso a un compito in background eseguito su un thread separato, dopo aver risposto al cliente. Come risposta, puoi far sapere ai clienti che il tuo servizio ha accettato e messo in coda la loro richiesta per elaborarla in background.</p>
<p>Ad esempio, nei servizi GenAI puoi utilizzare attività in background per elaborare documenti caricati di grandi dimensioni in un database vettoriale senza bloccare il server. In questo modo il server può gestire altre richieste mentre l'elaborazione dei documenti avviene in background.</p>
<p>Scoprirai come costruire un sistema di questo tipo nel <a data-type="xref" href="ch05.html#ch05">Capitolo 5</a>.</p>
</div></section>
<section data-pdf-bookmark="Custom Middleware and CORS Support" data-type="sect2"><div class="sect2" id="id18">
<h2>Middleware personalizzato e supporto CORS</h2>
<p><a data-primary="CORS (cross-origin resource sharing)" data-type="indexterm" id="id531"/><a data-primary="cross-origin resource sharing (CORS)" data-type="indexterm" id="id532"/><a data-primary="FastAPI (basics)" data-secondary="custom middleware and CORS support" data-type="indexterm" id="id533"/><a data-primary="middleware" data-secondary="FastAPI and" data-type="indexterm" id="id534"/>FastAPI ti permette di aggiungere <a href="https://oreil.ly/uvlLC">componenti middleware</a> al router della tua app per intercettare la comunicazione tra gli endpoint delle API e i client. Ogni middleware, posizionato davanti ai tuoi endpoint, ti permette di accedere agli oggetti di richiesta e di risposta per modificarli a seconda delle necessità. Puoi aggiungere una logica su come le richieste devono essere elaborate prima di essere consegnate ai gestori delle rotte. Una volta che la risposta è stata generata, puoi eseguire operazioni sulla risposta, come la modifica delle intestazioni, le operazioni di log e l'impostazione dei cookie, prima di inviarla al client.</p>
<p>Un modello comune nello sviluppo di un backend è quello di utilizzare il middleware per <a href="https://oreil.ly/Yfsqg">aggiungere intestazioni extra a una risposta</a>, eseguire controlli di base sulle richieste in arrivo, supportare le <a href="https://oreil.ly/6u1dI">richieste CORS</a>, <a href="ch03.html#middleware_monitoring">registrare e monitorare le comunicazioni</a> e molto altro ancora. Puoi anche sfruttare <a href="https://oreil.ly/AJKJt">middleware</a> di terze parti o <a href="https://oreil.ly/AJKJt">personalizzati</a>.</p>
</div></section>
<section data-pdf-bookmark="Freedom to Customize Any Service Layer" data-type="sect2"><div class="sect2" id="id19">
<h2>Libertà di personalizzare qualsiasi livello di servizio</h2>
<p><a data-primary="custom classes" data-type="indexterm" id="id535"/><a data-primary="FastAPI (basics)" data-secondary="service layer customization" data-type="indexterm" id="id536"/>In alcuni casi potresti voler uscire dalle limitazioni del tuo attuale framework web. FastAPI offre una soluzione a questo problema permettendoti di definire classi personalizzate che ereditano le classi base di Starlette, il framework web sottostante. Ad esempio, puoi <a href="https://oreil.ly/qgvgO">sovrascrivere i gestori di eccezioni predefiniti</a>, aggiungere <a href="https://oreil.ly/1A8OD">middleware ASGI personalizzati</a> o persino <a href="https://oreil.ly/jLXUf">creare risposte personalizzate</a>.</p>
<p>Con la potenza di Pydantic o degli <a href="https://oreil.ly/MJmqJ">encoder di FastAPI</a>, puoi anche creare senza problemi i tuoi <a href="https://oreil.ly/UnzRk">serializzatori personalizzati</a> per regolare la gestione degli oggetti datetime.</p>
<p>Questo ti permette di implementare le funzioni secondo le tue preferenze senza dover lottare contro FastAPI.</p>
</div></section>
<section data-pdf-bookmark="Data Validation and Serialization" data-type="sect2"><div class="sect2" id="id20">
<h2>Convalida e serializzazione dei dati</h2>
<p><a data-primary="data serialization" data-type="indexterm" id="ix_ch02-asciidoc7"/><a data-primary="data validation" data-type="indexterm" id="ix_ch02-asciidoc8"/><a data-primary="FastAPI (basics)" data-secondary="data validation/serialization" data-type="indexterm" id="ix_ch02-asciidoc9"/><a data-primary="Pydantic" data-secondary="data validation/serialization" data-type="indexterm" id="ix_ch02-asciidoc10"/>Per le applicazioni che gestiscono grandi quantità di dati, è importante che i dati che stai per elaborare siano puliti e in un formato noto.</p>
<p>Man mano che la complessità del tuo servizio cresce, vorrai eseguire la convalida e la serializzazione dei dati. In FastAPI, puoi usare Pydantic per serializzare automaticamente i tipi di dati comuni (ad esempio, liste, dizionari, primitive) quando vengono restituiti nelle rotte API. Puoi anche definire i tuoi schemi Pydantic per i dati delle richieste e delle risposte per eseguire una convalida dei dati più rigorosa.</p>
<p>Ad esempio, puoi convalidare la password di un utente al momento della creazione dell'account per adeguarla ai tuoi criteri di sicurezza, come mostrato nell'<a data-type="xref" href="#data_validation">esempio 2-2</a>.</p>
<div class="less_space pagebreak-before" data-type="example" id="data_validation">
<h5><span class="label">Esempio 2-2. </span>Convalida delle password degli utenti in FastAPI utilizzando uno schema Pydantic</h5>
<pre data-code-language="python" data-type="programlisting" translate="no"><code class="c1" translate="no"># main.py</code><code translate="no">
</code><code class="kn" translate="no">from</code><code translate="no"> </code><code class="nn" translate="no">pydantic</code><code translate="no"> </code><code class="kn" translate="no">import</code><code translate="no"> </code><code class="n" translate="no">BaseModel</code><code class="p" translate="no">,</code><code translate="no"> </code><code class="n" translate="no">Field</code><code class="p" translate="no">,</code><code translate="no"> </code><code class="n" translate="no">EmailStr</code><code translate="no">
</code><code translate="no">
</code><code class="k" translate="no">class</code><code translate="no"> </code><code class="nc" translate="no">UserCreate</code><code class="p" translate="no">(</code><code class="n" translate="no">BaseModel</code><code class="p" translate="no">)</code><code class="p" translate="no">:</code><code translate="no">
</code><code translate="no">    </code><code class="n" translate="no">username</code><code class="p" translate="no">:</code><code translate="no"> </code><code class="nb" translate="no">str</code><code translate="no">
</code><code translate="no">    </code><code class="n" translate="no">password</code><code class="p" translate="no">:</code><code translate="no"> </code><code class="nb" translate="no">str</code><code translate="no">
</code><code translate="no">
</code><code translate="no">    </code><code class="nd" translate="no">@validator</code><code class="p" translate="no">(</code><code class="s1" translate="no">'</code><code class="s1" translate="no">password</code><code class="s1" translate="no">'</code><code class="p" translate="no">)</code><code translate="no"> </code><a class="co" href="#callout_getting_started_with_fastapi_CO2-1" id="co_getting_started_with_fastapi_CO2-1"><img alt="1" src="assets/1.png" width="12" height="12"/></a><code translate="no">
</code><code translate="no">    </code><code class="k" translate="no">def</code><code translate="no"> </code><code class="nf" translate="no">validate_password</code><code class="p" translate="no">(</code><code class="bp" translate="no">cls</code><code class="p" translate="no">,</code><code translate="no"> </code><code class="n" translate="no">value</code><code class="p" translate="no">)</code><code class="p" translate="no">:</code><code translate="no">
</code><code translate="no">        </code><code class="k" translate="no">if</code><code translate="no"> </code><code class="nb" translate="no">len</code><code class="p" translate="no">(</code><code class="n" translate="no">value</code><code class="p" translate="no">)</code><code translate="no"> </code><code class="o" translate="no">&lt;</code><code translate="no"> </code><code class="mi" translate="no">8</code><code class="p" translate="no">:</code><code translate="no">
</code><code translate="no">            </code><code class="k" translate="no">raise</code><code translate="no"> </code><code class="ne" translate="no">ValueError</code><code class="p" translate="no">(</code><code class="s1" translate="no">'</code><code class="s1" translate="no">Password must be at least 8 characters long</code><code class="s1" translate="no">'</code><code class="p" translate="no">)</code><code translate="no">
</code><code translate="no">        </code><code class="k" translate="no">if</code><code translate="no"> </code><code class="ow" translate="no">not</code><code translate="no"> </code><code class="nb" translate="no">any</code><code class="p" translate="no">(</code><code class="n" translate="no">char</code><code class="o" translate="no">.</code><code class="n" translate="no">isdigit</code><code class="p" translate="no">(</code><code class="p" translate="no">)</code><code translate="no"> </code><code class="k" translate="no">for</code><code translate="no"> </code><code class="n" translate="no">char</code><code translate="no"> </code><code class="ow" translate="no">in</code><code translate="no"> </code><code class="n" translate="no">value</code><code class="p" translate="no">)</code><code class="p" translate="no">:</code><code translate="no">
</code><code translate="no">            </code><code class="k" translate="no">raise</code><code translate="no"> </code><code class="ne" translate="no">ValueError</code><code class="p" translate="no">(</code><code class="s1" translate="no">'</code><code class="s1" translate="no">Password must contain at least one digit</code><code class="s1" translate="no">'</code><code class="p" translate="no">)</code><code translate="no">
</code><code translate="no">        </code><code class="k" translate="no">if</code><code translate="no"> </code><code class="ow" translate="no">not</code><code translate="no"> </code><code class="nb" translate="no">any</code><code class="p" translate="no">(</code><code class="n" translate="no">char</code><code class="o" translate="no">.</code><code class="n" translate="no">isupper</code><code class="p" translate="no">(</code><code class="p" translate="no">)</code><code translate="no"> </code><code class="k" translate="no">for</code><code translate="no"> </code><code class="n" translate="no">char</code><code translate="no"> </code><code class="ow" translate="no">in</code><code translate="no"> </code><code class="n" translate="no">value</code><code class="p" translate="no">)</code><code class="p" translate="no">:</code><code translate="no">
</code><code translate="no">            </code><code class="k" translate="no">raise</code><code translate="no"> </code><code class="ne" translate="no">ValueError</code><code class="p" translate="no">(</code><code class="s1" translate="no">'</code><code class="s1" translate="no">Password must contain at least one uppercase letter</code><code class="s1" translate="no">'</code><code class="p" translate="no">)</code><code translate="no">
</code><code translate="no">        </code><code class="k" translate="no">return</code><code translate="no"> </code><code class="n" translate="no">value</code><code translate="no"> </code><a class="co" href="#callout_getting_started_with_fastapi_CO2-2" id="co_getting_started_with_fastapi_CO2-2"><img alt="2" src="assets/2.png" width="12" height="12"/></a><code translate="no">
</code><code translate="no">
</code><code class="n" translate="no">app</code><code translate="no"> </code><code class="o" translate="no">=</code><code translate="no"> </code><code class="n" translate="no">FastAPI</code><code class="p" translate="no">(</code><code class="p" translate="no">)</code><code translate="no">
</code><code translate="no">
</code><code class="nd" translate="no">@app</code><code class="o" translate="no">.</code><code class="n" translate="no">post</code><code class="p" translate="no">(</code><code class="s2" translate="no">"</code><code class="s2" translate="no">/users</code><code class="s2" translate="no">"</code><code class="p" translate="no">)</code><code translate="no">
</code><code class="k" translate="no">async</code><code translate="no"> </code><code class="k" translate="no">def</code><code translate="no"> </code><code class="nf" translate="no">create_user_controller</code><code class="p" translate="no">(</code><code class="n" translate="no">user</code><code class="p" translate="no">:</code><code translate="no"> </code><code class="n" translate="no">UserCreate</code><code class="p" translate="no">)</code><code class="p" translate="no">:</code><code translate="no">
</code><code translate="no">    </code><code class="k" translate="no">return</code><code translate="no"> </code><code class="p" translate="no">{</code><code class="s2" translate="no">"</code><code class="s2" translate="no">name</code><code class="s2" translate="no">"</code><code class="p" translate="no">:</code><code translate="no"> </code><code class="n" translate="no">user</code><code class="o" translate="no">.</code><code class="n" translate="no">name</code><code class="p" translate="no">,</code><code translate="no"> </code><code class="s2" translate="no">"</code><code class="s2" translate="no">message</code><code class="s2" translate="no">"</code><code class="p" translate="no">:</code><code translate="no"> </code><code class="s2" translate="no">"</code><code class="s2" translate="no">Account successfully created</code><code class="s2" translate="no">"</code><code class="p" translate="no">}</code><code translate="no">
</code><code translate="no">
</code><code class="o" translate="no">.</code><code class="o" translate="no">.</code><code class="o" translate="no">.</code></pre>
<dl class="calloutlist">
<dt><a class="co" href="#co_getting_started_with_fastapi_CO2-1" id="callout_getting_started_with_fastapi_CO2-1"><img alt="1" src="assets/1.png" width="12" height="12"/></a></dt>
<dd><p>Definisci un modello Pydantic con una convalida dei dati personalizzata sul campo <code translate="no">password</code>.</p></dd>
<dt><a class="co" href="#co_getting_started_with_fastapi_CO2-2" id="callout_getting_started_with_fastapi_CO2-2"><img alt="2" src="assets/2.png" width="12" height="12"/></a></dt>
<dd><p>Segnala a <code translate="no">ValueError</code> se uno qualsiasi dei criteri per le password non viene rispettato.</p></dd>
</dl></div>
<p>Questo ti permette di catturare, gestire e proteggere i tuoi servizi da problemi con i dati che non vengono rilevati dai controllori statici di tipo come <code translate="no">mypy</code>.</p>
<p>I validatori di Pydantic ti permettono anche di convalidare a runtime tipi di dati più complessi come email, URL, UUID e altro ancora. Il<a data-type="xref" href="ch04.html#ch04">Capitolo 4</a> approfondisce come eseguire la convalida dei dati con Pydantic.<a data-startref="ix_ch02-asciidoc10" data-type="indexterm" id="id537"/><a data-startref="ix_ch02-asciidoc9" data-type="indexterm" id="id538"/><a data-startref="ix_ch02-asciidoc8" data-type="indexterm" id="id539"/><a data-startref="ix_ch02-asciidoc7" data-type="indexterm" id="id540"/></p>
</div></section>
<section data-pdf-bookmark="Rich Ecosystem of Plug-Ins" data-type="sect2"><div class="sect2" id="id21">
<h2>Ricco ecosistema di plug-in</h2>
<p><a data-primary="FastAPI (basics)" data-secondary="plug-ins for" data-type="indexterm" id="id541"/><a data-primary="plug-ins" data-type="indexterm" id="id542"/>I plug-in sono pacchetti Python che si agganciano agli interni di FastAPI e alle funzionalità esistenti. Sono simili a qualsiasi altro pacchetto Python che installi e importi nei tuoi script e richiedono configurazioni minime dopo l'installazione. Integrarli significa estendere le funzionalità del tuo servizio senza dover gestire l'ordine delle integrazioni o i problemi di compatibilità. Puoi anche rimuoverli senza rompere la tua applicazione.</p>
<p class="less_space pagebreak-before">Tra i plug-in più noti ci sono FastAPI Filters, Auth Users, Rate Limiting e molti altri, che puoi vedere nel <a href="https://oreil.ly/nKbvP">repository GitHub di Awesome FastAPI</a>.</p>
</div></section>
<section data-pdf-bookmark="Automatic Documentation" data-type="sect2"><div class="sect2" id="id22">
<h2>Documentazione automatica</h2>
<p><a data-primary="auto-documentation" data-type="indexterm" id="id543"/><a data-primary="documentation, automatic generation of" data-type="indexterm" id="id544"/><a data-primary="FastAPI (basics)" data-secondary="automatic documentation" data-type="indexterm" id="id545"/><a data-primary="Swagger documentation" data-type="indexterm" id="id546"/>Con FastAPI, la documentazione dell'interfaccia utente di Swagger viene generata automaticamente per permetterti di visualizzare e testare tutte le rotte che crei, come hai visto nella <a data-type="xref" href="#swagger_docs">Figura 2-1</a>. Durante lo sviluppo, avere una pagina di documentazione interattiva ti permette di eseguire il debug e la prototipazione delle rotte in modo più semplice e veloce, fino a quando non costruisci e gestisci le tue suite di test.</p>
<p>Man mano che costruisci nuovi endpoint, potresti voler rivisitare la pagina <code translate="no">/docs</code> per testarli.</p>
<p>Puoi configurare un reindirizzamento dall'URL di base <code translate="no">/</code> all'endpoint <code translate="no">/docs</code> per facilitare un accesso più rapido alla pagina della documentazione, come mostrato nell'<a data-type="xref" href="#setting_up_redirect">Esempio 2-3</a>.</p>
<div data-type="example" id="setting_up_redirect">
<h5><span class="label">Esempio 2-3. </span>Impostazione del reindirizzamento alla pagina dei documenti generata automaticamente</h5>
<pre data-code-language="python" data-type="programlisting" translate="no"><code class="c1" translate="no"># main.py</code><code translate="no">
</code><code class="kn" translate="no">from</code><code translate="no"> </code><code class="nn" translate="no">fastapi</code><code class="nn" translate="no">.</code><code class="nn" translate="no">responses</code><code translate="no"> </code><code class="kn" translate="no">import</code><code translate="no"> </code><code class="n" translate="no">RedirectResponse</code><code translate="no">
</code><code translate="no">
</code><code class="nd" translate="no">@app</code><code class="o" translate="no">.</code><code class="n" translate="no">get</code><code class="p" translate="no">(</code><code class="s2" translate="no">"</code><code class="s2" translate="no">/</code><code class="s2" translate="no">"</code><code class="p" translate="no">,</code><code translate="no"> </code><code class="n" translate="no">include_in_schema</code><code class="o" translate="no">=</code><code class="kc" translate="no">False</code><code class="p" translate="no">)</code><code translate="no"> </code><a class="co" href="#callout_getting_started_with_fastapi_CO3-1" id="co_getting_started_with_fastapi_CO3-1"><img alt="1" src="assets/1.png" width="12" height="12"/></a><code translate="no">
</code><code class="k" translate="no">def</code><code translate="no"> </code><code class="nf" translate="no">docs_redirect_controller</code><code class="p" translate="no">(</code><code class="p" translate="no">)</code><code class="p" translate="no">:</code><code translate="no">
</code><code translate="no">    </code><code class="k" translate="no">return</code><code translate="no"> </code><code class="n" translate="no">RedirectResponse</code><code class="p" translate="no">(</code><code class="n" translate="no">url</code><code class="o" translate="no">=</code><code class="s2" translate="no">"</code><code class="s2" translate="no">/docs</code><code class="s2" translate="no">"</code><code class="p" translate="no">,</code><code translate="no"> </code><code class="n" translate="no">status_code</code><code class="o" translate="no">=</code><code class="n" translate="no">status</code><code class="o" translate="no">.</code><code class="n" translate="no">HTTP_303_SEE_OTHER</code><code class="p" translate="no">)</code><code translate="no"> </code><a class="co" href="#callout_getting_started_with_fastapi_CO3-2" id="co_getting_started_with_fastapi_CO3-2"><img alt="2" src="assets/2.png" width="12" height="12"/></a></pre></div>
<dl class="calloutlist">
<dt><a class="co" href="#co_getting_started_with_fastapi_CO3-1" id="callout_getting_started_with_fastapi_CO3-1"><img alt="1" src="assets/1.png" width="12" height="12"/></a></dt>
<dd><p>Imposta un gestore per il gestore di base, ma non includerlo nelle specifiche OpenAPI e nella pagina della documentazione.</p></dd>
<dt><a class="co" href="#co_getting_started_with_fastapi_CO3-2" id="callout_getting_started_with_fastapi_CO3-2"><img alt="2" src="assets/2.png" width="12" height="12"/></a></dt>
<dd><p>Restituisce una risposta di reindirizzamento alla pagina <code translate="no">/docs</code> con un codice di stato di reindirizzamento per i browser per eseguire il reindirizzamento.</p></dd>
</dl>
<p>Con l'<a data-type="xref" href="#setting_up_redirect">esempio 2-3</a>, puoi accedere alla pagina <code translate="no">/docs</code> durante lo sviluppo locale ogni volta che visiti l'URL di base <code translate="no">/</code> del servizio.</p>
<p>In produzione, a meno che la tua API non sia pubblica, disabilita questo reindirizzamento e nascondi le rotte di <code translate="no">/docs</code> come impostazione predefinita per una maggiore sicurezza.</p>
<div data-type="warning" epub:type="warning"><h6>Avvertenze</h6>
<p>Se la tua API è accessibile pubblicamente in produzione, potresti esporre endpoint non protetti e informazioni sensibili sulla tua API. Pertanto, è <a href="https://oreil.ly/Dk45G">buona norma disattivare la pagina della documentazione</a>.</p>
<p>Invece, puoi mostrare esplicitamente la pagina <code translate="no">/docs</code> solo su alcuni ambienti selezionati.</p>
</div>
<p class="less_space pagebreak-before">Per le API pubbliche, puoi impostare il gestore principale <code translate="no">/</code> in modo che restituisca la versione dell'API invece di reindirizzare alla pagina <code translate="no">/docs</code>.</p>
</div></section>
<section data-pdf-bookmark="Dependency Injection System" data-type="sect2"><div class="sect2" id="id23">
<h2>Sistema di iniezione delle dipendenze</h2>
<p><a data-primary="dependency injection system" data-type="indexterm" id="ix_ch02-asciidoc15"/><a data-primary="FastAPI (basics)" data-secondary="dependency injection system" data-type="indexterm" id="ix_ch02-asciidoc16"/>Un altro <a data-primary="inversion of control" data-type="indexterm" id="id547"/>potente componente di FastAPI è il suo <a href="https://oreil.ly/eAIwR">sistema di iniezione delle dipendenze</a> basato su un modello di sviluppo chiamato <em>inversione del controllo</em>. Utilizzando questo modello, si suddivide una funzione in una serie di funzioni che vengono iniettate in altre funzioni come<span class="keep-together"><em>dipendenze</em></span>.</p>
<p>Oltre ad aiutare a strutturare la logica della tua applicazione, le dipendenze possono aiutarti a ridurre le duplicazioni: ti permettono di condividere e riutilizzare la logica delle tue API, di riutilizzare le connessioni aperte al database, di applicare la sicurezza come i requisiti di autenticazione o autorizzazione e molto altro ancora.</p>
<p>Ad esempio, puoi specificare parametri di query comuni a tutte le rotte API (ad esempio, per la paginazione e il filtraggio), come mostrato nell'<a data-type="xref" href="#dependency_pagination">Esempio 2-4</a>.</p>
<div data-type="example" id="dependency_pagination">
<h5><span class="label">Esempio 2-4. </span>Ridurre la duplicazione utilizzando una dipendenza di paginazione</h5>
<pre data-code-language="python" data-type="programlisting" translate="no"><code class="kn" translate="no">from</code> <code class="nn" translate="no">fastapi</code> <code class="kn" translate="no">import</code> <code class="n" translate="no">FastAPI</code><code class="p" translate="no">,</code> <code class="n" translate="no">Depends</code>

<code class="n" translate="no">app</code> <code class="o" translate="no">=</code> <code class="n" translate="no">FastAPI</code><code class="p" translate="no">()</code>

<code class="k" translate="no">def</code> <code class="nf" translate="no">paginate</code><code class="p" translate="no">(</code><code class="n" translate="no">skip</code><code class="p" translate="no">:</code> <code class="nb" translate="no">int</code> <code class="o" translate="no">=</code> <code class="mi" translate="no">0</code><code class="p" translate="no">,</code> <code class="n" translate="no">limit</code><code class="p" translate="no">:</code> <code class="nb" translate="no">int</code> <code class="o" translate="no">=</code> <code class="mi" translate="no">10</code><code class="p" translate="no">):</code>
    <code class="k" translate="no">return</code> <code class="p" translate="no">{</code><code class="s2" translate="no">"skip"</code><code class="p" translate="no">:</code> <code class="n" translate="no">skip</code><code class="p" translate="no">,</code> <code class="s2" translate="no">"limit"</code><code class="p" translate="no">:</code> <code class="n" translate="no">limit</code><code class="p" translate="no">}</code>

<code class="nd" translate="no">@app</code><code class="o" translate="no">.</code><code class="n" translate="no">get</code><code class="p" translate="no">(</code><code class="s2" translate="no">"/messages"</code><code class="p" translate="no">)</code>
<code class="k" translate="no">def</code> <code class="nf" translate="no">list_messages_controller</code><code class="p" translate="no">(</code><code class="n" translate="no">pagination</code><code class="p" translate="no">:</code> <code class="nb" translate="no">dict</code> <code class="o" translate="no">=</code> <code class="n" translate="no">Depends</code><code class="p" translate="no">(</code><code class="n" translate="no">paginate</code><code class="p" translate="no">)):</code>
    <code class="k" translate="no">return</code> <code class="o" translate="no">...</code>  <code class="c1" translate="no"># filter and paginate results using pagination params</code>

<code class="nd" translate="no">@app</code><code class="o" translate="no">.</code><code class="n" translate="no">get</code><code class="p" translate="no">(</code><code class="s2" translate="no">"/conversations"</code><code class="p" translate="no">)</code>
<code class="k" translate="no">def</code> <code class="nf" translate="no">list_conversations_controller</code><code class="p" translate="no">(</code><code class="n" translate="no">pagination</code><code class="p" translate="no">:</code> <code class="nb" translate="no">dict</code> <code class="o" translate="no">=</code> <code class="n" translate="no">Depends</code><code class="p" translate="no">(</code><code class="n" translate="no">paginate</code><code class="p" translate="no">)):</code>
    <code class="k" translate="no">return</code> <code class="o" translate="no">...</code>  <code class="c1" translate="no"># filter and paginate results using pagination params</code></pre></div>
<p>In FastAPI, le dipendenze vengono memorizzate nella cache anche nel <em>contesto di una singola richiesta</em> per evitare calcoli duplicati. Ciò significa che una funzione di dipendenza viene eseguita solo una volta per ogni richiesta e il suo risultato viene riutilizzato per la durata della richiesta stessa, se necessario. Tuttavia, in una nuova richiesta, la funzione di dipendenza viene eseguita nuovamente.</p>
<p>Dover gestire le connessioni al database o controllare le credenziali dell'utente in ogni route handler è noioso e viola i principi di programmazione <em>Don't Repeat Yourself</em> (DRY). Un altro grande caso d'uso del sistema di dependency injection è quando crei una connessione al database e vuoi riutilizzarla per eseguire più richieste di fetch durante l'elaborazione di una singola richiesta.</p>
<p class="less_space pagebreak-before">Puoi creare delle dipendenze per le tue funzioni di route controller, come mostrato nell'<a data-type="xref" href="#fastapi_dependency">Esempio 2-5</a>.</p>
<div data-type="example" id="fastapi_dependency">
<h5><span class="label">Esempio 2-5. </span>Iniezione di dipendenza in FastAPI</h5>
<pre data-code-language="python" data-type="programlisting" translate="no"><code class="kn" translate="no">from</code><code translate="no"> </code><code class="nn" translate="no">fastapi</code><code translate="no"> </code><code class="kn" translate="no">import</code><code translate="no"> </code><code class="n" translate="no">FastAPI</code><code class="p" translate="no">,</code><code translate="no"> </code><code class="n" translate="no">Depends</code><code translate="no">
</code><code translate="no">
</code><code class="k" translate="no">def</code><code translate="no"> </code><code class="nf" translate="no">get_db</code><code class="p" translate="no">(</code><code class="p" translate="no">)</code><code class="p" translate="no">:</code><code translate="no"> </code><a class="co" href="#callout_getting_started_with_fastapi_CO4-1" id="co_getting_started_with_fastapi_CO4-1"><img alt="1" src="assets/1.png" width="12" height="12"/></a><code translate="no">
</code><code translate="no">    </code><code class="n" translate="no">db</code><code translate="no"> </code><code class="o" translate="no">=</code><code translate="no"> </code><code class="o" translate="no">.</code><code class="o" translate="no">.</code><code class="o" translate="no">.</code><code translate="no"> </code><code class="c1" translate="no"># create a database session</code><code translate="no">
</code><code translate="no">    </code><code class="k" translate="no">try</code><code class="p" translate="no">:</code><code translate="no">
</code><code translate="no">        </code><code class="k" translate="no">yield</code><code translate="no"> </code><code class="n" translate="no">db</code><code translate="no"> </code><a class="co" href="#callout_getting_started_with_fastapi_CO4-2" id="co_getting_started_with_fastapi_CO4-2"><img alt="2" src="assets/2.png" width="12" height="12"/></a><code translate="no">
</code><code translate="no">    </code><code class="k" translate="no">finally</code><code class="p" translate="no">:</code><code translate="no">
</code><code translate="no">        </code><code class="n" translate="no">db</code><code class="o" translate="no">.</code><code class="n" translate="no">close</code><code class="p" translate="no">(</code><code class="p" translate="no">)</code><code translate="no"> </code><a class="co" href="#callout_getting_started_with_fastapi_CO4-3" id="co_getting_started_with_fastapi_CO4-3"><img alt="3" src="assets/3.png" width="12" height="12"/></a><code translate="no">
</code><code translate="no">
</code><code class="n" translate="no">app</code><code translate="no"> </code><code class="o" translate="no">=</code><code translate="no"> </code><code class="n" translate="no">FastAPI</code><code class="p" translate="no">(</code><code class="p" translate="no">)</code><code translate="no">
</code><code translate="no">
</code><code class="nd" translate="no">@app</code><code class="o" translate="no">.</code><code class="n" translate="no">get</code><code class="p" translate="no">(</code><code class="s2" translate="no">"</code><code class="s2" translate="no">users/</code><code class="si" translate="no">{email}</code><code class="s2" translate="no">/messages</code><code class="s2" translate="no">"</code><code class="p" translate="no">)</code><code translate="no">
</code><code class="k" translate="no">def</code><code translate="no"> </code><code class="nf" translate="no">get_current_user_messages</code><code class="p" translate="no">(</code><code class="n" translate="no">email</code><code class="p" translate="no">,</code><code translate="no"> </code><code class="n" translate="no">db</code><code translate="no"> </code><code class="o" translate="no">=</code><code translate="no"> </code><code class="n" translate="no">Depends</code><code class="p" translate="no">(</code><code class="n" translate="no">get_db</code><code class="p" translate="no">)</code><code class="p" translate="no">)</code><code class="p" translate="no">:</code><code translate="no"> </code><a class="co" href="#callout_getting_started_with_fastapi_CO4-4" id="co_getting_started_with_fastapi_CO4-4"><img alt="4" src="assets/4.png" width="12" height="12"/></a><code translate="no">
</code><code translate="no">    </code><code class="n" translate="no">user</code><code translate="no"> </code><code class="o" translate="no">=</code><code translate="no"> </code><code class="n" translate="no">db</code><code class="o" translate="no">.</code><code class="n" translate="no">query</code><code class="p" translate="no">(</code><code class="o" translate="no">.</code><code class="o" translate="no">.</code><code class="o" translate="no">.</code><code class="p" translate="no">)</code><code translate="no"> </code><code class="c1" translate="no"># db is reused</code><code translate="no">
</code><code translate="no">    </code><code class="n" translate="no">messages</code><code translate="no"> </code><code class="o" translate="no">=</code><code translate="no"> </code><code class="n" translate="no">db</code><code class="o" translate="no">.</code><code class="n" translate="no">query</code><code class="p" translate="no">(</code><code class="o" translate="no">.</code><code class="o" translate="no">.</code><code class="o" translate="no">.</code><code class="p" translate="no">)</code><code translate="no"> </code><code class="c1" translate="no"># db is reused</code><code translate="no">
</code><code translate="no">    </code><code class="k" translate="no">return</code><code translate="no"> </code><code class="n" translate="no">messages</code><code translate="no"> </code><a class="co" href="#callout_getting_started_with_fastapi_CO4-5" id="co_getting_started_with_fastapi_CO4-5"><img alt="5" src="assets/5.png" width="12" height="12"/></a></pre>
<dl class="calloutlist">
<dt><a class="co" href="#co_getting_started_with_fastapi_CO4-1" id="callout_getting_started_with_fastapi_CO4-1"><img alt="1" src="assets/1.png" width="12" height="12"/></a></dt>
<dd><p>Implementa una funzione per creare e gestire una sessione del database, che può essere utilizzata come dipendenza nei gestori delle rotte.</p></dd>
<dt><a class="co" href="#co_getting_started_with_fastapi_CO4-2" id="callout_getting_started_with_fastapi_CO4-2"><img alt="2" src="assets/2.png" width="12" height="12"/></a></dt>
<dd><p>Rende la sessione di database aperta, rendendola disponibile per qualsiasi funzione che dipenda da <code translate="no">get_db</code>.</p></dd>
<dt><a class="co" href="#co_getting_started_with_fastapi_CO4-3" id="callout_getting_started_with_fastapi_CO4-3"><img alt="3" src="assets/3.png" width="12" height="12"/></a></dt>
<dd><p>Chiude la sessione del database dopo che la richiesta è stata elaborata, evitando perdite di risorse.</p></dd>
<dt><a class="co" href="#co_getting_started_with_fastapi_CO4-4" id="callout_getting_started_with_fastapi_CO4-4"><img alt="4" src="assets/4.png" width="12" height="12"/></a></dt>
<dd><p>Inietta la dipendenza <code translate="no">get_db</code> nel gestore della rotta per creare e riutilizzare la stessa sessione del database durante il ciclo di vita della richiesta. FastAPI esporrà automaticamente i parametri all'interno delle dipendenze sul tuo endpoint.</p></dd>
<dt><a class="co" href="#co_getting_started_with_fastapi_CO4-5" id="callout_getting_started_with_fastapi_CO4-5"><img alt="5" src="assets/5.png" width="12" height="12"/></a></dt>
<dd><p>Riutilizza la sessione di database iniettata per eseguire più operazioni di database in un'unica richiesta per restituire i messaggi di un utente.</p></dd>
</dl></div>
<p>Come mostrato nell'<a data-type="xref" href="#fastapi_dependency">Esempio 2-5</a>, puoi iniettare queste dipendenze in altre funzioni passandole come parametri a <code translate="no">Depends()</code> affinché FastAPI valuti e memorizzi gli output delle tue funzioni.</p>
<p>Qui definisci una funzione di utilità per creare una sessione del database e poi la usi come dipendenza della funzione <code translate="no">get_current_user_messages</code> per iniettare la sessione del database creata.</p>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="id548">
<h1>Grafico delle dipendenze gerarchico</h1>
<p><a data-primary="hierarchical dependency graph" data-type="indexterm" id="id549"/>Puoi anche iniettare le dipendenze all'interno di altre dipendenze per creare un <em>grafo di dipendenze gerarchico</em>, estremamente utile per creare <a href="https://oreil.ly/i_xHr">flussi di autenticazione e autorizzazione nella cache</a>, logiche di recupero dei dati annidate o alberi decisionali complessi nell'implementazione della logica di business della tua applicazione.</p>
<p>Ad esempio, puoi riutilizzare le stesse funzioni di creazione della sessione del database o di ricerca dell'utente in diverse parti della tua API, come mostrato nella <a data-type="xref" href="#dependency_injection">Figura 2-2</a>.</p>
<figure><div class="figure" id="dependency_injection">
<img alt="bgai 0202" src="assets/bgai_0202.png" width="917" height="585"/>
<h6><span class="label">Figura 2-2. </span>Iniezione di dipendenza in FastAPI</h6>
</div></figure>
<p>In un grafo delle dipendenze gerarchico, come mostrato nella <a data-type="xref" href="#dependency_injection">Figura 2-2</a>, ogni dipendenza (e le sue sottodipendenze) può fornire (iniettare) i suoi risultati a un'altra funzione che dipende da essa.</p>
</div></aside>
<p>Questo sistema di dipendenze è solo una delle tante altre caratteristiche di FastAPI che velocizzano e facilitano il processo di creazione dei servizi di backend.<a data-startref="ix_ch02-asciidoc16" data-type="indexterm" id="id550"/><a data-startref="ix_ch02-asciidoc15" data-type="indexterm" id="id551"/></p>
</div></section>
<section data-pdf-bookmark="Lifespan Events" data-type="sect2"><div class="sect2" id="id24">
<h2>Eventi della durata della vita</h2>
<p><a data-primary="FastAPI (basics)" data-secondary="lifespan events" data-type="indexterm" id="id552"/><a data-primary="lifespan events" data-type="indexterm" id="id553"/><a href="https://oreil.ly/Cn2DB">Gli eventi di durata di FastAPI</a> sono eccellenti per gestire l'inizializzazione e la pulizia del tuo servizio quando hai bisogno di impostare risorse che possono essere condivise tra le richieste.<sup><a data-type="noteref" href="ch02.html#id554" id="id554-marker" translate="no">5</a></sup> Durante l'avvio del server, puoi creare pool di connessioni al database o caricare modelli GenAI in memoria per riutilizzarli tra le varie richieste. Successivamente, prima dello spegnimento del server, puoi fare pulizia scaricando i modelli AI, chiudendo i pool di connessioni, eliminando gli artefatti temporanei e registrando gli eventi.</p>
<p>Utilizzando gli eventi lifespan, il tuo servizio FastAPI esegue operazioni di lunga durata come il caricamento del modello all'inizio, prima di servire le richieste, e lo mantiene caricato per riutilizzarlo tra le richieste. Durante lo spegnimento del server, puoi quindi terminare con grazia tutte le richieste rimanenti e in coda prima di eseguire qualsiasi operazione di pulizia.</p>
</div></section>
<section data-pdf-bookmark="Security and Authentication Components" data-type="sect2"><div class="sect2" id="id239">
<h2>Componenti di sicurezza e autenticazione</h2>
<p><a data-primary="authentication" data-secondary="FastAPI components for" data-type="indexterm" id="id555"/><a data-primary="FastAPI (basics)" data-secondary="security/authentication components" data-type="indexterm" id="id556"/><a data-primary="securing AI services" data-secondary="FastAPI components for" data-type="indexterm" id="id557"/>Come per qualsiasi altro framework, avrai bisogno di componenti di sicurezza e di autenticazione per proteggere il tuo servizio. FastAPI non ti vincola a un'implementazione specifica del livello di sicurezza e di autenticazione, ma ti offre un insieme di <a href="https://oreil.ly/zlAgl">componenti di sicurezza</a> che ti permettono di proteggere i tuoi servizi in base alle tue esigenze.</p>
<p>Imparerai come implementare un livello di autenticazione da zero per i tuoi servizi GenAI nel <a data-type="xref" href="ch08.html#ch08">Capitolo 8</a>.</p>
<div data-type="tip"><h6>Suggerimento</h6>
<p>Se non vuoi implementare un livello di autenticazione da zero, puoi anche rivolgerti a plugin di terze parti come <a href="https://oreil.ly/eEtMe">FastAPI Users</a> che se ne occupano automaticamente per te.</p>
</div>
<p>Puoi anche integrarti con provider di autenticazione di terze parti per <a href="https://oreil.ly/vIqCd">flussi di single sign-on in FastAPI</a> in ambienti aziendali.</p>
</div></section>
<section data-pdf-bookmark="Bidirectional Web Socket, GraphQL, and Custom Response Support" data-type="sect2"><div class="sect2" id="id25">
<h2>Supporto di Web Socket bidirezionali, GraphQL e risposte personalizzate</h2>
<p><a data-primary="FastAPI (basics)" data-secondary="bidirectional WebSocket support" data-type="indexterm" id="ix_ch02-asciidoc17"/><a data-primary="WebSocket (WS)" data-secondary="FastAPI support for" data-type="indexterm" id="ix_ch02-asciidoc18"/>Quando costruisci dei servizi, spesso hai bisogno di andare oltre gli<span class="keep-together"><em>endpoint</em></span> <em>REST</em>standard<span class="keep-together">.</span></p>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="id558">
<h1>Endpoint REST</h1>
<p><a data-primary="REST (Representational State Transfer) endpoints" data-type="indexterm" id="id559"/><em>Representational State Transfer</em> (REST) è uno stile architettonico per la progettazione di API in cui si utilizzano metodi HTTP comuni come <code translate="no">GET</code>, <code translate="no">POST</code>, <code translate="no">PUT</code> e <code translate="no">DELETE</code> per accedere e manipolare le risorse.</p>
<p>I seguenti sono esempi di endpoint REST comuni:</p>
<dl>
<dt><code translate="no">GET endpoint /api/messages</code></dt>
<dd>
<p>Recupera un elenco di messaggi.</p>
</dd>
<dt><code translate="no">POST endpoint /api/messages</code></dt>
<dd>
<p>Crea un nuovo messaggio.</p>
</dd>
<dt><code translate="no">GET endpoint /api/messages/\{id}</code></dt>
<dd>
<p>Recupera un messaggio specifico per ID.</p>
</dd>
<dt><code translate="no">PUT endpoint /api/messages/\{id}</code></dt>
<dd>
<p>Aggiorna un messaggio specifico per ID.</p>
</dd>
<dt><code translate="no">PATCH endpoint /api/messages/\{id}</code></dt>
<dd>
<p>Esegue un aggiornamento parziale su un messaggio specifico per ID.</p>
</dd>
<dt><code translate="no">DELETE endpoint /api/messages/\{id}</code></dt>
<dd>
<p>Elimina un messaggio specifico per ID.</p>
</dd>
</dl>
<p>La maggior parte delle API esterne sul web si basa sul modello architettonico REST grazie alla sua scalabilità, semplicità e natura stateless (cioè le risposte a ogni richiesta possono essere indipendenti da un'altra).</p>
</div></aside>
<p>Se stai realizzando un'applicazione di chat, potresti aver bisogno di una comunicazione client-server in tempo reale o di connessioni di lunga durata in cui i dati vengono trasmessi in una direzione. Gli endpoint WebSocket (WS) e gli eventi inviati dal server (SSE) possono aiutarti a trasmettere gli output del modello generativo ai client, come vedrai nel <a data-type="xref" href="ch06.html#ch06">Capitolo 6</a> sulla comunicazione in tempo reale con i servizi AI.</p>
<p><a data-primary="GraphQL, exposing endpoints with" data-type="indexterm" id="id560"/>In altri casi, potresti voler utilizzare <a href="https://oreil.ly/SL62a">GraphQL in FastAPI</a> per esporre endpoint che possano restituire schemi dinamici in base alla richiesta. FastAPI può utilizzare il <a href="https://oreil.ly/wIzvi">pacchetto<code translate="no">strawberry</code> </a><sup><a data-type="noteref" href="ch02.html#id561" id="id561-marker" translate="no">6</a></sup> per sfruttare GraphQL nell'utilizzo di schemi dinamici per il tuo servizio API in modo che i clienti possano selezionare i campi che desiderano da una risorsa per evitare di recuperare eccessivamente i dati dal tuo servizio. Tuttavia, in questo libro non tratteremo l'utilizzo di GraphQL.<a data-startref="ix_ch02-asciidoc18" data-type="indexterm" id="id562"/><a data-startref="ix_ch02-asciidoc17" data-type="indexterm" id="id563"/></p>
</div></section>
<section data-pdf-bookmark="Modern Python and IDE Integration with Sensible Defaults" data-type="sect2"><div class="sect2" id="id26">
<h2>Integrazione moderna di Python e IDE con impostazioni predefinite ragionevoli</h2>
<p><a data-primary="FastAPI (basics)" data-secondary="modern Python/IDE integration with sensible defaults" data-type="indexterm" id="id564"/><a data-primary="Python" data-secondary="modern Python/IDE integration with sensible defaults" data-type="indexterm" id="id565"/>Poiché lo stack tecnologico di FastAPI è costruito su Python moderno (ad esempio, con annotazioni di tipo e doc-strings), tutti i linters e i formattatori IDE possono controllare e formattare in modo nativo la tua base di codice. Le impostazioni predefinite sono sufficienti anche per iniziare a importare e istanziare la classe FastAPI. Dato che tutto si lega perfettamente alle moderne funzionalità di IDE e Python, chiunque può facilmente iniziare a costruire, testare, eseguire il debug e distribuire i propri servizi FastAPI.<a data-startref="ix_ch02-asciidoc6" data-type="indexterm" id="id566"/></p>
</div></section>
</div></section>
<section data-pdf-bookmark="FastAPI Project Structures" data-type="sect1"><div class="sect1" id="id240">
<h1>Strutture del progetto FastAPI</h1>
<p><a data-primary="FastAPI (basics)" data-secondary="project structures" data-type="indexterm" id="ix_ch02-asciidoc19"/>Spesso, quando lavori a un progetto reale, ti ritroverai a costruire servizi che abbracciano più moduli, pacchetti e directory annidate. La decisione su come strutturare il tuo progetto dipende totalmente da te.</p>
<p class="less_space pagebreak-before">È qui che la maggior parte delle persone si trova in difficoltà e si ritrova con una base di codice troppo complessa da gestire. Finisci per sentirti frustrato, dovendo capire la base di codice e la struttura del progetto prima di potervi contribuire. A un certo punto, la complessità crescerà così tanto che avrai paura di toccare di nuovo il progetto.</p>
<p>Alcuni file finiranno per essere troppo grandi per essere letti con funzioni gonfiate, oppure ci saranno troppi file sparsi dappertutto. Potresti anche ritrovarti con milioni di errori di importazione o dipendenze circolari che distruggono la tua applicazione.</p>
<p>Imparare a strutturare applicazioni più grandi sarà ancora più importante quando si lavora con modelli di intelligenza artificiale generativa. Questi modelli hanno spesso bisogno di dipendenze e funzioni di utilità aggiuntive per essere supportati. Pertanto, dovrai aggiungere un livello di complessità per i tuoi modelli in aggiunta ai livelli di applicazioni esistenti.</p>
<div data-type="tip"><h6>Suggerimento</h6>
<p>Rispetto ai framework opinionati come Django, devi seguire delle buone pratiche per avere successo con progetti più grandi in framework non opinionati come FastAPI.</p>
</div>
<p>Negli ultimi anni, lavorando con FastAPI e applicazioni di scienza dei dati, ho visto molti sviluppatori creare modelli personalizzati per l'avvio di progetti FastAPI. Alcuni consigliano addirittura di seguire una struttura resa popolare dal progetto Netflix Dispatch FastAPI per le applicazioni API più grandi, che ha ispirato altri modelli.</p>
<p>Quando si tratta di costruire applicazioni reali, devi fare tutto il possibile per mantenere la base di codice il più strutturata possibile, a tuo vantaggio, per aiutare te e gli altri membri del tuo team a comprendere il codice in futuro.</p>
<p>Sai di avere una buona struttura di progetto se riesci a trovare qualsiasi funzione o componente all'interno della tua base di codice. Se inizi a dubitare dello scopo di una directory o a passare ore a cercare un pezzo di codice, allora la struttura del tuo progetto potrebbe essere poco chiara e troppo complessa da capire.</p>
<p>In questi casi, puoi fare riferimento ad alcune strutture di progetto comuni che sono diventate recentemente popolari nella comunità FastAPI. Ci sono diverse strutture di progetto che puoi adottare: piatta, annidata e modulare.</p>
<p>Diamo un'occhiata dettagliata a ciascuno di essi.</p>
<section data-pdf-bookmark="Flat Structure" data-type="sect2"><div class="sect2" id="id27">
<h2>Struttura piatta</h2>
<p><a data-primary="FastAPI (basics)" data-secondary="project structures" data-tertiary="flat structure" data-type="indexterm" id="id567"/><a data-primary="flat project structure" data-type="indexterm" id="id568"/>Una struttura piatta è quella in cui i file dell'applicazione rimangono alla radice del progetto senza directory annidate. Puoi raggruppare tutti i tuoi file in un'unica directory per una migliore organizzazione.</p>
<p>L'idea principale è quella di mantenere tutto il codice simile in moduli e di metterlo insieme vicino alla radice del progetto. Ad esempio, metti tutti i modelli di database in <em>models.py</em> o gli endpoint in <em>routes.py</em>.</p>
<p>La struttura di progetto più comune è quella piatta, grazie alla sua semplicità e facilità d'uso. Questa struttura è spesso ideale per costruire la prima versione di un servizio o un piccolo microservizio. L <a data-type="xref" href="#flat_structure">'esempio 2-6</a> mostra come potrebbe essere la struttura.</p>
<div data-type="example" id="flat_structure">
<h5><span class="label">Esempio 2-6. </span>Struttura piatta di un progetto FastAPI</h5>
<pre data-code-language="text" data-type="programlisting" translate="no">flat-project
├── app
│   ├── services.py
│   ├── database.py
│   ├── models.py
│   ├── routers.py
│   └── main.py
├── requirements.txt
├── .env
├── .gitignore</pre></div>
<p>Nella struttura mostrata nell'<a data-type="xref" href="#flat_structure">Esempio 2-6</a> puoi notare che ci sono pochi file che contengono il nucleo della logica dell'applicazione. Se stai costruendo un microservizio con<span class="keep-together">FastAPI,</span> per definizione vorrai mantenere una struttura piatta per semplicità.</p>
<p>La semplicità della struttura piatta ti permette di concentrarti sullo sviluppo piuttosto che sulla struttura. Ci sono pochi file di cui preoccuparsi. Non devi nemmeno preoccuparti dell'accoppiamento, della decomposizione o del riutilizzo perché ci sono poche righe di codice da gestire.</p>
<p>D'altra parte, la struttura piatta sarà difficile da mantenere man mano che il tuo progetto cresce in complessità. A questo punto, ha senso suddividere i moduli globali di Python in pacchetti a sé stanti utilizzando la struttura annidata.</p>
</div></section>
<section data-pdf-bookmark="Nested Structure" data-type="sect2"><div class="sect2" id="id28">
<h2>Struttura annidata</h2>
<p><a data-primary="FastAPI (basics)" data-secondary="project structures" data-tertiary="nested structure" data-type="indexterm" id="id569"/><a data-primary="nested project structure" data-type="indexterm" id="id570"/>La struttura annidata raggruppa moduli simili in pacchetti, creando di fatto una struttura annidata e una gerarchia di moduli. Sotto un pacchetto si raggruppano tutti i moduli che hanno una natura simile, indipendentemente dalla funzione che supportano. Si tratta di moduli liberamente accoppiati che contengono una logica simile per diverse entità del tuo progetto. Per esempio, il pacchetto <code translate="no">models</code> può contenere i modelli di database <code translate="no">users</code> e <code translate="no">profiles</code>.</p>
<p>La struttura annidata è consigliata per i progetti più grandi dalla<span class="keep-together">documentazione</span> ufficiale di FastAPI<span class="keep-together">.</span></p>
<p class="less_space pagebreak-before">Puoi vedere un progetto con struttura annidata nell'<a data-type="xref" href="#nested_structure">Esempio 2-7</a>.</p>
<div data-type="example" id="nested_structure">
<h5><span class="label">Esempio 2-7. </span>Progetto FastAPI annidato</h5>
<pre data-code-language="text" data-type="programlisting" translate="no">nested-project
├── app
│    ├── main.py
│    ├── dependencies.py
│    └── services
│    │   ├── users.py
│    │   └── profiles.py
│    └── models
│    │   ├── users.py
│    │   └── profiles.py
│    └── routers
│        ├── users.py
│        └── profiles.py
├── requirements.txt
├── .env
├── .gitignore</pre></div>
<p>Quando aggiungi al tuo progetto modelli di intelligenza artificiale e diversi servizi e database esterni, puoi adottare una struttura annidata per gestire la crescente complessità.</p>
<p>L'insidia principale di questa struttura di progetto è l'accoppiamento ambiguo dei moduli: le modifiche di un modulo possono essere trasmesse a cascata ad altri moduli e può diventare difficile capire l'effetto a cascata delle nuove modifiche.<a data-primary="shotgun updates" data-type="indexterm" id="id571"/>Nel corso del tempo, può essere difficile mantenere e modificare il codice senza eseguire molti aggiornamenti in altri luoghi. Questo fenomeno viene definito " <em>aggiornamenti a cascata"</em>. Gli aggiornamenti a cascata, nel contesto dello sviluppo del software, sono quando è difficile mantenere e modificare il codice senza eseguire molti aggiornamenti in altri luoghi.</p>
<p>Se pensi di avere difficoltà a gestire l'accoppiamento dei moduli o ti aspetti di avere a che fare con un'applicazione di grandi dimensioni, ti consiglio di utilizzare una struttura modulare.</p>
</div></section>
<section data-pdf-bookmark="Modular Structure" data-type="sect2"><div class="sect2" id="id29">
<h2>Struttura modulare</h2>
<p><a data-primary="FastAPI (basics)" data-secondary="project structures" data-tertiary="modular structure" data-type="indexterm" id="ix_ch02-asciidoc20"/><a data-primary="modular project structure" data-type="indexterm" id="ix_ch02-asciidoc21"/>La struttura modulare, resa popolare dal progetto Netflix Dispatch FastAPI, è simile alla struttura annidata perché puoi inserire più moduli all'interno di un pacchetto e di sottopacchetti. Tuttavia, la differenza fondamentale sta nel modo in cui organizzi il progetto.</p>
<p>Nella struttura modulare, i moduli strettamente correlati e che si riferiscono a un dominio specifico sono raggruppati insieme. Questo approccio differisce dalla struttura annidata precedentemente menzionata. Un esempio potrebbe essere il pacchetto <code translate="no">users</code> che contiene schemi utente, servizi di database, dipendenze e router.</p>
<p class="less_space pagebreak-before">Per capire meglio questa differenza, guarda l'<a data-type="xref" href="#modular_structure">Esempio 2-8</a>.</p>
<div data-type="example" id="modular_structure">
<h5><span class="label">Esempio 2-8. </span>Struttura del progetto modulare FastAPI</h5>
<pre data-code-language="text" data-type="programlisting" translate="no">modular-project
├── app
│   └── modules
│   │   ├── auth
│   │   │   ├── routers.py
│   │   │   ├── models.py
│   │   │   ├── dependencies.py
│   │   │   ├── guards.py
│   │   │   ├── services.py
│   │   └── users
│   │   │   ├── router.py
│   │   │   ├── models.py
│   │   │   ├── dependencies.py
│   │   │   ├── services.py
│   │   │   ├── mappers.py
│   │   │   ├── pipes.py
│   │   └── profiles
│   └── routers
│   │   └── users.py
│   └── providers
│   │   └── email.py
│   │   └── stripe.py
............
│   ├── settings.py  # global configs
│   ├── middlewares.py  # global middleware
│   ├── models.py  # global models
│   ├── exceptions.py  # global exceptions
│   └── main.py
├── requirements.txt
├── .env
├── .gitignore</pre></div>
<p>In una struttura di progetto modulare come quella mostrata nell'<a data-type="xref" href="#modular_structure">Esempio 2-8</a>, riunisci componenti strettamente interconnessi tra loro in base a una funzione o a un sistema globale che implementano (ad esempio, l'autenticazione, l'elaborazione dei pagamenti, le notifiche, ecc.) o alla risorsa con cui interagiscono (ad esempio, utenti, profili, messaggi, ecc.). Questo tipo di incapsulamento elimina qualsiasi incertezza sugli accoppiamenti nel codice, migliorando la scalabilità e la manutenibilità.</p>
<p>Se hai bisogno di includere altre funzionalità, puoi creare un nuovo pacchetto che contenga tutto il codice necessario. Allo stesso modo, se hai bisogno di modificare o eliminare del codice, puoi facilmente determinare dove devono essere apportate le modifiche e prevedere l'impatto che avranno sulle altre parti del codice. Questo è possibile perché la struttura della base di codice è trasparente e ben incapsulata, rendendo chiaro dove sono collegati i diversi componenti.<a data-startref="ix_ch02-asciidoc21" data-type="indexterm" id="id572"/><a data-startref="ix_ch02-asciidoc20" data-type="indexterm" id="id573"/></p>
</div></section>
<section data-pdf-bookmark="Progressive Reorganization of Your FastAPI Project" data-type="sect2"><div class="sect2" id="id30">
<h2>Riorganizzazione progressiva del tuo progetto FastAPI</h2>
<p><a data-primary="FastAPI (basics)" data-secondary="project structures" data-tertiary="progressive reorganization of project" data-type="indexterm" id="ix_ch02-asciidoc22"/>Una base di codice modulare ti permette di aggiungere e rimuovere componenti con facilità. Puoi anche riutilizzare i componenti in diverse parti del sistema per evitare ripetizioni.</p>
<p>Quando inizi il tuo progetto, la modularità non è così importante: puoi iniziare con uno o pochi file Python per costruire facilmente i tuoi servizi. Tuttavia, non appena introdurrai modelli di intelligenza artificiale, servizi esterni e una logica aziendale complessa, dovrai prendere in considerazione la possibilità di modulare la tua base di codice.</p>
<p>Puoi ottenere la modularità progettando i componenti del tuo sistema tenendo conto della riutilizzabilità e della smaltibilità. Assicurati che il design dei tuoi moduli e delle tue funzioni consenta l'utilizzo in ambienti diversi e che li collochi al posto giusto nella directory del tuo progetto. La scelta della migliore struttura di progetto è una questione di preferenze. Tuttavia, potresti chiederti: "Quale struttura di progetto dovrei adottare per costruire servizi di IA generativa con FastAPI?".</p>
<p>Ho scoperto che il modo migliore per strutturare i progetti è quello di <em>riorganizzarli progressivamente</em>, passando da una struttura piatta a una struttura modulare man mano che la complessità del servizio cresce:</p>
<dl>
<dt>1. Piatto</dt>
<dd><p> Se stai iniziando un nuovo progetto e la complessità del tuo sistema non è ancora chiara, puoi concentrarti sulla scrittura di tutto il codice FastAPI in un unico file prima di preoccuparti della struttura del progetto. Estrai quindi il codice in diversi file sotto la directory principale. Questa è la struttura iniziale che adotterai quando sperimenterai la prima versione del tuo servizio da zero.</p></dd>
<dt>2. Annidato</dt>
<dd>
<p> Man mano che il numero di file nella tua base di codice e la complessità del servizio aumentano, puoi adottare la struttura annidata. Puoi cercare i file in base ai raggruppamenti logici (modelli, router, schemi, ecc.) e non devi preoccuparti troppo degli accoppiamenti logici nel codice. Quando apporti delle modifiche, solo una manciata di file viene influenzata. A questo punto, hai un microservizio AI.</p>
</dd>
<dt>3. Modulare</dt>
<dd>
<p> Quando passi da un microservizio a un servizio backend completo, vorrai adottare una struttura modulare. Ora c'è un numero crescente di moduli, funzionalità e complessità. Inizierai a raggruppare il codice in pacchetti basati su <em>aree di interesse</em>. Il tuo codice ora gestisce le richieste, l'autenticazione, i sistemi esterni e così via, mentre serve un modello AI.</p></dd>
</dl>
<p>Ti suggerisco di ristrutturare il tuo progetto come indicato. Tuttavia, hai la flessibilità di adottare qualsiasi schema organizzativo che abbia senso per te e che ti permetta di ricordare la posizione e lo scopo dei tuoi file.</p>
<div data-type="tip"><h6>Suggerimento</h6>
<p>Ricorda, se non riesci a giustificare l'organizzazione dei file nella tua base di codice a un altro sviluppatore, è il momento di riconsiderare la struttura esistente.</p>
</div>
<p>Man mano che costruisci il tuo servizio GenAI, ti ritroverai inevitabilmente con una grande base di codice e un'applicazione complessa.</p>
<p>Pensare alla struttura della tua applicazione FastAPI di grandi dimensioni è solo il primo passo per la creazione di servizi di livello produttivo. Nel prossimo passo imparerai a conoscere un modello di progettazione software che ti aiuterà a gestire la complessità dei tuoi servizi di intelligenza artificiale. Si tratta del modello di progettazione delle applicazioni <em>a cipolla</em>, o a <em>strati</em>, di cui parleremo nel prossimo articolo<a data-startref="ix_ch02-asciidoc22" data-type="indexterm" id="id574"/>.<a data-startref="ix_ch02-asciidoc19" data-type="indexterm" id="id575"/></p>
</div></section>
</div></section>
<section data-pdf-bookmark="Onion/Layered Application Design Pattern" data-type="sect1"><div class="sect1" id="id31">
<h1>Pattern di progettazione dell'applicazione Onion/Layered</h1>
<p><a data-primary="FastAPI (basics)" data-secondary="onion (layered) application design pattern" data-type="indexterm" id="ix_ch02-asciidoc23"/><a data-primary="layered (onion) application design pattern" data-type="indexterm" id="ix_ch02-asciidoc24"/><a data-primary="onion (layered) application design pattern" data-type="indexterm" id="ix_ch02-asciidoc25"/>Se hai intenzione di costruire un servizio backend completo per l'IA generativa, ti sarà utile conoscere meglio il modello di progettazione delle applicazioni a cipolla, o a strati, che può essere implementato all'interno di strutture di progetto nidificate e modulari. Lo scopo di questo modello è quello di creare una separazione delle preoccupazioni tra le diverse parti della tua applicazione per semplificare il processo di aggiunta, rimozione e modifica delle funzionalità.</p>
<p>Il design pattern a cipolla ha influenzato anche i framework web in altri linguaggi, come <a href="https://nestjs.com">Nest.js</a>.</p>
<p>Il design a cipolla consiste in strati, ognuno con una responsabilità specifica e una direzione di dipendenza, come mostrato nella <a data-type="xref" href="#onion_design_pattern">Figura 2-3</a>. Lo strato più interno contiene i modelli di dominio e la logica aziendale, mentre gli strati esterni contengono la gestione delle rotte (in un servizio API) o il codice di interfacciamento con l'utente (quando si servono modelli HTML).</p>
<p>Il modello è chiamato "a cipolla" perché gli strati si costruiscono l'uno sull'altro, con il modello di dominio al centro, circondato da strati di crescente astrazione che promuovono la testabilità, la manutenibilità e la flessibilità nella manutenzione dei servizi di intelligenza artificiale. Il nucleo dell'applicazione (modello di dominio e logica aziendale) si trova negli strati interni e tutti gli altri strati dipendono da esso. Questo approccio aiuta a gestire le dipendenze, a promuovere la separazione delle preoccupazioni e a facilitare una<span class="keep-together">base di codice</span> più testabile e manutenibile.</p>
<figure><div class="figure" id="onion_design_pattern">
<img alt="bgai 0203" src="assets/bgai_0203.png" width="1410" height="821"/>
<h6><span class="label">Figura 2-3. </span>Modello di progettazione a cipolla</h6>
</div></figure>
<p><a data-primary="dependency inversion principle" data-type="indexterm" id="id576"/>L'idea principale di questo pattern è il <em>principio</em> dell'<em>inversione delle dipendenze</em>, secondo il quale i moduli di alto livello non dovrebbero dipendere direttamente dall'implementazione dei moduli di basso livello, ma dichiarare ciò di cui hanno bisogno dai moduli di basso livello sfruttando il sistema di dipendenze FastAPI. Il sistema di dipendenze può quindi iniettare l'output dei moduli di basso livello per evitare l'accoppiamento tra i livelli.</p>
<p>Per implementare questo progetto software, devi scomporre il tuo servizio come una cipolla composta da strati sempre più profondi. Ogni strato (passando da quelli esterni a quelli interni) introduce componenti responsabili di una serie di compiti:</p>
<dl>
<dt>Router API</dt>
<dd>
<p><a data-primary="API routers" data-type="indexterm" id="id577"/>I router sono responsabili del raggruppamento di più controller/gestori di percorso per applicare una logica comune a più controller.</p>
<p>FastAPI mette a disposizione la classe <code translate="no">APIRouter</code> per aiutarti in questo senso.</p>
</dd>
<dt>Controllori/gestori di percorso</dt>
<dd>
<p><a data-primary="controllers" data-type="indexterm" id="id578"/>I controller sono responsabili della gestione delle <em>richieste</em> in entrata e della restituzione delle <em>risposte</em>al cliente attraverso un'esecuzione logica di servizi o provider.</p>
<p>Un buon progetto di controllore utilizza sempre le dipendenze per iniettare i dati o la logica necessari alla sua esecuzione. Vedi <a data-type="xref" href="#api_routers_controllers">Figura 2-4</a>.</p>
<figure><div class="figure" id="api_routers_controllers">
<img alt="bgai 0204" src="assets/bgai_0204.png" width="1006" height="438"/>
<h6><span class="label">Figura 2-4. </span>Router e controller API</h6>
</div></figure>
</dd>
<dt>Servizi/fornitori</dt>
<dd>
<p>I servizi sono responsabili della combinazione o dell'orchestrazione di più operazioni interne per implementare una logica aziendale (servizi), mentre i provider implementano l'interfaccia con i sistemi esterni.</p>
<p>I servizi in genere utilizzano repository per l'accesso ai dati per implementare una logica aziendale complessa piuttosto che semplici operazioni di recupero e mutazione dei dati. Ogni modulo della tua applicazione può avere il proprio servizio.</p>
<p>I provider sono simili ai servizi ma sono specializzati nell'interazione con sistemi esterni come le API interne o di terze parti. Esempi di provider sono i client per i server di posta elettronica, i gateway di pagamento o altri microservizi.</p>
<p>In sostanza, sia i provider che i servizi supportano l'implementazione della logica aziendale del controller facilitando le interazioni interne ed esterne.</p>
<p>Ecco un esempio di come lavorano insieme all'interno di un route controller: il servizio di database <code translate="no">users</code> recupera il record di un utente via e-mail e poi utilizza queste informazioni con un gateway di pagamento e con i client del server e-mail (provider) per elaborare i pagamenti e inviare le e-mail di conferma.</p>
</dd>
<dt>Repository (adattatori di dati)</dt>
<dd>
<p><a data-primary="repository design pattern" data-type="indexterm" id="id579"/>Un repository è un modello di progettazione utilizzato per implementare la logica di accesso ai dati e le operazioni di mutazione con le fonti di dati (da non confondere con un<span class="keep-together">repository</span> Git<span class="keep-together">).</span></p>
<p>I repository utilizzano la mappatura relazionale degli oggetti (ORM) o comandi SQL grezzi per eseguire query sulla tua infrastruttura come un database o un archivio di memoria per recuperare o modificare i dati.</p>
<p>Puoi implementare un'interfaccia astratta in questo livello per imporre una progettazione coerente in tutti i tuoi repository, utilizzando le operazioni di creazione, lettura, aggiornamento e cancellazione (CRUD). Vedi <a data-type="xref" href="#services_providers_repositories">Figura 2-5</a>.</p>
<figure><div class="figure" id="services_providers_repositories">
<img alt="bgai 0205" src="assets/bgai_0205.png" width="1237" height="361"/>
<h6><span class="label">Figura 2-5. </span>Servizi, provider e repository</h6>
</div></figure>
</dd>
<dt>Schemi/modelli</dt>
<dd>
<p>Questi sono responsabili dell'applicazione della sicurezza dei tipi, della struttura e della logica di convalida dei dati che scorrono nel servizio.</p>
</dd>
</dl>
<p>Avrai anche componenti che si estendono su più livelli per supportare l'intera applicazione:</p>
<dl>
<dt>Middleware</dt>
<dd>
<p>Questo gestisce le richieste e le risposte prima e dopo il loro passaggio ai controllori dell'applicazione/gestori delle rotte (vedi <a data-type="xref" href="#middlewares">Figura 2-6</a>).</p>
<figure><div class="figure" id="middlewares">
<img alt="bgai 0206" src="assets/bgai_0206.png" width="1138" height="180"/>
<h6><span class="label">Figura 2-6. </span>Middleware</h6>
</div></figure>
</dd>
<dt>Dipendenze</dt>
<dd>
<p>Si tratta di funzioni riutilizzabili definite dall'utente che possono essere iniettate nei controllori per supportare la logica aziendale. Le dipendenze possono essere memorizzate nella cache e dipendere da altre dipendenze.</p>
</dd>
<dt>Tubi</dt>
<dd>
<p>Si tratta di funzioni di trasformazione dei dati che puoi utilizzare tra i vari livelli dell'applicazione, come ad esempio gli aggregatori di dati, i pulitori, i parser, i traduttori e così via.</p>
</dd>
</dl>
<dl class="less_space pagebreak-before">
<dt>Mappatori</dt>
<dd>
<p>Si tratta di mappatori di dati da uno schema a un altro, che spesso passano i dati tra i vari livelli, come ad esempio dallo schema <code translate="no">UserRequest</code> in un livello router allo schema <code translate="no">UserInDB</code> nel livello di accesso ai dati. Vedi <a data-type="xref" href="#models_pipes_mappers">Figura 2-7</a>.</p>
<figure><div class="figure" id="models_pipes_mappers">
<img alt="bgai 0207" src="assets/bgai_0207.png" width="1377" height="334"/>
<h6><span class="label">Figura 2-7. </span>Modelli, tubi e mappatori</h6>
</div></figure>
</dd>
<dt>Filtri di eccezione</dt>
<dd>
<p>Questi gestiscono le eccezioni in modo coerente su tutti i livelli.</p>
</dd>
<dt>Guardie</dt>
<dd>
<p><a data-primary="guards" data-type="indexterm" id="id580"/>Questi proteggono i controllori da eventuali abusi. La logica di autenticazione e autorizzazione può essere implementata come dipendenza o middleware per fungere da protezione (vedi <a data-type="xref" href="#guards">Figura 2-8</a>).</p>
<figure><div class="figure" id="guards">
<img alt="bgai 0208" src="assets/bgai_0208.png" width="1125" height="163"/>
<h6><span class="label">Figura 2-8. </span>Protezioni</h6>
</div></figure>
</dd>
</dl>
<p>Se fai riferimento alla struttura modulare del progetto mostrata nell'<a data-type="xref" href="#modular_structure">Esempio 2-8</a>, noterai vari elementi del modello di progettazione a cipolla nella struttura modulare del progetto. Seguire questo modello può aiutarti a creare un servizio di AI generativa<span class="keep-together">FastAPI</span> manutenibile, testabile e scalabile.</p>
<p>Nei prossimi capitoli, utilizzerai questi schemi per costruire il servizio GenAI mostrato nella <a data-type="xref" href="#genai_service">figura 2-9</a>.</p>
<figure><div class="figure" id="genai_service">
<img alt="bgai 0209" src="assets/bgai_0209.png" width="1444" height="884"/>
<h6><span class="label">Figura 2-9. </span>Servizio di intelligenza artificiale generativa che costruirai con FastAPI</h6>
</div></figure>
<p>Successivamente, confronteremo FastAPI con altri framework.<a data-startref="ix_ch02-asciidoc25" data-type="indexterm" id="id581"/><a data-startref="ix_ch02-asciidoc24" data-type="indexterm" id="id582"/><a data-startref="ix_ch02-asciidoc23" data-type="indexterm" id="id583"/></p>
</div></section>
<section data-pdf-bookmark="Comparing FastAPI to Other Python Web Frameworks" data-type="sect1"><div class="sect1" id="id32">
<h1>Confronto tra FastAPI e altri framework web di Python</h1>
<p><a data-primary="FastAPI (basics)" data-secondary="comparison to other Python web frameworks" data-type="indexterm" id="ix_ch02-asciidoc26"/><a data-primary="Python web frameworks" data-type="indexterm" id="ix_ch02-asciidoc27"/>La maggior parte dei framework web di Python offre strumenti per la creazione di endpoint REST, GraphQL, WebSocket e altri tipi di endpoint.</p>
<p>Questi framework sono di tipo "opinionistico", come Django (Python) e Nestjs (JavaScript), mentre altri non lo sono. Flask o FastAPI (Python) e Express (JavaScript) ti danno la possibilità di progettare il tuo servizio come preferisci.</p>
<p><a data-primary="Django" data-type="indexterm" id="ix_ch02-asciidoc28"/><a data-primary="opinionated frameworks" data-type="indexterm" id="ix_ch02-asciidoc29"/>I framework opinionati, come Django (Python) e Nestjs (JavaScript), prendono decisioni per te con determinate ipotesi su come fornirai i dati ai tuoi componenti. In effetti, forniscono una struttura ma limitano ciò che ti è permesso fare. I framework opinionati sono in genere più facili da usare.<a data-primary="nonopinionated frameworks" data-type="indexterm" id="id584"/>D'altra parte, i framework non opinionati come Flask o FastAPI (Python) e Express (JavaScript) sono più flessibili ma possono darti troppa libertà - molte possibilità per ottenere gli stessi risultati.</p>
<p class="fix_tracking">
Dato che i framework non opzionali come FastAPI ti offrono una grande libertà nella costruzione dei servizi, potresti sentire un po' di stanchezza nella scelta e nell'integrazione di ogni singolo pacchetto di supporto. Ad esempio, per lavorare con un database, dovrai installare e integrare diversi pacchetti che funzionano bene insieme: uno per accedere al database, uno per migrarlo e un altro per agire come un mappatore relazionale di oggetti (ORM).</p>
<p>Questo rende difficile lavorare con i framework non opzionali e spesso si decide di utilizzare un framework opzionale come Django, che viene fornito con un eccellente sistema ORM strettamente integrato per interagire con i database.</p>
<p>Django è un framework a batteria che si presenta come "il framework web di Python per gli sviluppatori con scadenze" e viene fornito con un sistema ORM completamente integrato e ricco di funzionalità che si occupa delle migrazioni dei database e dell'accesso ai dati quando sei tu a fornire i modelli di dati.</p>
<p>Inoltre, ti fornisce un pannello di amministrazione, un sistema di autenticazione e autorizzazione degli utenti basato su credenziali e diverse funzionalità di sicurezza web, che non dovrai costruire da solo.2, è stato introdotto anche il supporto per le richieste asincrone, consentendoti di inserire la concomitanza nei tuoi servizi. Django si aspetta che tu adotti l'architettura MVC, richiedendoti di definire modelli di dati e viste. Queste viste diventano percorsi che servono file HTML templati, risposte JSON o qualsiasi altra risposta HTTP, anche senza fare affidamento su <code translate="no">django-rest-framework</code>. I livelli di controller conterranno quindi l'elaborazione dei dati e la logica aziendale.</p>
<p><a data-primary="progressive web applications (PWAs)" data-type="indexterm" id="id585"/><a data-primary="PWAs (progressive web applications)" data-type="indexterm" id="id586"/>Questo rende Django un'ottima scelta per le <em>applicazioni web progressive</em> (PWA) monolite che si distribuiscono come un unico backend con un frontend. Tuttavia, man mano che le aziende si spostano verso la creazione di team specializzati nello sviluppo di backend e frontend, i modelli di architettura a microservizi stanno diventando sempre più popolari.
Con i microservizi, vuoi separare i servizi di backend da quelli di frontend, creare API invece di PWA e concentrarti sul mantenere i tuoi servizi il più snelli possibile. Utilizzando Django puoi anche costruire API, ma puoi ritrovarti con un'applicazione pesante che rallenta lo sviluppo, la distribuzione e la scalabilità dei servizi. Ecco perché i framework non open source come Flask stanno diventando sempre più popolari<a data-startref="ix_ch02-asciidoc29" data-type="indexterm" id="id587"/><a data-startref="ix_ch02-asciidoc28" data-type="indexterm" id="id588"/>.<sup><a data-type="noteref" href="ch02.html#id589" id="id589-marker" translate="no">7</a></sup></p>
<p><a data-primary="Flask" data-type="indexterm" id="ix_ch02-asciidoc30"/>Flask viene fornito con il minor numero di codice possibile per la creazione di server web. Rispetto a FastAPI, Flask non viene fornito con la convalida dei dati, l'auto-documentazione e un sistema di iniezione delle dipendenze. Le caratteristiche citate sono spesso necessarie per la creazione di qualsiasi servizio backend che diventi complesso o che richieda l'integrazione con database e servizi esterni.</p>
<div data-type="note" epub:type="note"><h6>Nota</h6>
<p>Un nuovo framework web chiamato Quart ha cercato di affrontare questo problema ed è un buon concorrente di FastAPI. Tuttavia, al momento in cui scriviamo, Quart è nuovo e, rispetto ad altri framework, non ha una grande comunità di utenti e risorse documentate che ti aiutino nel caso in cui tu sia bloccato su un problema.</p>
</div>
<p><a data-primary="Web Server Gateway Interface (WSGI)" data-type="indexterm" id="id590"/><a data-primary="WSGI (Web Server Gateway Interface)" data-type="indexterm" id="id591"/>Inoltre, Flask è stato rilasciato nel 2010 e implementa un protocollo di comunicazione chiamato <em>Web Server Gateway Interface</em> (WSGI) per il servizio web, il che significa che le richieste vengono elaborate in modo sincrono rispetto ad ASGI, che è di natura asincrona. Inoltre, Flask non è stato progettato per gestire un gran numero di connessioni simultanee (come farebbe un framework asincrono). Tuttavia, questo non limita il numero di richieste parallele che il server può gestire da solo. In produzione, puoi utilizzare diverse strategie (come processi worker o thread) per gestire più richieste simultaneamente. Inoltre, poiché Flask implementa WSGI, non supporta gli endpoint WebSocket, utilizzati per mantenere un canale di comunicazione persistente e bidirezionale tra un client e un server. Questo perché WSGI non supporta nativamente WebSocket. Tuttavia, puoi installare le estensioni di Flask per integrare il supporto WebSocket.</p>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="id592">
<h1>Interfaccia server gateway asincrono</h1>
<p><a data-primary="Asynchronous Server Gateway Interface (ASGI)" data-type="indexterm" id="id593"/>I framework basati su ASGI possono elaborare più richieste eseguendo operazioni asincrone concorrenti sul ciclo di eventi principale, consentendo di gestire un volume maggiore di richieste in scala.</p>
<p>Può anche utilizzare un pool di thread (cioè un pool di thread worker) per eseguire attività sincrone in contemporanea senza bloccare il thread principale del server. Una volta terminate le attività, questi thread restituiscono il controllo al thread principale del server web e condividono i loro risultati. Quando un thread solleva un errore, il server web raccoglie le informazioni dal thread worker e invia invece una risposta di errore al client.</p>
<p>I moderni framework web che implementano lo standard ASGI non solo sono più efficienti, ma offrono anche la retrocompatibilità con WSGI nel caso in cui sia necessario.</p>
</div></aside>
<p>Flask, basandosi su un server WSGI, elabora ogni richiesta in modo sincrono, mentre<span class="keep-together">FastAPI</span> utilizza un ciclo di eventi per i carichi di lavoro simultanei. Pertanto, FastAPI sarà molto più veloce con le attività pesanti di input/output (I/O), ad esempio quando si comunica con un'API esterna o un archivio dati, che bloccherebbero un intero processo worker in Flask.</p>
<p>In sostanza, ti consiglio Django e altri framework se vuoi costruire PWA monolite, e Flask o Quart per semplici API e framework in altri linguaggi se hai più esperienza con essi.</p>
<p>Tuttavia, se stai costruendo un servizio backend che richiede il supporto di modelli AI, la connessione a sistemi esterni e un certo livello di complessità della logica di business, ti consiglio di considerare FastAPI come il framework web da scegliere<a data-startref="ix_ch02-asciidoc30" data-type="indexterm" id="id594"/>.<a data-startref="ix_ch02-asciidoc27" data-type="indexterm" id="id595"/><a data-startref="ix_ch02-asciidoc26" data-type="indexterm" id="id596"/></p>
</div></section>
<section data-pdf-bookmark="FastAPI Limitations" data-type="sect1"><div class="sect1" id="fastapi_limitations">
<h1>Limitazioni di FastAPI</h1>
<p><a data-primary="FastAPI (basics)" data-secondary="limitations" data-type="indexterm" id="ix_ch02-asciidoc31"/>A fronte delle caratteristiche e dei vantaggi sopra citati, ci sono anche diversi svantaggi e compromessi che devi considerare se vuoi adottare FastAPI per il tuo progetto. Tenendo conto dei casi d'uso dell'intelligenza artificiale, FastAPI è carente in diverse aree.</p>
<section data-pdf-bookmark="Inefficient Model Memory Management" data-type="sect2"><div class="sect2" id="id33">
<h2>Gestione inefficiente della memoria del modello</h2>
<p><a data-primary="FastAPI (basics)" data-secondary="limitations" data-tertiary="inefficient model memory management" data-type="indexterm" id="id597"/><a data-primary="model memory" data-type="indexterm" id="id598"/>FastAPI fornisce meccanismi integrati per la condivisione della memoria del modello tra più istanze o processi dello stesso container. Questo significa che quando si scalano i web worker orizzontalmente, è necessario caricare un'intera nuova istanza del modello nella memoria del container. Questo crea un collo di bottiglia nella memoria e aumenta i costi operativi dei servizi GenAI ad alto traffico.</p>
</div></section>
<section data-pdf-bookmark="Limited Number of Threads" data-type="sect2"><div class="sect2" id="id242">
<h2>Numero limitato di fili</h2>
<p><a data-primary="FastAPI (basics)" data-secondary="limitations" data-tertiary="limited number of threads" data-type="indexterm" id="id599"/><a data-primary="thread pool" data-secondary="limitations" data-type="indexterm" id="id600"/>C'è un limite al numero di thread che FastAPI crea all'avvio dell'applicazione nel pool di thread interno.<sup><a data-type="noteref" href="ch02.html#id601" id="id601-marker" translate="no">8</a></sup></p>
<p>Questo significa che c'è anche un limite alla scalabilità di una singola istanza di<span class="keep-together">FastAPI,</span> soprattutto con i carichi di lavoro AI che prevedono operazioni di I/O e CPU/GPU intensive.<sup><a data-type="noteref" href="ch02.html#id602" id="id602-marker" translate="no">9</a></sup></p>
</div></section>
<section data-pdf-bookmark="Restricted to Global Interpreter Lock" data-type="sect2"><div class="sect2" id="id34">
<h2>Limitato al blocco dell'interprete globale</h2>
<p><a data-primary="FastAPI (basics)" data-secondary="limitations" data-tertiary="Global Interpreter Lock" data-type="indexterm" id="id603"/><a data-primary="Global Interpreter Lock (GIL)" data-type="indexterm" id="id604"/><a data-primary="multithreading" data-secondary="Global Interpreter Lock and" data-type="indexterm" id="id605"/><a data-primary="Python" data-secondary="Global Interpreter Lock (GIL)" data-tertiary="FastAPI limitations" data-type="indexterm" id="id606"/>In Python, il multithreading può produrre risultati poco intuitivi e spesso controproducenti a causa del <em>Global Interpreter Lock</em> (GIL).</p>
<p>FastAPI sfrutta il multithreading attraverso un pool di thread interno per gestire le richieste web simultanee che colpiscono un percorso sincrono. Tuttavia, anche con endpoint asincroni, le richieste di inferenza dell'intelligenza artificiale possono comunque bloccare il ciclo principale dell'evento, impedendo a tutte le altre richieste di essere elaborate nel thread principale del servizio web.</p>
<p class="less_space pagebreak-before">Questo perché i carichi di lavoro di inferenza dell'intelligenza artificiale sono ad alta intensità di CPU/GPU. Le operazioni non I/O, come servire un modello costoso o aggregare grandi quantità di dati su un worker, causeranno l'attesa di altri thread, poiché Python attualmente non utilizza più core per il threading.<sup><a data-type="noteref" href="ch02.html#id607" id="id607-marker" translate="no">10</a></sup>
Invece, come scoprirai nel <a data-type="xref" href="ch05.html#ch05">Capitolo 5</a>, per questo tipo di operazioni di calcolo costose dovrai utilizzare il multiprocessing o un pool di processi.</p>
</div></section>
<section data-pdf-bookmark="Lack of Support for Micro-Batch Processing Inference Requests" data-type="sect2"><div class="sect2" id="id271">
<h2>Mancanza di supporto per le richieste di inferenza per l'elaborazione dei micro-lotti</h2>
<p><a data-primary="FastAPI (basics)" data-secondary="limitations" data-tertiary="lack of support for micro-batch processing inference requests" data-type="indexterm" id="id608"/>I framework di deep learning supportano la vettorizzazione in modo che le inferenze possano essere raggruppate, calcolate in modo efficiente e parallelizzate. Sfortunatamente, le richieste di predizione non possono essere raggruppate in FastAPI e di conseguenza ogni operazione di inferenza del modello ad alta intensità di calcolo può bloccare altre richieste.</p>
<p>Per scalare i servizi, una soluzione è quella di servire separatamente i modelli più pesanti e utilizzare FastAPI per autenticare e gestire i dati in entrata e in uscita.</p>
</div></section>
<section data-pdf-bookmark="Cannot Efficiently Split AI Workloads Between CPU and GPU" data-type="sect2"><div class="sect2" id="id243">
<h2>Non è possibile suddividere in modo efficiente i carichi di lavoro dell'intelligenza artificiale tra CPU e GPU</h2>
<p><a data-primary="FastAPI (basics)" data-secondary="limitations" data-tertiary="inefficient splitting of AI workloads between CPU and GPU" data-type="indexterm" id="id609"/><a data-primary="GPUs" data-secondary="inefficient splitting by FastAPI of AI workloads between CPU and GPU" data-type="indexterm" id="id610"/>Mentre la CPU gestisce principalmente le operazioni di trasformazione e validazione delle richieste, la GPU può eseguire e parallelizzare l'inferenza dei modelli ad alta intensità di calcolo. In alcuni framework web specializzati in ML (come BentoML), è anche possibile suddividere in modo efficiente i carichi di lavoro dell'intelligenza artificiale tra CPU e GPU.</p>
<div data-type="note" epub:type="note"><h6>Nota</h6>
<p>Quando si suddividono i carichi di lavoro dell'intelligenza artificiale tra CPU e GPU, le operazioni di preparazione e post-elaborazione dei dati vengono eseguite dalla CPU, mentre l'inferenza di deep learning più veloce viene eseguita dalla GPU.</p>
</div>
<p>Purtroppo FastAPI non è in grado di eseguire in modo efficiente questa suddivisione del carico di lavoro dell'inferenza AI tra questi dispositivi. Ciò significa che la CPU può essere bloccata dall'elaborazione delle richieste anche quando i processi di inferenza sono in esecuzione sulla GPU. Poiché questo è un grosso collo di bottiglia quando si lavora con i modelli più pesanti, sarà necessario servire i modelli più pesanti al di fuori di FastAPI per i carichi di lavoro simultanei.</p>
<p>Discuteremo le soluzioni a questa limitazione in modo più approfondito nel <a data-type="xref" href="ch05.html#ch05">Capitolo 5</a>.</p>
</div></section>
<section class="less_space pagebreak-before" data-pdf-bookmark="Dependency Conflicts" data-type="sect2"><div class="sect2" id="id35">
<h2>Conflitti di dipendenza</h2>
<p><a data-primary="dependency conflicts, FastAPI limitations in handling" data-type="indexterm" id="id611"/><a data-primary="FastAPI (basics)" data-secondary="limitations" data-tertiary="dependency conflicts" data-type="indexterm" id="id612"/>Quando distribuisci modelli di ML, dovrai affrontare sfide uniche rispetto alla distribuzione di applicazioni web tipiche, a causa del profondo legame del runtime del modello con le librerie native e l'hardware. Ogni ambiente di distribuzione può operare su hardware diversi e può richiedere l'uso di versioni specifiche delle librerie native e dei comandi di containerizzazione.</p>
</div></section>
<section data-pdf-bookmark="Lack of Support for Resource-Intensive AI Workloads" data-type="sect2"><div class="sect2" id="id36">
<h2>Mancanza di supporto per carichi di lavoro AI ad alta intensità di risorse</h2>
<p><a data-primary="FastAPI (basics)" data-secondary="limitations" data-tertiary="lack of support for resource-intensive AI workloads" data-type="indexterm" id="id613"/>Nonostante le sue incredibili capacità, FastAPI è stato sviluppato prima dell'avvento dell'IA generativa. Di conseguenza, rimane un framework web generico con un supporto recente per il servizio di IA e i flussi di lavoro ML. Tuttavia, per alcuni casi d'uso, come il servizio di modelli complessi e ad alta intensità di risorse e con un miliardo di parametri, può valere la pena di esplorare altri framework come <em>BentoML</em>.</p>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="id614">
<h1>BentoML: Framework ispirato a FastAPI per l'<span class="keep-together">esecuzione di modelli di intelligenza artificiale ad alta intensità di risorse</span></h1>
<p><a data-primary="BentoML" data-type="indexterm" id="id615"/><a data-primary="Starlette, BentoML and" data-type="indexterm" id="id616"/>Anche BentoML si basa su Starlette ed è stato progettato tenendo conto dei modelli FastAPI, ma in modo specifico per l'apprendimento automatico. La sua architettura consente di scalare le richieste web separatamente dall'inferenza del modello, offrendo flessibilità nelle<span class="keep-together">distribuzioni di</span> calcolo.</p>
<p>Affronta le sfide del flusso di lavoro ML utilizzando i suoi Runner, la gestione delle dipendenze e i sistemi di versionamento dei modelli. Grazie al suo sistema di gestione delle dipendenze, è in grado di accelerare efficacemente le implementazioni generando automaticamente e in modo dichiarativo i file Docker, in modo da non dover eseguire il debug di complessi comandi Docker per installare e utilizzare le librerie CUDA per l'inferenza su GPU.</p>
<p>Più avanti nel libro, presenterò un'architettura FastAPI per flussi di lavoro AI ad alta intensità di risorse che utilizza BentoML come server AI sottostante. In questa architettura, le attività di model-serving saranno delegate a BentoML, mentre FastAPI gestirà per te la sicurezza, la cache e la logica aziendale.</p>
</div></aside>
<p>Nei capitoli seguenti imparerai a costruire il tuo servizio GenAI con<span class="keep-together">FastAPI.</span></p>
<p>Ma prima di andare avanti, configuriamo gli strumenti Python necessari come linters, formattatori e type checkers nel tuo ambiente di sviluppo per facilitare la manutenzione del tuo progetto FastAPI mentre ci lavoriamo insieme.<a data-startref="ix_ch02-asciidoc31" data-type="indexterm" id="id617"/></p>
</div></section>
</div></section>
<section class="less_space pagebreak-before" data-pdf-bookmark="Setting Up a Managed Python Environment and Tooling" data-type="sect1"><div class="sect1" id="id37">
<h1>Impostazione di un ambiente Python gestito e dei tool</h1>
<p><a data-primary="FastAPI (basics)" data-secondary="setting up a managed Python environment/tooling" data-type="indexterm" id="ix_ch02-asciidoc32"/><a data-primary="Python" data-secondary="setting up a managed Python environment/tooling" data-type="indexterm" id="ix_ch02-asciidoc33"/>Per mantenere un ambiente di sviluppo stabile e riproducibile, potresti voler gestire l'ambiente e le dipendenze di Python.</p>
<p>Consiglio:</p>
<ul>
<li>
<p>Utilizzare un file <em>requirements.txt</em> con <code translate="no">pip</code> per i progetti più semplici</p>
</li>
<li>
<p>Usare <a href="https://oreil.ly/Qxl7h">uv</a> o <a href="https://oreil.ly/Kfsc4">Conda</a> per i flussi di lavoro guidati da <code translate="no">pip</code></p>
</li>
<li>
<p>Utilizzare la <a href="https://oreil.ly/Rt04z">poesia</a> per progetti più complessi</p>
</li>
</ul>
<p>Oltre alla gestione delle dipendenze, Python dispone anche di diversi pacchetti di terze parti che ti permettono di lincare e formattare la tua base di codice prima di inviarla in produzione.<sup><a data-type="noteref" href="ch02.html#id618" id="id618-marker" translate="no">11</a></sup></p>
<p>Per gli sviluppatori Python professionisti è buona norma utilizzare questi strumenti per individuare i bug durante lo sviluppo e prima di aggiungere le modifiche al repository del codice. In effetti, ti consiglio di eseguire frequentemente dei controlli sul codice con questi strumenti per evitare la comparsa di bug nei tuoi servizi.</p>
<p>Ecco un elenco non esaustivo di pacchetti Python che ti consiglio di integrare in qualsiasi progetto che inizi:</p>
<dl>
<dt>Linters</dt>
<dd>
<p><a data-primary="linters" data-type="indexterm" id="id619"/>Questi strumenti analizzano il codice sorgente per segnalare errori di programmazione, errori stilistici e frammenti di codice inutilizzati:</p>
<ul>
<li>
<p><em>Autoflake</em>: Rimuove le importazioni e le variabili inutilizzate dal codice per migliorarne la leggibilità</p>
</li>
<li>
<p><em>Flake8</em>: Controlli contro le proposte di miglioramento di Python (PEP) e gli stili di codice</p>
</li>
</ul>
</dd>
<dt>Formattatori</dt>
<dd>
<p><a data-primary="formatters (Python packages)" data-type="indexterm" id="id620"/>Questi ti permettono di vedere meglio ciò che hai scritto:</p>
<ul>
<li>
<p><em>isort</em>: Ordina le importazioni nei moduli Python</p>
</li>
<li>
<p><em>Nero</em>: Formatta il codice Python per renderlo più leggibile</p>
</li>
<li>
<p><em>Ruff</em>: Il liner e il formattatore a base di Rust sono estremamente veloci e possono essere utilizzati<span class="keep-together">in</span> sostituzione di altri strumenti come <code translate="no">isort</code>, <code translate="no">black</code>, <code translate="no">flake8</code>, ed eventualmente <code translate="no">bandit</code><sup><a data-type="noteref" href="ch02.html#id621" id="id621-marker" translate="no">12</a></sup></p>
</li>
</ul>
</dd>
<dt>Logger</dt>
<dd>
<p><a data-primary="loggers/logging" data-secondary="Python packages" data-type="indexterm" id="id622"/>Utilizzato nelle parti di codice più complesse per il debug e il monitoraggio dell'<span class="keep-together">applicazione:</span></p>
<ul>
<li>
<p><em>Loguru</em>: Sostituisce il modulo logger integrato di Python</p>
</li>
</ul>
</dd>
<dt>Scanner</dt>
<dd>
<p><a data-primary="scanners (Python packages)" data-type="indexterm" id="id623"/>Se vuoi avere la certezza di non aver commesso per caso un codice o una password insicuri:</p>
<ul>
<li>
<p><em>Bandit</em>: Scansione delle vulnerabilità della tua base di codice Python con controllo dei problemi di sicurezza più comuni, come i segreti hard-coded.</p>
</li>
<li>
<p><em>Sicurezza</em>: Scanner delle vulnerabilità delle dipendenze di Python per rilevare pacchetti con vulnerabilità note o pacchetti dannosi</p>
</li>
</ul>
</dd>
<dt>Controllori di tipo</dt>
<dd>
<p><a data-primary="type checkers" data-type="indexterm" id="id624"/>Inoltre, è ottimo se vuoi essere sicuro che le modifiche apportate agli schemi non abbiano danneggiato la tua applicazione:</p>
<ul>
<li>
<p><em>Mypy</em>: Un potente controllore di tipo statico che può aiutare a individuare molti bug nel tuo codice</p>
</li>
<li>
<p><em>Pylance</em>: Un verificatore di tipo che viene fornito con l'estensione Python di Microsoft per VS Code.</p>
</li>
</ul>
</dd>
</dl>
<p>Nell'ambito del tuo ambiente di sviluppo, è utile utilizzare sistemi di controllo di versione come Git per tenere traccia delle modifiche alla base di codice, gestire le diverse versioni del tuo progetto e gestire i contributi di codice da parte di altri sviluppatori.</p>
<div data-type="tip"><h6>Suggerimento</h6>
<p>Quando usi Git, puoi anche aggiungere dei file <em>.gitignore</em> per aiutarti a gestire i file e le directory che vuoi escludere dal monitoraggio del controllo di versione.</p>
</div>
<p><a data-primary="plug-ins" data-type="indexterm" id="id625"/>Gli ambienti di sviluppo integrati (IDE) come VS Code o JetBrains Pycharm forniscono plug-in per l'esecuzione di questi strumenti mentre scrivi o salvi il tuo lavoro. Spesso richiedono una certa configurazione, ma una volta effettuata, la formattazione automatica e il linting saranno impostati e pronti prima di iniziare. In ogni caso, ti consiglio di avere uno script o dei ganci pre-commit che lintano, controllano e formattano il tuo codice prima di eseguire il commit sulla tua base di codice o di distribuirlo in produzione.</p>
<div data-type="tip"><h6>Suggerimento</h6>
<p>Ho preparato un <a href="https://oreil.ly/j8lF7">modello vuoto di FastAPI</a> che include integrazioni con strumenti comuni che puoi utilizzare come base per i tuoi progetti.</p>
</div>
<p>Si tratta di nozioni fondamentali della programmazione Python e dell'ingegneria del software, che diventeranno cruciali quando inizierai a lavorare con modelli di intelligenza artificiale in grado di produrre output probabilistici, nonché con servizi e database esterni che possono cambiare schema in qualsiasi momento. Mantenere un'applicazione di intelligenza artificiale che cambia schemi e prompt in continuazione senza i suddetti strumenti può diventare un vero e proprio mal di testa molto velocemente.<a data-startref="ix_ch02-asciidoc33" data-type="indexterm" id="id626"/><a data-startref="ix_ch02-asciidoc32" data-type="indexterm" id="id627"/></p>
</div></section>
<section data-pdf-bookmark="Summary" data-type="sect1"><div class="sect1" id="id38">
<h1>Riassunto</h1>
<p>In questo capitolo hai imparato a conoscere il framework FastAPI, comprese le sue capacità e i suoi svantaggi rispetto ad altri framework.</p>
<p>Hai anche imparato come impostare il tuo progetto FastAPI da zero, insieme a una serie di strumenti che puoi utilizzare per migliorare la tua esperienza di sviluppo.</p>
<p>In seguito, ti sono state presentate diverse strutture di progetto che puoi adottare quando costruisci il tuo servizio FastAPI. In questo contesto, hai imparato qualcosa in più sul modello di progettazione software a cipolla/stratificato, che ti aiuta a gestire la complessità del progetto.</p>
<p>Infine, abbiamo parlato degli strumenti che puoi utilizzare per gestire i tuoi ambienti Python e aiutarti a mantenere la tua base di codice FastAPI man mano che cresce di complessità.</p>
<p>Ora dovresti essere in grado di avviare i tuoi progetti FastAPI e di gestire la complessità del progetto nel corso del tempo.<a data-startref="ix_ch02-asciidoc0" data-type="indexterm" id="id628"/></p>
<p>Nel prossimo capitolo imparerai a implementare le tue funzionalità GenAI in FastAPI per generare testo, immagini, audio e video. Capirai il funzionamento interno di ogni modello e il ruolo del sistema di ciclo di vita di FastAPI nel servizio dei modelli, sfruttando al contempo le GPU NVIDIA per le attività di inferenza. Infine, ti verrà presentato il sistema di attività in background di FastAPI per scaricare le operazioni di inferenza di lunga durata.</p>
</div></section>
<div data-type="footnotes"><p data-type="footnote" id="id507"><sup><a href="ch02.html#id507-marker">1</a></sup> Gran parte della logica di convalida dei dati di Pydantic v2 è stata riscritta in Rust per migliorare notevolmente le prestazioni.</p><p data-type="footnote" id="id511"><sup><a href="ch02.html#id511-marker">2</a></sup> Il comando <code translate="no">fastapi dev</code> cerca nelle directory del tuo progetto un oggetto FastAPI <code translate="no">app</code>. Se hai problemi ad avviare il tuo server FastAPI, consulta la sua documentazione usando <code translate="no">fastapi dev --help</code>.</p><p data-type="footnote" id="id527"><sup><a href="ch02.html#id527-marker">3</a></sup> Per eseguire l'inferenza del modello</p><p data-type="footnote" id="id530"><sup><a href="ch02.html#id530-marker">4</a></sup> Provenienti dal quadro Starlette</p><p data-type="footnote" id="id554"><sup><a href="ch02.html#id554-marker">5</a></sup> I nuovi eventi di durata di FastAPI sostituiscono i deprecati eventi di avvio/spegnimento delle versioni precedenti.</p><p data-type="footnote" id="id561"><sup><a href="ch02.html#id561-marker">6</a></sup> Una dipendenza esterna</p><p data-type="footnote" id="id589"><sup><a href="ch02.html#id589-marker">7</a></sup> Come risulta chiaramente dal numero di download mensili</p><p data-type="footnote" id="id601"><sup><a href="ch02.html#id601-marker">8</a></sup> FastAPI si affida a <code translate="no">AnyIO</code> (una libreria di rete e di concorrenza asincrona) per gestire la concorrenza. <code translate="no">AnyIO</code> crea fino a 40 thread per impostazione predefinita su un pool di thread interno dinamico e rimuove quelli che non vengono utilizzati per un certo periodo.</p><p data-type="footnote" id="id602"><sup><a href="ch02.html#id602-marker">9</a></sup> A meno che non si eseguano le operazioni della GPU in un altro processo (tramite multiprocessing) e si attendano le operazioni</p><p data-type="footnote" id="id607"><sup><a href="ch02.html#id607-marker">10</a></sup> Tuttavia, secondo la <a href="https://oreil.ly/_bRzj">PEP 703</a>, GIL sarà presto reso opzionale in CPython.</p><p data-type="footnote" id="id618"><sup><a href="ch02.html#id618-marker">11</a></sup> Fai riferimento al <a href="https://oreil.ly/6YWRN">repository GitHub di Hypermodern</a> per gli esempi di strumenti.</p><p data-type="footnote" id="id621"><sup><a href="ch02.html#id621-marker">12</a></sup> Puoi usare <code translate="no">ruff</code> per controlli più rapidi nelle pipeline CI/CD, a meno che il tuo ambiente di sviluppo o la pipeline CI/CD non siano strettamente integrati con gli altri strumenti.</p></div></div></section></div></div></body></html>