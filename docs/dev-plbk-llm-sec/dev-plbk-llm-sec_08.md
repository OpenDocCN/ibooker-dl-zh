# 第八章。别让你的钱包空空如也

> 小心小额支出；一个小漏洞足以使一艘大船沉没。
> 
> 本杰明·富兰克林

本章将探讨拒绝服务（DoS）、拒绝钱包（DoW）和模型克隆攻击，分析这些攻击类型之间的相似性和差异性。尽管这些攻击带来的后果各不相同——从服务中断和财务损失到知识产权的未经授权复制——但这三种攻击向量都在应用程序中利用了类似的漏洞。通过对比分析这些威胁，你将了解如何采取防护措施来阻止此类攻击。

DoS 这个术语已经成为在线服务中断的同义词。DoS 攻击是一种有意使计算机系统、网络或应用程序对其预期用户不可用的行为，通常是通过向应用程序发送大量请求来实现的。历史上，这些攻击针对过各种在线服务，从金融机构到社交媒体平台，造成了重大的运营中断和经济损失。随着我们深入到高级计算和人工智能时代，DoS 攻击的影响已经扩展到更复杂的技术，包括 LLMs。

尽管大型语言模型（LLMs）并非对传统的网络安全威胁免疫，但它们的独特特性使得它们容易受到 DoS 攻击，并且此类攻击可能带来独特且严重的后果。如今，DoS 攻击不仅关乎服务可用性的中断；它们还扩展到利用这些模型固有的特性，导致资源耗尽、性能下降，甚至可能造成直接的财务损失。这种新的 DoS 攻击前沿不仅是一个技术挑战，而且是一个重大的商业关注点，因为它直接影响到利用 LLMs 的服务可靠性和经济可行性。

最近出现的针对 LLMs 的 DoW 攻击，这是一种高度危险的 DoS 变体，为 LLMs 的安全问题带来了额外的财务维度。这些攻击通过利用基于云的 AI 服务的按使用付费模式，专门针对组织的经济资源。在 DoW 攻击中，攻击者旨在通过生成过多的查询或操作，导致服务提供商承受不可持续的成本，从而造成财务压力，而不仅仅是服务中断。这一现象突显了 LLMs 部署中的一种独特漏洞，其中应用程序的财务完整性与其操作安全性一样至关重要。

本章还将讨论*模型克隆攻击*，在这种攻击中，攻击者通过向系统发送大量问题、记录答案，然后使用这些答案来训练自己的模型，旨在窃取你模型背后的知识产权。虽然这些攻击通常与拒绝服务攻击分类不同，但它们有根本的相似之处。特别是，模型克隆攻击依赖于对您的模型进行重复查询，就像 DoS 攻击一样。这种相似性意味着许多相同的防御技术都适用。

# DoS 攻击

DoS 攻击的影响非常广泛。它们可能导致在线服务出现重大停机，造成巨大的经济损失，尤其是对于严重依赖在线交易的企业。除了财务损害之外，如果 DoS 攻击频繁发生或服务提供商处理不当，它们还可能侵蚀对服务或品牌的信任。此外，DoS 攻击可能掩盖更邪恶的活动，如数据泄露或恶意软件注入，因为它们会分散 IT 人员的注意力。

在我们深入研究 LLM 特定方面之前，让我们先检查一般 DoS 攻击的类型、原因和缓解步骤。

为了更好地理解这个问题，让我们看看 DoS 攻击的三个主要类别。

## 基于流量的攻击

基于流量的攻击是最直接的 DoS 攻击类型。在基于流量的攻击中，目标被大量流量淹没，使用用户数据报协议（UDP）洪水、互联网控制消息协议（ICMP）洪水和其他伪造数据包洪水等策略。流量量本身消耗了目标网站或应用的带宽，使其对合法流量不可用。

虽然简单的基于流量的攻击会从单个来源向目标淹没大量流量，但*分布式拒绝服务*（DDoS）攻击通过利用多个被破坏的系统来发起协调攻击，放大了这种威胁。这些攻击利用一个感染设备网络，称为*僵尸网络*，从互联网的多个点生成流量洪水，从而压倒目标。

## 协议攻击

*协议攻击*针对网络连接的网络层或传输层。它们利用运行互联网的协议中的弱点。通过操纵这些协议中的缺陷，攻击者可以发送相对少量的流量，在目标上创建不成比例的大负载，从而有效地干扰其通信能力。例如包括*SYN 洪水*、*死亡之 ping*和*Smurf 攻击*：

SYN 洪水

这种攻击利用了 TCP 握手过程，这是客户端和服务器之间建立连接的初始协商。在 SYN 洪水攻击中，攻击者向目标服务器发送一系列快速的 SYN 请求（开始连接的信号），但故意不发送最终的确认，从而未能完成握手。

死亡 ping

这种攻击涉及向系统发送恶意 ping。在死亡 ping 场景中，攻击者发送的 ping 比 IP 协议允许的更大（65,535 字节）。较旧的系统通常无法处理这些 oversized 数据包，导致它们冻结、崩溃或重启。

Smurf 攻击

攻击者向网络的广播地址发送 ICMP 请求（通常是 ping），并使用目标的 IP 地址伪造返回地址。广播网络上的所有设备都会对此 ping 做出响应，向受害者的 IP 地址发送回复。这放大了针对目标发送的流量量，使其资源不堪重负。

这些攻击中的每一个都代表了一种不同的方法，通过向目标发送不受欢迎的流量或请求来使其不堪重负，从而导致拒绝服务。针对此类攻击的保护通常涉及流量过滤、速率限制和网络配置调整的组合，以减少漏洞。

## 应用层攻击

应用层攻击是更复杂的攻击，它们针对应用层，在该层中，网页根据 HTTP 请求生成和交付。攻击者从服务器请求了如此多的资源，以至于它无法处理合法用户请求。这类攻击通常比基于流量或协议的攻击需要的资源更少，但由于其针对性，可以非常有效。这类攻击的例子包括*HTTP 洪水*和*Slowloris*：

HTTP 洪水

这种攻击涉及用大量 HTTP 请求淹没 Web 服务器，使其无法有效地对合法用户流量做出响应。攻击者通过向服务器发送大量请求来利用 HTTP 协议中的漏洞，目的是耗尽其资源，破坏服务，并最终使网站对真实用户不可访问。

Slowloris

在这里，攻击者向目标 Web 服务器发起多个 HTTP 连接，但通过缓慢发送部分请求来故意保持它们打开，从而消耗可用的服务器资源，并阻止服务器处理合法请求。

## 一场史诗般的 DoS 攻击：Dyn

2016 年 10 月，由于对领先的域名系统（DNS）提供商 Dyn 的复杂且大规模 DoS 攻击，互联网面临了大规模的中断。这一事件成为头条新闻，并标志着理解网络威胁及其对全球互联网基础设施潜在影响的转折点。

Dyn，以其在互联网性能管理和网站应用安全方面的作用而闻名，成为 DDoS 攻击的目标，攻击者使用了被入侵的物联网设备，如数字相机和 DVR，来生成恶意流量。感染了 Mirai 恶意软件的这些设备形成了一个僵尸网络，向 Dyn 的服务器发送压倒性的流量。

生成的攻击流量估计约为 1.2 Tbps（每秒太比特）。在当时，这是记录中最具影响力的 DDoS 攻击之一。对 Dyn 的 DNS 服务的攻击产生了连锁反应，导致欧洲和北美的主要互联网平台和服务对用户不可用。包括 Twitter、Netflix、PayPal 和 Amazon 在内的知名网站面临重大中断。攻击分多波次进行，导致攻击期间间歇性中断和广泛的不确定性。

# 针对 LLM 的模型 DoS 攻击

与主要针对网络和服务器基础设施漏洞的传统 DoS 攻击不同，模型 DoS 攻击专注于利用 LLM 固有的独特漏洞。在模型 DoS 攻击中，攻击者的目标是损害 LLM 的功能或耗尽其资源。

通过 Web 用户界面或 REST API 连接到网络的 LLM 应用可能成为我们本章前面详细介绍的传统的 DoS 攻击的目标，例如基于流量、协议和应用层的攻击。然而，LLM 的性质使它们容易受到本节中将讨论的特定新问题的攻击。

## 资源稀缺攻击

由于 LLM（大型语言模型）使用生成复杂文本响应的架构，它们对资源需求量大。这使得它们容易受到旨在超负荷其处理能力的攻击。例如，攻击者可能会反复提示 LLM 翻译大量文档或生成长篇内容。这种请求，尤其是如果通过自动化或机器人扩大规模，会迅速耗尽 LLM 可用的计算资源。

让我们通过一个实际例子来帮助说明这一点。一些服务提供商使用 LLM 来提供高效的机器翻译服务，能够处理和理解一种语言中的文本，并将其流畅地翻译成另一种语言。然而，LLM 的复杂性是有代价的：对计算资源的高需求，这些资源既密集又专业。与您可以用廉价的网络带宽或通用 CPU 处理的更直接的计算任务不同，LLM 通常需要先进的硬件，如 GPU 或专门的 AI 加速器，这些硬件成本更高，供应有限，即使在广泛的云计算环境中也是如此。

考虑这样一种情况，一个基于 LLM 的翻译服务不是被复杂的 DDoS 攻击（利用僵尸网络）针对，而是被简单的、廉价的翻译请求洪水淹没。这些请求单独来看可能不会引起警报——毕竟，它们是服务提供商设计服务时打算处理的输入类型。然而，由于 LLM 处理资源密集型的特性，即使是适度协调的大量复杂翻译请求也可能不成比例地消耗计算资源。

这种对高端计算资源的依赖使得 LLM 特别容易受到利用。攻击者只需付出微小的努力，就可以提交大量复杂的文本进行翻译。虽然发送这些文本是微不足道的，对攻击者来说几乎不需要资源，但翻译过程对 LLM 来说却是一个巨大的负担。系统必须执行深入、细微的分析和生成任务，这些任务消耗了大量的这些稀缺且昂贵的计算资源。

提出请求所需的不费吹灰之力的努力与处理所需的大量资源之间的巨大差距凸显了被利用的可能性。这一现实加剧了建立强大防御措施的重要性，因为 LLM 比简单的系统更容易受到这些攻击。

在这种情况下，攻击者不需要破坏大量设备或采用高级技术来发起有效的破坏；LLM 本身的设计，旨在进行深入、深思熟虑的分析，反而成为了它的致命弱点。少数攻击者，甚至是一个拥有有限资源的攻击者，可以发起大量的翻译请求，虽然这些请求看似合法，但其目的是为了利用 LLM 的计算需求。结果，服务可能会显著减慢，甚至完全停止，拒绝合法用户访问，并可能给服务提供商带来巨大的运营成本。

## 上下文窗口耗尽

在第三章中，我们提到了“注意力”的概念，这是现代 LLM 底层 Transformer 架构的一部分。这是一个开创性的创新，使得这些模型能够在生成响应或翻译时关注输入文本的不同部分。注意力机制至关重要，因为它们使 LLM 能够动态地优先考虑某些输入而不是其他输入，模仿我们在阅读或倾听时人类注意力的工作方式。这种能力对于理解语言的内容和细微差别至关重要，使得 LLM 在处理和生成自然语言方面非常有效。

建立在注意力基础之上，*上下文窗口*可以被视为一个 LLM 的短期记忆。它定义了模型集中注意力的范围，限制了它在任何给定时刻能够“记住”或考虑的文本量。没有这个上下文窗口，LLM 将无状态地运行，类似于试图进行对话却无法回忆起之前所说的内容。这种限制将极大地降低模型的使用价值，因为它无法在更长的交互中产生连贯、具有上下文意识的响应。

因此，上下文窗口不仅是一个技术限制，而且是一个关键特性，它使 LLM 能够有效地应用其注意力机制。它允许模型在其内存范围内保持一个“对话”或维持叙述或论点的线索。这种能力使 LLM 在各种应用中变得强大和多功能，从写作辅助和聊天机器人到更复杂的任务，如摘要和翻译。

然而，正如我们指出的那样，赋予 LLM 这种能力的特征也引入了特定的脆弱性。在上下文窗口内维护和处理所需的计算需求是显著的。攻击者可以通过构建推上下文窗口极限的输入来利用这些需求，从而对模型资源造成压力。这可能包括提供极其长的提示或构建导致 LLM 给出高度冗长的答案的提示，这些答案可能会填满聊天机器人的上下文窗口。识别和缓解这些脆弱性不仅对 LLM 的操作效率至关重要，而且对于保护其免受可能损害其功能或造成过高成本的可利用性攻击也是必不可少的。

## 不可预测的用户输入

另一个脆弱性是 LLM 与不可预测的用户输入的交互。由于这些模型被设计为响应各种查询，攻击者可以操纵它们执行复杂、资源密集型任务。例如，攻击者可以构建复杂的问题或提示，迫使 LLM 进行深入、持续的分析或计算，从而有效耗尽其资源。

这种脆弱性的一个显著例子可以在看似无害的数学请求中观察到，经过仔细检查，这些请求揭示了指数级资源消耗的潜力。考虑一个场景，一个配备了生成代码或解决复杂问题能力的 LLM 接收到一个如“一百万的阶乘是多少？”这样的请求。将这个请求编码并发送到 LLM 只需要几十个字节，但它会导致主机系统执行一百万次乘法运算。

但是，现代 CPU 可以在毫秒内完成一百万次乘法。所以，让我们看看一些可能真正难倒这个可怜系统的请求：

计算密集型请求

这些可能包括诸如“从一到十亿的素数之和是多少？”这样的问题。虽然请求素数之和看似简单，但识别出高达十亿的素数需要大量的计算工作，包括对大量数字进行素性检查。

大量内容生成请求

一个听起来无害的请求，如“编写每个世界杯比赛的详细历史”，可能迫使 LLM 生成大量内容，将数百个单独的事件串联成一个单一、全面的叙述。每个标记生成都需要计算资源，而长篇详细的回答可能会对系统造成重大负担。

复杂推理和解释链

一个如“列出并解释从采矿原料到最终组装的智能手机生产过程中涉及的每个步骤，包括每个阶段的社会经济影响”的提示，可能需要将多个知识领域与深层次的因果和解释链联系起来，这会显著增加生成任务的复杂性和持续时间。

如果没有适当的保护措施，LLM 可能会开始许多无限制的计算之旅，这会显著消耗系统资源，并可能破坏服务。

# DoW 攻击

DoW 是一种拒绝服务（DoS）的变体，虽然不是新出现的，但在云计算和可扩展在线服务的时代开始获得显著的关注。与旨在破坏服务可用性的传统 DoS 攻击不同，DoW 攻击针对的是组织的财务资源。通常，DoW 攻击的主要目标是利用在线服务的基于使用量的定价模式，导致受害者成本失控。

历史上，分布式拒绝服务（DoW）攻击与云服务相关联，其成本直接与使用指标相关，如计算时间、数据传输或交易量。基本前提是通过提高使用量——进而提高成本——到不可持续的水平，从而“剥夺”组织其财务资源。

任何可扩展的 Web 应用程序都可能成为 DoW 攻击的目标。然而，LLM 应用通常具有许多使其特别易受攻击的特征。以下是一些需要考虑的项目：

高计算成本

LLM 需要大量的处理能力来执行文本生成、翻译或数据分析任务。这种高计算需求在基于云的部署模型中转化为更高的运营成本。

使用量的可扩展性

大型语言模型（LLM）应用旨在与请求量成比例扩展。这种可扩展性可以在 DoW 攻击场景中被利用，导致资源消耗和关联成本的快速上升。

基于 API 的访问

LLM 通常通过 API 访问，这使得攻击者能够程序化地生成大量请求，从而提高成本。

贵重且复杂的定价模型

LLM 服务的定价结构可能很复杂，并基于多个因素，如处理的标记数量、交互的持续时间或使用的模型类型。攻击者可以利用这些特征来最大化其行为的财务影响。

将 DoW 的概念进一步深化，我们现在看到攻击已经超越了仅仅耗尽服务提供商资源以造成不必要费用的简单行为。在这种更为严重的 DoW 变体中，攻击者利用其他漏洞，例如提示注入（见第四章），来接管对 LLM 的访问，然后将其用于恶意目的——所有这些都是在目标者的费用上进行的。例如，想象一个场景，攻击者成功执行了提示注入攻击，绕过了 LLM 的防护措施。然后，攻击者发出与应用程序意图不符的请求，并利用 LLM 生成钓鱼邮件或破解 CAPTCHA 谜题，作为更广泛的网络黑客活动的一部分。

这种场景类似于传统的加密货币挖矿攻击，其中云资源被用于加密货币挖矿。在加密货币挖矿中，攻击者非法使用受害者的计算能力来挖掘加密货币，为受害者带来运营成本，而攻击者从中获利。

在这两种场景中，未经授权的资源使用导致受害者遭受经济损失，攻击者可能从中获利。然而，与主要由于计算资源使用增加而造成经济损失的加密货币挖矿相比，这些高级 DoW 攻击，其中攻击者可以使用系统进行非法或恶意任务，可能会使目标面临额外的法律责任担忧和空空如也的钱包。

# 模型克隆

模型克隆已成为一种特别阴险的攻击形式。模型克隆涉及战略性地使用大量特定主题的提示查询 LLM 应用程序，或使用该模型生成合成训练数据。攻击者的目标是收集这些交互的输出，以微调另一个模型，有效地复制原始 LLM 的功能和知识库，而无需直接访问其底层架构或训练数据。这是一种模型盗窃的形式，攻击者实际上可以窃取你用来创建训练模型和应用程序的高度有价值的知识产权。

通过大量查询利用模型资源，这种攻击向量与 DoS 和 DoW 攻击在战术上存在某些相似之处，因此我们将其包括在本节中。然而，意图和最终目标存在显著差异。虽然 DoS 旨在破坏服务可用性，但模型克隆旨在秘密复制模型的功能，对知识产权构成直接威胁，并可能使未经授权访问专有技术成为可能。

# 缓解策略

本章讨论的新兴威胁态势强调了部署和管理应用程序的 LLM 时需要采取稳健的安全措施。组织必须监控其 LLM 应用程序，以发现任何未经授权的访问或异常活动的迹象。实施严格的访问控制、定期进行安全审计以及部署实时异常检测系统对于保护免受此类场景至关重要。

许多 DoS 或 DoW 攻击始于旨在越狱系统并摧毁您可能为使模型符合您的意愿而设置的防护栏的提示注入。因此，您必须遵循我们在第四章（ch04.html#prompt_injection）中描述的提示注入缓解策略。然而，第四章（ch04.html#prompt_injection）也表明，消除提示注入攻击是困难的，因此您还需要采取其他安全措施。

## 领域特定防护栏

考虑通过奖励模型仅对领域特定查询做出响应来微调您的模型。如第四章（ch04.html#prompt_injection）所述，对齐对于确保人工智能系统的目标与开发者的预期价值观、目标和安全考虑相一致至关重要。通过调整您的模型以主要对与应用程序上下文相关的查询做出响应——例如电子商务平台上的产品查询——您可以显著减少处理无关或离题请求的计算浪费。

这种专注的方法可以帮助保护系统免受通过不必要的和资源密集型任务进行的利用。例如，一个由微调模型驱动的电子商务网站的聊天机器人将回答有关购买和产品细节的客户相关问题，同时拒绝无关的查询，如复杂的数学问题。这种选择性的响应具有双重作用：它确保应用程序的处理能力得到有效利用，与平台的运营目标相一致，并且减少了因资源消耗型输入而造成的过度成本风险，这些输入对用户满意度或利润底线贡献甚微。

## 输入验证和净化

有效的输入验证和净化对于防止利用 LLM（大型语言模型）的处理能力进行的攻击至关重要。这涉及到为可接受的输入建立严格的准则，并严格检查所有传入数据是否符合这些标准。净化进一步通过积极移除或中和数据中的任何潜在有害元素。例如，超出上下文窗口大小的输入可以被截断或分割，而具有不寻常或复杂结构且可能导致过度处理的输入可以被简化或拒绝。这种方法不仅有助于减轻由恶意输入触发的资源密集型操作的风险，还有助于维护 LLM 的整体完整性和性能。

## 坚固的速率限制

实施强大的速率限制对于控制对 LLM 资源的访问至关重要。这种策略涉及定义和执行在给定时间框架内用户或系统对 LLM 提出请求的频率限制。通过设置合理的请求次数或处理数据量的阈值，速率限制可以有效地防止系统因过度需求而超负荷，无论这些需求是故意攻击的一部分还是合法使用激增。复杂的速率限制还可以涉及根据持续的系统性能和用户行为监控进行动态调整，从而实现更灵活和响应迅速的控制。

## 资源使用限制

对每个查询或处理步骤的资源使用进行限制是直接控制对 LLM 造成的计算负担的方法。这可能包括对每个请求处理的令牌数量、允许的计算复杂度或处理单个输入的时间进行限制。通过实施这些限制，攻击者诱导 LLM 执行高度资源密集型任务变得更加困难。这种策略还可以帮助维持可预测和稳定的系统性能，即使在高负载条件下也是如此。

## 监控和警报

对 LLM 的资源利用率进行持续监控对于早期发现潜在的攻击至关重要。这种监控涉及跟踪各种指标，如 CPU 使用率、内存消耗、响应时间和并发请求数量。建立常规操作的基线模式使得检测可能表明攻击的异常变得更加容易。实施强大的警报系统确保任何异常活动都能迅速引起相关人员的注意，从而允许快速调查和响应。这种主动方法对于最小化攻击的影响并保持 LLM 服务的可靠性至关重要。

## 财务阈值和警报

为基于云的 LLM 设置财务阈值和警报可以大幅减少 DoW 攻击造成的损害。您应该为 LLM 使用建立预算限制，并配置警报以在接近或超过这些阈值时通知管理员。这些措施在按使用付费的模型中至关重要，因为高使用量的成本影响可能很大。通过密切监控使用成本并设置预定义的限制，组织可以避免因恶意利用其 LLM 资源而出现意外的财务负担。

模型 DoS 和 DoW 代表了重大的威胁。随着这些模型在各个应用中变得更加核心，理解和缓解这些威胁对于维护基于 LLM 服务的运营完整性和财务可行性至关重要。

# 结论

DoS 和 DoW 攻击长期以来一直是针对网络应用的重大威胁。将这些应用与大型语言模型（LLM）集成放大了这些担忧，引入了新的风险维度，需要提高警惕和战略预见性。

LLMs（大型语言模型）的架构，以其密集的计算需求和通常基于使用的复杂计费模式为特征，使它们特别容易受到这些类型攻击的影响。正如我们所见，潜在的损害远远超出了传统操作中断的边界。由于这些模型大规模运行的昂贵成本，存在升级的财务风险。更令人担忧的是，存在更高的责任风险，尤其是在 LLMs 被劫持并用于非法目的的情况下。这类场景可能会使组织陷入法律纠纷，并对其声誉造成不可挽回的损害。
