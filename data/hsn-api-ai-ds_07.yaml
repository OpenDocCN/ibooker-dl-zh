- en: Chapter 6\. Deploying Your API to the Cloud
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第6章\. 将您的API部署到云中
- en: It sounds a little extreme, but in this day and age, if your work isn’t online,
    it doesn’t exist.
  id: totrans-1
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 听起来可能有些极端，但在这个时代，如果你的作品不上线，它就不存在。
- en: ''
  id: totrans-2
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Austin Kleon, *Show Your Work! 10 Ways to Share Your Creativity and Get Discovered*
    (Workman, 2014)
  id: totrans-3
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 奥斯汀·克莱恩，《展示你的工作！10种分享你的创造力和被发现的方法》（Workman，2014）
- en: You have made great progress with your first API. You have selected the most
    important qualities for your users, developed multiple API endpoints, and created
    user-friendly documentation. In this chapter, you will publish your API to the
    cloud, where consumers can access it. This is another chance to share what you
    have been working on.
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: 您在您的第一个API上取得了巨大进步。您为您的用户选择了最重要的品质，开发了多个API端点，并创建了用户友好的文档。在本章中，您将把您的API发布到云中，消费者可以访问它。这是分享您一直在努力工作的另一个机会。
- en: Benefits and Responsibilities of Cloud Deployment
  id: totrans-5
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 云部署的益处和责任
- en: The *cloud* is an informal term to refer to the collection of computer servers
    and connecting infrastructure that make the public internet. For a developer or
    data scientist, a great way to deploy prototypes and personal projects is through
    public cloud hosts. Before these became available, the process of running side
    projects was laborious and the capabilities were pretty limited. As a simple example,
    before cloud hosts became available to developers, hosting your software on a
    server required purchasing the physical server. When you finished with your project,
    you still had that server sitting around. With the cloud you can spin up a virtual
    server with a few commands, and when you are finished you can delete it. Now you
    have a great opportunity to deploy your work to a public cloud host with all of
    the networking and application hosting power that you can imagine (or at least
    afford).
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
  zh: '*云*是一个非正式术语，指的是构成公共互联网的计算机服务器和连接基础设施的集合。对于开发人员或数据科学家来说，通过公共云主机部署原型和个人项目是一个很好的方式。在这些服务可用之前，运行副项目的流程是费时的，而且功能相当有限。作为一个简单的例子，在云主机对开发人员可用之前，在服务器上托管您的软件需要购买物理服务器。当您完成项目后，您仍然有那个服务器闲置在那里。有了云，您可以通过几个命令启动一个虚拟服务器，当您完成时，您可以删除它。现在您有了一个绝佳的机会，将您的作品部署到具有所有您能想象（或至少负担得起）的联网和应用程序托管能力的公共云主机上。'
- en: Benefits
  id: totrans-7
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 益处
- en: 'Cloud platforms allow you several great opportunities for the project in this
    book:'
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: 云平台为本书中的项目提供了几个绝佳的机会：
- en: You can learn the end-to-end process of cloud development, deployment, and operations
    with the project that you developed.
  id: totrans-9
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 您可以通过您开发的项目学习云开发的端到端流程、部署和运营。
- en: You can share it with others as part of your portfolio project. This fast feedback
    loop allows you to learn and improve much more quickly.
  id: totrans-10
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 您可以将它作为您的作品集项目的一部分与他人分享。这个快速的反馈循环使您能够更快地学习和改进。
- en: With the published API, you can use internet-facing tools and products to explore
    from the user’s perspective. This is the focus of [Part II](part02.html#part_2)
    of this book.
  id: totrans-11
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 通过发布的API，您可以使用面向互联网的工具和产品从用户的角度进行探索。这是本书[第二部分](part02.html#part_2)的重点。
- en: You can use generative AI services to consume the API. This is the focus of
    [Part III](part03.html#part_3) of this book.
  id: totrans-12
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 您可以使用生成式AI服务来消费API。这是本书[第三部分](part03.html#part_3)的重点。
- en: I have found that deploying an application to the web makes the project real
    in a way that isn’t possible when it is only running in a development environment.
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 我发现将应用程序部署到网络上，使其以一种在开发环境中运行时不可能实现的方式变得真实。
- en: Responsibilities
  id: totrans-14
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 责任
- en: You should be aware that deploying to the internet comes with a few responsibilities
    as well, the first of which is cost. Cloud providers offer paid services, and
    they generally charge a variable amount based on the amount of usage of the applications
    that are hosted. Although some of the cloud providers used in this chapter have
    a free tier of services or starter credits, they will require a debit or credit
    card to be added to the account. When you are developing projects on a cloud host,
    it’s not uncommon to have a surprise bill at the end of the month for several
    dollars. There are also horror stories of people who ended up with unexpected
    bills costing hundreds or thousands of dollars. I will share some tips about cost
    management, but you should take care not to sign up for any services that you
    can’t afford. (When deploying the example applications in this chapter, I spent
    less than $1 USD to host them for several weeks on all the services combined.
    But your costs could be greater.)
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 你应该意识到将内容部署到互联网也伴随着一些责任，其中首要的是成本。云服务提供商提供付费服务，并且通常根据托管应用程序的使用量收取可变费用。尽管本章中使用的某些云服务提供商提供免费层服务或入门信用额度，但它们将要求添加借记卡或信用卡到账户中。当你在一个云主机上开发项目时，月底收到几美元的意外账单并不罕见。也有关于人们最终收到数百或数千美元意外账单的恐怖故事。我将分享一些关于成本管理的技巧，但你应该小心不要注册任何你负担不起的服务。（当在本章中部署示例应用程序时，我在所有服务上花费不到1美元，将它们托管了几周。但你的费用可能会更高。）
- en: Warning
  id: totrans-16
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 警告
- en: Another responsibility is security. Using the phrase *expose your API endpoint*
    gives you a hint of this responsibility—when you make your work available to the
    world, bad actors can access it. If your portfolio project contains fantasy sports
    data, you won’t be putting any personal data at risk. However, if you are careless
    with the credentials you use to connect to the cloud services, you could expose
    usernames, passwords, and API keys publicly. This could allow a fraudster to use
    your accounts to run up large bills mining crypto or creating bot armies to attack
    websites.
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: 另一个责任是安全性。使用短语“暴露你的API端点”可以给你这个责任的提示——当你将你的工作公之于众时，恶意行为者可以访问它。如果你的项目组合包含幻想体育数据，你不会将任何个人信息置于风险之中。然而，如果你对用于连接云服务的凭证粗心大意，你可能会公开用户名、密码和API密钥。这可能会让欺诈者使用你的账户进行加密货币挖掘或创建机器人军队来攻击网站。
- en: 'There are several ways to control costs when using cloud hosts:'
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 在使用云主机时，有几种控制成本的方法：
- en: Review the costs of services before using them. There are usually several services
    involved in a coding project. Use cost calculators if available.
  id: totrans-19
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在使用服务之前审查其成本。通常，编码项目中涉及多个服务。如果可用，请使用成本计算器。
- en: Use services with free tiers and free trial periods.
  id: totrans-20
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用提供免费层和免费试用期的服务。
- en: Create monthly budgets and set up email notifications to notify you when you
    are approaching budgeted amounts.
  id: totrans-21
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 制定月度预算并设置电子邮件通知，以便在接近预算金额时通知你。
- en: Shut down or delete resources after use.
  id: totrans-22
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用完毕后关闭或删除资源。
- en: When you have finished working with a cloud host, clean up resources and remove
    your payment method.
  id: totrans-23
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 当你完成与云主机的合作后，清理资源并移除你的支付方式。
- en: Keep tight control of your login credentials.
  id: totrans-24
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 严格控制你的登录凭证。
- en: Use short-lived access keys.
  id: totrans-25
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用短期访问密钥。
- en: Only activate the permissions for specific services you are using, and disable
    them after you are done.
  id: totrans-26
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 只激活你正在使用的特定服务的权限，完成后将其禁用。
- en: Do not commit any credentials into source control repositories.
  id: totrans-27
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 不要将任何凭证提交到源代码控制存储库。
- en: If any credentials do become exposed, deactivate or delete them. Contact support
    of the cloud host if necessary.
  id: totrans-28
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如果任何凭证被暴露，请将其停用或删除。如有必要，请联系云主机的支持。
- en: Choosing a Cloud Host for Your Project
  id: totrans-29
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 为你的项目选择云主机
- en: I have used a variety of cloud hosts to deploy prototypes and portfolio projects,
    and their capabilities and pricing models change over time. When I am deciding
    what host to use, I first decide what my primary focus is at the time. If I am
    just focused on getting my app out into the world, I choose the host that is simplest
    to deploy. If I want to learn about a specific cloud host or some of its underlying
    technical services, I am more willing to put in the time (and often pay a bit
    in hosting fees) to learn the deployment process for that host. When I am trying
    to practice some deployment or operational technique such as continuous integration
    (CI) or containerization, I select a host that supports that particular method
    and use it to deploy my app.
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: 我已经使用过各种云主机来部署原型和项目组合，它们的性能和定价模式会随时间变化。当我决定使用哪个主机时，我首先决定当时的主要关注点。如果我只是专注于将我的应用程序推向世界，我会选择部署最简单的云主机。如果我想了解特定的云主机或其底层的一些技术服务，我更愿意投入时间（并且通常在托管费用上支付一些费用）来学习该主机的部署过程。当我尝试练习某些部署或操作技术，如持续集成（CI）或容器化时，我会选择支持该特定方法的云主机，并使用它来部署我的应用程序。
- en: This chapter includes instructions for deploying to two cloud hosts, and I would
    encourage you to try out both of them to see the advantages and disadvantages
    of each. You will begin by using Render, which is fairly simple to deploy. Then,
    you will install and configure the Docker containerization tool, which you will
    use to deploy to Amazon Web Services (AWS).
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: 本章包括部署到两个云主机的说明，我鼓励您尝试使用它们，以了解每个云主机的优缺点。您将首先使用Render，它部署起来相对简单。然后，您将安装和配置Docker容器化工具，您将使用它来部署到亚马逊网络服务（AWS）。
- en: '[Table 6-1](#tools_table_chapter_6) displays the new tools or services you
    will use in this chapter.'
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: '[表6-1](#tools_table_chapter_6)显示了您在本章中将使用的新工具或服务。'
- en: Table 6-1\. New tools or services used in this chapter
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: 表6-1\. 本章中使用的新工具或服务
- en: '| Software or service name | Version | Purpose |'
  id: totrans-34
  prefs: []
  type: TYPE_TB
  zh: '| 软件或服务名称 | 版本 | 用途 |'
- en: '| --- | --- | --- |'
  id: totrans-35
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- | --- |'
- en: '| Amazon Lightsail | NA | AWS virtual cloud server |'
  id: totrans-36
  prefs: []
  type: TYPE_TB
  zh: '| Amazon Lightsail | NA | AWS虚拟云服务器 |'
- en: '| AWS CLI | 2.15 | Command-line interface for AWS services |'
  id: totrans-37
  prefs: []
  type: TYPE_TB
  zh: '| AWS CLI | 2.15 | AWS服务的命令行界面 |'
- en: '| Docker | 24.0 | Pack and run your application in a container |'
  id: totrans-38
  prefs: []
  type: TYPE_TB
  zh: '| Docker | 24.0 | 在容器中打包和运行您的应用程序 |'
- en: '| Render | NA | Cloud hosting provider |'
  id: totrans-39
  prefs: []
  type: TYPE_TB
  zh: '| Render | NA | 云托管提供商 |'
- en: Setting Up Your Project Directory
  id: totrans-40
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 设置您的项目目录
- en: 'To continue your portfolio project where you left it in the previous chapter,
    change the directory to *chapter6* and then copy the previous chapter’s files
    into it. The following shows the commands and expected output:'
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: 要继续在上一章结束的地方继续您的项目，请将目录更改为*chapter6*，然后将上一章的文件复制到其中。以下显示了命令和预期输出：
- en: '[PRE0]'
  id: totrans-42
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: Using GitHub Codespaces as a Cloud Host
  id: totrans-43
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用GitHub Codespaces作为云主机
- en: For intermittent cloud hosting, GitHub Codespaces may be sufficient. It will
    only be available while your Codespace is running, but this can be useful for
    testing with an external tool or sharing it with someone else to review.
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: 对于间歇性云托管，GitHub Codespaces可能足够使用。它仅在您的Codespace运行时才可用，但这对于使用外部工具进行测试或与他人共享以供审查可能很有用。
- en: When you first run the API in your Codespace, you will see a dialog stating
    “Your application running on port 8000 is available,” as shown in [Figure 6-1](#make_api_public_ch6).
    Click Make Public.
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: 当您第一次在您的Codespace中运行API时，您将看到一个对话框，显示“您的应用程序正在端口8000上运行”，如图[图6-1](#make_api_public_ch6)所示。点击“公开”。
- en: '![Make API Public](assets/haad_0601.png)'
  id: totrans-46
  prefs: []
  type: TYPE_IMG
  zh: '![Make API Public](assets/haad_0601.png)'
- en: Figure 6-1\. Making the API public
  id: totrans-47
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图6-1\. 使API公开
- en: The API is now running in Codespaces with a public port. To view the API in
    the browser, click Ports in the terminal and hover over Port 8000 as shown in
    [Figure 6-2](#api_running_public_port_6).
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: API现在在Codespaces中运行，并公开了端口。要在浏览器中查看API，请在终端中点击端口，并将鼠标悬停在如图[图6-2](#api_running_public_port_6)所示的端口8000上。
- en: '![Open API on public address](assets/haad_0602.png)'
  id: totrans-49
  prefs: []
  type: TYPE_IMG
  zh: '![在公开地址上打开API](assets/haad_0602.png)'
- en: Figure 6-2\. Open API on a public address
  id: totrans-50
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图6-2\. 在公开地址上打开API
- en: 'Click the globe icon, and the web browser should be opened to the health check
    endpoint of your API. If you look at the address in your browser, you should see
    a base URL that ends in *app.github.dev*. The browser page should show the response
    from your API running on Codespaces. You should see the following health check
    message in your web browser:'
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: 点击地球图标，浏览器应打开到您的 API 健康检查端点。如果您查看浏览器中的地址，您应该看到一个以 *app.github.dev* 结尾的基本 URL。浏览器页面应显示在
    Codespaces 上运行的您的 API 的响应。您应该在您的网络浏览器中看到以下健康检查消息：
- en: '[PRE1]'
  id: totrans-52
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: Your API is running publicly in the cloud.
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 您的 API 正在云中公开运行。
- en: Deploying to Render
  id: totrans-54
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 部署到 Render
- en: Render calls itself “a unified cloud to build and run all your apps and websites.”
    At the time of this writing, Render has a pricing plan that includes Python hosting
    for free, except for a small cost for monthly storage. You will be generally following
    the instructions from [Deploy a FastAPI App](https://oreil.ly/nmdaK).
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: Render 自称为“一个统一的云平台，用于构建和运行所有您的应用程序和网站。”在撰写本文时，Render 的定价计划包括免费的 Python 主机服务，但每月存储费用除外。您将一般遵循
    [部署 FastAPI 应用](https://oreil.ly/nmdaK) 的说明。
- en: The process of deploying to Render only involves a few steps, as shown in [Figure 6-3](#deploying_render_diagram_ch4).
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: 将应用程序部署到 Render 的过程仅涉及几个步骤，如图 [图 6-3](#deploying_render_diagram_ch4) 所示。
- en: '![Deploying your API to Render](assets/haad_0603.png)'
  id: totrans-57
  prefs: []
  type: TYPE_IMG
  zh: '![将您的 API 部署到 Render](assets/haad_0603.png)'
- en: Figure 6-3\. Deploying your API to Render
  id: totrans-58
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图 6-3\. 将您的 API 部署到 Render
- en: Signing Up for Render
  id: totrans-59
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 注册 Render
- en: The first step is to [sign up for a Render account](https://oreil.ly/rend).
    You can create a new account or use one of the existing services, such as GitHub
    or Google. It should work the same either way. When you have created your account
    and provided the information requested, you should see the Render dashboard with
    no services.
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: 第一步是 [注册 Render 账户](https://oreil.ly/rend)。您可以创建一个新账户或使用现有的服务之一，例如 GitHub 或
    Google。两种方式都应相同。当您创建了账户并提供了所需的信息后，您应该看到没有服务的 Render 仪表板。
- en: Creating a New Web Service
  id: totrans-61
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 创建新的 Web 服务
- en: From the New menu, select Web Service.
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: 从“新建”菜单中选择“Web 服务”。
- en: On the New Web Service page, select Public Git Repository, enter the URL of
    your GitHub repo, as shown in [Figure 6-4](#render_choose_git_ch6), and click
    Connect.
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: 在“新建 Web 服务”页面，选择“公共 Git 仓库”，输入您的 GitHub 仓库的 URL，如图 [图 6-4](#render_choose_git_ch6)
    所示，然后点击“连接”。
- en: '![Choosing how to deploy your web service](assets/haad_0604.png)'
  id: totrans-64
  prefs: []
  type: TYPE_IMG
  zh: '![选择如何部署您的 Web 服务](assets/haad_0604.png)'
- en: Figure 6-4\. Choosing how to deploy a web service
  id: totrans-65
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图 6-4\. 选择如何部署 Web 服务
- en: The next page should say “You are deploying a Web Service,” as shown in [Figure 6-5](#render_service_page_ch6).
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: 下一个页面应显示“您正在部署 Web 服务”，如图 [图 6-5](#render_service_page_ch6) 所示。
- en: '![Render web service settings](assets/haad_0605.png)'
  id: totrans-67
  prefs: []
  type: TYPE_IMG
  zh: '![Render Web 服务设置](assets/haad_0605.png)'
- en: Figure 6-5\. Render web service settings
  id: totrans-68
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图 6-5\. Render Web 服务设置
- en: 'Enter the settings on this page as follows:'
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: 在此页面上输入以下设置：
- en: '*Name*: Enter an available unique name.'
  id: totrans-70
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*名称*：输入一个可用的唯一名称。'
- en: '*Project*: Do not create a project.'
  id: totrans-71
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*项目*：不要创建项目。'
- en: '*Language*: **`Python 3`**'
  id: totrans-72
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*语言*：**`Python 3`**'
- en: '*Branch*: **`main`**'
  id: totrans-73
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*分支*：**`main`**'
- en: '*Region*: Select the region nearest you.'
  id: totrans-74
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*区域*：选择离您最近的位置。'
- en: '*Root directory*: **`chapter6`**'
  id: totrans-75
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*根目录*：**`chapter6`**'
- en: '*Build command*: **`pip install -r requirements.txt`**'
  id: totrans-76
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*构建命令*：**`pip install -r requirements.txt`**'
- en: '*Start command*: **`uvicorn main:app --host 0.0.0.0 --port $PORT`**'
  id: totrans-77
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*启动命令*：**`uvicorn main:app --host 0.0.0.0 --port $PORT`**'
- en: '*Instance type*: **`Free`**'
  id: totrans-78
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*实例类型*：**`免费`**'
- en: Notice that the start command did not use `fastapi run` as you used on the command
    line. For the web deployments, you are directly using the Uvicorn web server to
    run the API without using the fastapi-cli library.
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: 注意，启动命令没有使用您在命令行上使用的 `fastapi run`。对于 Web 部署，您直接使用 Uvicorn Web 服务器运行 API，而不使用
    fastapi-cli 库。
- en: Scroll to the bottom of the page, and select Deploy Web Service. A page should
    be displayed with a deployment log. As you watch, you should see the cloud host
    installing the software from your *requirements.txt* file and starting an instance
    of your application. When the process completes successfully, you should see the
    statement “Your service is live,” as shown in [Figure 6-6](#successful_render_deploy).
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: 滚动到页面底部，并选择“部署 Web 服务”。应显示一个包含部署日志的页面。在您观看的过程中，您应该看到云主机从您的 *requirements.txt*
    文件中安装软件并启动您的应用程序实例。当过程成功完成时，您应该看到“您的服务已上线”的声明，如图 [图 6-6](#successful_render_deploy)
    所示。
- en: '![Render successfully deployed](assets/haad_0606.png)'
  id: totrans-81
  prefs: []
  type: TYPE_IMG
  zh: '![Render 成功部署](assets/haad_0606.png)'
- en: Figure 6-6\. Successful deployment on Render
  id: totrans-82
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图 6-6\. 在 Render 上成功部署
- en: Copy the URL of your web service that is displayed near the top of the window.
    (In this example, the address is *[*https://football-api-service.onrender.com*](https://football-api-service.onrender.com)*).
    Paste this URL into another browser window. You should see the health check message
    of your API. If you access the */docs* endpoint, you can use Swagger UI to check
    that the rest of the endpoints are returning data. Congratulations! You have deployed
    your API to the first cloud host!
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: 复制窗口顶部附近显示的您的网络服务的 URL。 (在本例中，地址是 *[*https://football-api-service.onrender.com*](https://football-api-service.onrender.com)*)。
    将此 URL 粘贴到另一个浏览器窗口中。你应该能看到您的 API 的健康检查信息。如果你访问 */docs* 端点，你可以使用 Swagger UI 检查其他端点是否返回数据。恭喜！你已经将你的
    API 部署到了第一个云主机！
- en: Tip
  id: totrans-84
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 小贴士
- en: If you receive an error in the deployment, verify that you committed the [Chapter 6](#chapter_6)
    code to your repository prior to deploying.
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你在部署过程中收到错误，请验证在部署之前你是否已将 [第 6 章](#chapter_6) 的代码提交到你的仓库。
- en: Auto-Deploying a Change to Your API
  id: totrans-86
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 自动部署你的 API 的更改
- en: 'By default, Render is set to auto-deploy any changes you make to files in your
    repository’s *chapter6* folder. Test this by modifying the health-check endpoint
    in *main.py* with the following message:'
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: 默认情况下，Render 设置为自动部署你对仓库的 *chapter6* 文件夹中的文件所做的任何更改。通过以下消息修改 *main.py* 中的健康检查端点来测试这一点：
- en: '[PRE2]'
  id: totrans-88
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: Commit these changes to your GitHub repository.
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: 将这些更改提交到你的 GitHub 仓库。
- en: Open your web service from the [Render dashboard](https://dashboard.render.com)
    and select Events. The most recent event should be a new deployment. After a few
    minutes, you should see the updated health check text when you access the web
    service in your browser.
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: 从 [Render 控制台](https://dashboard.render.com) 打开你的网络服务并选择事件。最近的操作应该是一个新的部署。几分钟后，当你通过浏览器访问网络服务时，你应该能看到更新的健康检查文本。
- en: In the next section, you will configure your application to run on Docker, which
    will be used by AWS Lightsail.
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一节中，你将配置你的应用程序在 Docker 上运行，这将由 AWS Lightsail 使用。
- en: Shipping Your Application in a Docker Container
  id: totrans-92
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 在 Docker 容器中传输你的应用程序
- en: Whereas Render deployed your application from a source code repository (GitHub),
    AWS will use an application named Docker. Docker is a very useful tool for shipping
    applications in *containers*. Just as cargo is shipped in a shipping container,
    applications are shipped in a software container.
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: 与 Render 从源代码仓库（GitHub）部署你的应用程序不同，AWS 将使用名为 Docker 的应用程序。Docker 是一个非常有用的工具，用于在
    *容器* 中传输应用程序。就像货物在运输集装箱中运输一样，应用程序在软件容器中传输。
- en: The [Docker glossary](https://oreil.ly/TyStu) explains a few key terms that
    you will use. A *Dockerfile* is “a text document that contains all the commands
    you would normally execute manually to build a Docker image.” The *container image*,
    or Docker image, is “an ordered collection of root filesystem changes and the
    corresponding execution parameters for use within a container runtime.” A *repository*
    is a set of Docker images. A *container runtime* is software that uses the image
    to create a container, which is a runtime instance of a container image. You will
    use Docker as your container runtime.
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: '[Docker 术语表](https://oreil.ly/TyStu) 解释了你将使用的一些关键术语。*Dockerfile* 是“一个包含所有你通常手动执行的命令以构建
    Docker 镜像的文本文件。”*容器镜像*，或 Docker 镜像，“是一个有序的根文件系统更改和相应的执行参数的集合，用于在容器运行时中使用。”*仓库*是一组
    Docker 镜像。*容器运行时*是使用镜像创建容器的软件，它是容器镜像的运行时实例。你将使用 Docker 作为你的容器运行时。'
- en: You will first learn the process of using Docker to run your application locally,
    and then build on that knowledge to deploy to AWS Lightsail.
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: 你将首先学习使用 Docker 在本地运行你的应用程序的过程，然后在此基础上构建知识以部署到 AWS Lightsail。
- en: Don’t worry if all of this information does not make sense yet. As you go through
    the process of deploying the application in the three different environments,
    you will begin to see the purpose of the tasks.
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: 如果所有这些信息现在还不明白，请不要担心。随着你通过在三个不同的环境中部署应用程序的过程，你将开始看到这些任务的目的。
- en: '[Table 6-2](#docker_commands_ch6) has a summary of Docker commands you will
    use in this chapter. A full list of commands is available on the [Docker cheat
    sheet](https://oreil.ly/Prc1P).'
  id: totrans-97
  prefs: []
  type: TYPE_NORMAL
  zh: '[表 6-2](#docker_commands_ch6) 总结了你将在本章中使用的 Docker 命令。完整的命令列表可在 [Docker 技巧表](https://oreil.ly/Prc1P)
    中找到。'
- en: Table 6-2\. Docker commands
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: 表 6-2\. Docker 命令
- en: '| Command | Purpose |'
  id: totrans-99
  prefs: []
  type: TYPE_TB
  zh: '| 命令 | 目的 |'
- en: '| --- | --- |'
  id: totrans-100
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- |'
- en: '| `docker --version` | Verify what version of the library is installed. |'
  id: totrans-101
  prefs: []
  type: TYPE_TB
  zh: '| `docker --version` | 验证已安装的库版本。 |'
- en: '| `docker build -t` | Build an image from a Dockerfile. |'
  id: totrans-102
  prefs: []
  type: TYPE_TB
  zh: '| `docker build -t` | 从 Dockerfile 构建一个镜像。 |'
- en: '| `docker images` | List local images in your environment. |'
  id: totrans-103
  prefs: []
  type: TYPE_TB
  zh: '| `docker images` | 列出您环境中的本地镜像。 |'
- en: '| `docker run` | Run a container from a local image. |'
  id: totrans-104
  prefs: []
  type: TYPE_TB
  zh: '| `docker run` | 从本地镜像运行容器。 |'
- en: Verifying Docker Installation
  id: totrans-105
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 验证 Docker 安装
- en: If you are using GitHub Codespaces, Docker should come preloaded for you. Otherwise,
    follow the instructions on the [Get Docker page](https://oreil.ly/jUGKm) to install
    the appropriate version for your development environment.
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您使用 GitHub Codespaces，Docker 应已预装。否则，按照 [Get Docker 页面](https://oreil.ly/jUGKm)
    上的说明安装适合您开发环境的相应版本。
- en: 'Verify that Docker is installed by executing the command **`docker --version`**,
    which should return the version and build number, such as the following:'
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: 通过执行命令 **`docker --version`** 来验证 Docker 是否已安装，它应返回版本和构建号，如下所示：
- en: '[PRE3]'
  id: totrans-108
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'You will perform a couple of fairly simple steps:'
  id: totrans-109
  prefs: []
  type: TYPE_NORMAL
  zh: 您将执行几个相当简单的步骤：
- en: Create a Dockerfile.
  id: totrans-110
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 创建一个 Dockerfile。
- en: Build a container image from this Dockerfile.
  id: totrans-111
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 从此 Dockerfile 构建容器镜像。
- en: Run a container based on this image.
  id: totrans-112
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 基于此镜像运行容器。
- en: Let’s get started.
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们开始吧。
- en: Creating a Dockerfile
  id: totrans-114
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 创建 Dockerfile
- en: 'A *Dockerfile* contains the instructions that Docker will use to create a container
    image. Keep in mind that the statements will be executed in the `docker build`
    step that you will initiate. Create a file named *chapter6/Dockerfile*:'
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
  zh: '*Dockerfile* 包含 Docker 将用于创建容器镜像的指令。请记住，这些语句将在您将启动的 `docker build` 步骤中执行。创建一个名为
    *chapter6/Dockerfile* 的文件：'
- en: '[PRE4]'
  id: totrans-116
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: 'Update *chapter6/Dockerfile* with the following contents:'
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
  zh: 使用以下内容更新 *chapter6/Dockerfile*：
- en: '[PRE5]'
  id: totrans-118
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: '[![1](assets/1.png)](#co_deploying_your_api_to_the_cloud_CO1-1)'
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
  zh: '[![1](assets/1.png)](#co_deploying_your_api_to_the_cloud_CO1-1)'
- en: This chooses the *parent image*, which is the official Python 3.10 slim Docker
    image in this case. This image already contains most of the items you will need
    to run your application. That allows you to focus on adding your code and any
    custom libraries.
  id: totrans-120
  prefs: []
  type: TYPE_NORMAL
  zh: 这选择 *父镜像*，在本例中是官方 Python 3.10 slim Docker 镜像。此镜像已经包含您运行应用程序所需的大部分内容。这使您能够专注于添加您的代码和任何自定义库。
- en: '[![2](assets/2.png)](#co_deploying_your_api_to_the_cloud_CO1-2)'
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
  zh: '[![2](assets/2.png)](#co_deploying_your_api_to_the_cloud_CO1-2)'
- en: This statement sets a working directory inside the container image. This working
    directory is where the remaining commands will be executed unless otherwise specified.
  id: totrans-122
  prefs: []
  type: TYPE_NORMAL
  zh: 此语句设置容器镜像内部的工作目录。除非另有指定，否则剩余的命令将在该工作目录中执行。
- en: '[![3](assets/3.png)](#co_deploying_your_api_to_the_cloud_CO1-3)'
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
  zh: '[![3](assets/3.png)](#co_deploying_your_api_to_the_cloud_CO1-3)'
- en: 'This copies the *requirements.txt* file from *context*, which is a set of files
    in a location that you will specify when you execute the build statement. (Spoiler
    alert: in this chapter, you will be using the *chapter6* directory as the context,
    so the context includes all the files in this folder.)'
  id: totrans-124
  prefs: []
  type: TYPE_NORMAL
  zh: 这将 *requirements.txt* 文件从 *context* 复制到其中，*context* 是您在执行构建语句时指定的位置的文件集。（剧透：在本章中，您将使用
    *chapter6* 目录作为上下文，因此上下文包括此文件夹中的所有文件。）
- en: '[![4](assets/4.png)](#co_deploying_your_api_to_the_cloud_CO1-4)'
  id: totrans-125
  prefs: []
  type: TYPE_NORMAL
  zh: '[![4](assets/4.png)](#co_deploying_your_api_to_the_cloud_CO1-4)'
- en: 'This uses `pip` to install the specified libraries in your *requirements.txt*
    file into a new layer in the Docker image. A Docker container image is like a
    brand-new virtual server: you have complete control of the libraries and versions
    that are contained in it so that your application works correctly.'
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
  zh: 这使用 `pip` 将您的 *requirements.txt* 文件中指定的库安装到 Docker 镜像的新层中。Docker 容器镜像就像一个全新的虚拟服务器：您对其包含的库和版本有完全的控制权，以确保您的应用程序能够正确运行。
- en: '[![5](assets/5.png)](#co_deploying_your_api_to_the_cloud_CO1-5)'
  id: totrans-127
  prefs: []
  type: TYPE_NORMAL
  zh: '[![5](assets/5.png)](#co_deploying_your_api_to_the_cloud_CO1-5)'
- en: These two statements copy your Python program files and SQLite database from
    the context directory to your Docker working directory.
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
  zh: 这两个语句将您的 Python 程序文件和 SQLite 数据库从上下文目录复制到您的 Docker 工作目录。
- en: '[![6](assets/6.png)](#co_deploying_your_api_to_the_cloud_CO1-6)'
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
  zh: '[![6](assets/6.png)](#co_deploying_your_api_to_the_cloud_CO1-6)'
- en: After steps 1 through 5 have built the container image, this step sets the default
    command that will be executed each time a container is launched from that image
    using the `docker run` command. As you did with the Render deployment, you are
    directly calling Uvicorn to run the API.
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: 在步骤 1 到 5 构建容器镜像之后，此步骤设置默认命令，该命令将在使用 `docker run` 命令从该镜像启动容器时执行。就像你在 Render
    部署中所做的那样，你直接调用 Uvicorn 来运行 API。
- en: These are all the instructions you need to define your container image. The
    next step will be to build the container image in your local repository.
  id: totrans-131
  prefs: []
  type: TYPE_NORMAL
  zh: 这些就是您需要定义容器镜像的所有指令。下一步将在您的本地仓库中构建容器镜像。
- en: Creating a .dockerignore File
  id: totrans-132
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 创建一个.dockerignore文件
- en: 'Just like *.gitignore* excludes files from version control, you want to exclude
    some files in your directory from the Docker image. Create a file named *.dockerignore*
    with the following contents:'
  id: totrans-133
  prefs: []
  type: TYPE_NORMAL
  zh: 就像*.gitignore*排除版本控制中的文件一样，您希望排除目录中的一些文件，使其不在Docker镜像中。创建一个名为*.dockerignore*的文件，并包含以下内容：
- en: '[PRE6]'
  id: totrans-134
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: Building a Container Image
  id: totrans-135
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 构建容器镜像
- en: 'To put this Dockerfile to use, enter the following command at the command line:'
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: 要使用此Dockerfile，请在命令行中输入以下命令：
- en: '[PRE7]'
  id: totrans-137
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: This tells Docker to build an image (`apicontainerimage`) using the Dockerfile
    in the current directory. The container image will be stored in your local Docker
    repository.
  id: totrans-138
  prefs: []
  type: TYPE_NORMAL
  zh: 这告诉Docker使用当前目录中的Dockerfile构建一个镜像（`apicontainerimage`）。容器镜像将存储在您的本地Docker仓库中。
- en: 'You should see multiple steps being executed. The first time you run this command,
    this may take several minutes. Future builds will take less time because Docker
    can cache items that do not change. You should see something similar to the following
    when it is completed:'
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
  zh: 您应该看到多个步骤正在执行。第一次运行此命令时，这可能需要几分钟。未来的构建将花费更少的时间，因为Docker可以缓存未更改的项目。完成时，您应该看到类似以下内容：
- en: '[PRE8]'
  id: totrans-140
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: 'To verify that the image was created successfully, enter the command **`docker
    images`** to view the images in your repository. You should see something like
    the following:'
  id: totrans-141
  prefs: []
  type: TYPE_NORMAL
  zh: 为了验证镜像创建成功，请输入命令 **`docker images`** 来查看您仓库中的镜像。您应该看到类似以下内容：
- en: '[PRE9]'
  id: totrans-142
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: Running Your Container Image Locally
  id: totrans-143
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 在本地运行容器镜像
- en: You use the `docker run` command to run a container based on this image. There
    are just a couple of options to notice here. The statement `--publish 80:80` maps
    port 80 inside the Docker container (the second `80`) to port 80 on your local
    environment (the first `80`). The statement `--name apicontainer1` sets the name
    of the container that you will be using. This is a convenient way to reference
    the running container (Docker will also assign an image ID). Finally, `apicontainerimage`
    passes the image name that you built in the previous step. Remember, the image
    is used to run a container.
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
  zh: 您使用`docker run`命令基于此镜像运行一个容器。这里有几个选项需要注意。`--publish 80:80`语句将Docker容器内部的端口80（第二个80）映射到您的本地环境中的端口80（第一个80）。`--name
    apicontainer1`语句设置了您将要使用的容器的名称。这是一个方便的方式来引用正在运行的容器（Docker也会分配一个镜像ID）。最后，`apicontainerimage`传递了您在上一步骤中构建的镜像名称。记住，镜像用于运行容器。
- en: 'Execute the following command:'
  id: totrans-145
  prefs: []
  type: TYPE_NORMAL
  zh: 执行以下命令：
- en: '[PRE10]'
  id: totrans-146
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: 'You should see the following:'
  id: totrans-147
  prefs: []
  type: TYPE_NORMAL
  zh: 您应该看到以下内容：
- en: '[PRE11]'
  id: totrans-148
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: You will see the message “Your application running on port 80 is available.”
    Select “Open in Browser” to run the API in the web browser. You should see the
    health check message in the window, exactly like when you ran the API from the
    command line.
  id: totrans-149
  prefs: []
  type: TYPE_NORMAL
  zh: 您将看到消息“您的应用程序在端口80上运行可用。”选择“在浏览器中打开”以在Web浏览器中运行API。您应该在窗口中看到健康检查消息，这与您从命令行运行API时完全一样。
- en: 'Now if you go back to the terminal window, you will see a log message for the
    first request to the API:'
  id: totrans-150
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，如果您回到终端窗口，您将看到对API的第一个请求的日志消息：
- en: '[PRE12]'
  id: totrans-151
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: Congratulations! Your application is being run by Docker in a container that
    you defined. To stop the application, press Ctrl-C.
  id: totrans-152
  prefs: []
  type: TYPE_NORMAL
  zh: 恭喜！您的应用程序正在由Docker在您定义的容器中运行。要停止应用程序，请按Ctrl-C。
- en: Deploying to AWS
  id: totrans-153
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 部署到AWS
- en: The AWS deployment will take advantage of the Docker container that you created.
    You will run your application using the Amazon Lightsail service, which is one
    of the simpler AWS services to get started with.
  id: totrans-154
  prefs: []
  type: TYPE_NORMAL
  zh: AWS部署将利用您创建的Docker容器。您将使用Amazon Lightsail服务运行您的应用程序，这是AWS中启动起来相对简单的服务之一。
- en: To begin, [create a new AWS account](https://oreil.ly/09mZ7) and store your
    login credentials securely. For this project, it will be acceptable to use the
    *root user* account, which is the full owner of the account identified by the
    email address. However, you should enable multifactor authentication (MFA), following
    the directions [in the AWS Identity and Access Management User Guide](https://oreil.ly/N5Q7e).
  id: totrans-155
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，[创建一个新的AWS账户](https://oreil.ly/09mZ7) 并安全地存储您的登录凭证。对于这个项目，使用*root用户*账户是可以接受的，它是通过电子邮件地址识别的账户的全权所有者。然而，您应该启用多因素认证（MFA），按照[AWS身份和访问管理用户指南](https://oreil.ly/N5Q7e)中的说明操作。
- en: If you continue using AWS, a best practice is to create a separate administration
    account and use it for normal work instead of the root user.
  id: totrans-156
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您继续使用AWS，一个最佳实践是创建一个单独的管理账户，并使用它进行常规工作，而不是使用root用户。
- en: Creating a Lightsail Container Service
  id: totrans-157
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 创建一个Lightsail容器服务
- en: When you have logged in to the AWS console, select Lightsail from the search
    bar and then select Containers from the lefthand menu. You should see a page that
    looks like [Figure 6-7](#lightsail_home_ch4). Click “Create container service.”
  id: totrans-158
  prefs: []
  type: TYPE_NORMAL
  zh: 当你登录到 AWS 控制台后，从搜索栏中选择 Lightsail，然后从左侧菜单中选择容器。你应该会看到一个类似于[图 6-7](#lightsail_home_ch4)
    的页面。点击“创建容器服务”。
- en: '![Lightsail home page](assets/haad_0607.png)'
  id: totrans-159
  prefs: []
  type: TYPE_IMG
  zh: '![Lightsail 主页](assets/haad_0607.png)'
- en: Figure 6-7\. Starter page for Lightsail
  id: totrans-160
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图 6-7\. Lightsail 的起始页面
- en: 'You will be asked to complete the information for your first Lightsail service:'
  id: totrans-161
  prefs: []
  type: TYPE_NORMAL
  zh: 你将被要求完成第一个 Lightsail 服务的相关信息：
- en: '*Region*: Select a region that is nearest to you for best performance.'
  id: totrans-162
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*区域*：选择离你最近的一个区域以获得最佳性能。'
- en: '*Power*: Choose Nano or Micro.'
  id: totrans-163
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*功率*：选择 Nano 或 Micro。'
- en: '*Scale*: Choose 1.'
  id: totrans-164
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*规模*：选择 1。'
- en: '*Identify your service*: Choose a name for your container. This example uses
    `aws-api-container`.'
  id: totrans-165
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*标识你的服务*：为你的容器选择一个名称。本例中使用 `aws-api-container`。'
- en: Click “Create container service”. It will take several minutes for the container
    to be created. When it finishes, you should see a status page like the one in
    [Figure 6-8](#completed_lightsail_status).
  id: totrans-166
  prefs: []
  type: TYPE_NORMAL
  zh: 点击“创建容器服务”。创建容器可能需要几分钟时间。完成时，你应该会看到一个状态页面，类似于[图 6-8](#completed_lightsail_status)
    中的页面。
- en: '![Lightsail instance complete](assets/haad_0608.png)'
  id: totrans-167
  prefs: []
  type: TYPE_IMG
  zh: '![Lightsail 实例完成](assets/haad_0608.png)'
- en: Figure 6-8\. Lightsail container service creation completed
  id: totrans-168
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图 6-8\. Lightsail 容器服务创建完成
- en: Installing the AWS CLI
  id: totrans-169
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 安装 AWS CLI
- en: To interact with AWS, you will use the AWS CLI. Follow the instructions from
    AWS to [install or update the latest version of the AWS CLI](https://oreil.ly/r8tTp).
  id: totrans-170
  prefs: []
  type: TYPE_NORMAL
  zh: 为了与 AWS 交互，你将使用 AWS CLI。按照 AWS 的说明[安装或更新 AWS CLI 的最新版本](https://oreil.ly/r8tTp)。
- en: 'Run the following command to verify the installation:'
  id: totrans-171
  prefs: []
  type: TYPE_NORMAL
  zh: 运行以下命令以验证安装：
- en: '[PRE13]'
  id: totrans-172
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: Installing the Amazon Lightsail Container Services Plug-in
  id: totrans-173
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 安装 Amazon Lightsail 容器服务插件
- en: For Lightsail, an additional installation is required. Follow the instructions
    on [installing the Amazon Lightsail container services plug-in](https://oreil.ly/xMzkI).
  id: totrans-174
  prefs: []
  type: TYPE_NORMAL
  zh: 对于 Lightsail，还需要进行额外的安装。按照[安装 Amazon Lightsail 容器服务插件](https://oreil.ly/xMzkI)的说明进行操作。
- en: Configuring Your Login Credentials
  id: totrans-175
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 配置您的登录凭证
- en: To connect the AWS CLI to your AWS account, you will need to configure your
    authentication and access credentials. There are multiple ways to do this, and
    it can take a bit of time to set up correctly. As mentioned multiple times in
    this chapter, you should be extremely careful in the handling of your credentials
    by cloud services. This includes taking care that they are never committed to
    a source code repository. Follow the instructions from [“Authentication and access
    credentials for the AWS CLI”](https://oreil.ly/HAXYD) to configure your AWS CLI.
  id: totrans-176
  prefs: []
  type: TYPE_NORMAL
  zh: 为了将 AWS CLI 连接到你的 AWS 账户，你需要配置你的身份验证和访问凭证。有多种方法可以做到这一点，正确设置可能需要一些时间。正如本章多次提到的，你应该非常小心地处理云服务中的凭证，确保它们永远不会被提交到源代码仓库。按照[“AWS
    CLI 的身份验证和访问凭证”](https://oreil.ly/HAXYD)中的说明来配置你的 AWS CLI。
- en: 'Once you have followed the instructions for configuring your credentials, verify
    them by entering this command:'
  id: totrans-177
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦你完成了配置凭证的说明，请通过输入以下命令来验证它们：
- en: '[PRE14]'
  id: totrans-178
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: 'You should receive a response in the following format:'
  id: totrans-179
  prefs: []
  type: TYPE_NORMAL
  zh: 你应该会收到以下格式的响应：
- en: '[PRE15]'
  id: totrans-180
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: Pushing Your Container Image to Lightsail
  id: totrans-181
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 将你的容器镜像推送到 Lightsail
- en: Next, you will use the AWS CLI to push a container image to Lightsail. If you
    run into any issues during these instructions, additional information is available
    on the [“Push, view, and delete container images for a Lightsail container service”
    page](https://oreil.ly/lJ0wX).
  id: totrans-182
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，你将使用 AWS CLI 将容器镜像推送到 Lightsail。如果在执行这些说明时遇到任何问题，可以在[“推送、查看和删除 Lightsail
    容器服务的容器镜像”页面](https://oreil.ly/lJ0wX)找到更多信息。
- en: 'To verify that your Docker images are still in your local repository where
    you built them in the previous sections of this chapter, enter the following:'
  id: totrans-183
  prefs: []
  type: TYPE_NORMAL
  zh: 为了验证你的 Docker 镜像是否仍然在你之前章节中构建的本地仓库中，请输入以下命令：
- en: '[PRE16]'
  id: totrans-184
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: 'You will push an image from this local Docker repository to Lightsail. Take
    a moment to understand some of the values you will populate:'
  id: totrans-185
  prefs: []
  type: TYPE_NORMAL
  zh: 你将从本地的 Docker 仓库推送一个镜像到 Lightsail。花点时间理解你将要填写的一些值：
- en: '`Region`'
  id: totrans-186
  prefs: []
  type: TYPE_NORMAL
  zh: '`区域`'
- en: This is the AWS region where you set up the Lightsail service.
  id: totrans-187
  prefs: []
  type: TYPE_NORMAL
  zh: 这是你设置 Lightsail 服务的 AWS 区域。
- en: '`ContainerServiceName`'
  id: totrans-188
  prefs: []
  type: TYPE_NORMAL
  zh: '`容器服务名称`'
- en: This should be `aws-api-container` if you set up the Lightsail service correctly
    in the previous steps.
  id: totrans-189
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你在前面的步骤中正确设置了 Lightsail 服务，这应该是 `aws-api-container`。
- en: '`LocalContainerImageName:ImageTag`'
  id: totrans-190
  prefs: []
  type: TYPE_NORMAL
  zh: '`LocalContainerImageName:ImageTag`'
- en: This is the name and tag from your local repository. In the preceding example,
    the value would be `apicontainerimage:latest`.
  id: totrans-191
  prefs: []
  type: TYPE_NORMAL
  zh: 这是你的本地存储库中的名称和标签。在前面的示例中，值将是`apicontainerimage:latest`。
- en: 'Enter the following command in the terminal, replacing the values in brackets
    with your information:'
  id: totrans-192
  prefs: []
  type: TYPE_NORMAL
  zh: 在终端中输入以下命令，用括号中的值替换你的信息：
- en: '[PRE17]'
  id: totrans-193
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: Note
  id: totrans-194
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 注意
- en: These commands may wrap in this book, but you will enter them on a single line
    in the terminal.
  id: totrans-195
  prefs: []
  type: TYPE_NORMAL
  zh: 这些命令可能会在这本书中换行，但你将在终端的单行中输入它们。
- en: 'Here is an example of the command filled out completely:'
  id: totrans-196
  prefs: []
  type: TYPE_NORMAL
  zh: 这里是一个完整填写命令的示例：
- en: '[PRE18]'
  id: totrans-197
  prefs: []
  type: TYPE_PRE
  zh: '[PRE18]'
- en: 'After a couple of minutes, you should see the following:'
  id: totrans-198
  prefs: []
  type: TYPE_NORMAL
  zh: 几分钟后，你应该看到以下内容：
- en: '[PRE19]'
  id: totrans-199
  prefs: []
  type: TYPE_PRE
  zh: '[PRE19]'
- en: Go back to the Lightsail console login and view the Images tab on your `aws-api-container`.
    You should see something like [Figure 6-9](#lightsail_stored_images_ch4).
  id: totrans-200
  prefs: []
  type: TYPE_NORMAL
  zh: 返回Lightsail控制台登录并查看`aws-api-container`上的镜像选项卡。你应该看到类似于[图6-9](#lightsail_stored_images_ch4)的内容。
- en: '![Lightsail stored images](assets/haad_0609.png)'
  id: totrans-201
  prefs: []
  type: TYPE_IMG
  zh: '![Lightsail存储的镜像](assets/haad_0609.png)'
- en: Figure 6-9\. Lightsail stored images page
  id: totrans-202
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图6-9\. Lightsail存储的镜像页面
- en: Creating a Lightsail Deployment
  id: totrans-203
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 创建Lightsail部署
- en: 'On the Deployments tab of the `aws-api-container` service, select “Create your
    first deployment.” Enter the following values, as shown in [Figure 6-10](#first_deployment_top):'
  id: totrans-204
  prefs: []
  type: TYPE_NORMAL
  zh: 在`aws-api-container`服务的部署选项卡上，选择“创建你的第一个部署”。输入以下值，如图6-10[图6-10](#first_deployment_top)所示：
- en: '*Container name*: Choose a unique container name. This example uses `aws-api-container-1`.'
  id: totrans-205
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*容器名称*：选择一个唯一的容器名称。此示例使用`aws-api-container-1`。'
- en: '*Image*: Choose the stored image that was pushed in the previous steps.'
  id: totrans-206
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*镜像*：选择之前步骤中推送的存储镜像。'
- en: '![Lightsail top options](assets/haad_0610.png)'
  id: totrans-207
  prefs: []
  type: TYPE_IMG
  zh: '![Lightsail顶级选项](assets/haad_0610.png)'
- en: Figure 6-10\. Deployment options (top of page)
  id: totrans-208
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图6-10\. 部署选项（页面顶部）
- en: Click “+ Add open ports” and enter a value of 80 in the port. In the Public
    Endpoint section, click the drop-down box and select the container you created.
  id: totrans-209
  prefs: []
  type: TYPE_NORMAL
  zh: 点击“+ 添加开放端口”并在端口中输入80。在公共端点部分，点击下拉框并选择你创建的容器。
- en: After these steps, the completed options should appear as shown in [Figure 6-11](#first_deployment_bottom).
  id: totrans-210
  prefs: []
  type: TYPE_NORMAL
  zh: 在这些步骤之后，完成后的选项应如图6-11[图6-11](#first_deployment_bottom)所示。
- en: '![Lightsail top options](assets/haad_0611.png)'
  id: totrans-211
  prefs: []
  type: TYPE_IMG
  zh: '![Lightsail顶级选项](assets/haad_0611.png)'
- en: Figure 6-11\. Deployment options (bottom of page)
  id: totrans-212
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图6-11\. 部署选项（页面底部）
- en: Click “Save and deploy.” Lightsail will begin deploying. After a few minutes,
    you should see a status of Active, as shown in [Figure 6-12](#lightsail_deploy_success).
  id: totrans-213
  prefs: []
  type: TYPE_NORMAL
  zh: 点击“保存并部署”。Lightsail将开始部署。几分钟后，你应该看到活动状态，如图6-12[图6-12](#lightsail_deploy_success)所示。
- en: '![Lightsail deployment success](assets/haad_0612.png)'
  id: totrans-214
  prefs: []
  type: TYPE_IMG
  zh: '![Lightsail部署成功](assets/haad_0612.png)'
- en: Figure 6-12\. Lightsail deployment success
  id: totrans-215
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图6-12\. Lightsail部署成功
- en: Your container will have a Status of Running, and a “Public domain” will be
    generated (not shown in [Figure 6-12](#lightsail_deploy_success)). This is the
    base URL for the API. To verify that your API is running, copy the value from
    the “Public domain” and paste it into a browser bar. You should see your API’s
    health check page. Congratulations, you’ve deployed your API using AWS Lightsail!
  id: totrans-216
  prefs: []
  type: TYPE_NORMAL
  zh: 你的容器将有一个运行状态，并生成一个“公共域”（在[图6-12](#lightsail_deploy_success)中未显示）。这是API的基础URL。为了验证你的API正在运行，从“公共域”中复制值并将其粘贴到浏览器栏中。你应该看到你的API的健康检查页面。恭喜你，你已经使用AWS
    Lightsail部署了你的API！
- en: Updating Your API Documentation
  id: totrans-217
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 更新你的API文档
- en: 'In [Chapter 5](ch05.html#chapter_5), you created the *README.md* file as API’s
    documentation, but you didn’t have an API address yet. Update the Public API Address
    section of the *README.md* file as follows, replacing `[*API URL*]` with your
    deployed application’s address, wherever you find it:'
  id: totrans-218
  prefs: []
  type: TYPE_NORMAL
  zh: 在[第5章](ch05.html#chapter_5)中，你创建了*README.md*文件作为API的文档，但你还没有API地址。按照以下方式更新*README.md*文件的公共API地址部分，将`[*API
    URL*]`替换为你的部署应用的地址，无论你在哪里找到它：
- en: '[PRE20]'
  id: totrans-219
  prefs: []
  type: TYPE_PRE
  zh: '[PRE20]'
- en: Additional Resources
  id: totrans-220
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 其他资源
- en: The [Docker website](https://oreil.ly/6AyzJ) provides a deep dive into the concepts
    around Docker containers.
  id: totrans-221
  prefs: []
  type: TYPE_NORMAL
  zh: '[Docker网站](https://oreil.ly/6AyzJ)提供了关于Docker容器概念的深入探讨。'
- en: For best practices on containerizing Python, take a look at [“Best practices
    for containerizing Python applications with Docker” from Snyk.io](https://oreil.ly/1SYWr).
  id: totrans-222
  prefs: []
  type: TYPE_NORMAL
  zh: 对于Python容器化的最佳实践，请参阅Snyk.io的“使用Docker容器化Python应用程序的最佳实践”。
- en: Summary
  id: totrans-223
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 摘要
- en: 'In this chapter, you learned the benefits and responsibilities of using cloud
    hosting platforms to deploy your API. You now have experience in deploying your
    application in several different ways:'
  id: totrans-224
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，你学习了使用云托管平台部署API的好处和责任。你现在有几种不同方式部署应用程序的经验：
- en: In a local development environment or GitHub Codespaces environment
  id: totrans-225
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在本地开发环境或GitHub Codespaces环境中
- en: In a Docker container in a local development environment or GitHub Codespaces
    environment
  id: totrans-226
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在本地开发环境或GitHub Codespaces环境中的Docker容器内
- en: On the Render cloud host
  id: totrans-227
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在Render云主机上
- en: On AWS using Amazon Lightsail and Docker
  id: totrans-228
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在AWS上使用Amazon Lightsail和Docker
- en: In [Chapter 7](ch07.html#chapter_7), you will create an SDK to make your API
    easier to use for Python developers.
  id: totrans-229
  prefs: []
  type: TYPE_NORMAL
  zh: 在[第7章](ch07.html#chapter_7)，你将创建一个SDK，使Python开发者更容易使用你的API。
