- en: 7 Assembling and using an agent platform
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 7 组装和使用代理平台
- en: This chapter covers
  id: totrans-1
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 本章涵盖
- en: Nexus chat and dashboard interface for AI agents
  id: totrans-2
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Nexus聊天和仪表板界面用于AI代理
- en: Streamlit framework for building intelligent dashboards, prototypes, and AI
    chat apps
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 用于构建智能仪表板、原型和AI聊天应用的Streamlit框架
- en: Developing, testing, and engaging agent profiles and personas in Nexus
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在Nexus中开发、测试和参与代理配置文件和角色
- en: Developing the base Nexus agent
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 开发基础Nexus代理
- en: Developing, testing, and engaging agent actions and tools alone or within Nexus
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 独立或在内置Nexus中开发、测试和参与代理行为和工具
- en: After we explored some basic concepts about agents and looked at using actions
    with tools to build prompts and personas using frameworks such as the Semantic
    Kernel (SK), we took the first steps toward building a foundation for this book.
    That foundation is called Nexus, an agent platform designed to be simple to learn,
    easy to explore, and powerful enough to build your agent systems.
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: 在我们探索了一些关于代理的基本概念并查看使用工具通过框架如语义内核（SK）构建提示和角色之后，我们迈出了构建本书基础的第一步。这个基础被称为Nexus，这是一个旨在易于学习、易于探索且足够强大以构建您的代理系统的代理平台。
- en: 7.1 Introducing Nexus, not just another agent platform
  id: totrans-8
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 7.1 介绍Nexus，不仅仅是另一个代理平台
- en: There are more than 100 AI platforms and toolkits for consuming and developing
    large language model (LLM) applications, ranging from toolkits such as SK or LangChain
    to complete platforms such as AutoGen and CrewAI. This makes it difficult to decide
    which platform is well suited to building your own AI agents.
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: 有超过100个AI平台和工具包用于消费和开发大型语言模型（LLM）应用，从SK或LangChain这样的工具包到AutoGen和CrewAI这样的完整平台。这使得决定哪个平台最适合构建自己的AI代理变得困难。
- en: 'Nexus is an open source platform developed with this book to teach the core
    concepts of building full-featured AI agents. In this chapter, we’ll examine how
    Nexus is built and introduce two primary agent components: profiles/personas and
    actions/tools.'
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: Nexus是一个开源平台，与本书一起开发，用于教授构建全功能AI代理的核心概念。在本章中，我们将检查Nexus是如何构建的，并介绍两个主要代理组件：配置文件/角色和行为/工具。
- en: Figure 7.1 shows the primary interface to Nexus, a Streamlit chat application
    that allows you to choose and explore various agentic features. The interface
    is similar to ChatGPT, Gemini, and other commercial LLM applications.
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 图7.1显示了Nexus的主要界面，这是一个Streamlit聊天应用，允许您选择和探索各种代理功能。界面类似于ChatGPT、Gemini和其他商业LLM应用。
- en: '![figure](../Images/7-1.png)'
  id: totrans-12
  prefs: []
  type: TYPE_IMG
  zh: '![figure](../Images/7-1.png)'
- en: Figure 7.1 The Nexus interface and features
  id: totrans-13
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图7.1 Nexus界面和功能
- en: 'In addition to the standard features of an LLM chat application, Nexus allows
    the user to configure an agent to use a specific API/model, the persona, and possible
    actions. In the remainder of the book, the available agent options will include
    the following:'
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 除了LLM聊天应用的标准功能外，Nexus允许用户配置一个代理来使用特定的API/模型、角色和可能的行为。本书的剩余部分，可用的代理选项将包括以下内容：
- en: '*Personas/profiles*—The primary persona and profile the agent will use. A persona
    is the personality and primary motivator, and an agent engages the persona to
    answer requests. We’ll look in this chapter at how personas/profiles can be developed
    and consumed.'
  id: totrans-15
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*角色/配置文件* — 代理将使用的主要角色和配置文件。角色是性格和主要动机，代理通过角色来回答请求。在本章中，我们将探讨角色/配置文件的开发和消费方式。'
- en: '*Actions/tools*—Represents the actions an agent can take using tools, whether
    they’re semantic/prompt or native/code functions. In this chapter, we’ll look
    at how to build both semantic and native functions within Nexus.'
  id: totrans-16
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*行为/工具* — 表示代理可以使用工具执行的动作，无论是语义/提示还是本地/代码函数。在本章中，我们将探讨如何在Nexus中构建语义和本地函数。'
- en: '*Knowledge/memory —*Represents additional information an agent may have access
    to. At the same time, agent memory can represent various aspects, from short-term
    to semantic memory.'
  id: totrans-17
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*知识/记忆* — 表示代理可能访问的附加信息。同时，代理记忆可以代表从短期到语义记忆的各个方面。'
- en: '*Planning/feedback —*Represents how the agent plans and receives feedback on
    the plans or the execution of plans. Nexus will allow the user to select options
    for the type of planning and feedback an agent uses.'
  id: totrans-18
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*规划/反馈* — 表示代理如何规划并接收关于计划或计划执行的反馈。Nexus将允许用户选择代理使用的规划类型和反馈选项。'
- en: As we progress through this book, Nexus will be added to support new agent features.
    However, simultaneously, the intent will be to keep things relatively simple to
    teach many of these essential core concepts. In the next section, we’ll look at
    how to quickly use Nexus before going under the hood to explore features in detail.
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: 随着我们继续阅读本书，Nexus 将被添加以支持新的代理功能。然而，同时，我们的目标是保持事情相对简单，以便教授许多这些基本核心概念。在下一节中，我们将探讨如何快速使用
    Nexus，然后再深入了解其功能。
- en: 7.1.1 Running Nexus
  id: totrans-20
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 7.1.1 运行 Nexus
- en: Nexus is primarily intended to be a teaching platform for all levels of developers.
    As such, it will support various deployment and usage options. In the next exercise,
    we’ll introduce how to get up and running with Nexus quickly.
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: Nexus 主要旨在成为所有级别开发者的教学平台。因此，它将支持各种部署和使用选项。在下一项练习中，我们将介绍如何快速启动 Nexus。
- en: Open a terminal to a new Python virtual environment (version 3.10). If you need
    assistance creating one, refer to appendix B. Then, execute the commands shown
    in listing 7.1 within this new environment. You can either set the environment
    variable at the command line or create a new `.env` file and add the setting.
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: 在一个新的 Python 虚拟环境（版本 3.10）中打开一个终端。如果您需要创建一个的协助，请参阅附录 B。然后，在此新环境中执行列表 7.1 中显示的命令。您可以在命令行中设置环境变量或创建一个新的
    `.env` 文件并添加设置。
- en: Listing 7.1 Terminal command line
  id: totrans-23
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 列表 7.1 终端命令行
- en: '[PRE0]'
  id: totrans-24
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: '#1 Installs the package directly from the repository and branch; be sure to
    include the branch.'
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: '#1 直接从仓库和分支安装包；务必包含分支。'
- en: '#2 Creates the key as an environment variable or creates a new .env file with
    the setting'
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: '#2 将密钥作为环境变量创建，或创建一个新的 .env 文件并设置该配置'
- en: '#3 Runs the application'
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: '#3 运行应用程序'
- en: After entering the last command, a website will launch with a login page, as
    shown in figure 7.2\. Go ahead and create a new user. A future version of Nexus
    will allow multiple users to engage in chat threads.
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: 在输入最后一个命令后，将启动一个带有登录页面的网站，如图 7.2 所示。请继续创建一个新用户。Nexus 的未来版本将允许多个用户参与聊天线程。
- en: '![figure](../Images/7-2.png)'
  id: totrans-29
  prefs: []
  type: TYPE_IMG
  zh: '![图片](../Images/7-2.png)'
- en: Figure 7.2 Logging in or creating a new Nexus user
  id: totrans-30
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图 7.2 登录或创建新的 Nexus 用户
- en: After you log in, you’ll see a page like figure 7.1\. Create a new chat and
    start conversing with an agent. If you encounter a problem, be sure you have the
    API key set properly. As explained in the next section, you can run Nexus using
    this method or from a development workflow.
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: 登录后，您将看到一个类似于图 7.1 的页面。创建一个新的聊天并与代理开始对话。如果您遇到问题，请确保您已正确设置 API 密钥。正如下一节所解释的，您可以使用此方法或从开发工作流程中运行
    Nexus。
- en: 7.1.2 Developing Nexus
  id: totrans-32
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 7.1.2 开发 Nexus
- en: While working through the exercises of this book, you’ll want to set up Nexus
    in development mode. That means downloading the repository directly from GitHub
    and working with the code.
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: 在完成本书的练习时，您可能希望以开发模式设置 Nexus。这意味着直接从 GitHub 下载仓库并处理代码。
- en: Open a new terminal, and set your working directory to the `chapter_7` source
    code folder. Then, set up a new Python virtual environment (version 3.10) and
    enter the commands shown in listing 7.2\. Again, refer to appendix B if you need
    assistance with any previous setup.
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: 打开一个新的终端，并将工作目录设置为 `chapter_7` 源代码文件夹。然后，设置一个新的 Python 虚拟环境（版本 3.10）并输入列表 7.2
    中显示的命令。再次，如果您需要任何先前设置的协助，请参阅附录 B。
- en: Listing 7.2 Installing Nexus for development
  id: totrans-35
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 列表 7.2 安装 Nexus 以进行开发
- en: '[PRE1]'
  id: totrans-36
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: '#1 Downloads and installs the specific branch from the repository'
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: '#1 从仓库下载并安装特定的分支'
- en: '#2 Installs the downloaded repository as an editable package'
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: '#2 将下载的仓库作为可编辑的包安装'
- en: '#3 Sets your OpenAI key as an environment variable or adds it to an .env file'
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: '#3 将您的 OpenAI 密钥作为环境变量设置或添加到 .env 文件中'
- en: '#4 Starts the application'
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: '#4 启动应用程序'
- en: Figure 7.3 shows the Login or Create New User screen. Create a new user, and
    the application will log you in. This application uses cookies to remember the
    user, so you won’t have to log in the next time you start the application. If
    you have cookies disabled on your browser, you’ll need to log in every time.
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: 图 7.3 显示了登录或创建新用户界面。创建一个新用户，应用程序将自动为您登录。此应用程序使用 cookies 来记住用户，因此您下次启动应用程序时无需登录。如果您在浏览器中禁用了
    cookies，您将需要每次都登录。
- en: '![figure](../Images/7-3.png)'
  id: totrans-42
  prefs: []
  type: TYPE_IMG
  zh: '![图片](../Images/7-3.png)'
- en: Figure 7.3 The Login or Create New User page
  id: totrans-43
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图 7.3 登录或创建新用户页面
- en: Go to the Nexus repository folder and look around. Figure 7.4 shows an architecture
    diagram of the application’s main elements. At the top, the interface developed
    with Streamlit connects the rest of the system through the chat system. The chat
    system manages the database, agent manager, action manager, and profile managers.
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: 前往 Nexus 仓库文件夹并四处查看。图 7.4 显示了应用程序主要元素的架构图。在顶部，使用 Streamlit 开发的界面通过聊天系统连接到系统的其余部分。聊天系统管理数据库、代理管理器、动作管理器和配置文件管理器。
- en: '![figure](../Images/7-4.png)'
  id: totrans-45
  prefs: []
  type: TYPE_IMG
  zh: '![图](../Images/7-4.png)'
- en: Figure 7.4 A high-level architecture diagram of the main elements of the application
  id: totrans-46
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图 7.4 应用程序主要元素的高级架构图
- en: This agent platform is written entirely in Python, and the web interface uses
    Streamlit. In the next section, we look at how to build an OpenAI LLM chat application.
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: 此代理平台完全用 Python 编写，网页界面使用 Streamlit。在下一节中，我们将探讨如何构建 OpenAI LLM 聊天应用。
- en: 7.2 Introducing Streamlit for chat application development
  id: totrans-48
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 7.2 介绍 Streamlit 用于聊天应用开发
- en: Streamlit is a quick and powerful web interface prototyping tool designed to
    be used for building machine learning dashboards and concepts. It allows applications
    to be written completely in Python and produces a modern React-powered web interface.
    You can even deploy the completed application quickly to the cloud or as a standalone
    application.
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: Streamlit 是一个快速且强大的网页界面原型设计工具，旨在用于构建机器学习仪表板和概念。它允许应用程序完全使用 Python 编写，并生成一个由现代
    React 驱动的网页界面。你甚至可以快速将完成的应用部署到云端或作为独立应用程序。
- en: 7.2.1 Building a Streamlit chat application
  id: totrans-50
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 7.2.1 构建 Streamlit 聊天应用
- en: Begin by opening Visual Studio Code (VS Code) to the `chapter_07` source folder.
    If you’ve completed the previous exercise, you should already be ready. As always,
    if you need assistance setting up your environment and tools, refer to appendix
    B.
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: 开始时，打开 Visual Studio Code（VS Code）到 `chapter_07` 源文件夹。如果你已经完成了前面的练习，你应该已经准备好了。一如既往地，如果你需要帮助设置环境和工具，请参阅附录
    B。
- en: We’ll start by opening the `chatgpt_clone_response.py` file in VS Code. The
    top section of the code is shown in listing 7.3\. This code uses the Streamlit
    state to load the primary model and messages. Streamlit provides a mechanism to
    save the session state for any Python object. This state is only a session state
    and will expire when the user closes the browser.
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: 我们首先在 VS Code 中打开 `ChatGPT_clone_response.py` 文件。代码的顶部部分如列表 7.3 所示。此代码使用 Streamlit
    状态来加载主模型和消息。Streamlit 提供了一种机制来保存任何 Python 对象的会话状态。这个状态仅是会话状态，当用户关闭浏览器时将过期。
- en: Listing 7.3 `chatgpt_clone_response.py` (top section)
  id: totrans-53
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 列表 7.3 `ChatGPT_clone_response.py`（顶部部分）
- en: '[PRE2]'
  id: totrans-54
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: '#1 Loads the environment variables from the .env file'
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: '#1 从 .env 文件中加载环境变量'
- en: '#2 Configures the OpenAI client'
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: '#2 配置 OpenAI 客户端'
- en: '#3 Checks the internal session state for the setting, and adds it if not there'
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: '#3 检查内部会话状态中的设置，如果不存在则添加'
- en: '#4 Checks for the presence of the message state; if none, adds an empty list'
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: '#4 检查消息状态是否存在；如果不存在，则添加一个空列表'
- en: '#5 Loops through messages in the state and displays them'
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: '#5 遍历状态中的消息并显示它们'
- en: The Streamlit app itself is stateless. This means the entire Python script will
    reexecute all interface components when the web page refreshes or a user selects
    an action. The Streamlit state allows for a temporary storage mechanism. Of course,
    a database needs to support more long-term storage.
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: Streamlit 应用本身是无状态的。这意味着当网页刷新或用户选择操作时，整个 Python 脚本将重新执行所有界面组件。Streamlit 状态允许临时存储机制。当然，数据库需要支持更长期的存储。
- en: UI controls and components are added by using the `st.` prefix and then the
    element name. Streamlit supports several standard UI controls and supports images,
    video, sound, and, of course, chat.
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: 通过使用 `st.` 前缀然后是元素名称来添加 UI 控制和组件。Streamlit 支持多个标准 UI 控制并支持图片、视频、声音，当然还有聊天。
- en: 'Scrolling down further will yield listing 7.4, which has a slightly more complex
    layout of the components. The main `if` statement controls the running of the
    remaining code. By using the Walrus operator (: =), the prompt is set to whatever
    the user enters. If the user doesn’t enter any text, the code below the `if` statement
    doesn’t execute.'
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: 向下滚动将进一步显示列表 7.4，它具有稍微复杂一点的组件布局。主要的 `if` 语句控制剩余代码的运行。通过使用 Walrus 操作符（:=），提示信息被设置为用户输入的内容。如果用户没有输入任何文本，则
    `if` 语句下面的代码不会执行。
- en: Listing 7.4 `chatgpt_clone_response.py` (bottom section)
  id: totrans-63
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 列表 7.4 `ChatGPT_clone_response.py`（底部部分）
- en: '[PRE3]'
  id: totrans-64
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: '#1 The chat input control is rendered, and content is set.'
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: '#1 渲染聊天输入控件并设置内容。'
- en: '#2 Sets the chat message control to output as the user'
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: '#2 将聊天消息控制设置为用户输出'
- en: '#3 Shows a spinner to represent the long-running API call'
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: '#3 显示一个旋转器来表示长时间运行的 API 调用'
- en: '#4 Calls the OpenAI API and sets the message history'
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: '#4 调用 OpenAI API 并设置消息历史'
- en: '#5 Writes the message response as markdown to the interface'
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: '#5 将消息响应以 Markdown 格式写入界面'
- en: '#6 Adds the assistant response to the message state'
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: '#6 将助手响应添加到消息状态'
- en: When the user enters text in the prompt and presses Enter, that text is added
    to the message state, and a request is made to the API. As the response is being
    processed, the `st.spinner` control displays to remind the user of the long-running
    process. Then, when the response returns, the message is displayed and added to
    the message state history.
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: 当用户在提示中输入文本并按 Enter 键时，该文本将被添加到消息状态，并向 API 发出请求。在响应被处理时，`st.spinner` 控件会显示，以提醒用户长时间运行的过程。然后，当响应返回时，消息会显示并添加到消息状态历史中。
- en: 'Streamlit apps are run using the module, and to debug applications, you need
    to attach the debugger to the module by following these steps:'
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: Streamlit 应用程序使用模块运行，要调试应用程序，您需要按照以下步骤将调试器附加到模块：
- en: Press Ctrl-Shift-D to open the VS Code debugger.
  id: totrans-73
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 按 Ctrl-Shift-D 打开 VS Code 调试器。
- en: Click the link to create a new launch configuration, or click the gear icon
    to show the current one.
  id: totrans-74
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击链接创建新的启动配置，或点击齿轮图标显示当前配置。
- en: Edit or use the debugger configuration tools to edit the `.vscode/launch.json`
    file, like the one shown in the next listing. Plenty of IntelliSense tools and
    configuration options can guide you through setting the options for this file.
  id: totrans-75
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用调试器配置工具编辑 `.vscode/launch.json` 文件，例如下一段代码所示。IntelliSense 工具和配置选项众多，可引导您设置此文件的选项。
- en: Listing 7.5 `.vscode/launch.json`
  id: totrans-76
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 列表 7.5 `.vscode/launch.json`
- en: '[PRE4]'
  id: totrans-77
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: '#1 Make sure that the debugger is set to Module.'
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: '#1 确保调试器设置为模块。'
- en: '#2 Be sure the module is streamlit.'
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: '#2 确保模块是 streamlit。'
- en: '#3 The ${file} is the current file, or you can hardcode this to a file path.'
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: '#3 ${file} 是当前文件，或者您可以将它硬编码为文件路径。'
- en: After you have the `launch.json` file configuration set, save it, and open the
    `chatgpt_ clone_response.py` file in VS Code. You can now run the application
    in debug mode by pressing F5\. This will launch the application from the terminal,
    and in a few seconds, the app will display.
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: 在您设置好 `launch.json` 文件配置后，保存它，并在 VS Code 中打开 `ChatGPT_ clone_response.py` 文件。现在，您可以通过按
    F5 以调试模式运行应用程序。这将从终端启动应用程序，几秒钟后应用程序将显示。
- en: Figure 7.5 shows the app running and waiting to return a response. The interface
    is clean, modern, and already organized without any additional work. You can continue
    chatting to the LLM using the interface and then refresh the page to see what
    happens.
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: 图 7.5 显示应用程序正在运行并等待返回响应。界面简洁、现代，并且已经组织得很好，无需额外工作。您可以使用界面继续与 LLM 进行聊天，然后刷新页面以查看发生了什么。
- en: '![figure](../Images/7-5.png)'
  id: totrans-83
  prefs: []
  type: TYPE_IMG
  zh: '![图片](../Images/7-5.png)'
- en: Figure 7.5 The simple interface and the waiting spinner
  id: totrans-84
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图 7.5 简单的界面和等待的旋转器
- en: What is most impressive about this demonstration is how easy it is to create
    a single-page application. In the next section, we’ll continue looking at this
    application but with a few enhancements.
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: 这个演示最令人印象深刻的是创建单页应用程序的简单性。在下一节中，我们将继续探讨这个应用程序，但会添加一些增强功能。
- en: 7.2.2 Creating a streaming chat application
  id: totrans-86
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 7.2.2 创建流式聊天应用程序
- en: Modern chat applications, such as ChatGPT and Gemini, mask the slowness of their
    models by using streaming. Streaming provides for the API call to immediately
    start seeing tokens as they are produced from the LLM. This streaming experience
    also better engages the user in how the content is generated.
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: 现代聊天应用程序，如 ChatGPT 和 Gemini，通过使用流来掩盖其模型的速度慢。流允许 API 调用立即看到从 LLM 产生的标记。这种流式体验也更好地吸引用户参与内容生成过程。
- en: Adding support for streaming to any application UI is generally not a trivial
    task, but fortunately, Streamlit has a control that can work seamlessly. In this
    next exercise, we’ll look at how to update the app to support streaming.
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: 向任何应用程序 UI 添加支持流通常不是一个简单任务，但幸运的是，Streamlit 有一个可以无缝工作的控件。在接下来的练习中，我们将探讨如何更新应用程序以支持流。
- en: Open `chapter_7/chatgpt_clone_streaming.py` in VS Code. The relevant updates
    to the code are shown in listing 7.6\. Using the `st.write_stream` control allows
    the UI to stream content. This also means the Python script is blocked waiting
    for this control to be completed.
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: 在VS Code中打开`chapter_7/ChatGPT_clone_streaming.py`。代码的相关更新显示在列表7.6中。使用`st.write_stream`控件允许UI流式传输内容。这也意味着Python脚本在等待此控件完成时会被阻塞。
- en: Listing 7.6 `chatgpt_clone_streaming.py` (relevant section)
  id: totrans-90
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 列表7.6 `ChatGPT_clone_streaming.py`（相关部分）
- en: '[PRE5]'
  id: totrans-91
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: '#1 Sets stream to True to initiate streaming on the API'
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
  zh: '#1 将流设置为True以在API上启动流'
- en: '#2 Uses the stream control to write the stream to the interface'
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: '#2 使用流控件将流写入界面'
- en: '#3 Adds the response to the message state history after the stream completes'
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: '#3 在流完成后将响应添加到消息状态历史记录中'
- en: Debug the page by pressing F5 and waiting for the page to load. Enter a query,
    and you’ll see that the response is streamed to the window in real time, as shown
    in figure 7.6\. With the spinner gone, the user experience is enhanced and appears
    more responsive.
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: 通过按F5键并等待页面加载来调试页面。输入一个查询，你会看到响应实时流出到窗口中，如图7.6所示。随着旋转器的消失，用户体验得到提升，看起来更加响应。
- en: '![figure](../Images/7-6.png)'
  id: totrans-96
  prefs: []
  type: TYPE_IMG
  zh: '![figure](../Images/7-6.png)'
- en: Figure 7.6 The updated interface with streaming of the text response
  id: totrans-97
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图7.6 更新后的界面，带有文本响应的流
- en: This section demonstrated how relatively simple it can be to use Streamlit to
    create a Python web interface. Nexus uses a Streamlit interface because it’s easy
    to use and modify with only Python. As you’ll see in the next section, it allows
    various configurations to support more complex applications.
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: 本节展示了使用Streamlit创建Python网络界面的相对简单性。Nexus使用Streamlit界面，因为它仅使用Python就易于使用和修改。正如你将在下一节中看到的，它允许各种配置以支持更复杂的应用程序。
- en: 7.3 Developing profiles and personas for agents
  id: totrans-99
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 7.3 为代理开发配置文件和角色
- en: Nexus uses agent profiles to describe an agent’s functions and capabilities.
    Figure 7.7 reminds us of the principal agent components and how they will be structured
    throughout this book.
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
  zh: Nexus使用代理配置文件来描述代理的功能和能力。图7.7提醒我们主要代理组件及其在本书中如何结构化。
- en: '![figure](../Images/7-7.png)'
  id: totrans-101
  prefs: []
  type: TYPE_IMG
  zh: '![figure](../Images/7-7.png)'
- en: Figure 7.7 The agent profile as it’s mapped to the YAML file definition
  id: totrans-102
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图7.7 代理配置文件映射到YAML文件定义
- en: For now, as of this writing, Nexus only supports the persona and actions section
    of the profile. Figure 7.7 shows a profile called Fritz, along with the persona
    and actions. Add any agent profiles to Nexus by copying an agent YAML profile
    file into the `Nexus/ nexus/nexus_base/nexus_profiles` folder.
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: 目前为止，Nexus仅支持配置文件的角色和动作部分。图7.7显示了一个名为Fritz的配置文件，以及角色和动作。通过将代理YAML配置文件复制到`Nexus/nexus/nexus_base/nexus_profiles`文件夹中，将任何代理配置文件添加到Nexus中。
- en: Nexus uses a plugin system to dynamically discover the various components and
    profiles as they are placed into their respective folders. The `nexus_profiles`
    folder holds the YAML definitions for the agent.
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: Nexus使用插件系统动态发现各种组件和配置文件，当它们被放置到各自的文件夹中。`nexus_profiles`文件夹包含代理的YAML定义。
- en: We can easily define a new agent profile by creating a new YAML file in the
    `nexus_ profiles` folder. Listing 7.7 shows an example of a new profile with a
    slightly updated persona. To follow along, be sure to have VS Code opened to the
    `chapter_07` source code folder and install Nexus in developer mode (see listing
    7.7). Then, create the `fiona.yaml` file in the `Nexus/nexus/nexus_base/nexus_profiles`
    folder.
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以轻松地通过在`nexus_profiles`文件夹中创建一个新的YAML文件来定义一个新的代理配置文件。列表7.7显示了一个带有略微更新角色的新配置文件示例。为了跟上，请确保VS
    Code已打开到`chapter_07`源代码文件夹，并在开发者模式下安装Nexus（见列表7.7）。然后，在`Nexus/nexus/nexus_base/nexus_profiles`文件夹中创建`fiona.yaml`文件。
- en: Listing 7.7 `fiona.yaml` (create this file)
  id: totrans-106
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 列表7.7 `fiona.yaml`（创建此文件）
- en: '[PRE6]'
  id: totrans-107
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: '#1 The text avatar used to represent the persona'
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: '#1 用于表示角色的文本头像'
- en: '#2 A persona is representative of the base system prompt.'
  id: totrans-109
  prefs: []
  type: TYPE_NORMAL
  zh: '#2 一个角色代表基础系统提示。'
- en: '#3 An action function the agent can use'
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
  zh: '#3 代理可以使用的动作函数'
- en: '#4 Not currently supported'
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: '#4 目前不支持'
- en: After saving the file, you can start Nexus from the command line or run it in
    debug mode by creating a new launch configuration in the `.vscode/launch.json`
    folder, as shown in the next listing. Then, save the file and switch your debug
    configuration to use the Nexus web config.
  id: totrans-112
  prefs: []
  type: TYPE_NORMAL
  zh: 保存文件后，您可以从命令行启动Nexus或以调试模式运行它，通过在`.vscode/launch.json`文件夹中创建一个新的启动配置来实现，如下一列表所示。然后，保存文件并将您的调试配置切换到使用Nexus网络配置。
- en: Listing 7.8 `.vscode/launch.json` (adding debug launch)
  id: totrans-113
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 列表7.8 `.vscode/launch.json`（添加调试启动）
- en: '[PRE7]'
  id: totrans-114
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: '#1 You may have to adjust this path if your virtual environment is different.'
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
  zh: '#1 如果你的虚拟环境不同，你可能需要调整此路径。'
- en: When you press F5 or select Run > Start Debugging from the menu, the Streamlit
    Nexus interface will launch. Go ahead and run Nexus in debug mode. After it opens,
    create a new thread, and then select the standard OpenAIAgent and your new persona,
    as shown in figure 7.8.
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: 当你按下 F5 或从菜单中选择运行 > 开始调试时，Streamlit Nexus 界面将启动。请继续以调试模式运行 Nexus。打开后，创建一个新的线程，然后选择标准
    OpenAIAgent 和你的新角色，如图 7.8 所示。
- en: '![figure](../Images/7-8.png)'
  id: totrans-117
  prefs: []
  type: TYPE_IMG
  zh: '![图](../Images/7-8.png)'
- en: Figure 7.8 Selecting and chatting with a new persona
  id: totrans-118
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图 7.8 选择并与新角色聊天
- en: At this point, the profile is responsible for defining the agent’s system prompt.
    You can see this in figure 7.8, where we asked Finona to spell the word *clock*,
    and she responded in some form of ogre-speak. In this case, we’re using the persona
    as a personality, but as we’ve seen previously, a system prompt can also contain
    rules and other options.
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
  zh: 到目前为止，配置文件负责定义代理的系统提示。你可以在图 7.8 中看到这一点，我们要求 Finona 拼写单词 *clock*，她以某种形式的 ogre-speak
    进行回应。在这种情况下，我们使用角色作为个性，但正如我们之前看到的，系统提示也可以包含规则和其他选项。
- en: The profile and persona are the base definitions for how the agent interacts
    with users or other systems. Powering the profile requires an agent engine. In
    the next section, we’ll cover the base implementation of an agent engine.
  id: totrans-120
  prefs: []
  type: TYPE_NORMAL
  zh: 配置文件和角色是代理与用户或其他系统交互的基础定义。为配置文件提供动力需要一个代理引擎。在下一节中，我们将介绍代理引擎的基础实现。
- en: 7.4 Powering the agent and understanding the agent engine
  id: totrans-121
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 7.4 为代理提供动力并理解代理引擎
- en: Agent engines power agents within Nexus. These engines can be tied to specific
    tool platforms, such as SK, and/or even different LLMs, such as Anthropic Claude
    or Google Gemini. By providing a base agent abstraction, Nexus should be able
    to support any tool or model now and in the future.
  id: totrans-122
  prefs: []
  type: TYPE_NORMAL
  zh: 代理引擎为 Nexus 内的代理提供动力。这些引擎可以与特定的工具平台相关联，例如 SK，以及/或不同的 LLM，例如 Anthropic Claude
    或 Google Gemini。通过提供基础代理抽象，Nexus 应该能够支持现在和未来的任何工具或模型。
- en: Currently, Nexus only implements an OpenAI API–powered agent. We’ll look at
    how the base agent is defined by opening the `agent_manager.py` file from the
    `Nexus/ nexus/nexus_base` folder.
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
  zh: 目前，Nexus 仅实现了一个由 OpenAI API 提供动力的代理。我们将通过打开 `Nexus/ nexus/nexus_base` 文件夹中的
    `agent_manager.py` 文件来查看基础代理是如何定义的。
- en: Listing 7.9 shows the `BaseAgent` class functions. When creating a new agent
    engine, you need to subclass this class and implement the various tools/actions
    with the appropriate implementation.
  id: totrans-124
  prefs: []
  type: TYPE_NORMAL
  zh: 列表 7.9 展示了 `BaseAgent` 类函数。在创建新的代理引擎时，你需要继承这个类并使用适当的实现来实现各种工具/操作。
- en: Listing 7.9 `agent_manager.py:BaseAgent`
  id: totrans-125
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 列表 7.9 `agent_manager.py:BaseAgent`
- en: '[PRE8]'
  id: totrans-126
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: '#1 Calls the LLM and returns a response'
  id: totrans-127
  prefs: []
  type: TYPE_NORMAL
  zh: '#1 调用 LLM 并返回响应'
- en: '#2 Executes a semantic function'
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
  zh: '#2 执行语义函数'
- en: '#3 Calls the LLM and returns a response'
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
  zh: '#3 调用 LLM 并返回响应'
- en: '#4 Appends a message to the agent’s internal chat history'
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: '#4 将消息追加到代理的内部聊天历史中'
- en: '#5 Loads the chat history and allows the agent to reload various histories'
  id: totrans-131
  prefs: []
  type: TYPE_NORMAL
  zh: '#5 加载聊天历史并允许代理重新加载各种历史'
- en: '#6 Loads the actions that the agent has available to use'
  id: totrans-132
  prefs: []
  type: TYPE_NORMAL
  zh: '#6 加载代理可用的操作'
- en: Open the `nexus_agents/oai_agent.py` file in VS Code. Listing 7.10 shows an
    agent engine implementation of the `get_response` function that directly consumes
    the OpenAI API. `self.client` is an OpenAI client created earlier during class
    initialization, and the rest of the code you’ve seen used in earlier examples.
  id: totrans-133
  prefs: []
  type: TYPE_NORMAL
  zh: 在 VS Code 中打开 `nexus_agents/oai_agent.py` 文件。列表 7.10 展示了一个直接使用 OpenAI API 的代理引擎
    `get_response` 函数的实现。`self.client` 是在类初始化期间创建的 OpenAI 客户端，其余的代码你在之前的示例中已经见过。
- en: Listing 7.10 `oai_agent.py` (`get_response`)
  id: totrans-134
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 列表 7.10 `oai_agent.py` (`get_response`)
- en: '[PRE9]'
  id: totrans-135
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: '#1 Adds the user_input to the message stack'
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: '#1 将用户输入添加到消息栈中'
- en: '#2 The client was created earlier and is now used to create chat completions.'
  id: totrans-137
  prefs: []
  type: TYPE_NORMAL
  zh: '#2 客户端之前已创建，现在用于创建聊天补全。'
- en: '#3 Temperature is hardcoded but could be configured.'
  id: totrans-138
  prefs: []
  type: TYPE_NORMAL
  zh: '#3 温度值是硬编码的，但可以进行配置。'
- en: '#4 Returns the response from the chat completions call'
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
  zh: '#4 从聊天补全调用返回响应'
- en: Like the agent profiles, Nexus uses a plugin system that allows you to place
    new agent engine definitions in the `nexus_agents` folder. If you create your
    agent, it just needs to be placed in this folder for Nexus to discover.
  id: totrans-140
  prefs: []
  type: TYPE_NORMAL
  zh: 与代理配置文件类似，Nexus 使用一个插件系统，允许你将新的代理引擎定义放置在 `nexus_agents` 文件夹中。如果你创建了你的代理，只需将其放置在这个文件夹中，Nexus
    就可以找到它。
- en: We won’t need to run an example because we’ve already seen how the OpenAIAgent
    performs. In the next section, we’ll look at agent functions that agents can develop,
    add, and consume.
  id: totrans-141
  prefs: []
  type: TYPE_NORMAL
  zh: 我们不需要运行一个示例，因为我们已经看到了 OpenAIAgent 的表现。在下一节中，我们将探讨代理可以开发、添加和消费的代理功能。
- en: 7.5 Giving an agent actions and tools
  id: totrans-142
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 7.5 给代理动作和工具
- en: Like the SK, Nexus supports having native (code) and semantic (prompt) functions.
    Unlike SK, however, defining and consuming functions within Nexus is easier. All
    you need to do is write functions into a Python file and place them into the `nexus_
    actions` folder.
  id: totrans-143
  prefs: []
  type: TYPE_NORMAL
  zh: 与 SK 一样，Nexus 支持原生（代码）和语义（提示）函数。然而，与 SK 不同的是，在 Nexus 中定义和消费函数更容易。你只需要将函数写入 Python
    文件并将它们放置在 `nexus_ actions` 文件夹中。
- en: To see how easy it is to define functions, open the `Nexus/nexus/nexus_base/
    nexus_actions` folder, and go to the `test_actions.py` file. Listing 7.11 shows
    two function definitions. The first function is a simple example of a code/native
    function, and the second is a prompt/semantic function.
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
  zh: 要看到定义函数有多容易，请打开 `Nexus/nexus/nexus_base/ nexus_actions` 文件夹，并转到 `test_actions.py`
    文件。列表 7.11 显示了两个函数定义。第一个函数是一个简单的代码/原生函数示例，第二个是一个提示/语义函数。
- en: Listing 7.11 `test_actions.py` (native/semantic function definitions)
  id: totrans-145
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 列表 7.11 `test_actions.py`（原生/语义函数定义）
- en: '[PRE10]'
  id: totrans-146
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: '#1 Applies the agent_action decorator to make a function an action'
  id: totrans-147
  prefs: []
  type: TYPE_NORMAL
  zh: '#1 将 agent_action 装饰器应用于使函数成为动作'
- en: '#2 Sets a descriptive comment for the function'
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
  zh: '#2 为函数设置描述性注释'
- en: '#3 The code can be as simple or complex as needed.'
  id: totrans-149
  prefs: []
  type: TYPE_NORMAL
  zh: '#3 代码可以简单或复杂，根据需要。'
- en: '#4 Applies the agent_action decorator to make a function an action'
  id: totrans-150
  prefs: []
  type: TYPE_NORMAL
  zh: '#4 将 agent_action 装饰器应用于使函数成为动作'
- en: '#5 The function comment becomes the prompt and can include placeholders.'
  id: totrans-151
  prefs: []
  type: TYPE_NORMAL
  zh: '#5 函数注释成为提示，并可以包含占位符。'
- en: '#6 Semantic functions don’t implement any code.'
  id: totrans-152
  prefs: []
  type: TYPE_NORMAL
  zh: '#6 语义函数不实现任何代码。'
- en: Place both functions in the `nexus_actions` folder, and they will be automatically
    discovered. Adding the `agent_action` decorator allows the functions to be inspected
    and automatically generates the OpenAI standard tool specification. The LLM can
    then use this tool specification for tool use and function calling.
  id: totrans-153
  prefs: []
  type: TYPE_NORMAL
  zh: 将这两个函数放置在 `nexus_actions` 文件夹中，它们将被自动发现。添加 `agent_action` 装饰器允许检查函数并自动生成 OpenAI
    标准工具规范。LLM 可以使用这个工具规范来进行工具使用和函数调用。
- en: Listing 7.12 shows the generated OpenAI tool specification for both functions,
    as shown previously in listing 7.11\. The semantic function, which uses a prompt,
    also applies to the tool description. This tool description is sent to the LLM
    to determine which function to call.
  id: totrans-154
  prefs: []
  type: TYPE_NORMAL
  zh: 列表 7.12 显示了为两个函数生成的 OpenAI 工具规范，如之前在列表 7.11 中所示。使用提示的语义函数也适用于工具描述。这个工具描述被发送到
    LLM 以确定调用哪个函数。
- en: 'Listing 7.12 `test_actions`: OpenAI-generated tool specifications'
  id: totrans-155
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 列表 7.12 `test_actions`：OpenAI 生成的工具规范
- en: '[PRE11]'
  id: totrans-156
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: '#1 The function comment becomes the function tool description.'
  id: totrans-157
  prefs: []
  type: TYPE_NORMAL
  zh: '#1 函数注释成为函数工具描述。'
- en: '#2 The input parameters of the function are extracted and added to the specification.'
  id: totrans-158
  prefs: []
  type: TYPE_NORMAL
  zh: '#2 函数的输入参数被提取并添加到规范中。'
- en: '#3 The function comment becomes the function tool description.'
  id: totrans-159
  prefs: []
  type: TYPE_NORMAL
  zh: '#3 函数注释成为函数工具描述。'
- en: '#4 The input parameters of the function are extracted and added to the specification.'
  id: totrans-160
  prefs: []
  type: TYPE_NORMAL
  zh: '#4 函数的输入参数被提取并添加到规范中。'
- en: The agent engine also needs to implement that capability to implement functions
    and other components. The OpenAI agent has been implemented to support parallel
    function calling. Other agent engine implementations will be required to support
    their respective versions of action use. Fortunately, the definition of the OpenAI
    tool is becoming the standard, and many platforms adhere to this standard.
  id: totrans-161
  prefs: []
  type: TYPE_NORMAL
  zh: 代理引擎还需要实现实现函数和其他组件的能力。OpenAI 代理已被实现以支持并行函数调用。其他代理引擎实现将需要支持它们各自的动作使用版本。幸运的是，OpenAI
    工具的定义正在成为标准，许多平台都遵循这个标准。
- en: Before we dive into a demo on tool use, let’s observe how the OpenAI agent implements
    actions by opening the `oai_agent.py` file in VS Code. The following listing shows
    the top of the agent’s `get_response_stream` function and its implementation of
    function calling.
  id: totrans-162
  prefs: []
  type: TYPE_NORMAL
  zh: 在我们深入到工具使用演示之前，让我们通过在 VS Code 中打开 `oai_agent.py` 文件来观察 OpenAI 代理如何实现动作。以下列表显示了代理的
    `get_response_stream` 函数的顶部及其函数调用的实现。
- en: Listing 7.13 Caling the API in `get_response_stream`
  id: totrans-163
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 列表 7.13 在 `get_response_stream` 中调用 API
- en: '[PRE12]'
  id: totrans-164
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: '#1 Detects whether the agent has any available tools turned on'
  id: totrans-165
  prefs: []
  type: TYPE_NORMAL
  zh: '#1 检测代理是否开启了任何可用的工具'
- en: '#2 Sets the tools in the chat completions call'
  id: totrans-166
  prefs: []
  type: TYPE_NORMAL
  zh: '#2 在聊天完成调用中设置工具'
- en: '#3 Ensures that the LLM knows it can choose any tool'
  id: totrans-167
  prefs: []
  type: TYPE_NORMAL
  zh: '#3 确保LLM知道它可以选择任何工具'
- en: '#4 If no tools, calls the LLM the standard way'
  id: totrans-168
  prefs: []
  type: TYPE_NORMAL
  zh: '#4 如果没有工具，则以标准方式调用LLM'
- en: '#5 Detects whether there were any tools used by the LLM'
  id: totrans-169
  prefs: []
  type: TYPE_NORMAL
  zh: '#5 检测LLM是否使用了任何工具'
- en: Executing the functions follows, as shown in listing 7.14\. This code demonstrates
    how the agent supports parallel function/tool calls. These calls are parallel
    because the agent executes each one together and in no order. In chapter 11, we’ll
    look at planners that allow actions to be called in ordered sequences.
  id: totrans-170
  prefs: []
  type: TYPE_NORMAL
  zh: 执行的函数如下所示，如列表7.14所示。此代码演示了代理如何支持并行函数/工具调用。这些调用是并行的，因为代理一起执行每个调用，并且没有顺序。在第11章中，我们将探讨允许按顺序调用动作的计划者。
- en: 'Listing 7.14 `oai_agent.py` (`get_response_stream`: execute tool calls)'
  id: totrans-171
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 列表7.14 `oai_agent.py` (`get_response_stream`：执行工具调用）
- en: '[PRE13]'
  id: totrans-172
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: '#1 Proceeds if tool calls are detected in the LLM response'
  id: totrans-173
  prefs: []
  type: TYPE_NORMAL
  zh: '#1 如果检测到LLM响应中的工具调用，则继续进行'
- en: '#2 Loads pointers to the actual function implementations for code execution'
  id: totrans-174
  prefs: []
  type: TYPE_NORMAL
  zh: '#2 加载指向实际函数实现的指针以执行代码'
- en: '#3 Loops through all the calls the LLM wants to call; there can be several.'
  id: totrans-175
  prefs: []
  type: TYPE_NORMAL
  zh: '#3 遍历LLM想要调用的所有调用；可能有多个。'
- en: '#4 Performs a second LLM call with the results of the tool calls'
  id: totrans-176
  prefs: []
  type: TYPE_NORMAL
  zh: '#4 使用工具调用的结果执行第二次LLM调用'
- en: To demo this, start up Nexus in the debugger by pressing F5\. Then, select the
    two test actions—`recommend` and `get_current_weather`—and the terse persona/profile
    Olly. Figure 7.9 shows the result of entering a query and the agent responding
    by using both tools in its response.
  id: totrans-177
  prefs: []
  type: TYPE_NORMAL
  zh: 为了演示这一点，通过按F5启动Nexus的调试器。然后，选择两个测试动作—`recommend`和`get_current_weather`—以及简短的个性/配置文件Olly。图7.9显示了输入查询的结果，代理通过在其响应中使用这两个工具进行响应。
- en: '![figure](../Images/7-9.png)'
  id: totrans-178
  prefs: []
  type: TYPE_IMG
  zh: '![图](../Images/7-9.png)'
- en: Figure 7.9 How the agent can use tools in parallel and respond with a single
    response
  id: totrans-179
  prefs:
  - PREF_H5
  type: TYPE_NORMAL
  zh: 图7.9 代理如何并行使用工具并使用单个响应进行响应
- en: If you need to review how these agent actions work in more detail, refer to
    chapter 5\. The underlying code is more complex and out of the scope of review
    here. However, you can review the Nexus code to gain a better understanding of
    how everything connects.
  id: totrans-180
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你需要更详细地审查这些代理动作的工作方式，请参阅第5章。底层代码更复杂，超出了此处审查的范围。然而，你可以审查Nexus代码，以更好地理解一切是如何连接的。
- en: Now, you can continue exercising the various agent options within Nexus. Try
    selecting different profiles/personas with other functions, for example. In the
    next chapter, we unveil how agents can consume external memory and knowledge using
    patterns such as Retrieval Augmented Generation (RAG).
  id: totrans-181
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，你可以在Nexus中继续练习各种代理选项。尝试选择不同的配置文件/角色与其他功能一起使用，例如。在下一章中，我们将揭示代理如何使用检索增强生成（RAG）等模式消耗外部记忆和知识。
- en: 7.6 Exercises
  id: totrans-182
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 7.6 练习
- en: 'Use the following exercises to improve your knowledge of the material:'
  id: totrans-183
  prefs: []
  type: TYPE_NORMAL
  zh: 使用以下练习来提高你对材料的了解：
- en: '*Exercise 1*—Explore Streamlit Basics (Easy)'
  id: totrans-184
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*练习1*—探索Streamlit基础（简单）'
- en: '*Objective *—Gain familiarity with Streamlit by creating a simple web application
    that displays text input by the user.'
  id: totrans-185
  prefs: []
  type: TYPE_NORMAL
  zh: '*目标*—通过创建一个显示用户输入文本的简单Web应用程序来熟悉Streamlit。'
- en: '*Tasks:*'
  id: totrans-186
  prefs: []
  type: TYPE_NORMAL
  zh: '*任务*：'
- en: Follow the Streamlit documentation to set up a basic application.
  id: totrans-187
  prefs:
  - PREF_UL
  - PREF_UL
  type: TYPE_NORMAL
  zh: 按照Streamlit文档设置基本应用程序。
- en: Add a text input and a button. When the button is clicked, display the text
    entered by the user on the screen.
  id: totrans-188
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 添加一个文本输入和一个按钮。当按钮被点击时，在屏幕上显示用户输入的文本。
- en: '*Exercise 2*—Create a Basic Agent Profile'
  id: totrans-189
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*练习2*—创建基本代理配置文件'
- en: '*Objective *—Understand the process of creating and applying agent profiles
    in Nexus.'
  id: totrans-190
  prefs: []
  type: TYPE_NORMAL
  zh: '*目标*—理解在Nexus中创建和应用代理配置文件的过程。'
- en: '*Tasks:*'
  id: totrans-191
  prefs: []
  type: TYPE_NORMAL
  zh: '*任务*：'
- en: Create a new agent profile with a unique persona. This persona should have a
    specific theme or characteristic (e.g., a historian).
  id: totrans-192
  prefs:
  - PREF_UL
  - PREF_UL
  type: TYPE_NORMAL
  zh: 创建一个新的代理配置文件，具有独特的角色。这个角色应该有一个特定的主题或特征（例如，历史学家）。
- en: Define a basic set of responses that align with this persona.
  id: totrans-193
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 定义一组与该角色相符的基本响应。
- en: Test the persona by interacting with it through the Nexus interface.
  id: totrans-194
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 通过Nexus界面与之交互来测试这个角色。
- en: '*Exercise 3*—Develop a Custom Action'
  id: totrans-195
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*练习3*—开发自定义动作'
- en: '*Objective *—Learn to extend the functionality of Nexus by developing a custom
    action.'
  id: totrans-196
  prefs: []
  type: TYPE_NORMAL
  zh: '*目标*—通过开发自定义动作来学习扩展Nexus的功能。'
- en: '*Tasks:*'
  id: totrans-197
  prefs: []
  type: TYPE_NORMAL
  zh: '*任务*：'
- en: Develop a new action (e.g., `fetch_current_news`) that integrates with a mock
    API to retrieve the latest news headlines.
  id: totrans-198
  prefs:
  - PREF_UL
  - PREF_UL
  type: TYPE_NORMAL
  zh: 开发一个新的动作（例如，`fetch_current_news`），该动作与模拟API集成以检索最新的新闻标题。
- en: Implement this action as both a native (code) function and a semantic (prompt-based)
    function.
  id: totrans-199
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 将此动作作为本地（代码）函数和语义（基于提示）函数实现。
- en: Test the action in the Nexus environment to ensure it works as expected.
  id: totrans-200
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在 Nexus 环境中测试动作，以确保其按预期工作。
- en: '*Exercise 4 —*Integrate a Third-Party API'
  id: totrans-201
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*练习 4 —* 集成第三方 API'
- en: '*Objective *—Enhance the capabilities of a Nexus agent by integrating a real
    third-party API.'
  id: totrans-202
  prefs: []
  type: TYPE_NORMAL
  zh: '*目标* — 通过集成真实的第三方 API 来增强 Nexus 代理的功能。'
- en: '*Tasks:*'
  id: totrans-203
  prefs: []
  type: TYPE_NORMAL
  zh: '*任务：*'
- en: Choose a public API (e.g., weather or news API), and create a new action that
    fetches data from this API.
  id: totrans-204
  prefs:
  - PREF_UL
  - PREF_UL
  type: TYPE_NORMAL
  zh: 选择一个公共 API（例如，天气或新闻 API），并创建一个新的动作，从该 API 获取数据。
- en: Incorporate error handling and ensure that the agent can gracefully handle API
    failures or unexpected responses.
  id: totrans-205
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 集成错误处理，并确保代理能够优雅地处理 API 失败或意外响应。
- en: Test the integration thoroughly within Nexus.
  id: totrans-206
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在 Nexus 中彻底测试集成。
- en: Summary
  id: totrans-207
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 摘要
- en: Nexus is an open source agent development platform used in conjunction with
    this book. It’s designed to develop, test, and host AI agents and is built on
    Streamlit for creating interactive dashboards and chat interfaces.
  id: totrans-208
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Nexus 是一个开源代理开发平台，与本书一起使用。它旨在开发、测试和托管 AI 代理，并基于 Streamlit 创建交互式仪表板和聊天界面。
- en: Streamlit, a Python web application framework, enables the rapid development
    of user-friendly dashboards and chat applications. This framework facilitates
    the exploration and interaction with various agent features in a streamlined manner.
  id: totrans-209
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Streamlit，一个 Python 网络应用程序框架，使快速开发用户友好的仪表板和聊天应用成为可能。这个框架简化了探索和与各种代理功能交互的方式。
- en: Nexus supports creating and customizing agent profiles and personas, allowing
    users to define their agents’ personalities and behaviors. These profiles dictate
    how agents interact with and respond to user inputs.
  id: totrans-210
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Nexus 支持创建和自定义代理配置文件和角色，使用户能够定义代理的性格和行为。这些配置文件决定了代理如何与用户输入交互和响应。
- en: The Nexus platform allows for developing and integrating semantic (prompt-based)
    and native (code-based) actions and tools within agents. This enables the creation
    of highly functional and responsive agents.
  id: totrans-211
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Nexus 平台允许在代理中开发和集成基于语义（基于提示）和本地（基于代码）的动作和工具。这使创建高度功能性和响应性代理成为可能。
- en: As an open source platform, Nexus is designed to be extensible, encouraging
    contributions and the addition of new features, tools, and agent capabilities
    by the community.
  id: totrans-212
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 作为开源平台，Nexus 被设计为可扩展的，鼓励社区贡献，并添加新的功能、工具和代理能力。
- en: Nexus is flexible, supporting various deployment options, including a web interface,
    API, and a Discord bot in future iterations, accommodating a wide range of development
    and testing needs.
  id: totrans-213
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Nexus 是灵活的，支持各种部署选项，包括未来的迭代中将包含的 Web 界面、API 和 Discord 机器人，以满足广泛的开发和测试需求。
