# 第五章：保护应用程序和软件供应链

在我们导航从 SCM（源代码管理）到持续集成和交付的交付过程中，我们已经在本书中提到了安全工具和实践。我们讨论了现代工具中的 RBAC（基于角色的访问控制）和 Policy-as-Code（PaC）治理如何帮助保护您的代码存储库和管道，并提到了在持续集成中早期安全测试的作用。我们研究了动态测试以揭示应用程序中的运行时漏洞。这仅仅是对安全的一个轻触。

在本章中，我们将把安全置于首位，并给予其在网络安全攻击频率和复杂性不断增长的世界中应有的关注。高调的数据泄露事件经常成为头条新闻，全球范围内的法规正在收紧，客户越来越根据安全态势评估供应商。

随着发布周期以天为单位而不是以月为单位，传统的安全作为生产前的最后一道关卡的模式已经不可行。相反，我们将负担“左移”到开发者身上，他们现在必须将安全实践整合到他们的日常工作中。那些不是安全专家的开发者现在承担着前所未有的安全责任。

人工智能承诺为这种紧张关系提供一些缓解。AI 驱动的安全工具正在提高检测准确性，大幅减少浪费开发者时间的误报，甚至可以自动生成修复代码。AI 不仅简单地将安全负担转移到左边，还帮助分担这一负担，为开发者提供专家级的安全指导，而无需他们自己成为安全专家。

本章将介绍向 AI 原生软件交付的演变如何改变了我们处理安全问题的方法——不是通过简单地添加更多工具或流程，而是通过从根本上改变我们识别、优先排序和修复安全问题的方法。我们将探讨保护软件供应链安全的重要性，这涉及到保护构建和交付软件的工具、流程和人员，从最初的代码到最终产品。由于现代软件严重依赖相互连接的组件，每个组件都可能存在恶意行为者可以利用的潜在漏洞，因此这是一个关键问题。

理解供应链担忧并学习以安全视角评估您的 SDLC（软件开发生命周期）将使您能够实施强有力的安全措施，并更好地保护您的应用程序、数据和您组织的声誉。

# 现代应用和网络安全威胁格局

构建和部署现代软件应用程序严重依赖于分布式和复杂的软件供应链。这些供应链通常包括庞大的代码库、开源依赖项、第三方组件、工件存储库和 CI/CD 管道。虽然这种互联性促进了创新并加速了我们的开发周期，但它也引入了安全风险。攻击面的扩大和漏洞在供应链中传播的潜在可能性使我们的软件供应链成为恶意行为者的主要目标。

在本节中，我们将探讨这些威胁，并了解监管合规框架如何演变以应对这些威胁。最后，我们将探讨新的合规要求如何影响您的组织。

## 软件供应链攻击日益增长的威胁

软件供应链包括所有参与创建和交付软件的人员、流程和工具。它涵盖了软件开发的完整生命周期，从最初的代码创建到部署和维护。它是一个复杂的生态系统，其中每个元素都在最终产品中扮演着至关重要的角色。

软件供应链由两个主要方面构成：应用程序和 DevOps 工具链，如图 5-1 所示。

![图片](img/ansd_0501.png)

###### 图 5-1. 软件供应链

### 软件供应链中的应用程序风险

“应用程序”在这里指的是您软件的所有元素，包括您的专有源代码；如库、框架和模块等开源依赖项；以及开发过程中产生的软件工件。

根据 Synopsys 发布的 2024 年开源安全和风险评估报告，96%的代码库包含开源组件。重要的是要记住，我们的组织有责任保护我们使用的开源组件，就像它们对内部开发的代码一样。由于开源的使用非常普遍，我们不应该对在应用程序中发现超过 80%的漏洞来自开源依赖项感到惊讶。2021 年在广泛使用的 Java 日志库 Log4j 中发现的一个漏洞就是一个开源引入的威胁的例子。这个漏洞允许攻击者通过向应用程序的日志发送一个特别定制的字符串来在受影响的系统上远程执行代码。由于 Log4j 在应用程序和服务中的广泛使用，这个漏洞的利用特别危险，导致大量抢修和缓解漏洞。

在广泛使用的 XZ Utils 数据压缩工具中发现后门提供了另一个例子。XZ Utils，像许多开源项目一样，由志愿者维护，他们资源有限，难以解决安全问题。发现一位受信任的贡献者实现了一个后门，这将允许攻击者获得使用该工具构建的软件运行的系统的管理员权限。这个实用程序存在于大多数 Linux 发行版中，幸运的是，在工具被广泛部署在生产系统之前就被发现了。

应用程序供应链中出现的另一个新兴威胁利用了 AI 编码助手的幻觉。当 AI 模型在包名上产生幻觉，推荐不存在的库或错误的包标识符时，他们为攻击者创造了机会。恶意行为者可以监控流行的 AI 编码助手以寻找这种幻觉，然后在公共存储库中注册这些幻觉的包名。当开发人员尝试使用这些不存在但 AI 推荐的包时，他们无意中安装了恶意代码。这种“幻觉占位”攻击向量已经在野外观察到，研究人员发现，常见的编码助手经常建议不存在的包。

### 软件供应链中的 DevOps 风险

DevOps 工具链包括用于自动化构建、测试和部署软件的一套工具和流程。这包括代码仓库、CI/CD 工具和管道、工件注册表以及其他工具，如 GitOps 和 IaCM 工具，这些工具简化了开发过程。

SolarWinds 黑客攻击是一个鲜明的例子，说明了受损害的 DevOps 工具链如何被利用来传播恶意代码。在这场复杂的攻击中，威胁行为者渗透了 SolarWinds Orion 软件构建系统，将恶意代码注入到合法的软件更新中。这些受污染的更新随后被分发给一万八千名 SolarWinds 客户，使攻击者获得了对他们的网络的广泛访问。这一事件突显了攻击者利用 DevOps 管道固有的信任和自动化来大规模分发恶意软件的潜力，将常规的软件更新转变为毁灭性的网络攻击。

2021 年的 Codecov 供应链黑客攻击是工具链安全漏洞的另一个例子，它影响了成千上万的组织。恶意行为者修改了 Codecov Bash Uploader 脚本（客户使用该工具上传代码覆盖率数据）。这种修改允许攻击者从 Codecov 客户的持续集成环境中窃取敏感信息，例如令牌、密钥和凭证。该漏洞在两个月后才被发现，可能暴露了客户持续集成环境中存储的敏感数据。

### 增长中的威胁

软件供应链攻击不会消失。[Gartner Research](https://oreil.ly/Uwphu)预测，到 2025 年，全球将有 45%的组织将经历过对其软件供应链的攻击。一行代码中的安全漏洞、第三方库或管道中的工具都可能产生连锁反应，损害整个软件产品。确保软件供应链安全不仅仅是保护单个组件，还要确保整个开发和交付过程的完整性和安全性。

## 适用于软件供应链的监管合规框架

鉴于日益增长的威胁，政府和监管机构已采取法规，旨在通过建立最佳实践、促进透明度和要求组织采取主动措施来保护其软件供应链来应对这些挑战。出现的一些最重要的合规和监管框架包括以下内容：

美国行政命令 14028，改善国家网络安全

这项于 2021 年发布的行政命令要求联邦机构和他们的软件供应商加强他们的软件供应链安全实践。它强调使用安全的软件开发实践、漏洞披露和事件响应。

欧洲联盟的网络和信息安全 2 号指令（NIS2 指令）

该指令旨在在整个欧盟建立一个高水平的网络安全。它包括关于软件供应链安全的条款，要求组织评估和管理与软件组件和第三方依赖相关的风险。

NIST SP 800-218，安全软件开发框架（SSDF）

这本国家标准与技术研究院出版物提供了将安全集成到 SDLC（软件开发生命周期）中的指导，包括供应链风险管理。它为安全的软件开发实践提供了一个全面的框架。

ISO/IEC 27036-2:2023

该标准为管理供应商和供应链相关的信息安全风险提供了指南。它涵盖了各种方面，包括供应商选择、合同管理和绩效监控。

支付卡行业数据安全标准（PCI DSS）

虽然 PCI DSS 并非仅关注软件供应链，但它要求处理支付卡数据的组织实施安全的软件开发实践，这包括管理供应链风险。

网络弹性法案（CRA）

这项拟议的欧盟法规旨在提高数字产品和服务的网络安全。它包括对漏洞处理、安全更新、软件物料清单（SBOM）和意识到漏洞后 24 小时内报告积极利用的漏洞的要求。

此外，质量系统法规（QSR）（21 CFR Part 820）和通用数据保护条例（GDPR）是规范软件实践、间接影响软件供应链问题的框架。QSR 要求严格的控制和流程，以确保医疗设备（包括软件组件）的安全性和有效性。这包括要求制造商验证和控制其设备中集成的软件。同样，GDPR 对保护个人数据的高要求需要组织实施强大的技术和组织措施，这可能扩展到软件及其供应链的安全，尤其是如果它处理个人数据的话。

这些框架和法规有助于构建更安全、更具弹性的软件生态系统，既有利于企业也有利于消费者。然而，这种增加的复杂性可能会影响开发团队。理解这些要求并将它们整合到你的流程中对于成功合规至关重要。

# 使用左移策略保障现代应用安全

面对高度激动的黑客，我们传统的等到最后的安全方法是不够的。这些措施不仅没有提供我们所需要的安全保护，而且传统的安全测试也减缓了软件的交付。为了保护现代应用，组织必须使用为现代 DevOps 工作流程设计的工具和实践。在本节中，我们将探讨组织在实施安全实践时面临的挑战。在第三章中，我们提到了左移安全，即在开发最早阶段实施安全实践的做法。我们将探讨如何使用这种方法来降低风险，以及实施左移安全和管理漏洞的开发者友好最佳实践。

## 开发者友好的左移安全需求

而不是等到软件开发周期的最后阶段才测试你应用程序的安全性，你必须积极地在每个可能阶段解决和测试安全相关问题。这种方法不仅通过避免后期对软件代码的大量重写节省了时间和精力，而且提高了最终产品的整体安全和效率。图 5-2 对比了左移安全方法与传统应用安全方法。

需要注意的是，有效的左移安全不仅仅是在交付流程中更早地进行安全测试。虽然这可能会帮助开发者避免在几天或几周后返回代码时出现的上下文切换成本，但最终并没有节省工作量。真正有效的实施需要选择能够无缝集成到您的 CI/CD 管道中的安全工具。这些工具不仅应识别漏洞，还应根据严重性进行优先排序并提供可操作见解。您选择的工具应规范和去重发现结果，以帮助开发者避免警报疲劳并专注于最关键的风险。这种集成方法确保安全在开发过程中绝对处于核心地位。

![动态应用程序安全测试](img/ansd_0502.png)

###### 图 5-2. 左移方法与传统测试方法的对比

## 应用程序安全扫描器

现在有许多扫描器和工具可用于进行安全测试和分析，其中许多现在都增强了人工智能功能。让我们来看看这些扫描器和工具最常见的类别：

软件组成分析（SCA）

这种扫描器通过分析软件物料清单（SBOMs）以检测库和框架中的已知漏洞来识别第三方组件和依赖项中的漏洞。我们将在本章后面讨论 SBOMs。SCA 工具在漏洞可能被触及或利用的可能性方面具有显著的机器学习能力。Snyk 是 SCA 扫描器的一个流行例子。

静态应用程序安全测试（SAST）

SAST 工具通过扫描代码以寻找表明漏洞的模式（如 SQL 注入、XSS 和缓冲区溢出）来分析源代码以查找潜在漏洞，而无需执行应用程序。人工智能正在增强 SAST 以减少误报率，节省工程师的时间。SonarQube、Checkmarx 和 Fortify 是 SAST 工具的例子。

容器扫描

这种扫描类型通过分析容器镜像的内容以查找已知漏洞和配置错误，从而识别容器镜像及其依赖项中的漏洞。

秘密检测扫描

这种扫描类型检测代码存储库和配置文件中的敏感信息，例如 API 密钥、密码和令牌。借助人工智能，秘密检测工具在检测隐藏的秘密以及区分实际凭据和测试数据方面变得更加出色，从而减少误报和相关的工作量。

动态应用程序安全测试

这种测试方法通过模拟外部攻击来分析运行中的应用程序，以识别漏洞。它像真实用户一样与应用程序交互，以检测注入漏洞、认证问题和配置错误等问题，而无需访问源代码。AI 增强的 DAST 工具基于应用程序行为生成测试用例，而不是使用固定模式。它们尝试自动验证其发现，以解决误报问题。

基础设施即代码扫描

这种类型的扫描在部署前分析 IaC 文件，以识别安全漏洞、配置错误和合规性问题。

这些类型的扫描器在软件开发管道的早期阶段就集成，符合左移方法。秘密扫描是一种推荐的安全实践，它自动识别并向用户警报代码库和其他数据源中的敏感信息。

这防止了敏感信息一开始就被纳入代码库。SCA 工具通常在代码提交后、构建前早期集成到管道中。SAST 扫描可以是构建阶段的一部分。容器扫描通常在构建容器镜像后、部署前进行集成。

通过在整个开发管道中整合 SCA、SAST、容器扫描、秘密扫描、DAST 和 IaC 扫描，您可以有效地实施左移安全策略，并主动保护您的应用程序免受漏洞的侵害。

您的测试工具识别的每个问题都必须进行分级。审查问题、确定其是否真实以及修复它都有成本。误报，即报告但并非真实的问题，是一个重大问题。它们浪费了审查者的时间，从其他安全努力和创新中消耗资源。此外，通过“狼来了”的方式，它们降低了工程师对安全发现的信任，并可能减慢对其他真实问题的响应时间。考虑到这一点，减少误报数量成为许多扫描工具中 AI 的关键优先事项。

由于涉及扫描器的数量增加，分级问题变得更加严重，这些扫描器可能会以不同的方式发现相同的问题。在一些组织中，甚至可能使用多个 SAST 工具对同一代码库进行扫描。在这些环境中，可能会使用安全测试编排层来去重和归一化发现结果，形成一个单一且可管理的列表。在原生 AI 环境中，AI/ML 在这里在模式匹配以及减少开发者工作量方面发挥作用。

将会在所有这些类型的扫描器中检测到问题，并需要修复。安全工具越来越多地提供通过专门的 AI 编码助手进行自动或半自动修复，以简化开发者的这一过程。

# 保护软件供应链安全

在本节中，我们将探讨当今软件供应链中固有的常见安全风险。我们将分析与代码仓库、CI/CD 管道、工件仓库、开源依赖项以及支撑你的软件开发流程的基础设施相关的风险。人工智能通过识别复杂供应链中的模式和异常，正在改变组织检测和应对这些风险的方式，这些模式和异常在规模上手动监控是不可能的。我们将探讨你可以使用的各种框架和基准来评估你的工具链的安全性。在本节结束时，你将更好地理解潜在威胁以及如何减轻它们。

现代软件供应链的复杂性为人工智能提供了一个理想的使用案例。人工智能系统可以持续监控存储库、构建系统和部署中的可疑模式。例如，机器学习模型可以检测到可能表明开发者账户被入侵的不寻常的提交模式，识别出可能表明供应链攻击的可疑包行为，或发现可能导致安全漏洞的配置漂移。这些人工智能能力为相互连接的组件提供了前所未有的可见性和保护。

## 识别顶级 CI/CD 安全风险

开放式全球应用程序安全项目（OWASP），一个专注于提高软件安全的领先组织，已经确定了顶级 10 CI/CD 安全风险。以下列表所示，威胁范围是多样化的。了解这些风险并实施推荐的缓解策略将有助于你确保并加强你的 CI/CD 生态系统。

不足的流程控制机制

CI/CD 管道中不足的流程控制机制可以被攻击者利用，攻击者可以访问你的管道。通过绕过必要的审查和批准，恶意代码或工件可以推送到管道中，可能达到生产环境并产生严重后果。

不充分的身份和访问管理

在各种系统中管理众多身份的复杂性，加上过度宽容账户的倾向，可能导致妥协。如果任何用户账户被入侵，攻击者可能会获得广泛的访问权限，可能达到生产环境。

依赖链滥用

依赖链滥用指的是利用你的开发和构建系统获取代码依赖项中的漏洞。这可能会发生当这些系统被欺骗以获取和执行恶意包而不是合法包时。攻击者通过发布与内部包同名（依赖混淆）的恶意包、劫持维护者账户（依赖劫持）或依赖打字错误（打字欺骗）来欺骗开发者下载他们的包。

毒化管道执行

这是一种网络攻击，恶意代码被注入到 CI/CD 管道中，通常是通过被破坏的源代码控制系统。然后，有毒代码可以在管道内执行，可能赋予攻击者与构建作业相同的访问和权限。攻击者可以操纵构建配置文件或其他管道依赖的文件，导致诸如凭证盗窃、数据泄露或恶意工件部署等行为。

缺乏基于管道的访问控制

当管道执行节点对资源有过度访问权限时，风险就会产生。攻击者可以利用这一点在管道内运行恶意代码，滥用管道授予的权限在 CI/CD 系统内部或外部横向移动。

缺乏凭证卫生

在凭证在多个系统和环境中广泛使用的环境中，缺乏凭证卫生是一个重大风险。例如，包含凭证的意外代码推送、构建和部署过程中的不安全使用、未轮换的凭证，以及凭证被打印到控制台输出或存储在容器镜像中。

不安全的系统配置

在典型的工具链中，由于有众多系统和供应商，不安全的系统配置是一个常见的漏洞。配置错误，如过时的软件、过于宽松的访问控制或默认设置不安全，可以轻易被攻击者利用以获得未经授权的访问、操纵 CI/CD 流程，甚至损害生产环境。

第三方服务的无管理使用

在 CI/CD 管道中的第三方服务，虽然方便且对开发有价值，但可以轻易地被授予对敏感资源的过度访问权限，从而有效地扩大了组织的攻击面。这种缺乏治理和可见性使得维护适当的访问控制变得困难，如果这些第三方服务中的任何一个被破坏，组织就会面临攻击的脆弱性。

不适当的工件完整性验证

由于软件交付涉及多个阶段和来源，恶意行为者可以潜在地篡改工件而不会引发警报。如果没有被发现，这些被破坏的工件可能会通过管道流动，最终部署到生产环境中，执行恶意代码并损害系统。

缺乏日志记录和可见性

没有强大的日志记录，你基本上对开发管道中发生的恶意活动视而不见，这使得及时检测和响应攻击变得困难。

理解这些风险并实施推荐的缓解策略是构建安全且具有弹性的 CI/CD 生态系统的关键。

## 识别顶级开源风险

OSS 依赖项的使用无处不在，因此组织必须应对它带来的安全和合规风险。我们之前提到了两个例子。在第一个例子中，Log4j 威胁影响了数千个系统。第二个例子，XZ Utils 的例子，虽然发现得早，但说明了恶意行为者如何通过破坏 OSS 组件来造成破坏。

常见漏洞和暴露（CVEs）是组织可以用来识别已知安全问题的机制之一，以便采取措施减轻这些问题。CVE 监控工具自动化了扫描您的软件并提醒您潜在风险的过程。虽然勤勉的监控可以帮助您从使用的 OSS 中消除已知威胁，但它并不能保证您的 OSS 组件真正安全。未维护的组件或过时的依赖项也会带来风险，因为 OSS 包引入了数十个依赖项，这些依赖项可能非常复杂，难以管理。

虽然 CVE 管理可以帮助对抗已知威胁，但还有其他类别的威胁需要应对。OWASP 基金会创建了一个以下前 10 名列表，以捕捉更全面的 OSS 风险范围，您的组织需要防范：

已知漏洞

一个开源组件可能包含公开披露的安全漏洞，通常通过 CVE 或其他渠道。如果这些漏洞在您的软件中可利用，可能会损害您系统的机密性、完整性和或可用性。

合法包的妥协

攻击者可能通过劫持账户或利用漏洞将恶意代码注入现有项目或分发基础设施中。这可能导致在最终用户或组织系统中执行代码，从而对机密性、完整性和可用性构成风险。

名称混淆攻击

名称混淆攻击涉及恶意行为者创建与合法组件名称非常相似的组件，目的是欺骗用户安装它们。这些攻击可能导致在用户和组织系统中执行有害代码，损害机密性、完整性和可用性。

未维护的软件

由于未维护的 OSS 组件不再积极开发或支持，因此可能没有新漏洞的补丁。这种情况可能导致下游开发者需要创建自己的补丁时，需要付出更多努力和更长的解决时间。

过时的软件

在项目中使用过时的软件组件可能会带来重大挑战。它可能会使紧急更新变得困难，尤其是在发现您正在使用的版本存在漏洞时。较老的版本也可能不如新版本那样彻底测试安全漏洞。

未跟踪的依赖项

未跟踪的依赖项可能在开发者不知情的情况下引入漏洞。这些依赖项可能由于 SBOM 不完整、SCA 工具功能有限或手动安装方法而被遗漏。

许可证风险

开源组件可能具有与预期用途不兼容的许可证，违反法律要求，或者根本就没有许可证。使用未许可的组件或未能遵守许可证条款可能导致法律后果。

软件不成熟

开源项目不成熟，缺乏最佳实践，如标准版本控制、测试或文档，可能会给您的软件带来运营风险。这种不成熟可能导致意外行为、增加的开发努力以及漏洞。

未经批准的更改

对软件组件的未经批准的更改可能导致软件构建的完整性和可重复性受损。

依赖项大小不合适

开源组件在大小和功能上可能存在显著差异，这可能导致安全风险。小型组件提供的基本功能有限，但由于它们依赖于上游项目，仍然可能引入重大风险。大型组件虽然可能提供更多功能，但由于未使用的功能和依赖项，攻击面可能更大。

在下一节中，我们将探讨一个框架——SLSA，它可以帮助解决这些风险。

# 通过软件工件供应链级别确保完整性

显然，开源软件的风险众多。在我们利用开源软件或任何第三方组件构建自己的软件之前，我们必须问：谁编写了此软件？它是使用我们信任的工具和平台构建和发布的吗？它带来了哪些依赖项？它是否符合我们重要的监管要求？

软件工件供应链级别（SLSA，发音为“salsa”）是一个框架，它提供了一种结构化的方法来回答这些问题。SLSA 设计用于增强整个软件供应链中软件工件的完整性。它提高了软件供应链的安全性，并有助于解决我们已探讨的开源软件威胁。

与实物证据的保管链类似，SLSA 强调在整个生命周期中跟踪和验证软件工件完整性的重要性。在本节中，我们将深入探讨 SLSA，并提供如何遵守其要求以保护您的软件免受潜在威胁的指导。

## SLSA 概述

SLSA 是由开源安全基金会推动的开源项目。它专注于实际实施和可衡量的安全改进，因此获得了广泛的认可。

SLSA 为开源软件和供应商提供的软件的提供者和消费者提供了好处。在您的组织中，您可以使用 SLSA 来帮助确保您的软件开发过程免受内部篡改。这确保了您部署到生产环境的代码正是您构建、测试并批准的代码。

对于软件消费者，SLSA 提供了验证开源软件（OSS）真实性和完整性的机制。包注册表能够使用 SLSA 来保证上传的 OSS 包是从合法仓库中的源构建的。作为一个开源软件消费者，从受信任的注册表中获取源可以确保你下载的包是有效的。此外，你可以要求你的供应商遵守 SLSA 原则。通过从信誉良好的第三方审计员那里验证供应商的 SLSA 认证可以提供额外的信心层。

[SLSA 定义了一个分层框架](https://oreil.ly/i7qar)，允许组织逐步提高其软件供应链的安全性。级别代表对篡改的保证和保护的提高程度。没有实施任何保护措施的组织被认为是第 0 级。

SLSA 第 1 级是基础。第 1 级要求产生基本来源信息。这些信息应详细说明构建过程，描述依赖关系，并给出源代码位置。第 1 级是组织开始其软件供应链安全之旅的起点。消费者可以使用这些信息来做出关于软件相关风险的决策。

第 2 级在第一级的基础上通过引入更严格的构建要求而建立。你的构建环境必须是隔离和受控的。此级别还强制要求对工件进行签名以验证完整性，防止篡改。

最后，第 3 级要求源代码来源和构建可重复性。来源必须可审计，其完整性必须得到保证。

表 5-1 总结了 SLSA 1.0 定义的三个级别的要求。

表 5-1\. SLSA 级别

| 实施者 | 要求 | 程度 | L1 | L2 | L3 |
| --- | --- | --- | --- | --- | --- |
| 生产者 | 选择合适的构建平台 |  | ✓ | ✓ | ✓ |
|  | 遵循一致的构建流程 |  | ✓ | ✓ | ✓ |
|  | 分发来源 |  | ✓ | ✓ | ✓ |
| 构建平台 | 生成来源存在 | 存在 | ✓ | ✓ | ✓ |
|  | 生成来源确保为真实 | 真实 |  | ✓ | ✓ |
|  | 生成来源不可伪造 | 不可伪造 |  |  | ✓ |
|  | 隔离强度 | 托管 |  | ✓ | ✓ |
|  | 隔离强度 | 隔离 |  |  | ✓ |

## 使用 SLSA 确保完整性

以下原则指导了 SLSA 框架的设计决策：

信任少数平台；关注工件

将信任扩展到少数核心平台，例如构建和打包工具，然后自动验证这些平台产生的工件。例如，你信任的构建平台为每个用于构建的工件生成并签名来源证明。下游平台随后验证由公钥签名的来源，以自动确定工件符合 SLSA 级别。

将软件追踪回源代码，而不是个人

在最终软件工件与其原始源代码之间建立直接和可验证的联系。这种方法与信任对包注册表具有写入访问权限的个人以及信任代码本身的不可变和可分析性质形成对比。通过建立直接联系，组织可以显著降低恶意代码注入或未经授权修改的风险。

优先考虑证明而不是推断

依靠对工件起源的直接证据，而不是根据对中间构建系统或其他系统的了解来推断工件的可靠性。SLSA 强制对工件起源的明确证明，而不是推断完整性。这需要工件构建过程的具体证据。

在 SLSA 1.0 中，构建平台对于确保工件完整性至关重要。*构建平台*用于指代负责编译、打包和准备软件以供分发的系统。一个强大的构建平台对于实现更高的 SLSA 级别至关重要。您选择的系统应支持隔离构建，这意味着对于每次构建，都会创建新的基础设施，构建运行后，该基础设施将被删除。此外，系统应强制执行非特权、容器化的持续集成步骤，不使用卷挂载。这符合 SLSA 规范，防止访问起源密钥信息。拥有加固的构建系统，您可以确保恶意行为者无法篡改您的构建。

除了选择一个可以保证工件完整性的构建平台外，您的系统还应生成和分发证明（数字签名记录），以证明您的软件符合您期望的 SLSA 构建级别。SLSA 证明的证明是提供关于软件工件起源和构建过程的可验证证据的加密签名。它们充当数字护照，确保工件的完整性和真实性。

考虑使用 CI/CD 管道构建的容器镜像。此镜像的 SLSA 证明的证明可能包括以下信息：

构建者

用于构建镜像的 CI/CD 平台（例如，GitHub Actions，GitLab CI/CD）

调用

用于创建镜像的特定构建配置或脚本

材料

在构建过程中使用的源代码存储库、依赖项和其他输入

主题

由其唯一的摘要（散列）标识的工件本身

签名

由受信任实体生成的加密签名，验证证明的完整性和真实性

为了验证 SLSA 证明的证明，组织可以使用像 SLSA Verifier Service 这样的工具。此服务验证证明的真实性，检查签名与受信任签名人公钥的匹配，并确保证明符合 SLSA 规范。

为了实现最大安全性，SLSA 建议构建平台而不是个人开发者生成来源。如果您的组织不使用构建平台，考虑采用具有 SLSA 支持的构建平台。对于第三方平台，检查其兼容性，并在需要时请求 SLSA 支持。如果您维护自己的构建平台，请添加 SLSA 来源生成功能。

同样，包生态系统应将 SLSA 来源与软件包一起分发，将证明嵌入到包中或作为单独的元数据文件提供。如果您的组织使用第三方生态系统，请了解 SLSA 支持情况并遵循他们的指南。对于直接分发，请将 SLSA 来源包含在您的包工件中。

通过利用 SLSA 来源证明，您的组织可以确信软件工件的真实性和完整性，并降低供应链攻击的风险。

### 超越 SLSA 增强供应链安全

虽然 SLSA 提供了一个出色的构建完整性框架，但它主要关注工件来源和构建系统完整性。为了解决 OWASP Top Ten CI/CD 风险中确定的供应链风险的全谱系，组织需要额外的安全措施。

一个全面的供应链安全策略应包括：

持续行为监控

由 AI 和 ML 驱动的现代交付和安全平台正在改进，以检测存储库、构建系统和部署管道中的异常活动。这些系统建立正常行为的基线，并标记可能表明妥协的偏差。像 Datadog CI 和 GitGuardian 这样的监控和安全工具现在是流行的选择。

高级依赖分析

除此之外，基本的漏洞扫描之外，智能分析工具可以评估包行为、代码模式和维护者活动趋势，以在公开报告之前识别潜在的恶意依赖项。AI 驱动的系统可以通过分析代码语义和行为来检测妥协的微妙迹象，这是传统扫描器无法做到的，有助于保护免受复杂的供应链攻击，如依赖混淆或打字错误。

自动化政策执行

在您的管道中实施自动化政策护栏，以强制执行超出构建完整性的安全要求。这些系统防止过度宽容的访问，阻止危险的配置，并确保适当的秘密管理——解决 SLSA 未完全涵盖的诸如 RBAC 不足和凭证卫生等风险。今天，在交付平台中广泛实施政策仍然做得不均匀。展望未来，这是一个强有力的方法，并且将受益于 AI，在适应不断变化的威胁方面变得更加灵活，以及在 PaC 场景中通过 AI 代码生成辅助快速创建政策。

供应链风险预测

预测分析和 AI 模型分析历史漏洞趋势和新兴威胁情报，突出供应链中潜在风险更高的组件，帮助团队在问题变得关键之前主动解决漏洞。通过分析数千个项目和依赖项的模式，这些系统在导致安全事件之前识别环境中的风险因素，从而实现脆弱区域的主动加固。

通过结合这些 AI 增强功能与 SLSA 的构建完整性重点，组织可以创建一种多层次防御方法，解决供应链风险的全面范围。这种综合策略不仅保护构建过程，还保护整个软件交付管道，从开发到部署。

### 解决 AI 生成的依赖项风险

随着组织越来越多地采用 AI 编码助手，一个新的供应链风险已经出现：AI 幻觉抢注。这发生在攻击者注册 AI 工具通过幻觉错误建议的包名时，为恶意代码注入提供了途径。

虽然核心 SLSA 框架提供了对传统供应链攻击的显著保护，但使用 AI 编码工具的组织应实施额外的安全措施：

验证注册策略

配置包管理器仅从官方审查过的注册表和已知良好的私有仓库中拉取。这防止开发人员意外地从不受信任的来源安装包，即使 AI 助手建议也是如此。

包的年龄和流行度检查

实施工具，自动验证推荐包的最低下载次数和既定历史指标。使用率极低的包应触发额外的审查。

AI 置信度验证

当使用提供推荐置信度分数的 AI 编码助手时，实施流程以标记置信度低的包建议，手动验证权威来源。

预安装验证

在开发环境中添加自动检查，在允许将依赖项添加到项目文件之前，验证包的存在和来源是否在受信任的仓库中。

这些额外的控制措施，与 SLSA 实践和全面的 SBOM 相结合，形成了一种多层次防御方法，可以抵御传统的供应链攻击和新兴的 AI 辅助威胁。通过解决 AI 引入的依赖项选择过程中的特定风险，组织可以在保持供应链完整性的同时安全地利用 AI 编码助手。除了 AI 置信度验证外，这些实践对其他基于包的攻击（如拼写欺骗）也有帮助。

# 使用软件物料清单解决零日漏洞

在第一部分，我们探讨了 Log4j 漏洞，攻击者通过利用日志消息中的特定模式远程执行任意代码，导致广泛的数据泄露、勒索软件攻击和关键服务的中断。这是一个零日漏洞的例子，这是最狡猾的威胁类型之一，因为它利用了软件供应商不知道的漏洞，在任何防御措施可以实施之前，给攻击者带来了显著的优势。在本节中，我们将探讨 SBOM 如何作为对抗此类漏洞的必要工具。SBOM 提供了软件工件中使用的所有组件和依赖关系的详细清单。我们将探讨 SBOM 的组成和特征，以及它们在整个软件开发生命周期（SDLC）中的管理方式。

尽管依赖关系管理工具和包管理器已经存在多年，用于跟踪和管理软件组件，但自 2018 年以来，SBOM 取得了显著的进步。包括国家电信和信息管理局（NTIA）多利益相关者流程在内的协作努力，为 SBOM 制定了最佳实践和建议。这项协作努力汇集了行业专家、政府机构和学术界人士，以定义 SBOM 生成、共享和消费的标准和指南。

因此，软件物料清单（SBOM）已成为关键构建块。事实上，[最近 Linux 基金会的研究](https://oreil.ly/aIlVL)发现，2022 年有 78%的组织正在生产或消费 SBOM，比前一年增长了 66%。

在为您的软件创建 SBOM 时，您有两个标准可供选择：

CycloneDX

CycloneDX 项目成为 SBOM 的领先标准，提供了一种机器可读的格式，用于表示软件组件、依赖关系及其关系。CycloneDX 得到了各种组织的广泛采用和支持。

SPDX

软件包数据交换（SPDX）是 SBOM 的另一个流行标准，由 Linux 基金会赞助，并在 ISO/IEC 5962 国际标准中得到规定。它提供了一个灵活且可扩展的格式，用于表示软件组件。SPDX 在开源社区中已经广泛使用多年。

SPDX 是一个更成熟的格式，具有更广泛的范围，不仅包括组件信息，还包括关于 SBOM 本身的元数据，例如其创建者和创建日期。它特别适合于管理开源软件许可证和共享有关软件包的信息。

CycloneDX 是一种较新的格式，它提供了一种更结构化和机器可读的方法，重点在于提供有关软件组件及其关系的详细信息。CycloneDX 由于其灵活性和适应性而常被首选，适用于广泛的用例。您的具体用例可能决定了您采用哪种标准；您为软件供应链安全管理选择的工具和流程应该能够支持这两种标准。

无论您选择哪种具体格式，用于评估 SBOM 质量的因素都是相同的。NTIA 已经制定了一套 SBOM 应包含的最小元素，以提供有关软件组件及其依赖关系的基本信息。确保这些元素的存在将促进在各个工具和平台之间有效分析 SBOMs，以及遵守底层的 SPDX 或 CycloneDX 规范。

通过提供组件的全面清单，SBOMs 提供了透明度和可追溯性，有助于确保符合您组织的网络安全政策和法律要求。PaC 框架可以利用 SBOMs 来自动化这一合规性。使用 PaC，您可以使用代码定义安全策略，这些策略可以像代码一样进行管理和版本控制。然后，这些策略可以应用于 SBOMs，确保软件组件遵守组织对开源的安全标准。自动合规性降低了人为错误的风险并提高了效率。

例如，您的组织可能定义一个策略，仅允许使用具有许可协议（例如，MIT、Apache License 2.0）的开源组件，以确保与组织的现有软件组合兼容，并避免潜在的法律问题。

您可以定义一个策略，自动拒绝具有已知漏洞且严重程度阈值以上的开源组件。或者，您可以建立评估开源供应商声誉和可信度的标准。这可能包括供应商规模、安全实践和社区参与等因素。

将 SBOMs 与 PaC 结合使用，创建了一个强大的治理开源使用、确保合规性和减轻安全风险的框架。自动化安全策略的执行减轻了安全团队的工作负担，并提高了整体效率。

# 使用 SBOMs 修复依赖项问题

在具有无数依赖项的复杂代码库中，定位和修复受影响的工件可能是一项艰巨的任务。遵循以下最佳实践可以帮助您的组织迅速应对零日漏洞和其他威胁：

保持 SBOMs 更新

确保 SBOMs 作为 CI/CD 流程的一部分自动生成。这确保了您始终拥有关于您组织支持的每个工件软件依赖关系的最新信息。

利用自动化漏洞扫描工具

使用自动化工具扫描您的 SBOMs 与漏洞数据库进行比对。这些工具可以及时识别您依赖项中的已知漏洞，让您能够优先处理修复工作，并应对潜在的安全威胁。

建立稳健的补丁管理流程

为您 SBOMs 中发现的漏洞制定一个明确的补丁流程。这包括为补丁设置优先级、与供应商协调以及部署前的补丁测试。通过维护一个最新且安全的软件供应链，您可以显著降低零日漏洞利用的风险。

人工智能显著增强了这些最佳实践。智能 SBOM 分析系统可以：

预测漏洞影响

AI 模型可以分析您的应用程序架构，以确定有漏洞的组件是否处于可利用的位置，区分理论上的漏洞和那些立即构成风险的情况。这种上下文分析有助于团队首先关注最关键的问题。

自动化依赖项更新

当发现漏洞时，AI 系统可以自动生成包含适当依赖项更新的 pull 请求，测试与您的代码库的兼容性，并管理多个存储库的更新过程。这种自动化大大缩短了从漏洞披露到修复的时间。

识别隐藏的依赖项

机器学习算法可以检测在包清单中未记录或间接的依赖项，提供您实际攻击面的更全面视图。

# 采用 DevSecOps 原则

我们在本章中看到了软件供应链是多么脆弱。以安全的方式持续交付软件需要不仅仅是仔细审查您使用的工具和第三方组件。它需要不仅仅是选择支持 SLSA 和生成 SBOMs 及证明的 CI/CD 工具和技术。为了确保一致的安全交付，您的团队必须维护一个安全平台，进行彻底的漏洞测试，及时优先处理和修复问题，防止不安全代码发布，遵守法规，并保证软件及其所有组件的完整性。

这不能是您团队中单个角色或组织内部单个团队的工作。它需要一个将安全集成到整个 SDLC 中的协作方法。这正是 DevSecOps 方法所倡导的。与在几个地方添加安全性的传统方法不同，DevSecOps 促进了开发、安全和运维团队之间的持续协作，确保安全从开始就被考虑在内。

在本节中，我们将解释 DevSecOps 原则，并展示采用这些原则如何帮助您更快地识别和修复漏洞，降低违规风险，并提高软件的整体安全性。

## 建立协作文化和打破职能壁垒

成功实施 DevSecOps 的第一步且最为关键的是建立一个以安全为首要考虑的协作文化。自然地，这可能是最困难的一步，需要你组织领导团队的全力支持。安全必须是组织的优先事项，并成为开发者、运维、安全团队以及其他人员共同承担的责任。

通过创建跨职能的 DevSecOps 团队，是一种简单的方法来打破壁垒并建立共享的所有感。孤立的团队可能会限制沟通和知识共享，这可能导致重复的工作和流程不一致。相反，跨职能的 DevSecOps 团队可以促进协作和开放沟通。例如，在建立新的安全实践或选择新的安全相关工具时，包括开发、运维和安全角色的观点，可以更容易地获得成功所需的承诺和对齐。

此外，跨职能团队可以帮助防止选择或推荐那些造成瓶颈和影响生产力的决策。一个例子就是单方面命令强制实施一些新的应用安全检查，而不考虑它们对开发过程的影响。这将导致开发者的工作量增加，这不仅会损害生产力，还会损害你组织内部的信任和善意。

除了创建跨职能团队外，你还应该在你组织内部识别并支持几位关键的安全倡导者，以帮助他们推广安全倡议并在同事中提高意识。利用你的跨职能团队和安全倡导者，通过建立开放和透明的沟通渠道来分享想法和沟通进度，以促进信息和思想的交流。这可以包括定期的会议、团队聊天和知识分享会。

人工智能工具作为安全团队和开发团队之间的协作桥梁，通过提供共享的上下文并在安全和开发关注点之间进行翻译。例如，当一个由人工智能驱动的安全工具识别出一个漏洞时，它可以以开发者友好的方式解释问题，同时提供安全团队所需的安全上下文。这种共享的理解减少了团队之间的摩擦，并帮助建立一个每个人都使用同一种语言的网络安全文化。

最后，投资于安全培训。识别技能差距，并为所有团队成员提供持续的安全培训，使他们具备识别和缓解安全风险的知识和技能。这不仅提高了整个团队的标准，也展示了你组织对安全作为优先事项的承诺。

## 采用并执行安全的编码方法和左移策略

安全编码实践对于防止漏洞至关重要。OWASP Top 10 和常见弱点枚举（CWE）为识别和解决常见安全漏洞提供了有用的指导。此外，确保您的方法定义解决了以下常见威胁：

输入验证

总是验证用户输入，以防止恶意数据注入到您的应用程序中。这有助于防止 SQL 注入、XSS 和其他注入攻击。

输出编码

正确编码输出以防止 XSS 攻击。这确保了用户生成的内容在页面上安全显示，而不允许恶意代码执行。

错误处理

实施强大的错误处理以防止信息泄露和潜在漏洞。避免显示可能为攻击者提供有价值信息的敏感错误消息。

会话管理

使用安全的会话管理技术来保护用户数据并防止未经授权的访问。这包括使用强大的会话标识符并实施超时。

身份验证和授权

实施强大的身份验证机制并执行适当的授权控制，以限制对敏感资源的访问。

密码学

使用安全的密码学算法和实践来保护敏感数据。避免使用弱加密方法，并确保适当的密钥管理。

依赖项管理

保持依赖项更新并安全地管理它们，以避免漏洞。使用依赖项扫描器等工具来识别和解决第三方库中已知漏洞。

虽然了解最新的威胁和安全的编码可以防止许多漏洞，但您的组织最佳的努力也可能不是万无一失的。静态和动态分析工具，以及早期安全测试，充当了后备，捕捉到可能在代码审查中被忽视的问题。这就是左移（shift-left）的作用所在。我们已经介绍了左移如何使您能够在早期阶段识别和解决漏洞。早期补救可以降低漏洞发布到生产代码中的风险。

# 摘要

在现代软件开发中，安全性不能是事后考虑的事情。它必须是整个开发过程中的一个组成部分。正如我们在本章中看到的，一种针对安全的 AI 原生方法会转变：

+   如何通过智能分析而不是仅静态规则来发现漏洞

+   如何根据实际风险而不是通用严重程度评级来优先处理发现的问题

+   如何实施补救措施，包括自动指导和代码生成

+   通过持续监控和异常检测来确保供应链的安全性

+   团队如何协作，在安全和开发之间共享上下文和理解

通过将安全性嵌入到从设计到部署的每个阶段，并通过培养由 AI 增强的共享责任文化，组织可以构建和交付能够抵御现代威胁的应用程序。

在第六章，我们将关注如何通过混沌测试来提高我们应用程序的弹性，以揭示可能被忽视的弱点。
